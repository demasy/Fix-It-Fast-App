/**
 * @license
 * Copyright (c) 2014, 2021, Oracle and/or its affiliates.
 * Licensed under The Universal Permissive License (UPL), Version 1.0
 * as shown at https://oss.oracle.com/licenses/upl/
 * @ignore
 */
define(["exports","ojs/ojdvt-toolkit"],function(e,t){"use strict";const i=function(e,t){var i=null,n=null!=t.getOptions().data;return e.categories&&e.categories.length>0?i=e.categories[0]:n||(i=e.id?e.id:e.text),i},n=function(e,t){var i=t.getOptions().hiddenCategories;return!(!i||i.length<=0)&&-1!==i.indexOf(e)},o=function(e,t){var i=t.getOptions();return"off"==e.expanded||0==e.expanded||i.expanded&&0==i.expanded.has(e.id)};var s=function(e,t,i,n,o,s){this.Init(e,t,i,n,o,s)};t.Obj.createSubclass(s,t.Obj),s.prototype.Init=function(e,n,o,s,r,a){if(this._legend=e,this._displayables=n,this._item=o,this._category=i(this._item,this._legend),this._id=this._category?this._category:o.title,this._drillable=a,this._tooltip=s,this._datatip=r,this._isShowingKeyboardFocusEffect=!1,this._hoverBorderRadius=parseInt(e.getOptions()._hoverBorderRadius),this._drillable)for(var l=0;l<this._displayables.length;l++)this._displayables[l].setCursor(t.SelectionEffectUtils.getSelectingCursor())},s.associate=function(e,t,i,n,o,r){if(!e||!i)return null;var a=new s(t,e,i,n,o,r);t.__registerObject(a);for(var l=0;l<e.length;l++)t.getEventManager().associate(e[l],a);return a},s.prototype.getData=function(){return this._item},s.prototype.getColor=function(){return this._item.color},s.prototype.getId=function(){return this._id},s.prototype.getDisplayables=function(){return this._displayables},s.prototype.getCategories=function(e){return null!=this._category?[this._category]:null},s.prototype.isDrillable=function(){return this._drillable},s.prototype.getAriaLabel=function(){var e=[],i=this._legend.getOptions().translations,s=this._legend.getOptions().hideAndShowBehavior,r=n(this._category,this._legend),a=this.getData();return this._displayables[0]instanceof t.IconButton?(e.push(i[o(a,this._legend)?"stateCollapsed":"stateExpanded"]),t.Displayable.generateAriaLabel(a.title,e)):("off"!=s&&"none"!=s&&e.push(i[r?"stateHidden":"stateVisible"]),this.isDrillable()&&e.push(i.stateDrillable),null!=a.shortDesc?t.Displayable.generateAriaLabel(a.shortDesc,e):e.length>0?t.Displayable.generateAriaLabel(a.text,e):null)},s.prototype.updateAriaLabel=function(){!t.Agent.deferAriaCreation()&&this._displayables[0]&&this._displayables[0].setAriaProperty("label",this.getAriaLabel())},s.prototype.getNextNavigable=function(e){if(e.type==t.MouseEvent.CLICK)return this;var i=this._legend.__getKeyboardObjects();return t.KeyboardHandler.getNextNavigable(this,e,i,!0,this._legend)},s.prototype.getKeyboardBoundingBox=function(e){return this._displayables[0]?this._displayables[0].getDimensions(e):new t.Rectangle(0,0,0,0)},s.prototype.getTargetElem=function(){return this._displayables[0]?this._displayables[0].getElem():null},s.prototype.showKeyboardFocusEffect=function(){this._isShowingKeyboardFocusEffect=!0,this._displayables[0]&&(this._displayables[0]instanceof t.IconButton?this._displayables[0].showKeyboardFocusEffect():this._displayables[0].setSolidStroke(t.Agent.getFocusColor()))},s.prototype.hideKeyboardFocusEffect=function(){this._isShowingKeyboardFocusEffect=!1,this._displayables[0]&&(this._displayables[0]instanceof t.IconButton?this._displayables[0].hideKeyboardFocusEffect():this._displayables[0].setStroke(null))},s.prototype.isShowingKeyboardFocusEffect=function(){return this._isShowingKeyboardFocusEffect},s.prototype.getTooltip=function(e){return this._tooltip},s.prototype.getDatatip=function(e){return this._datatip},s.prototype.getDatatipColor=function(e){return this._item.color},s.prototype.isDragAvailable=function(e){return!0},s.prototype.getDragTransferable=function(e,t){return[this.getId()]},s.prototype.getDragFeedback=function(e,t){return this.getDisplayables()},s.prototype.showHoverEffect=function(){this._displayables[0]&&(this._displayables[0]instanceof t.Rect&&this._displayables[0].setClassName("oj-legend-hover"),this._displayables[0].setRx(this._hoverBorderRadius))},s.prototype.hideHoverEffect=function(){this._displayables[0]&&this._displayables[0]instanceof t.Rect&&(this._displayables[0].setClassName(),this._displayables[0].setRx(0))};var r=function(e){this._legend=e,this._options=this._legend.getOptions()};t.Obj.createSubclass(r,t.Automation),r.prototype.GetSubIdForDomElement=function(e){var t=this._legend.getEventManager().GetLogicalObject(e);if(t&&t instanceof s){var i=t.getData(),n=this._getIndicesFromItem(i,this._options);if(n)return"section"+n}return null},r.prototype._getIndicesFromItem=function(e,t){if(t.sections&&t.sections.length>0){for(var i=0;i<t.sections.length;i++){if(t.sections[i]==e)return"["+i+"]";var n=this._getIndicesFromItem(e,t.sections[i]);if(n)return"["+i+"]"+n}return null}if(t.items&&t.items.length>0){for(var o=0;o<t.items.length;o++)if(t.items[o]==e)return":item["+o+"]";return null}},r.prototype.getIndicesFromSeries=function(e,t){if(t.sections&&t.sections.length>0){for(var i=0;i<t.sections.length;i++){var n=this.getIndicesFromSeries(e,t.sections[i]);if(n)return"["+i+"]"+n}return null}if(t.items&&t.items.length>0){for(var o=0;o<t.items.length;o++)if(t.items[o].text==e.name)return":item["+o+"]";return null}},r.prototype.getLegendItem=function(e,t){var i=t.indexOf("["),n=t.indexOf("]");if(i>=0&&n>=0){var o=t.substring(i+1,n),s=t.indexOf(":"),r=(t=t.substring(n+1)).indexOf("["),a=t.indexOf("]");return r>=0&&a>=0?this.getLegendItem(e.sections[o],t):0==s?e.items[o]:e.sections[o]}},r.prototype.getDomElementForSubId=function(e){if(e==t.Automation.TOOLTIP_SUBID)return this.GetTooltipElement(this._legend);for(var i=this.getLegendItem(this._options,e),n=this._legend.__getObjects(),o=0;o<n.length;o++){if(i==n[o].getData())return n[o].getDisplayables()[0].getElem()}return null},r.prototype.getTitle=function(){return this._options.title},r.prototype.getItem=function(e){var t,i=e.shift(),n=this._options;if(!n.sections||0===n.sections.length)return null;for(;null!=i;)e.length>0?n=n.sections[i]:t=n.items[i],i=e.shift();return t?{text:t.text?t.text:null}:null},r.prototype.getSection=function(e){var t,i=e.shift(),n=this._options;if(!n.sections||0===n.sections.length)return null;for(;null!=i;)e.length>0?n=n.sections[i]:t=n.sections[i],i=e.shift();return{title:t.title?t.title:null,items:t.items?this._generateItemObjects(t.items):null,sections:t.sections?this._generateSectionObjects(t.sections):null}},r.prototype._generateItemObjects=function(e){for(var t=[],i=0;i<e.length;i++)t.push({text:e[i].text});return t},r.prototype._generateSectionObjects=function(e){for(var t=[],i=0;i<e.length;i++)t.push({title:e[i].title?e[i].title:null,items:e[i].items?this._generateItemObjects(e[i].items):null,sections:e[i].sections?this._generateSectionObjects(e[i].sections):null});return t};var a=function(e){this.Init({alta:a.SKIN_ALTA},e)};t.Obj.createSubclass(a,t.BaseComponentDefaults),a.SKIN_ALTA={skin:t.CSSStyle.SKIN_ALTA,orientation:"vertical",position:null,backgroundColor:null,borderColor:null,textStyle:new t.CSSStyle(t.BaseComponentDefaults.FONT_FAMILY_ALTA_11+"color: #333333;"),titleStyle:new t.CSSStyle(t.BaseComponentDefaults.FONT_FAMILY_ALTA_11+"color: #737373;"),_sectionTitleStyle:new t.CSSStyle(t.BaseComponentDefaults.FONT_FAMILY_ALTA_11+"color: #737373;"),titleHalign:"start",hiddenCategories:[],hideAndShowBehavior:"off",hoverBehavior:"none",hoverBehaviorDelay:200,scrolling:"asNeeded",halign:"start",valign:"top",drilling:"off",dnd:{drag:{series:{}},drop:{legend:{}}},_color:"#a6acb1",_markerShape:"square",_lineWidth:3,layout:{outerGapWidth:3,outerGapHeight:3,titleGapWidth:17,titleGapHeight:9,symbolGapWidth:7,symbolGapHeight:4,rowGap:4,columnGap:10,sectionGapHeight:16,sectionGapWidth:24},isLayout:!1},a.getGapSize=function(e,i){var n=Math.min(t.TextUtils.getTextStringHeight(e.getCtx(),e.getOptions().textStyle)/14,1);return Math.ceil(i*n)},a.prototype.getNoCloneObject=function(e){return{sections:{items:{_getDataContext:!0}}}};var l=function(e){this.Init(e.getCtx(),e.processEvent,e,e),this._legend=e};t.Obj.createSubclass(l,t.EventManager),l.prototype.OnClick=function(e){l.superclass.OnClick.call(this,e);var t=this.GetLogicalObject(e.target);if(t){var i=this.processHideShowEvent(t),n=this.handleClick(t,e);(i||n)&&e.stopPropagation()}},l.prototype.OnMouseOver=function(e){l.superclass.OnMouseOver.call(this,e);var t=this.GetLogicalObject(e.target);t&&this.UpdateActiveElement(t)},l.prototype.HandleTouchClickInternal=function(e){var t=this.GetLogicalObject(e.target);if(t){var i=e.touchEvent,n=this.processHideShowEvent(t),o=this.handleClick(t,e);(n||o)&&i&&i.preventDefault()}},l.prototype.processHideShowEvent=function(e){var i=this._legend.getOptions().hideAndShowBehavior;if("none"==i||"off"==i)return!1;var o=e.getCategories?e.getCategories():null;if(!o||o.length<=0)return!1;var s=e.getCategories()[0],r=this._legend.getOptions().hiddenCategories||[];r=r.slice();for(var a=e.getDisplayables(),l=0;l<a.length;l++){var h=a[l];h instanceof t.SimpleMarker?h.setHollow(e.getColor()):h instanceof t.Rect&&e.updateAriaLabel()}var g,c=o[0];return n(s,this._legend)?(r.splice(r.indexOf(s),1),g=t.EventFactory.newCategoryShowEvent(c,r)):(r.push(s),g=t.EventFactory.newCategoryHideEvent(c,r)),this._legend.getOptions().hiddenCategories=r,this.FireEvent(g,this._legend),!0},l.prototype.handleClick=function(e,i){if(e instanceof s&&e.isDrillable()){var n=e.getId();return this.FireEvent(t.EventFactory.newDrillEvent(n),this._legend),!0}var o=e instanceof t.SimpleObjPeer?e.getParams():null;return!(!o||!o.isCollapsible)&&(this.toggleSectionCollapse(i,o.id),!0)},l.prototype.ProcessRolloverEvent=function(e,i,n){var o=this._legend.getOptions();if(("none"!==o.hoverBehavior||"none"!==o.hideAndShowBehavior&&"off"!==o.hideAndShowBehavior)&&!(i.getDisplayables&&i.getDisplayables()[0]instanceof t.IconButton)){if("none"!==o.hoverBehavior){var s=i.getCategories?i.getCategories():[];o.highlightedCategories=n&&s?s.slice():null;var r=t.EventFactory.newCategoryHighlightEvent(o.highlightedCategories,n),a=t.CSSStyle.getTimeMilliseconds(o.hoverBehaviorDelay);this.RolloverHandler.processEvent(r,this._legend.__getObjects(),a,!0)}"none"!==o.hideAndShowBehavior&&"off"!==o.hideAndShowBehavior&&(n?i.showHoverEffect&&i.showHoverEffect():i.hideHoverEffect&&i.hideHoverEffect())}},l.prototype.onCollapseButtonClick=function(e,t){var i=t.getId();this.toggleSectionCollapse(e,i)},l.prototype.toggleSectionCollapse=function(e,i){for(var n=this._legend.getOptions(),o=n.expanded,s=this._legend.getOptions(),r=null,a=0;a<i.length;a++)s=s.sections[i[a]];if(o?o.has(s.id)?(n.expanded=o.delete([s.id]),r=!1):(n.expanded=o.add([s.id]),r=!0):s.expanded="off"==s.expanded?"on":"off",e.type==t.MouseEvent.CLICK){var l=this.GetLogicalObject(e.target);l.getNextNavigable&&this.setFocusObj(l.getNextNavigable(e))}var h=this._legend.getKeyboardFocus(),g=!!h&&h.isShowingKeyboardFocusEffect();if(this._legend.render(),h&&this._legend.setKeyboardFocus(h,g),this.hideTooltip(),null!=r){e=new t.EventFactory.newExpandCollapseEvent(r?"expand":"collapse",s.id,s,this._legend.getOptions()._widgetConstructor,n.expanded);this.FireEvent(e,this._legend)}},l.prototype.GetTouchResponse=function(){return this._legend.getOptions()._isScrollingLegend?t.EventManager.TOUCH_RESPONSE_TOUCH_HOLD:t.EventManager.TOUCH_RESPONSE_TOUCH_START},l.prototype.isDndSupported=function(){return!0},l.prototype.GetDragSourceType=function(e){var t=this.DragSource.getDragObject();return t instanceof s&&null!=t.getData()._getDataContext?"series":null},l.prototype.GetDragDataContexts=function(e){var i=this.DragSource.getDragObject();if(i instanceof s){var n=i.getData()._getDataContext();return e&&(n=t.JsonUtils.clone(n,null,{component:!0,componentElement:!0}),t.ToolkitUtils.cleanDragDataContext(n)),[n]}return[]},l.prototype.GetDropTargetType=function(e){var t=this._legend.stageToLocal(this.getCtx().pageToStageCoords(e.pageX,e.pageY)),i=this._legend.getOptions().dnd.drop,n=this._legend.__getBounds();return Object.keys(i.legend).length>0&&n.containsPoint(t.x,t.y)?"legend":null},l.prototype.GetDropEventPayload=function(e){return{}},l.prototype.ShowDropEffect=function(e){if("legend"==this.GetDropTargetType(e)){var t=this._legend.getOptions()._dropColor,i=this._legend.getCache().getFromCache("background");i&&(i.setSolidFill(t),i.setClassName("oj-active-drop"))}},l.prototype.ClearDropEffect=function(){var e=this._legend.getCache().getFromCache("background");if(e){var i=this._legend.getOptions().backgroundColor;i?e.setSolidFill(i):e.setInvisibleFill(),t.ToolkitUtils.removeClassName(e.getElem(),"oj-invalid-drop"),t.ToolkitUtils.removeClassName(e.getElem(),"oj-active-drop")}},l.prototype.ShowRejectedDropEffect=function(e){if("legend"==this.GetDropTargetType(e)){var t=this._legend.getCache().getFromCache("background");t&&t.setClassName("oj-invalid-drop")}};var h=function(e,t){this.Init(e,t)};t.Obj.createSubclass(h,t.KeyboardHandler),h.prototype.Init=function(e,t){h.superclass.Init.call(this,e),this._legend=t},h.prototype.processKeyDown=function(e){var i=e.keyCode,n=this._eventManager.getFocus(),o=n&&n.getDisplayables()[0]instanceof t.IconButton,s=null;if(null==n&&i==t.KeyboardEvent.TAB){var r=this._legend.__getKeyboardObjects();r.length>0&&(t.EventManager.consumeEvent(e),s=this.getDefaultNavigable(r))}else n&&(i==t.KeyboardEvent.TAB?(t.EventManager.consumeEvent(e),s=n):i==t.KeyboardEvent.ENTER||i==t.KeyboardEvent.SPACE?(i==t.KeyboardEvent.ENTER&&this._eventManager.handleClick(n,e),o?this._eventManager.onCollapseButtonClick(e,n.getDisplayables()[0]):this._eventManager.processHideShowEvent(n),t.EventManager.consumeEvent(e)):!o||i!=t.KeyboardEvent.LEFT_ARROW&&i!=t.KeyboardEvent.RIGHT_ARROW?s=h.superclass.processKeyDown.call(this,e):(this._eventManager.onCollapseButtonClick(e,n.getDisplayables()[0]),t.EventManager.consumeEvent(e)));return s&&this._legend.container.scrollIntoView(s.getDisplayables()[0]),s};var g=new Object;t.Obj.createSubclass(g,t.Obj),g._DEFAULT_LINE_WIDTH_WITH_MARKER=2,g._LINE_MARKER_SIZE_FACTOR=.6,g._DEFAULT_SYMBOL_SIZE=10,g._BUTTON_SIZE=12,g._FOCUS_GAP=2,g.render=function(e,i){var n=e.getOptions(),o=e.getCtx(),s=t.Agent.isRightToLeft(o);e.__setBounds(i),n.isLayout||g._renderBackground(e,i);var r="redwood"===o.getThemeBehavior()?"always":"asNeeded",l=new t.SimpleScrollableContainer(o,i.w,i.h,r),h=new t.Container(o);l.getScrollingPane().addChild(h),e.addChild(l),e.container=l;var c=a.getGapSize(e,n.layout.outerGapWidth),u=a.getGapSize(e,n.layout.outerGapHeight);if(i.x+=c,i.y+=u,i.w-=2*c,i.h-=2*u,i.w<=0||i.h<=0)return new t.Dimension(0,0);var p=g._renderContents(e,h,new t.Rectangle(i.x,i.y,i.w,i.h));if(0==p.w||0==p.h)return new t.Dimension(0,0);l.prepareContentPane(),p.h>i.h?(p.h=i.h,n._isScrollingLegend=!0):n._isScrollingLegend=!1;var d=0,f=0,_=null!=n.hAlign?n.hAlign:n.halign;"center"==_?d=i.x-p.x+(i.w-p.w)/2:"end"==_&&(d=s?i.x-p.x:i.x-p.x+i.w-p.w);var y=null!=n.vAlign?n.vAlign:n.valign;"middle"==y?f=i.y-p.y+(i.h-p.h)/2:"bottom"==y&&(f=i.y-p.y+i.h-p.h);var v=new t.Rectangle(p.x+d-c,p.y+f-u,p.w+2*c,p.h+2*u);if(n.isLayout)return v;(d||f)&&h.setTranslate(d,f);for(var b=e.__getTitles(),m=0;m<b.length;m++)t.LayoutUtils.align(p,b[m].halign,b[m].text,b[m].text.getDimensions().w);return v},g._renderContents=function(e,t,i){var n=e.getOptions();i=i.clone();var o=g._renderTitle(e,t,n.title,i,null,!0);if(o){var s=o.getDimensions(),r=a.getGapSize(e,n.layout.titleGapHeight);i.y+=s.h+r,i.h-=Math.floor(s.h+r)}var l=g._renderSections(e,t,n.sections,i,[]);return o?s.getUnion(l):l},g._renderBackground=function(e,i){var n=e.getOptions(),o=n.backgroundColor,s=n.borderColor,r=n.dnd?n.dnd.drop.legend:{},a=n.dnd?n.dnd.drag.series:{};if(o||s||Object.keys(r).length>0||Object.keys(a).length>0){var l=new t.Rect(e.getCtx(),i.x,i.y,i.w,i.h);o?l.setSolidFill(o):l.setInvisibleFill(),s&&(l.setSolidStroke(s),l.setPixelHinting(!0)),e.addChild(l),e.getCache().putToCache("background",l)}},g._renderTitle=function(e,i,n,o,s,r,a,l){var h=e.getOptions(),g=i.getCtx(),c=t.Agent.isRightToLeft(g);if(!n)return null;var u=new t.OutputText(g,n,o.x,o.y),p=h.titleStyle;if(s){var d=h._sectionTitleStyle.clone();p=s.titleStyle?d.merge(new t.CSSStyle(s.titleStyle)):d}if(u.setCSSStyle(p),t.TextUtils.fitText(u,o.w,1/0,i)){if(c&&u.setX(o.x+o.w-u.getDimensions().w),h.isLayout)i.removeChild(u);else{var f={id:a,button:l};if(f.isCollapsible=s&&("on"==s.collapsible||1==s.collapsible),e.getEventManager().associate(u,new t.SimpleObjPeer(u.getUntruncatedTextString(),null,null,f)),r){var _=s&&s.titleHalign?s.titleHalign:h.titleHalign;e.__registerTitle({text:u,halign:_})}}return u}return null},g._renderSections=function(e,i,n,s,r){if(!n||0==n.length)return new t.Rectangle(0,0,0,0);var l=e.getOptions();l.symbolWidth||l.symbolHeight?(l.symbolWidth?l.symbolHeight||(l.symbolHeight=l.symbolWidth):l.symbolWidth=l.symbolHeight,l.symbolWidth=parseInt(l.symbolWidth),l.symbolHeight=parseInt(l.symbolHeight)):(l.symbolWidth=g._DEFAULT_SYMBOL_SIZE,l.symbolHeight=g._DEFAULT_SYMBOL_SIZE);for(var h,c=a.getGapSize(e,l.layout.sectionGapHeight),u=a.getGapSize(e,l.layout.titleGapHeight),p=a.getGapSize(e,l.layout.sectionGapWidth),d=g._getRowHeight(e),f="vertical"!=l.orientation,_=null,y=s.clone(),v=0;v<n.length;v++){var b=r.concat([v]),m=o(n[v],e)?u:c;f?(h=g._renderHorizontalSection(e,i,n[v],y,d)).w>y.w?(y.w<s.w&&(s.y+=h.h+m,s.h-=h.h+m),h=h.w<=s.w?g._renderHorizontalSection(e,i,n[v],s,d):g._renderVerticalSection(e,i,n[v],s,d,b,!0),s.y+=h.h+m,s.h-=h.h+m,y=s.clone()):(y.w-=h.w+p,t.Agent.isRightToLeft(e.getCtx())||(y.x+=h.w+p)):(h=g._renderVerticalSection(e,i,n[v],s,d,b,!1),s.y+=h.h+m,s.h-=h.h+m),_=_?_.getUnion(h):h}return _},g._createButton=function(e,i,n,o,r,a,l,h,c,u,p){var d=t.ToolkitUtils.getIconStyle(e,o[r]),f=new t.IconButton(e,"borderless",{style:d,size:g._BUTTON_SIZE},null,c,u,p);f.setTranslate(a,l);var _=s.associate([f],i,n,h,null,!1);return f.setAriaRole("button"),_.updateAriaLabel(),f},g._renderVerticalSection=function(e,i,n,s,r,l,h){if(n){var c,u=e.getOptions(),p=a.getGapSize(e,u.layout.symbolGapWidth),d=a.getGapSize(e,u.layout.rowGap),f=a.getGapSize(e,u.layout.columnGap),_=e.getCtx(),y=t.Agent.isRightToLeft(_),v=null!=n.sections&&n.sections.length>0,b=null!=n.items&&n.items.length>0,m=s.clone();"off"!=u.scrolling&&(m.h=1/0);var C,S="on"==n.collapsible||1==n.collapsible;if(S){var x=y?m.x+m.w-g._BUTTON_SIZE:m.x;if(!u.isLayout){var O=o(n,e),w=O?"closed":"open",E=u.translations[O?"tooltipExpand":"tooltipCollapse"],T=e.getEventManager();C=g._createButton(_,e,n,u._resources,w,x,m.y,E,l,T.onCollapseButtonClick,T),i.addChild(C)}c=new t.Rectangle(x,m.y,g._BUTTON_SIZE,g._BUTTON_SIZE);var D=a.getGapSize(e,u.layout.symbolGapWidth);y||(m.x+=g._BUTTON_SIZE+D),m.w-=g._BUTTON_SIZE+D}var A=g._renderTitle(e,i,n.title,m,n,!S&&l.length<=1,l,C),I=A?A.getDimensions():new t.Rectangle(y?m.x+m.w:m.x,m.y,0,0),M=c?I.getUnion(c):I;if(!b&&!v||o(n,e))return M;if(M.h>0){var L=a.getGapSize(e,u.layout.titleGapHeight);m.y+=M.h+L,m.h-=M.h+L}if(v){var F=g._renderSections(e,i,n.sections,m,l);M=M.getUnion(F)}if(!b)return M;var R=g._calcColumns(e,m,r,n.items,h),G=R.numCols,k=R.numRows,H=R.width,B=m.y;if(0==k||0==G)return M;var N=k*(r+d)-d,j=Math.min(G*(H+f)-f,m.w),P=new t.Rectangle(y?m.x+m.w-j:m.x,m.y,j,N);if(M=M.getUnion(P),u.isLayout)return M;for(var U=H-u.symbolWidth-p,W=0,K=1,z=n.items.length,V=0;V<z;V++){var Z=n.items[V];if(g._createLegendItem(e,i,Z,m,U,r,V),m.y+=r+d,++W===k&&K!==G&&(m.y=B,m.w-=H+f,y||(m.x+=H+f),W=0,K++),W===k)break}return M}},g._renderHorizontalSection=function(e,i,n,o,s){if(n){var r=e.getOptions(),l=r.symbolWidth,h=a.getGapSize(e,r.layout.symbolGapWidth),c=a.getGapSize(e,r.layout.columnGap),u=a.getGapSize(e,r.layout.titleGapWidth),p=null!=n.items&&n.items.length>0,d=t.Agent.isRightToLeft(e.getCtx()),f=o.clone(),_=g._renderTitle(e,i,n.title,o,n,!1),y=_?_.getDimensions():new t.Rectangle(d?o.x+o.w:o.x,o.y,0,0);if(!p)return y;y.w>0&&(f.w-=y.w+u,d||(f.x+=y.w+u));var v,b,m,C=[],S=o.w-f.w,x=n.items.length;for(m=0;m<x;m++)v=n.items[m],S+=(b=Math.ceil(t.TextUtils.getTextStringWidth(e.getCtx(),v.text,r.textStyle)))+l+h+c,C.push(b);x>0&&(S-=c);var O,w=new t.Rectangle(d?o.x+o.w-S:o.x,o.y,S,Math.max(s,y.h));if(r.isLayout||S>o.w)return i.removeChild(_),w;if(_){e.getCache().putToCache("horizRowAlign",!0),e.getCache().putToCache("sectionRect",w);var E=_.getDimensions(),T=w.y+w.h/2-E.h/2-E.y;_.setTranslate(0,T)}for(m=0;m<x;m++)v=n.items[m],g._createLegendItem(e,i,v,f,C[m],s,m),O=C[m]+l+h,f.w-=O+c,d||(f.x+=O+c);return e.getCache().putToCache("horizRowAlign",!1),e.getCache().putToCache("sectionRect",null),w}},g._calcColumns=function(e,i,n,o,s){for(var r=e.getOptions(),l=[],h=0;h<o.length;h++)l.push(o[h].text);var g,c,u,p=t.TextUtils.getMaxTextStringWidth(e.getCtx(),l,r.textStyle),d=r.symbolWidth,f=a.getGapSize(e,r.layout.symbolGapWidth),_=a.getGapSize(e,r.layout.rowGap),y=a.getGapSize(e,r.layout.columnGap),v=Math.ceil(d+f+p);s?(u=Math.min(Math.max(Math.floor((i.w+y)/(v+y)),1),o.length),g=Math.min(Math.floor((i.h+_)/(n+_)),Math.ceil(o.length/u)),u=Math.ceil(o.length/g),g=Math.ceil(o.length/u)):i.h==1/0?(u=1,g=o.length):(g=Math.min(Math.floor((i.h+_)/(n+_)),o.length),u=Math.ceil(o.length/g),g=Math.ceil(o.length/u));var b=(i.w-y*(u-1))/u;return(c=Math.min(v,b))<d?{width:0,numCols:0,numRows:0}:{width:c,numCols:u,numRows:g}},g._getRowHeight=function(e){var i=e.getOptions(),n=t.TextUtils.getTextStringHeight(e.getCtx(),i.textStyle),o=i.symbolHeight+a.getGapSize(e,i.layout.symbolGapHeight);return Math.ceil(Math.max(n,o))},g._createLegendItem=function(e,o,r,l,h,c,u){var p,d=e.getOptions(),f=e.getCtx(),_=t.Agent.isRightToLeft(f),y=d.symbolWidth,v=a.getGapSize(e,d.layout.symbolGapWidth),b=_?l.x+l.w-y:l.x,m=_?l.x+l.w-y-v:l.x+y+v,C=g._createLegendSymbol(e,b,l.y,c,r,u),S=r.text;if(null!=S){var x=d.textStyle;(p=g._createLegendText(o,h,S,x))&&(p.setX(m),t.TextUtils.centerTextVertically(p,l.y+c/2),_&&p.alignRight());var O=e.getCache().getFromCache("sectionRect");if(e.getCache().getFromCache("horizRowAlign")&&O&&"vertical"!=d.orientation){var w=p.getDimensions().h,E=O.y+O.h/2-Math.max(d.symbolHeight,w)/2-l.y;C.setTranslate(0,E),p.setTranslate(0,E)}}o.addChild(C);var T=new t.Rect(f,_?m-h-g._FOCUS_GAP:b-g._FOCUS_GAP,l.y-g._FOCUS_GAP,y+v+h+2*g._FOCUS_GAP,c+2*g._FOCUS_GAP);T.setInvisibleFill();var D=d.hideAndShowBehavior;"none"!=D&&"off"!=D&&T.setCursor("pointer"),o.addChild(T);var A=[T,C];null!=p&&A.push(p);var I=s.associate(A,e,r,null!=p?p.getUntruncatedTextString():null,r.shortDesc,g._isItemDrillable(e,r));n(i(r,e),e)&&(C.setHollow(I.getColor()),C.setStyle().setClassName()),("none"!=D&&"off"!=D||null!=r.shortDesc)&&(T.setAriaRole("img"),I.updateAriaLabel())},g._isItemDrillable=function(e,t){return"on"==t.drilling||"off"!=t.drilling&&"on"==e.getOptions().drilling},g._createLegendText=function(e,i,n,o){var s=new t.OutputText(e.getCtx(),n);return s.setCSSStyle(o),s=t.TextUtils.fitText(s,i,1/0,e)?s:null},g._createLegendSymbol=function(e,o,s,r,a,l){var h=e.getOptions(),c=e.getCtx(),u=null!=a.type?a.type:a.symbolType;a.markerShape||(a.markerShape=h._markerShape),a.color||(a.color=h._color),a.lineWidth||(a.lineWidth="lineWithMarker"==u?g._DEFAULT_LINE_WIDTH_WITH_MARKER:h._lineWidth);var p,d=h.symbolWidth,f=h.symbolHeight,_=s+r/2,y=o+d/2;if("line"==u)p=g._createLine(c,o,s,d,r,a);else if("lineWithMarker"==u)p=g._createLine(c,o,s,d,r,a),n(i(a,e),e)||p.addChild(g._createMarker(e,y,_,d*g._LINE_MARKER_SIZE_FACTOR,f*g._LINE_MARKER_SIZE_FACTOR,a));else if("image"==u)p=g._createImage(e,o,s,d,f,r,a);else if("_verticalBoxPlot"==u)f=Math.max(4*Math.round(f/4),4),(p=new t.Container(c)).addChild(g._createMarker(e,y,_+f/4,d,f/2,g._getBoxPlotOptions(a,"q2"))),p.addChild(g._createMarker(e,y,_-f/4,d,f/2,g._getBoxPlotOptions(a,"q3")));else if("_horizontalBoxPlot"==u){var v=t.Agent.isRightToLeft(c),b=(d=Math.max(4*Math.round(d/4),4))/4*(v?1:-1);(p=new t.Container(c)).addChild(g._createMarker(e,y+b,_,d/2,f,g._getBoxPlotOptions(a,"q2"))),p.addChild(g._createMarker(e,y-b,_,d/2,f,g._getBoxPlotOptions(a,"q3")))}else p=g._createMarker(e,y,_,d,f,a);return p},g._createImage=function(e,i,n,o,s,r,a){var l=e.getCtx(),h=n+r/2,g=i+o/2;return new t.ImageMarker(l,g,h,o,s,null,a.source)},g._createMarker=function(e,i,n,o,s,r){var a,l=e.getCtx(),h=(e.getOptions(),r.markerShape),g=r.symbolType&&"lineWithMarker"==r.symbolType&&r.markerColor?r.markerColor:r.color,c=r.markerStyle||r.markerSvgStyle?r.markerStyle||r.markerSvgStyle:r.style||r.svgStyle,u=r.markerClassName||r.markerSvgClassName?r.markerClassName||r.markerSvgClassName:r.className||r.svgClassName,p=r.pattern;if(p&&"none"!=p?((a=new t.SimpleMarker(l,h,0,0,o,s,null,null,!0)).setFill(new t.PatternFill(p,g,"#FFFFFF")),a.setTranslate(i,n)):(a=new t.SimpleMarker(l,h,i,n,o,s,null,null,!0)).setSolidFill(g),r.borderColor){var d=r._borderWidth?r._borderWidth:1;a.setSolidStroke(r.borderColor,null,d)}return"square"!=h&&"rectangle"!=h||a.setPixelHinting(!0),a.setClassName(u).setStyle(c),a},g._createLine=function(e,i,n,o,s,r){var a=n+s/2;o=o%2==1?o+1:o;var l,h=new t.Line(e,i,Math.round(a),i+o,Math.round(a)),g=r.lineStyle;"dashed"==g?l={dashArray:"4,2,4"}:"dotted"==g&&(l={dashArray:"2"});var c=new t.Stroke(r.color,1,r.lineWidth,!1,l);return h.setClassName(r.className||r.svgClassName).setStyle(r.style||r.svgStyle),h.setStroke(c),h.setPixelHinting(!0),h},g._getBoxPlotOptions=function(e,t){return{markerShape:"rectangle",color:e._boxPlot[t+"Color"],pattern:e._boxPlot["_"+t+"Pattern"],className:e._boxPlot[t+"ClassName"]||e._boxPlot[t+"svgClassName"],style:e._boxPlot[t+"Style"]||e._boxPlot[t+"svgStyle"]}};const c=function(){};t.Obj.createSubclass(c,t.BaseComponent),c.newInstance=function(e,t,i){var n=new c;return n.Init(e,t,i),n},c.getDefaults=function(e){return(new a).getDefaults(e)},c.prototype.Init=function(e,t,i){c.superclass.Init.call(this,e,t,i),this.setId("legend1000"+Math.floor(1e9*Math.random())),this.Defaults=new a(e),this.EventManager=new l(this),this.EventManager.addListeners(this),this._peers=[],this._navigablePeers=[],this._bounds=null,this._titles=[]},c.prototype.SetOptions=function(e){this.getOptionsCache().clearCache(),e?(this.Options=this.Defaults.calcOptions(e),this._transferVisibilityProperties(this.Options.sections)):this.Options||(this.Options=this.GetDefaults())},c.prototype.getPreferredSize=function(e,i,n){this.SetOptions(e),this.getOptions().isLayout=!0;var o=new t.Rectangle(0,0,i,n),s=g.render(this,o);return this.getOptions().isLayout=!1,new t.Dimension(s.w,s.h)},c.prototype.render=function(e,i,n){this.getCache().clearCache(),this.SetOptions(e),isNaN(i)||isNaN(n)||(this.Width=i,this.Height=n),this.getOptions().isLayout=!1;for(var o=this.getNumChildren(),s=0;s<o;s++){this.getChildAt(s).destroy()}this.removeChildren(),this._peers=[],this._navigablePeers=[],this._bounds=null,this._titles=[],t.Agent.isTouchDevice()||this.EventManager.setKeyboardHandler(new h(this.EventManager,this)),this.UpdateAriaAttributes();var r=new t.Rectangle(0,0,this.Width,this.Height);this._contentDimensions=g.render(this,r);var a=this.getOptions().highlightedCategories;return a&&a.length>0&&this.highlight(a),this.RenderComplete(),this._contentDimensions},c.prototype.highlight=function(e){this.getOptions().highlightedCategories=e&&e.length>0?e.slice():null,t.CategoryRolloverHandler.highlight(e,this.__getObjects(),!0)},c.prototype.processEvent=function(e,i){if("categoryHighlight"==e.type&&"dim"==this.getOptions().hoverBehavior){var n=this.__getObjects();this!=i&&this.highlight(e.categories);for(var o=0;o<n.length;o++)if(t.Obj.compareValues(this.getCtx(),n[o].getId(),e.categories)){this.container.scrollIntoView(n[o].getDisplayables()[0]);break}}this==i&&this.dispatchEvent(e)},c.prototype.__registerObject=function(e){if(e.getDisplayables()[0]instanceof t.IconButton)this._navigablePeers.push(e);else{var i=this.getOptions().hideAndShowBehavior;(null!=e.getDatatip()||e.isDrillable()||"none"!=i&&"off"!=i)&&this._navigablePeers.push(e),this._peers.push(e)}},c.prototype.__getObjects=function(){return this._peers},c.prototype.__getKeyboardObjects=function(){return this._navigablePeers},c.prototype.__setBounds=function(e){this._bounds=e.clone()},c.prototype.__getBounds=function(){return this._bounds},c.prototype.__registerTitle=function(e){this._titles.push(e)},c.prototype.__getTitles=function(){return this._titles},c.prototype.getAutomation=function(){return new r(this)},c.prototype.getKeyboardFocus=function(){return null!=this.EventManager?this.EventManager.getFocus():null},c.prototype.setKeyboardFocus=function(e,i){if(null!=this.EventManager){for(var n=this.__getKeyboardObjects(),o=0;o<n.length;o++)if(t.Obj.compareValues(this.getCtx(),n[o].getId(),e.getId())){this.EventManager.setFocusObj(n[o]),i&&n[o].showKeyboardFocusEffect();break}var s=this.getKeyboardFocus();if(s){var r=s.getDisplayables()[0];r.setAriaProperty("label",s.getAriaLabel()),this.getCtx().setActiveElement(r)}}},c.prototype.getDimensions=function(e){var i=new t.Rectangle(0,0,this.Width,this.Height);return e&&e!==this?this.ConvertCoordSpaceRect(i,e):i},c.prototype.getContentDimensions=function(e){return e&&e!==this?this.ConvertCoordSpaceRect(this._contentDimensions,e):this._contentDimensions},c.prototype._transferVisibilityProperties=function(e){if(e&&!(e.length<=0))for(var t=this.getOptions().hiddenCategories,n=0;n<e.length;n++){var o=e[n];o.sections&&this._transferVisibilityProperties(o.sections);var s=o.items;if(s&&!(s.length<=0))for(var r=0;r<s.length;r++){var a=s[r],l=i(a,this);"hidden"==a.categoryVisibility&&t.indexOf(l)<0&&t.push(l),a.categoryVisibility=null}}},c.prototype.UpdateAriaAttributes=function(){if(this.IsParentRoot()){var e=this.getOptions(),i=e.translations,n=e.hideAndShowBehavior;("off"!=n&&"none"!=n||"dim"==e.hoverBehavior)&&(this.getCtx().setAriaRole("application"),this.getCtx().setAriaLabel(t.ResourceUtils.format(i.labelAndValue,[i.labelDataVisualization,t.AriaUtils.processAriaLabel(this.GetComponentDescription())])))}},c.prototype.isNavigable=function(){return this._navigablePeers.length>0},c.getItemCount=function(e){var t=e.getOptionsCache().getFromCache("itemsCount");if(null!=t)return t;t=0;for(var i=e.getOptions().sections,n=0;n<i.length;n++){var o=i[n];t+=c.getSectionItemsCount(o)}return e.getOptionsCache().putToCache("itemsCount",t),t},c.getSectionItemsCount=function(e){var t=0;if(e.items&&(t+=e.items.length),e.sections)for(var i=e.sections,n=0;n<i.length;n++)t+=c.getSectionItemsCount(i[n]);return t},e.Legend=c,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ojlegend-toolkit.js.map