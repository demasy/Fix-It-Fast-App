/**
 * @license
 * Copyright (c) 2014, 2021, Oracle and/or its affiliates.
 * Licensed under The Universal Permissive License (UPL), Version 1.0
 * as shown at https://oss.oracle.com/licenses/upl/
 * @ignore
 */
define(["exports","ojs/ojeventtarget"],function(t,e){"use strict";
/**
     * @preserve Copyright 2013 jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     */class s{constructor(t,e){this.treeDataProvider=t,this.options=e,this.SuppressNodeTreeAsyncIterable=class{constructor(t,e){this._parent=t,this._asyncIterator=e,this[Symbol.asyncIterator]=()=>new this._parent.SuppressNodeTreeAsyncIterator(this._parent,this._asyncIterator)}},this.SuppressNodeTreeAsyncIterator=class{constructor(t,e){this._parent=t,this._baseIterator=e}_fetchNext(){return this._baseIterator.next()}next(){return this._fetchNext().then(t=>this._parent._suppressNodeIfEmptyChildrenFirst(t))}},this.AsyncIteratorYieldResult=class{constructor(t){this.value=t,this.done=!1}},this.AsyncIteratorReturnResult=class{constructor(t){this.value=t,this.done=!0}},this.FetchListResult=class{constructor(t,e,s){this.fetchParameters=t,this.data=e,this.metadata=s}},this.FetchByOffsetResults=class{constructor(t,e,s){this.fetchParameters=t,this.results=e,this.done=s}},this.Item=class{constructor(t,e){this.metadata=t,this.data=e}}}containsKeys(t){return this.treeDataProvider.containsKeys(t)}getCapability(t){return this.treeDataProvider.getCapability(t)}getTotalSize(){return this.treeDataProvider.getTotalSize()}isEmpty(){return this.treeDataProvider.isEmpty()}createOptimizedKeySet(t){return this.treeDataProvider.createOptimizedKeySet(t)}createOptimizedKeyMap(t){return this.treeDataProvider.createOptimizedKeyMap(t)}getChildDataProvider(t){const e=this.treeDataProvider.getChildDataProvider(t);return null===e?null:new s(e,this.options)}fetchFirst(t){const e=this.treeDataProvider.fetchFirst(t);return new this.SuppressNodeTreeAsyncIterable(this,e[Symbol.asyncIterator]())}fetchByOffset(t){return this.treeDataProvider.fetchByOffset(t).then(t=>this._suppressNodeIfEmptyChildrenByOffset(t))}fetchByKeys(t){return this.treeDataProvider.fetchByKeys(t)}_suppressNodeIfEmptyChildrenByOffset(t){if(t.results&&this.options&&"ifEmptyChildren"==this.options.suppressNode){const e=[],s=[];return new Promise(r=>{for(let e=0;e<t.results.length;e++){const r=t.results[e];s[e]=this._suppressChild(r.metadata.key,t.fetchParameters?t.fetchParameters.filterCriterion:null)}return Promise.all(s).then(s=>{for(let r=0;r<s.length;r++)!1===s[r]&&e.push(new this.Item(t.results[r].metadata,t.results[r].data));return r(e)})}).then(e=>new this.FetchByOffsetResults(t.fetchParameters,e,t.done))}return Promise.resolve(t)}_suppressNodeIfEmptyChildrenFirst(t){const e=[];if(!t.done&&this.options&&"ifEmptyChildren"==this.options.suppressNode){return new Promise(s=>{if(t&&t.value&&t.value.data){const r=t.value.metadata,a=t.value.data,i=[];for(let s=0;r&&s<r.length;s++)e[s]=this._suppressChild(r[s].key,t.value.fetchParameters?t.value.fetchParameters.filterCriterion:null);return Promise.all(e).then(t=>{for(let e=0;e<t.length;e++)!1===t[e]&&i.push({data:a[e],metadata:r[e]});return s(i)})}return{data:t.value.data,metadata:t.value.metadata}}).then(e=>{const s=[],r=[];for(const t of e)s.push(t.data),r.push(t.metadata);return new this.AsyncIteratorYieldResult(new this.FetchListResult(t.value.fetchParameters,s,r))})}return Promise.resolve(t)}_suppressChild(t,e){const s=this.getChildDataProvider(t);return null==s||"yes"===s.isEmpty()?Promise.resolve(null!==s):e?s.fetchByOffset({offset:0,filterCriterion:e}).then(t=>!(t&&t.results&&t.results.length>0)):Promise.resolve(!1)}}e.EventTargetMixin.applyMixin(s),t.SuppressNodeTreeDataProvider=s,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=ojsuppressnodetreedataprovider.js.map