/**
 * @license
 * Copyright (c) 2014, 2021, Oracle and/or its affiliates.
 * Licensed under The Universal Permissive License (UPL), Version 1.0
 * as shown at https://oss.oracle.com/licenses/upl/
 * @ignore
 */
define(["exports","ojs/ojdomutils","ojs/ojlistdataproviderview","ojs/ojcore-base","ojs/ojconfig","ojs/ojcontext","ojs/ojlogger","ojs/ojthemeutils","ojs/ojtimerutils","ojs/ojtranslation","preact","ojs/ojhighlighttext","ojs/ojvcomponent","ojs/ojpopupcore"],function(t,e,o,s,i,n,a,l,r,d,u,h,p,c){"use strict";s=s&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s,n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n;class g extends u.Component{constructor(t){super(t)}render(t){return u.h("li",{role:"presentation",class:"oj-listbox-result",style:t.itemStyle},u.h("div",{class:"oj-listbox-result-label oj-listbox-skeleton-line-height oj-animation-skeleton"}))}}g.defaultProps={itemStyle:null};class _ extends u.Component{constructor(t){super(t)}render(t){const e=[];for(let o=0;o<t.numItems;o++)e.push(u.h(g,{itemStyle:t.itemStyle}));return u.h("ul",{role:"listbox",id:t.id,class:"oj-listbox-results oj-inputsearch-results"},e)}}_.defaultProps={id:null,numItems:1,itemStyle:null};class f extends u.Component{constructor(t){super(t),this._handleMouseenter=t=>{e.recentTouchEnd()||this.setState({hover:!0})},this._handleMouseleave=t=>{this.setState({hover:!1})},this._handleClick=t=>{0===t.button&&this._fireSuggestionActionEvent(this.props.formattedText,this.props.suggestionItemContext)},this._fireSuggestionActionEvent=(t,e)=>{var o,s;null===(s=(o=this.props).onOjSuggestionAction)||void 0===s||s.call(o,{text:t,itemContext:e})},this.state={hover:!1}}fireSuggestionAction(){this._fireSuggestionActionEvent(this.props.formattedText,this.props.suggestionItemContext)}getFormattedText(){return this.props.formattedText}render(t,e){let o="oj-listbox-result oj-listbox-result-selectable";e.hover&&(o+=" oj-hover"),t.focus&&(o+=" oj-focus");const s=this._renderContent(t);return u.h("li",{role:"presentation",class:o,onClick:this._handleClick,onMouseEnter:this._handleMouseenter,onMouseLeave:this._handleMouseleave},u.h("div",{id:t.labelId,class:"oj-listbox-result-label",role:"option"},s))}_renderContent(t){var e;const o=t.suggestionItemTemplate;return o?o({data:t.suggestionItemContext.data,key:t.suggestionItemContext.key,metadata:t.suggestionItemContext.metadata,index:t.index,searchText:t.searchText}):u.h(h.HighlightText,{"data-oj-internal":!0,text:t.formattedText,matchText:null!==(e=t.searchText)&&void 0!==e?e:""})}}f.defaultProps={focus:!1,formattedText:"",index:-1,labelId:"",searchText:null};class m extends u.Component{constructor(t){super(t),this._renderedSuggestions=[],this.getCount=()=>{const t=this._renderedSuggestions.length,e=this._renderedSuggestions.indexOf(null);return-1===e?t:e},this.getFormattedText=t=>{var e;return null===(e=this._renderedSuggestions[t])||void 0===e?void 0:e.getFormattedText()},this.fireSuggestionAction=t=>{var e;null===(e=this._renderedSuggestions[t])||void 0===e||e.fireSuggestionAction()},this._setRenderedSuggestion=(t,e)=>{this._renderedSuggestions[t]=e}}render(t){var e;if((null===(e=t.data)||void 0===e?void 0:e.length)>0){let e=[];for(let o=0;o<t.data.length;o++){const s=o===t.focusIndex,i=t.formatItemText(t.suggestionItemText,t.data[o]),n=u.h(f,{ref:this._setRenderedSuggestion.bind(this,o),labelId:t.labelIds[o],focus:s,index:o,formattedText:i,searchText:t.searchText,suggestionItemContext:t.data[o],suggestionItemTemplate:t.suggestionItemTemplate,onOjSuggestionAction:t.onOjSuggestionAction});e.push(n)}return u.h("ul",{role:"listbox",id:t.id,class:"oj-listbox-results oj-inputsearch-results"},e)}return null}}m.defaultProps={data:null,focusIndex:-1,formatItemText:null,id:null,labelIds:null,onOjSuggestionAction:null,searchText:null,suggestionItemTemplate:null};var v=function(t,e){var o={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(o[s]=t[s]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(s=Object.getOwnPropertySymbols(t);i<s.length;i++)e.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(t,s[i])&&(o[s[i]]=t[s[i]])}return o};class x extends u.Component{constructor(t){super(t),this._isComposing=!1,this._setInputElem=t=>{var e,o;this._inputElem=t,null===(o=(e=this.props).inputRef)||void 0===o||o.call(e,t)},this._handleCompositionstart=t=>{var e;this._isComposing=!0,null===(e=this.props.onCompositionStart)||void 0===e||e.call(this._inputElem,t)},this._handleCompositionend=t=>{var e,o,s;this._isComposing=!1,null===(e=this.props.onCompositionEnd)||void 0===e||e.call(this._inputElem,t),null===(s=(o=this.props).onInputChanged)||void 0===s||s.call(o,{value:t.target.value})},this._handleInput=t=>{var e,o,s;null===(e=this.props.onInput)||void 0===e||e.call(this._inputElem,t),this._isComposing&&!this._isAndroidDevice||null===(s=(o=this.props).onInputChanged)||void 0===s||s.call(o,{value:t.target.value})};const e=s.AgentUtils.getAgentInfo();this._isAndroidDevice=e.os===s.AgentUtils.OS.ANDROID}render(t){const{onInputChanged:e,onInput:o,onCompositionStart:s,onCompositionEnd:i}=t,n=v(t,["onInputChanged","onInput","onCompositionStart","onCompositionEnd"]);return u.h("input",Object.assign({ref:this._setInputElem,onInput:this._handleInput,oncompositionstart:this._handleCompositionstart,oncompositionend:this._handleCompositionend},n))}}var w,S=function(t,e,o,s){var i,n=arguments.length,a=n<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,o):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,s);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(a=(n<3?i(a):n>3?i(e,o,a):i(e,o))||a);return n>3&&a&&Object.defineProperty(e,o,a),a};t.InputSearch=w=class extends u.Component{constructor(t){super(t),this._KEYS={TAB:9,ENTER:13,ESC:27,LEFT:37,UP:38,RIGHT:39,DOWN:40},this._counter=0,this._queryCount=0,this._handleMouseenter=t=>{e.recentTouchEnd()||this._updateState({hover:!0})},this._handleMouseleave=t=>{this._updateState({hover:!1})},this._handleFocusin=t=>{this._updateState({focus:!0})},this._handleFocusout=t=>{this._updateState({focus:!1})},this._handleMobileFilterInputFocusin=t=>{this._updateState({mobileFilterInputFocus:!0})},this._handleMobileFilterInputFocusout=t=>{this._updateState({mobileFilterInputFocus:!1})},this._handleMobileFilterClear=t=>{var e;null===(e=this._mobileFilterInputElem)||void 0===e||e.focus(),this._updateState({filterText:"",displayValue:"",showAutocompleteText:!1,autocompleteFloatingText:null})},this._handleMobileDropdownBack=t=>{var e;null===(e=this._mainInputElem)||void 0===e||e.focus(),this._updateState({dropdownOpen:!1,filterText:this.props.value,displayValue:this.props.value})},this._handleInputChanged=t=>{const e=t.value,o=this.state.filterText||"",s=o.toLowerCase(),i=e.toLowerCase(),n={};this.state.showAutocompleteText&&!this.state.autocompleteFloatingText&&o===e?Object.assign(n,{showAutocompleteText:!1,focusedSuggestionIndex:-1}):!this.state.showAutocompleteText&&i.length<s.length&&s.startsWith(i)?Object.assign(n,{showAutocompleteText:!1}):Object.assign(n,{showAutocompleteText:e.length>0}),Object.assign(n,{filterText:e,displayValue:e,dropdownOpen:!0}),this._updateState(n)},this._handleFocus=t=>{var e;null===(e=this._rootElem)||void 0===e||e.dispatchEvent(new FocusEvent("focus",{relatedTarget:t.relatedTarget}))},this._handleBlur=t=>{var e;null===(e=this._rootElem)||void 0===e||e.dispatchEvent(new FocusEvent("blur",{relatedTarget:t.relatedTarget}))},this._handleFilterInputKeydownEnter=t=>{var e,o;const s=this.state.focusedSuggestionIndex;return this.state.dropdownOpen&&s>=0&&(null===(e=this._suggestionsList)||void 0===e?void 0:e.getCount())>s&&!this._resolveFetchBusyState?(null===(o=this._suggestionsList)||void 0===o||o.fireSuggestionAction(s),null):{dropdownOpen:!1,valueSubmitted:!0,actionDetail:null}},this._handleDesktopMainInputKeydown=t=>{var e,o,s,i;const n={lastEventType:"keyboard"},a=t.keyCode;switch(a){case this._KEYS.ENTER:const l=this._handleFilterInputKeydownEnter(t);l&&Object.assign(n,l);break;case this._KEYS.TAB:Object.assign(n,{dropdownOpen:!1,focus:!1,actionDetail:null}),this.state.showAutocompleteText&&Object.assign(n,{showAutocompleteText:!1,resetFilterInputSelectionRange:!0});break;case this._KEYS.ESC:this.state.dropdownOpen&&(n.dropdownOpen=!1,this.state.showAutocompleteText&&Object.assign(n,{showAutocompleteText:!1,displayValue:this.state.filterText}),t.preventDefault());break;case this._KEYS.UP:case this._KEYS.DOWN:if(this.state.dropdownOpen){if(!this._resolveFetchBusyState&&(null===(e=this._suggestionsList)||void 0===e?void 0:e.getCount())>0){let e=this.state.focusedSuggestionIndex;a===this._KEYS.DOWN||-1===e?(e+=1,n.scrollFocusedSuggestionIntoView="bottom"):e>0&&(e-=1,n.scrollFocusedSuggestionIntoView="top",t.preventDefault()),e=Math.min((null===(o=this._suggestionsList)||void 0===o?void 0:o.getCount())-1,e),n.focusedSuggestionIndex=e;const l=0===e&&(null===(s=this.state.filterText)||void 0===s?void 0:s.length)>0;n.showAutocompleteText=l,l?n.displayValue=this.state.filterText:e>-1&&(n.displayValue=null===(i=this._suggestionsList)||void 0===i?void 0:i.getFormattedText(e))}}else n.dropdownOpen=!0;break;case this._KEYS.LEFT:case this._KEYS.RIGHT:this.state.showAutocompleteText&&!this.state.autocompleteFloatingText&&Object.assign(n,{showAutocompleteText:!1,filterText:this.state.displayValue})}this._updateState(n)},this._handleMobileFilterInputKeydown=t=>{const e={lastEventType:"keyboard"};switch(t.keyCode){case this._KEYS.ENTER:const o=this._handleFilterInputKeydownEnter(t);o&&Object.assign(e,o)}this._updateState(e)},this._handleMousedown=t=>{0===t.button&&(this._updateState({focus:!0,dropdownOpen:!0}),t.target!==this._mainInputElem||this.state.fullScreenPopup?t.preventDefault():this._handleFilterInputMousedown(t))},this._handleFilterInputMousedown=t=>{this.state.showAutocompleteText&&(this.state.autocompleteFloatingText?this._updateState({showAutocompleteText:!1,filterText:this.state.autocompleteFloatingText,displayValue:this.state.autocompleteFloatingText}):this._updateState({showAutocompleteText:!1,filterText:this.state.displayValue}))},this._handleDesktopDropdownMousedown=t=>{0===t.button&&(this._updateState({focus:!0}),t.preventDefault())},this._handleDropdownMousemove=t=>{this._updateState({lastEventType:"mouse"})},this._handleDropdownMouseleave=t=>{this._updateState({lastEventType:null})},this._setRootElem=t=>{this._rootElem=t},this._setDropdownElem=t=>{this._dropdownElem=t},this._setMainInputElem=t=>{this._mainInputElem=t},this._setMainInputContainerElem=t=>{this._mainInputContainerElem=t},this._setSuggestionsList=t=>{this._suggestionsList=t},this._setMobileFilterInputElem=t=>{this._mobileFilterInputElem=t},this._getFilterInputElem=()=>this._mobileFilterInputElem||this._mainInputElem,this._clickAwayHandler=t=>{const e=t.target;if(e.closest("#"+CSS.escape(this._getDropdownElemId()))||e.closest("#"+CSS.escape(this._getMainInputContainerId())))return;const o={dropdownOpen:!1};this.state.showAutocompleteText&&Object.assign(o,{showAutocompleteText:!1,resetFilterInputSelectionRange:!0}),this._updateState(o)},this._handleDataProviderRefreshEventListener=t=>{this._updateState({fetchedInitial:!1})},this._handleSuggestionAction=t=>{this._updateState({filterText:t.text,displayValue:t.text,dropdownOpen:!1,valueSubmitted:!0,actionDetail:t.itemContext})},this._uniqueId=t.id?t.id:p.getUniqueId();let o=(l.parseJSONFromFontFamily("oj-inputsearch-option-defaults")||{}).showIndicatorDelay;o=parseInt(o,10),o=isNaN(o)?250:o,this._showIndicatorDelay=o;const s=l.getCachedCSSVarValues(["--oj-private-core-global-dropdown-offset"])[0]||"0";this._dropdownVerticalOffset=parseInt(s,10),t.suggestions&&(this._dataProvider=this._wrapDataProviderIfNeeded(this.props.suggestions)),this.state={dropdownOpen:!1,dropdownAbove:!1,valueSubmitted:!1,focus:!1,hover:!1,active:!1,displayValue:null,filterText:null,lastFetchedFilterText:null,fetchedData:null,labelIds:[],fetchedInitial:!1,loading:!1,focusedSuggestionIndex:-1,activeDescendantId:null,scrollFocusedSuggestionIntoView:null,actionDetail:null,lastEventType:null,showAutocompleteText:!1,autocompleteFloatingText:null,initialRender:!0,oldPropsValue:t.value,oldPropsSuggestions:t.suggestions,fullScreenPopup:t.suggestions&&"phone"===i.getDeviceRenderMode(),mobileFilterInputFocus:!1,mobileFilterInputActive:!1,resetFilterInputSelectionRange:!1}}render(t,e){let o="oj-inputsearch oj-form-control oj-text-field oj-component";e.hover&&(o+=" oj-hover"),e.active&&(o+=" oj-active"),e.focus&&(o+=" oj-focus"),e.dropdownOpen&&(o+=" oj-listbox-dropdown-open",e.dropdownAbove&&(o+=" oj-listbox-drop-above")),e.fullScreenPopup&&(o+=" oj-inputsearch-mobile");const s=e.displayValue||"";return this._renderEnabled(t,e,o,"oj-text-field-start-end-icon oj-inputsearch-search-icon oj-component-icon",s,"oj-inputsearch-input oj-text-field-input")}static getDerivedStateFromProps(t,e){return e.initialRender?this._initStateFromProps(t,e):this._updateStateFromProps(t,e)}static _initStateFromProps(t,e){return{displayValue:t.value,filterText:t.value,fullScreenPopup:t.suggestions&&"phone"===i.getDeviceRenderMode()}}static _updateStateFromProps(t,e){const o={};return t.value!==e.oldPropsValue&&(!e.fullScreenPopup&&t.value!==e.displayValue||e.fullScreenPopup&&!e.dropdownOpen)&&(o.displayValue=t.value,o.filterText=t.value),e.oldPropsSuggestions!=t.suggestions&&(o.fetchedInitial=!1,o.fullScreenPopup=t.suggestions&&"phone"===i.getDeviceRenderMode()),t.suggestions||(o.dropdownOpen=!1,o.fetchedData=null),!1!==e.dropdownOpen&&!1!==o.dropdownOpen||(o.lastEventType=null,o.showAutocompleteText=!1),e.showAutocompleteText&&!1!==o.showAutocompleteText||(o.autocompleteFloatingText=null),o}componentDidMount(){var t,e;null!==this.props.value&&(null===(e=(t=this.props).onRawValueChanged)||void 0===e||e.call(t,this.props.value)),this._dataProvider&&this._addDataProviderEventListeners(this._dataProvider),this._updateState({initialRender:!1})}_updateState(t){this.setState(function(e,o){let s;s="function"==typeof t?t(e,o):t;let i=!1;for(const t in s)if(s[t]!==e[t]){i=!0;break}return i?s:null})}componentDidUpdate(t,e){var o,s,i,n,a,l,r,d,u,h;if(this.state.fullScreenPopup&&!e.dropdownOpen&&this.state.dropdownOpen&&(null===(o=this._mobileFilterInputElem)||void 0===o||o.focus()),(e.focus&&!this.state.focus||this.state.valueSubmitted)&&(this.props.value!==this.state.displayValue&&(null===(i=(s=this.props).onValueChanged)||void 0===i||i.call(s,this.state.displayValue)),e.focus&&!this.state.focus&&e.filterText!==this.state.displayValue&&this._updateState({filterText:this.state.displayValue}),this.state.valueSubmitted&&(null===(a=(n=this.props).onOjValueAction)||void 0===a||a.call(n,{value:this.state.displayValue,itemContext:this.state.actionDetail,previousValue:this.props.value}),this.state.fullScreenPopup&&(null===(l=this._mainInputElem)||void 0===l||l.focus()),this._updateState({valueSubmitted:!1}),this._testPromiseResolve&&(this._testPromiseResolve(),this._testPromiseResolve=null))),e.displayValue!=this.state.displayValue&&(null===(d=(r=this.props).onRawValueChanged)||void 0===d||d.call(r,this.state.displayValue)),t.suggestions!=this.props.suggestions&&(t.suggestions&&this._removeDataProviderEventListeners(this._dataProvider),this.props.suggestions?(this._dataProvider=this._wrapDataProviderIfNeeded(this.props.suggestions),this._addDataProviderEventListeners(this._dataProvider)):(this._dataProvider=null,this._resolveFetching())),this.state.dropdownOpen){this.state.lastFetchedFilterText==this.state.filterText&&(this.state.fetchedInitial||this._resolveFetchBusyState)||(this._updateState({lastFetchedFilterText:this.state.filterText}),this._fetchData(this.state.filterText)),e.dropdownOpen&&this.state.filterText===e.filterText?this.state.fetchedData&&this._updateState((t,e)=>{const o=Math.min(t.fetchedData.length-1,t.focusedSuggestionIndex);return t.focusedSuggestionIndex!==o?{focusedSuggestionIndex:o}:null}):e.dropdownOpen||this.state.filterText!==e.filterText?this._updateState((t,e)=>{var o;const s=(null===(o=t.filterText)||void 0===o?void 0:o.length)>0?0:-1;return t.focusedSuggestionIndex!==s?{focusedSuggestionIndex:s}:null}):this._updateState({focusedSuggestionIndex:-1});const t=this._resolveFetchBusyState?-1:this.state.focusedSuggestionIndex;if(t>=0&&this.state.labelIds.length>t){const e=this.state.filterText||"";if(0===t&&this.state.showAutocompleteText&&e.length>0){const o=null===(u=this._suggestionsList)||void 0===u?void 0:u.getFormattedText(0),s=o.toLowerCase(),i=e.toLowerCase();if(s.startsWith(i)){const s=e.length,i=o.substr(s);this._updateState({displayValue:e+i,autocompleteFloatingText:null,activeDescendantId:this.state.labelIds[t]}),this._getFilterInputElem().setSelectionRange(s,s+i.length)}else this.state.fullScreenPopup?this._updateState({autocompleteFloatingText:null,activeDescendantId:null,focusedSuggestionIndex:-1}):this._updateState({autocompleteFloatingText:o,displayValue:e,activeDescendantId:this.state.labelIds[t]})}else this._updateState({activeDescendantId:this.state.labelIds[t]})}else this._updateState({activeDescendantId:null});this._resolveFetchBusyState||0!==this.state.labelIds.length||(this.state.fullScreenPopup?this._updateState({showAutocompleteText:!1}):this._updateState({showAutocompleteText:!1,dropdownOpen:!1}))}else e.dropdownOpen&&(this._updateState({focusedSuggestionIndex:-1}),this._resolveFetching());const p=this.state.scrollFocusedSuggestionIntoView;if(p){const t=this.state.activeDescendantId;if(t){const e="top"===p;this._scrollSuggestionIntoView(t,e),this._updateState({scrollFocusedSuggestionIntoView:null})}}this.state.resetFilterInputSelectionRange&&(null===(h=this._getFilterInputElem())||void 0===h||h.setSelectionRange(this.state.displayValue.length,this.state.displayValue.length),this._updateState({resetFilterInputSelectionRange:!1})),this.state.oldPropsValue!==this.props.value&&this._updateState({oldPropsValue:this.props.value}),this.state.oldPropsSuggestions!==this.props.suggestions&&this._updateState({oldPropsSuggestions:this.props.suggestions})}componentWillUnmount(){this._dataProvider&&this._removeDataProviderEventListeners(this._dataProvider),this._resolveFetching(),this._updateState({initialRender:!0})}focus(){var t;null===(t=this._mainInputElem)||void 0===t||t.focus()}blur(){var t;null===(t=this._mainInputElem)||void 0===t||t.blur()}_getDropdownElemId(){return"searchDropdown_"+this._uniqueId}_getMainInputContainerId(){return"searchInputContainer_"+this._uniqueId}_getMobileFilterContainerId(){return"searchMobileFilterContainer_"+this._uniqueId}_getListboxId(){return"searchSuggestionsListbox_"+this._uniqueId}_getDesktopDropdownPosition(){const t={my:"start top",at:"start bottom",of:this._mainInputContainerElem,collision:"flip",using:this._usingHandler.bind(this),offset:{x:0,y:this._dropdownVerticalOffset}},o="rtl"===e.getReadingDirection();let i=s.PositionUtils.normalizeHorizontalAlignment(t,o);return i=s.PositionUtils.coerceToJet(i),i=s.PositionUtils.coerceToJqUi(i),i.of=t.of,i}_getMobileDropdownPosition(){const t=window.scrollX||window.pageXOffset,o=window.scrollY||window.pageYOffset;let i={my:"start top",at:"start top",of:window,offset:{x:t,y:o}};const n="rtl"===e.getReadingDirection();return i=s.PositionUtils.normalizeHorizontalAlignment(i,n),i}_getMobileDropdownStyle(){const t={},e=Math.min(window.innerWidth,window.screen.availWidth),o=Math.min(window.innerHeight,window.screen.availHeight);if("phone"===i.getDeviceType()&&window.parent&&window!==window.parent){const e=Math.min(window.parent.innerHeight,window.parent.screen.availHeight),s=Math.min(o,e);if(o>s){const e=o-s;t.paddingBottom=e+"px"}}return t.width=e+"px",t.height=o+"px",t}_usingHandler(t,e){s.PositionUtils.isAligningPositionClipped(e)?this._updateState({dropdownOpen:!1}):(e.element.element.css(t),this._updateState({dropdownAbove:"bottom"===e.vertical}))}_renderEnabled(t,e,o,i,n,a){const l=t.id?t.id:null,r=t["aria-label"]?t["aria-label"]:null,d=this._dataProvider?this._getListboxId():null,h=s.AgentUtils.getAgentInfo(),c=h.os===s.AgentUtils.OS.ANDROID||h.os===s.AgentUtils.OS.IOS||h.os===s.AgentUtils.OS.WINDOWSPHONE?"search":"text",g=e.autocompleteFloatingText?this._renderAutocompleteFloatingText(e.autocompleteFloatingText,n):null,_=u.h("span",{class:i,role:"presentation"}),f=e.fullScreenPopup?this._renderMobileMainTextFieldContainer(t,e,_,a,r,d):this._renderDesktopMainTextFieldContainer(t,e,_,n,a,r,d,c,g),m=e.dropdownOpen?this._renderDropdown(t,e,n,a,r,d,c,g):null;return u.h(p.Root,{id:l,ref:this._setRootElem,class:o,"aria-label":r,onMouseDown:this._handleMousedown,onMouseEnter:this._handleMouseenter,onMouseLeave:this._handleMouseleave},f,m)}_renderDesktopMainTextFieldContainer(t,e,o,s,i,n,a,l,r){return u.h("div",{role:"presentation",class:"oj-text-field-container oj-text-field-has-start-slot",id:this._getMainInputContainerId(),ref:this._setMainInputContainerElem},u.h("span",{class:"oj-text-field-start"},o),u.h("div",{class:"oj-text-field-middle",role:this._dataProvider?"combobox":void 0,"aria-label":this._dataProvider?n:null,"aria-owns":a,"aria-haspopup":this._dataProvider?"listbox":"false","aria-expanded":e.dropdownOpen?"true":"false"},u.h(x,Object.assign({type:l,inputRef:this._setMainInputElem,value:s,class:i+" oj-inputsearch-filter",placeholder:t.placeholder,autocomplete:"off",autocorrect:"off"},{autocapitalize:"off"},{spellcheck:!1,autofocus:!1,"aria-label":n,"aria-autocomplete":this._dataProvider?"list":null,"aria-controls":a,"aria-busy":e.dropdownOpen&&e.loading,"aria-activedescendant":this._dataProvider?e.activeDescendantId:null,onfocusin:this._handleFocusin,onfocusout:this._handleFocusout,onFocus:this._handleFocus,onBlur:this._handleBlur,onInputChanged:this._handleInputChanged,onKeyDown:this._handleDesktopMainInputKeydown})),r))}_renderMobileMainTextFieldContainer(t,e,o,s,i,n){return u.h("div",{role:"presentation",class:"oj-text-field-container oj-text-field-has-start-slot",id:this._getMainInputContainerId()},u.h("span",{class:"oj-text-field-start"},o),u.h("div",{class:"oj-text-field-middle",role:this._dataProvider?"combobox":void 0,"aria-label":this._dataProvider?i:null,"aria-owns":n,"aria-haspopup":this._dataProvider?"listbox":"false","aria-expanded":e.dropdownOpen?"true":"false"},u.h("input",Object.assign({readOnly:!0,ref:this._setMainInputElem,value:t.value,class:s,placeholder:t.placeholder,autocomplete:"off",autocorrect:"off"},{autocapitalize:"off"},{spellcheck:!1,autofocus:!1,"aria-label":i,"aria-autocomplete":this._dataProvider?"list":null,"aria-controls":n,"aria-busy":e.dropdownOpen&&e.loading,onfocusin:this._handleFocusin,onfocusout:this._handleFocusout,onFocus:this._handleFocus,onBlur:this._handleBlur}))))}_renderMobileDropdownFilterField(t,e,o,s,i,n,a,l){let r="oj-text-field";e.mobileFilterInputActive&&(r+=" oj-active"),e.mobileFilterInputFocus&&(r+=" oj-focus");let d="oj-text-field-container oj-text-field-has-start-slot";const h=this._renderMobileDropdownBackIcon();let p;return o&&o.length>0&&(d+=" oj-text-field-has-end-slot",p=this._renderMobileDropdownClearIcon()),u.h("div",{class:r},u.h("div",{role:"presentation",class:d,id:this._getMobileFilterContainerId()},u.h("span",{class:"oj-text-field-start"},h),u.h("div",{class:"oj-text-field-middle","aria-label":i,"aria-owns":n},u.h(x,Object.assign({type:a,inputRef:this._setMobileFilterInputElem,value:o,class:s+" oj-inputsearch-filter",placeholder:t.placeholder,autocomplete:"off",autocorrect:"off"},{autocapitalize:"off"},{spellcheck:!1,autofocus:!1,"aria-label":i,"aria-autocomplete":"list","aria-controls":n,"aria-busy":e.loading,"aria-activedescendant":e.activeDescendantId,onfocusin:this._handleMobileFilterInputFocusin,onfocusout:this._handleMobileFilterInputFocusout,onInputChanged:this._handleInputChanged,onKeyDown:this._handleMobileFilterInputKeydown,onMouseDown:this._handleFilterInputMousedown})),l),u.h("span",{class:"oj-text-field-end"},p)))}_renderMobileDropdownBackIcon(){const t=d.getTranslatedString("oj-ojInputSearch2.cancel");return u.h("span",{class:"oj-inputsearch-back-button","aria-label":t,onClick:this._handleMobileDropdownBack},u.h("span",{class:"oj-inputsearch-back-icon oj-inputsearch-icon oj-component-icon oj-clickable-icon-nocontext"}))}_renderMobileDropdownClearIcon(){return u.h("span",{class:"oj-inputsearch-clear-button","aria-hidden":!0,onClick:this._handleMobileFilterClear},u.h("span",{class:"oj-inputsearch-clear-icon oj-inputsearch-icon oj-component-icon oj-clickable-icon-nocontext"}))}_renderDropdown(t,e,o,s,i,n,a,l){const r=e.loading?this._renderDropdownSkeleton():this._renderDropdownSuggestions(t,e);let d="oj-listbox-drop oj-listbox-inputsearch";return"keyboard"===e.lastEventType&&(d+=" oj-listbox-hide-hover"),"mouse"===e.lastEventType&&(d+=" oj-listbox-hide-focus"),e.fullScreenPopup?this._renderMobileDropdown(t,e,d,r,o,s,i,n,a,l):this._renderDesktopDropdown(t,e,d,r)}_renderDesktopDropdown(t,e,o,s){const i=this._getDesktopDropdownPosition(),n={minWidth:this._rootElem.offsetWidth+"px"};return e.dropdownAbove&&(o+=" oj-listbox-drop-above"),this._renderVPopup(i,o,n,s,null,this._handleDesktopDropdownMousedown)}_renderMobileDropdown(t,e,o,s,i,n,a,l,r,d){const u=this._getMobileDropdownPosition(),h=this._getMobileDropdownStyle();o+=" oj-listbox-fullscreen";const p=this._renderMobileDropdownFilterField(t,e,i,n,a,l,r,d);return this._renderVPopup(u,o,h,s,p,null)}_renderVPopup(t,e,o,s,i,n){return u.h(c.VPopup,{position:t,layerSelectors:"oj-listbox-drop-layer",autoDismiss:this._clickAwayHandler},u.h("div",{"data-oj-binding-provider":"preact",id:this._getDropdownElemId(),ref:this._setDropdownElem,class:e,role:"presentation",style:o,onMouseDown:n,onMouseMove:this._handleDropdownMousemove,onMouseLeave:this._handleDropdownMouseleave},i,s))}_renderAutocompleteFloatingText(t,e){const o=" — "+t;return u.h("div",{class:"oj-inputsearch-autocomplete-floating-container"},u.h("span",{style:"visibility: hidden;"},e),u.h("span",{class:"oj-inputsearch-autocomplete-floating-text"},o))}_scrollSuggestionIntoView(t,e){const o=document.getElementById(t),s=o.closest(".oj-listbox-result"),i=o.closest(".oj-listbox-results"),n=s.offsetTop,a=s.offsetHeight,l=i.scrollTop,r=i.offsetHeight;(n<l||n+a>l+r)&&(i.scrollTop=e?n:n+a-r)}_generateId(){return this._uniqueId+"-"+this._counter++}_fetchData(t){this._queryCount+=1;const e=this._queryCount;let o=t;""===o&&(o=null);let i={size:12};if(o){const t=this._dataProvider.getCapability("filter");t&&t.textFilter||a.error("InputSearch: DataProvider does not support text filter. Filtering results in dropdown may not work correctly."),i.filterCriterion=s.FilterFactory.getFilter({filterDef:{text:o}})}if(!this._loadingTimer){const t=r.getTimer(this._showIndicatorDelay);t.getPromise().then(function(t){this._loadingTimer=null,t&&this._dataProvider&&this.state.dropdownOpen&&this._updateState({loading:!0})}.bind(this)),this._loadingTimer=t}let n=[];this._resolveFetchBusyState||(this._resolveFetchBusyState=this._addBusyState("InputSearch: fetching suggestions"));const l=this._dataProvider.fetchFirst(i)[Symbol.asyncIterator]();let d=12;const u=function(t){if(e!==this._queryCount)return;let o=t.done;const s=t.value,i=s.data,a=s.metadata;for(let t=0;t<i.length;t++){const e=i[t],s=a[t],l=s.key;if(n.push({data:e,metadata:s,key:l}),d-=1,0===d){o=!0;break}}if(o){let t=[];for(let e=0;e<n.length;e++)t.push("oj-inputsearch-result-label-"+this._generateId());this._updateState({fetchedInitial:!0,labelIds:t,fetchedData:n}),this._resolveFetching()}else l.next().then(u)}.bind(this);l.next().then(u)}_renderDropdownSkeleton(){let t=1,e=0;if(this._dropdownElem){const o=this._dropdownElem.querySelectorAll(".oj-listbox-result");if(t=Math.max(1,o.length),o.length>0){e=this._dropdownElem.querySelector(".oj-listbox-results").offsetWidth}}const o=e>0?{width:e+"px"}:null;return u.h(_,{id:this._getListboxId(),numItems:t,itemStyle:o})}_renderDropdownSuggestions(t,e){var o;return(null===(o=e.fetchedData)||void 0===o?void 0:o.length)>0?u.h(m,{ref:this._setSuggestionsList,data:e.fetchedData,searchText:e.filterText,focusIndex:e.focusedSuggestionIndex,formatItemText:w._formatItemText,id:this._getListboxId(),labelIds:e.labelIds,onOjSuggestionAction:this._handleSuggestionAction,suggestionItemText:t.suggestionItemText,suggestionItemTemplate:t.suggestionItemTemplate}):null}_addBusyState(t){const e=this._rootElem,o={description:'The component identified by "'+e.id+'" '+t};return n.getContext(e).getBusyContext().addBusyState(o)}_isDataProvider(t){return!!(null==t?void 0:t.fetchFirst)}_wrapDataProviderIfNeeded(t){if(this._isDataProvider(t)){let e=t;return e instanceof s.ListDataProviderView||(e=new s.ListDataProviderView(e)),e}return null}_addDataProviderEventListeners(t){t.addEventListener("mutate",this._handleDataProviderRefreshEventListener),t.addEventListener("refresh",this._handleDataProviderRefreshEventListener)}_removeDataProviderEventListeners(t){t.removeEventListener("mutate",this._handleDataProviderRefreshEventListener),t.removeEventListener("refresh",this._handleDataProviderRefreshEventListener)}_resolveFetching(){this._loadingTimer&&(this._loadingTimer.clear(),this._loadingTimer=null),this._resolveFetchBusyState&&(this._resolveFetchBusyState(),this._resolveFetchBusyState=null),this.state.loading&&this._updateState({loading:!1})}static _formatItemText(t,e){var o;let s;return(null==e?void 0:e.data)&&("string"==typeof t?((null===(o=e.data)||void 0===o?void 0:o.hasOwnProperty(t))||a.error(`oj-input-search: No '${t}' property found in DataProvider with key: ${null==e?void 0:e.key}`),s=e.data[t]):s=t(e)),s||""}_testChangeValue(t){const e=new Promise(t=>{this._testPromiseResolve=t});return this._updateState({filterText:t,displayValue:t,dropdownOpen:!1,valueSubmitted:!0,actionDetail:null}),e}_testChangeValueByKey(t){const e=new Promise(t=>{this._testPromiseResolve=t}),o=function(){throw this._testPromiseResolve&&(this._testPromiseResolve(),this._testPromiseResolve=null),new Error("oj-input-search: No row found in DataProvider for key: "+t)};return this._dataProvider.fetchByKeys({keys:new Set([t])}).then(function(e){const s=e.results.get(t);if(s&&null!=s.data&&null!=s.metadata){const t={data:s.data,metadata:s.metadata,key:s.metadata.key},e=w._formatItemText(this.props.suggestionItemText,t);this._updateState({filterText:e,displayValue:e,dropdownOpen:!1,valueSubmitted:!0,actionDetail:t})}else o()}.bind(this),o),e}},t.InputSearch.defaultProps={suggestions:null,suggestionItemText:"label",placeholder:"",rawValue:null,value:null},t.InputSearch.metadata={properties:{suggestions:{type:"object|null"},suggestionItemText:{type:"string | number|function"},placeholder:{type:"string"},rawValue:{type:"string|null",readOnly:!0,writeback:!0},value:{type:"string|null",writeback:!0}},events:{ojValueAction:{}},slots:{suggestionItemTemplate:{data:{}}},extension:{_WRITEBACK_PROPS:["rawValue","value"],_READ_ONLY_PROPS:["rawValue"],_OBSERVED_GLOBAL_PROPS:["aria-label","id"]},methods:{focus:{},blur:{},_testChangeValue:{},_testChangeValueByKey:{}}},t.InputSearch=w=S([p.customElement("oj-input-search")],t.InputSearch),Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=ojinputsearch.js.map