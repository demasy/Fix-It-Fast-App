/**
 * @license
 * Copyright (c) 2014, 2021, Oracle and/or its affiliates.
 * Licensed under The Universal Permissive License (UPL), Version 1.0
 * as shown at https://oss.oracle.com/licenses/upl/
 * @ignore
 */
define(["exports","ojs/ojdvt-toolkit","ojs/ojdvt-panzoomcanvas","ojs/ojdvt-overview"],function(t,e,n,o){"use strict";var i={};e.Obj.createSubclass(i,e.Obj,"DvtDiagramLinkUtils"),i.GetStrokeDash=function(t,e){return"solid"==t?null:"dash"===t?e?"8,2":"6,4":"dot"===t?e?"4,1":"2,3":"dashDot"===t?e?"10,1,4,1":"8,3,2,3":void 0},i.GetStrokeDashOffset=function(t,e){return e&&"solid"!=t?1:null},i.getStrokeObject=function(t,e){return{_type:t,strokeDasharray:i.GetStrokeDash(t,e),strokeDashoffset:i.GetStrokeDashOffset(t,e)}},i.processStrokeDashArray=function(t){if(t){var e=t.split(/[\s,]+/);return e.length%2>0&&(e=e.concat(e)),e.toString()}return t},i.getCustomUnderlay=function(t){if(t){for(var n=t.split(/[\s,]+/),o="",i=0;i<n.length;i++){var s=e.CSSStyle.toNumber(n[i].trim());o+=i%2==0?s+2:s>=2?s-2:0,i<n.length-1&&(o+=", ")}return o}return null},i.ConvertToPath=function(t){var e=[];if(t)for(var n=0;n<t.length;n+=2)0==n?e.push("M"):e.push("L"),e.push(t[n]),e.push(t[n+1]);return e},i.ConvertToPoints=function(t){var e=[];if(t)for(var n=0;n<t.length;n++)isNaN(t[n])||e.push(t[n]);return e},i.IsPath=function(t){return!!(t&&t.length>0)&&isNaN(t[0])},i.GetLinkBounds=function(t){var n=new e.Rectangle(Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),o=t.getPoints();if(o)if(i.IsPath(o))n=e.PathUtils.getDimensions(o);else for(var s,a,r,d,h=0;h<o.length;h+=2){var l=o[h],g=o[h+1];s=Math.max(n.x+n.w,l),a=Math.max(n.y+n.h,g),r=Math.min(n.x,l),d=Math.min(n.y,g),n.x=r,n.y=d,n.w=s-r,n.h=a-d}var u=new e.Rectangle(n.x,n.y,n.w,n.h),p=t.getLabelPosition(),c=t.getLabelRotationAngle(),_=t.getLabelRotationPoint(),f=t.getLabelBounds();return p&&f&&(null!=c&&(f=e.BaseDiagram.RotateBounds(f,c,_)),u.x=Math.min(n.x,f.x+p.x),u.y=Math.min(n.y,f.y+p.y),u.w=Math.max(n.x+n.w,f.x+p.x+f.w)-u.x,u.h=Math.max(n.y+n.h,f.y+p.y+f.h)-u.y),u};var s=function(t,e){this.Init(t,e)};e.Obj.createSubclass(s,e.Obj,"DvtDiagramPoint"),s.prototype.Init=function(t,e){this.x=null===t||isNaN(t)?0:t,this.y=null===e||isNaN(e)?0:e};var a=new Object;e.Obj.createSubclass(a,e.Obj),a.GetCollapsedContainers=function(t,e){for(var n=[];e.length>0;){var o=e.shift();if(o.nodes)o.nodes.forEach(function(t){e.push(t)});else{var i=t.getChildDataProvider(o.id);!i||"yes"===i.isEmpty()||"disjoint"===o.descendantsConnectivity||n.push(o)}}return n},a.GetNodeOption=function(t,e){for(var n=[e.getId()];e&&e.getGroupId();){var o=e.getGroupId();n.push(o),e=t.getNodeById(o)}for(var i=n.pop(),s=[t.getOptions()],r=t.getCtx();i&&s[0].nodes;)s=s[0].nodes.filter(function(t){return a.compareValues(r,t.id,i)}),i=n.pop();return s[0]},a.compareValues=function(t,n,o){return!n&&!o||e.Obj.compareValues(t,n,o)};var r=function(t){this.Init(t)};e.Obj.createSubclass(r,e.Obj,"DvtDiagramLayoutContext"),r.prototype.Init=function(t){this._nodeCount=0,this._linkCount=0,this._bLocaleR2L=!1,this._nodes=new t.ojMap,this._links=new t.ojMap,this._arNodes=[],this._arLinks=[],this._dirtyContext=new t.ojMap,this.Context=t},r.prototype.setLayout=function(t){this._layout=t},r.prototype.getLayout=function(){return this._layout},r.prototype.setLayoutAttributes=function(t){this._layoutAttrs=t},r.prototype.getLayoutAttributes=function(){return this._layoutAttrs},r.prototype.addNode=function(t){this.getNodeById(t.getId())||(this._nodeCount++,this._arNodes.push(t)),this._nodes.set(t.getId(),t)},r.prototype.addNodeToMap=function(t){this._nodes.set(t.getId(),t)},r.prototype.removeNode=function(t,n){n&&(t?e.ArrayUtils.removeItem(t.getChildNodes(),n):(e.ArrayUtils.removeItem(this._arNodes,n),this._nodeCount--),this._nodes.delete(n.getId()))},r.prototype.getNodeById=function(t){return this._nodes.get(t)},r.prototype.getNodeByIndex=function(t){return this._arNodes[t]},r.prototype.getNodeCount=function(){return this._nodeCount},r.prototype.addLink=function(t){this.getLinkById(t.getId())||(this._linkCount++,this._arLinks.push(t)),this._links.set(t.getId(),t)},r.prototype.removeLink=function(t){t&&(this.getLinkById(t.getId())&&(e.ArrayUtils.removeItem(this._arLinks,t),this._linkCount--),this._links.delete(t.getId()))},r.prototype.getLinkById=function(t){return this._links.get(t)},r.prototype.getLinkByIndex=function(t){return this._arLinks[t]},r.prototype.getLinkCount=function(){return this._linkCount},r.prototype.localToGlobal=function(t,e){var n=this.GetGlobalOffset(e);return new s(t.x+n.x,t.y+n.y)},r.prototype.GetGlobalOffset=function(t){for(var e=new s(0,0);t;){e.x+=t.ContentOffset.x+t.getPosition().x,e.y+=t.ContentOffset.y+t.getPosition().y;var n=t.getContainerId();if(n){if((t=this.getNodeById(n))&&t.isDisclosed()){var o=t.getContainerPadding();o&&(e.x+=o.left,e.y+=o.top)}}else t=null}return e},r.prototype.setLocaleR2L=function(t){this._bLocaleR2L=t},r.prototype.isLocaleR2L=function(){return this._bLocaleR2L},r.prototype.setComponentSize=function(t){this._componentSize=t},r.prototype.getComponentSize=function(){return this._componentSize},r.prototype.setViewport=function(t){this._viewport=t},r.prototype.getViewport=function(){return this._viewport},r.prototype.setContainerId=function(t){this._containerId=t},r.prototype.getContainerId=function(){return this._containerId},r.prototype.setContainerPadding=function(t,e,n,o){this.getContainerId()&&(this._containerPadding={},"number"!=typeof t&&"string"!=typeof t&&(o=t.left,e=t.right,n=t.bottom,t=t.top),this._containerPadding.top=t,this._containerPadding.right=e,this._containerPadding.bottom=n,this._containerPadding.left=o)},r.prototype.getContainerPadding=function(){return this._containerPadding},r.prototype.setCurrentViewport=function(t){this._currentViewport=t},r.prototype.getCurrentViewport=function(){return this._currentViewport},r.prototype.getCommonContainer=function(t,e){for(var n=function(t,e){for(var n=[],o=e.getNodeById(t)?e.getNodeById(t).getContainerId():null;o;)n.push(o),o=e.getNodeById(o)?e.getNodeById(o).getContainerId():null;return n.reverse(),n},o=n(t,this),i=n(e,this),s=null,r=0;r<o.length&&r<i.length&&a.compareValues(this.Context,o[r],i[r]);r++)s=o[r];return s},r.prototype.getEventData=function(){return this._eventData},r.prototype.setEventData=function(t){this._eventData=t},r.prototype.setDirtyContext=function(t){this._dirtyContext=t},r.prototype.getDirtyContext=function(){return this._dirtyContext};var d=function(t,e,n,o){this.Init(t,e,n,o)};e.Obj.createSubclass(d,e.Obj,"DvtDiagramRectangle"),d.prototype.Init=function(t,e,n,o){this.x=null===t||isNaN(t)?0:t,this.y=null===e||isNaN(e)?0:e,this.w=null===n||isNaN(n)?0:n,this.h=null===o||isNaN(o)?0:o};var h=function(){this.Init()};e.Obj.createSubclass(h,e.Obj,"DvtDiagramLayoutContextNode"),h.prototype.Init=function(){this._bReadOnly=!1,this._selected=!1,this._bDisclosed=!1,this.IsRendered=!0,this.ContentOffset=new s(0,0)},h.prototype.setId=function(t){this._id=t},h.prototype.getId=function(){return this._id},h.prototype.setBounds=function(t){this._bounds=t,this._origBounds=t},h.prototype.getBounds=function(){return!this._bounds&&this.Component&&this.Component.updateNodeDims(this),this._bounds},h.prototype.setContentBounds=function(t){this._contentBounds=t,this._origContentBounds=t},h.prototype.getContentBounds=function(){return!this._contentBounds&&this.Component&&this.Component.updateNodeDims(this),this._contentBounds},h.prototype.setPosition=function(t){this._position=t,this.UpdateParentNodes(),this.setDirty()},h.prototype.getPosition=function(){return this._position},h.prototype.getRelativePosition=function(t){var e=this.LayoutContext;if(e){for(var n=new s(0,0),o=this,i=!1;o;){var r=o.getContainerId();if(r){var d=e.getNodeById(r);d&&this.Component&&!d.IsRendered&&this.Component.renderNodeFromContext(d,!0)}if(n.x+=o.ContentOffset.x+o.getPosition().x,n.y+=o.ContentOffset.y+o.getPosition().y,a.compareValues(e.Context,r,t))i=!0,o=null;else if((o=e.getNodeById(r))&&o.isDisclosed()){var h=o.getContainerPadding();h&&(n.x+=h.left,n.y+=h.top)}else o=null}return i||(n=null),n}},h.prototype.setLabelPosition=function(t){this._labelPosition=t,this.setDirty()},h.prototype.getLabelPosition=function(){return this._labelPosition},h.prototype.setLabelBounds=function(t){this._labelBounds=t},h.prototype.getLabelBounds=function(){return!this._labelBounds&&this.Component&&this.Component.updateNodeDims(this),this._labelBounds},h.prototype.setLayoutAttributes=function(t){this._layoutAttrs=t},h.prototype.getLayoutAttributes=function(){return this._layoutAttrs},h.prototype.setReadOnly=function(t){this._bReadOnly=t},h.prototype.isReadOnly=function(){return this._bReadOnly},h.prototype.setContainerId=function(t){this._containerId=t},h.prototype.getContainerId=function(){return this._containerId},h.prototype.setSelected=function(t){this._selected=t},h.prototype.getSelected=function(){return this._selected},h.prototype.setLabelRotationAngle=function(t){this._labelRotAngle=t,this.setDirty()},h.prototype.getLabelRotationAngle=function(){return this._labelRotAngle},h.prototype.setLabelRotationPoint=function(t){this._labelRotPoint=t,this.setDirty()},h.prototype.getLabelRotationPoint=function(){return this._labelRotPoint},h.prototype.SetContainerPaddingObj=function(t){this.isDisclosed()&&(this._containerPadding=t,t&&(this._origBounds&&(this._origBounds=new d(this._origBounds.x,this._origBounds.y,this._origBounds.w-(t.left+t.right),this._origBounds.h-(t.top+t.bottom))),this._origContentBounds&&(this._origContentBounds=new d(this._origContentBounds.x,this._origContentBounds.y,this._origContentBounds.w-(t.left+t.right),this._origContentBounds.h-(t.top+t.bottom)))))},h.prototype.setContainerPadding=function(t,e,n,o){this.isDisclosed()&&(this._containerPadding={},"number"!=typeof t&&"string"!=typeof t&&(o=t.left,e=t.right,n=t.bottom,t=t.top),this._containerPadding.top=t,this._containerPadding.right=e,this._containerPadding.bottom=n,this._containerPadding.left=o,this._origBounds&&(this._bounds=new d(this._origBounds.x,this._origBounds.y,this._origBounds.w+o+e,this._origBounds.h+t+n)),this._origContentBounds&&(this._contentBounds=new d(this._origContentBounds.x,this._origContentBounds.y,this._origContentBounds.w+o+e,this._origContentBounds.h+t+n)),this.setDirty())},h.prototype.getContainerPadding=function(){return this._containerPadding},h.prototype.setDisclosed=function(t){this._bDisclosed=t},h.prototype.isDisclosed=function(){return this._bDisclosed},h.prototype.setChildNodes=function(t){this._childNodes=t},h.prototype.getChildNodes=function(){return this._childNodes},h.prototype.setParentNode=function(t){this._parentNode=t},h.prototype.getParentNode=function(){return this._parentNode},h.prototype.UpdateParentNodes=function(){var t=this.getParentNode();t&&t.IsRendered&&(t.Reset(),t.UpdateParentNodes())},h.prototype.Reset=function(){this.IsRendered=!1,this.setBounds(null),this.setContentBounds(null),this.setLabelBounds(null),this.setDirty()},h.prototype.setLabelValign=function(t){this._labelValign=t,this.setDirty()},h.prototype.setLabelHalign=function(t){this._labelHalign=t,this.setDirty()},h.prototype.getLabelValign=function(){return this._labelValign},h.prototype.getLabelHalign=function(){return this._labelHalign},h.prototype.setData=function(t){this._data=t},h.prototype.getData=function(){return this._data},h.prototype.setDirty=function(){this.LayoutContext&&this.LayoutContext.getDirtyContext().set(this.getId(),!0)},h.prototype.copyFrom=function(t){t&&(this.setPosition(t.getPosition()),this.setLabelPosition(t.getLabelPosition()),this.setLabelRotationAngle(t.getLabelRotationAngle()),this.setLabelRotationPoint(t.getLabelRotationPoint()),this.setLabelValign(t.getLabelValign()),this.setLabelHalign(t.getLabelHalign()),t.getContainerPadding()&&this.setContainerPadding(t.getContainerPadding()))};var l={};e.Obj.createSubclass(l,e.Obj,"DvtDiagramLayoutUtils"),l.convertRectToDiagramRect=function(t){return void 0===t||null==t?null:new d(t.x,t.y,t.w,t.h)},l.convertPointToDiagramPoint=function(t){return void 0===t||null==t?null:new s(t.x,t.y)},l.convertDiagramRectToRect=function(t){return t?new e.Rectangle(t.x,t.y,t.w,t.h):null},l.convertDiagramPointToPoint=function(t){return t?new e.Point(t.x,t.y):null};var g=function(){this.Init()};e.Obj.createSubclass(g,e.Obj,"DvtDiagramLayoutContextLink"),g.prototype.Init=function(){this._startConnectorOffset=0,this._endConnectorOffset=0,this._linkWidth=1,this._selected=!1,this._bPromoted=!1},g.prototype.setId=function(t){this._id=t},g.prototype.getId=function(){return this._id},g.prototype.setStartId=function(t){this._startId=t},g.prototype.getStartId=function(){return this._startId},g.prototype.setEndId=function(t){this._endId=t},g.prototype.getEndId=function(){return this._endId},g.prototype.setPoints=function(t){this._points="string"==typeof t?e.PathUtils.createPathArray(t):t,this.setDirty()},g.prototype.getPoints=function(){return this._points},g.prototype.setLabelPosition=function(t){this._labelPosition=t,this.setDirty()},g.prototype.getLabelPosition=function(){return this._labelPosition},g.prototype.setLabelBounds=function(t){this._labelBounds=t},g.prototype.getLabelBounds=function(){return this._labelBounds},g.prototype.setStartConnectorOffset=function(t){this._startConnectorOffset=t},g.prototype.getStartConnectorOffset=function(){return this._startConnectorOffset},g.prototype.setEndConnectorOffset=function(t){this._endConnectorOffset=t},g.prototype.getEndConnectorOffset=function(){return this._endConnectorOffset},g.prototype.setLinkWidth=function(t){this._linkWidth=t},g.prototype.getLinkWidth=function(){return this._linkWidth},g.prototype.setLayoutAttributes=function(t){this._layoutAttrs=t},g.prototype.getLayoutAttributes=function(){return this._layoutAttrs},g.prototype.setSelected=function(t){this._selected=t},g.prototype.getSelected=function(){return this._selected},g.prototype.setLabelRotationAngle=function(t){this._labelRotAngle=t,this.setDirty()},g.prototype.getLabelRotationAngle=function(){return this._labelRotAngle},g.prototype.setLabelRotationPoint=function(t){this._labelRotPoint=t,this.setDirty()},g.prototype.getLabelRotationPoint=function(){return this._labelRotPoint},g.prototype.setPromoted=function(t){this._bPromoted=t},g.prototype.isPromoted=function(){return this._bPromoted},g.prototype.setLabelValign=function(t){this._labelValign=t,this.setDirty()},g.prototype.setLabelHalign=function(t){this._labelHalign=t,this.setDirty()},g.prototype.getLabelValign=function(){return this._labelValign},g.prototype.getLabelHalign=function(){return this._labelHalign},g.prototype.setCoordinateSpace=function(t){this._coordinateContainerId=t,this.setDirty()},g.prototype.getCoordinateSpace=function(){return this._coordinateContainerId},g.prototype.setData=function(t){this._data=t},g.prototype.getData=function(){return this._data},g.prototype.setDirty=function(){this.LayoutContext&&this.LayoutContext.getDirtyContext().set(this.getId(),!0)},g.prototype.copyFrom=function(t){t&&(this.setPoints(t.getPoints()),this.setLabelPosition(t.getLabelPosition()),this.setLabelRotationAngle(t.getLabelRotationAngle()),this.setLabelRotationPoint(t.getLabelRotationPoint()),this.setLabelValign(t.getLabelValign()),this.setLabelHalign(t.getLabelHalign()),this.setCoordinateSpace(t.getCoordinateSpace()))};var u=function(t,e,n){this.Init(t,e,n)};e.Obj.createSubclass(u,n.PanZoomComponent,"DvtBaseDiagram"),u.prototype.Init=function(t,n,o){u.superclass.Init.call(this,t,n,o),this.getCtx().getStage().getElem().setAttributeNS(null,"text-rendering","geometricPrecision"),this._linksPane=new e.Container(t),this._nodesPane=new e.Container(t),this._topPane=new e.Container(t),e.Agent.isTouchDevice()&&(this._touchEventPane=new e.Container(t),this._touchEventPane.setStyle({display:"none"})),this.InitializeZoomLimits()},u.prototype.InitComponentInternal=function(){var t=this.getPanZoomCanvas();t.setMinZoom(this.getMinZoom()),t.setMaxZoom(this.getMaxZoom()),t.setAnimationDuration(this.getAnimationDuration()),t.getContentPane().addChild(this._linksPane),t.getContentPane().addChild(this._nodesPane),t.getContentPane().addChild(this._topPane),this._touchEventPane&&t.getContentPane().addChild(this._touchEventPane)},u.prototype.getAnimationDuration=function(){return DEFAULT_ANIMATION_DURATION},u.prototype.setMaxZoom=function(t){this._maxZoom=t,this.getPanZoomCanvas()&&this.getPanZoomCanvas().setMaxZoom(t)},u.prototype.getMaxZoom=function(){return this._maxZoom},u.prototype.setMinZoom=function(t){this._minZoom=t,this.getPanZoomCanvas()&&this.getPanZoomCanvas().setMinZoom(t)},u.prototype.getMinZoom=function(){return this._minZoom},u.prototype.InitializeZoomLimits=function(){this.setMaxZoom(2),this.setMinZoom(0)},u.prototype.getNodeById=function(t){return null},u.prototype.getLinkById=function(t){return null},u.prototype.GetAllLinks=function(){return[]},u.prototype.GetAllNodes=function(){return[]},u.prototype.GetAllRoots=function(){return[]},u.prototype.RefreshEmptyText=function(t){if(t&&this.getEmptyText())this._emptyTextDisplay?(this._emptyTextDisplay.setX(this.Width/2),this._emptyTextDisplay.setY(this.Height/2),e.TextUtils.fitText(this._emptyTextDisplay,this.getWidth()-2*e.TextUtils.EMPTY_TEXT_BUFFER,1/0,this)):this._emptyTextDisplay=this.CreateEmptyText(this.getEmptyText());else if(this._emptyTextDisplay){var n=this._emptyTextDisplay.getParent();n&&n.removeChild(this._emptyTextDisplay),this._emptyTextDisplay=null}},u.prototype.CreateEmptyText=function(t){var n=this.getOptions();return this.renderEmptyText(this,t,new e.Rectangle(0,0,this.getWidth(),this.getHeight()),this.getEventManager(),n._statusMessageStyle)},u.prototype.setEmptyText=function(t){this._emptyText=t},u.prototype.getEmptyText=function(){return this._emptyText},u.prototype.SetPanningEnabled=function(t){this._panningEnabled=t},u.prototype.IsPanningEnabled=function(){return this._panningEnabled},u.prototype.setPanDirection=function(t){this._panDirection=t,this.getPanZoomCanvas()&&this.getPanZoomCanvas().setPanDirection(t)},u.prototype.getPanDirection=function(){return this._panDirection},u.prototype.SetZoomingEnabled=function(t){this._zoomingEnabled=t},u.prototype.IsZoomingEnabled=function(){return this._zoomingEnabled},u.prototype.getSelectionHandler=function(){return this._selectionHandler},u.prototype.setSelectionMode=function(t){this._selectionHandler="single"==t?new e.SelectionHandler(this.getCtx(),e.SelectionHandler.TYPE_SINGLE):"multiple"==t?new e.SelectionHandler(this.getCtx(),e.SelectionHandler.TYPE_MULTIPLE):null,this.getEventManager().setSelectionHandler(this._selectionHandler)},u.prototype.getSelectionMode=function(){return this._selectionHandler?this._selectionHandler.getType():null},u.prototype.isSelectionSupported=function(){return!!this._selectionHandler},u.prototype.getNodesPane=function(){return this._nodesPane},u.prototype.setNodesPane=function(t){this._nodesPane=t},u.prototype.getLinksPane=function(){return this._linksPane},u.prototype.setLinksPane=function(t){this._linksPane=t},u.prototype.getTopPane=function(){return this._topPane},u.prototype.setTopPane=function(t){this._topPane=t},u.prototype.getTouchEventPane=function(){return this._touchEventPane||null},u.prototype.getBottomPane=function(){this._bottomPane||(this._bottomPane=new e.Container(this.getCtx()),this.getPanZoomCanvas().getContentPane().addChildAt(this._bottomPane,0));return this._bottomPane},u.prototype.CreateEmptyLayoutContext=function(){var t=new r(this.getCtx());return t.setLocaleR2L(e.Agent.isRightToLeft(this.getCtx())),t.setComponentSize(new d(0,0,this.getWidth(),this.getHeight())),t},u.prototype.CreateLayoutContextNode=function(t,e,n,o){var i=new h;i.setId(t.getId?t.getId():t.getData().getId()),i.setBounds(l.convertRectToDiagramRect(t.getLayoutBounds())),i.setContentBounds(l.convertRectToDiagramRect(t.getContentBounds()));var s=t.getLayoutAttributes?t.getLayoutAttributes(e):t.getData()._itemData;return i.setLayoutAttributes(s),i.setData(s),i.setLabelBounds(l.convertRectToDiagramRect(t.getLabelBounds())),i.setLabelPosition(l.convertPointToDiagramPoint(t.getLabelPosition())),i.setSelected(1==t.isSelected()),t.isDisclosed()&&(i.setDisclosed(!0),i.SetContainerPaddingObj(u.getLayoutContainerPadding(t.getContainerPadding()))),i.setContainerId(t.getGroupId()),i.Component=this,i.IsRendered=!n,i.LayoutContext=o,i},u.prototype.CreateLayoutContextLink=function(t,e,n,o,i){var s,a=new g;return a.setId(t.getId?t.getId():t.getData().getId()),a.setStartId(e||t.getData().getStartId()),a.setEndId(n||t.getData().getEndId()),t.isPromoted()?(s=t.getData()._links,this.isDataProviderMode()&&(s=s.map(function(t){return t._itemData}))):s=t.getData()._itemData,a.setLayoutAttributes(s),a.setData(s),a.setLabelBounds(l.convertRectToDiagramRect(t.getLabelBounds())),a.setLabelPosition(l.convertPointToDiagramPoint(t.getLabelPosition())),a.setStartConnectorOffset(t.getStartConnectorOffset()),a.setEndConnectorOffset(t.getEndConnectorOffset()),a.setLinkWidth(t.getLinkWidth()),a.setSelected(1==t.isSelected()),a.setPromoted(1==t.isPromoted()),a.LayoutContext=i,a},u.prototype.ApplyLayoutContext=function(t,n){var o=t.getContainerPadding();if(o){var a=t.getContainerId();if(a){var r=this.getNodeById(a);r&&r.setContainerPadding(u.getContainerPadding(o))}}for(var d=Number.MAX_VALUE,h=Number.MAX_VALUE,g=0;g<t.getNodeCount();g++){(D=(b=t.getNodeByIndex(g)).getPosition())&&(d=Math.min(d,D.x),h=Math.min(h,D.y));var p=b.getLabelBounds(),c=b.getLabelPosition();p&&c&&(d=Math.min(d,c.x+p.x),h=Math.min(h,c.y+p.y))}for(var _=0;_<t.getLinkCount();_++){var f=t.getLinkByIndex(_),y=i.GetLinkBounds(f);d=Math.min(d,y.x),h=Math.min(h,y.y)}var C=new e.Point(-d,-h),m=C.x,v=C.y,S=t.getDirtyContext();for(g=0;g<t.getNodeCount();g++){var b;if((b=t.getNodeByIndex(g)).getContainerId()&&(b.ContentOffset=new s(C.x,C.y)),S.has(b.getId())){var D,N=this.getNodeById(b.getId());if((D=b.getPosition())&&N.SetPosition(D.x+m,D.y+v),this.ApplyLabelPosition(b,N,l.convertDiagramPointToPoint(D)),N.isDisclosed()){var E=b.getContainerPadding();E&&N.setContainerPadding(u.getContainerPadding(E))}}}for(_=0;_<t.getLinkCount();_++){f=t.getLinkByIndex(_);if(S.has(f.getId())){var k=this.getLinkById(f.getId()),P=this.GetLinkTranslationOffset(k,f,C),O=P.x,I=P.y,L=f.getPoints();L&&k.setPoints(L),k.setTranslate(O,I),this.ApplyLabelPosition(f,k,new e.Point(0,0))}}var T=t.getViewport();T&&(this._layoutViewport=new e.Rectangle(T.x+m,T.y+v,T.w,T.h)),n&&(this._layoutOffset=new e.Point(m,v))},u.prototype.GetLinkTranslationOffset=function(t,n,o){var i=new e.Point(0,0),s=this.getCtx();if(t.getGroupId()){if(!a.compareValues(s,t.getGroupId(),n.getCoordinateSpace())){for(var r=n.getCoordinateSpace(),d=this.getNodeById(t.getGroupId());d;){var h=d.getContainerPadding();i.x-=h.left-d.GetPosition().x,i.y-=h.top-d.GetPosition().y;var l=d.getGroupId();d=a.compareValues(s,l,r)?null:this.getNodeById(l)}r||(i.x+=o.x,i.y+=o.y)}}else i=o;return i},u.prototype.GetLayoutViewport=function(){return this._layoutViewport},u.prototype.IsLayoutViewport=function(){return!!this._layoutViewport},u.prototype.ClearLayoutViewport=function(){this._layoutViewport=null},u.prototype.AdjustMinZoom=function(){if(0==this.getMinZoom()){var t=this.getPanZoomCanvas(),e=this.GetViewBounds(),n=this.CalculateMinimumScale(e);return t.setMinZoom(this.GetMinZoomFactor()*Math.min(n,t.getMaxZoom())),e}return null},u.prototype.GetMinZoomFactor=function(){return 1},u.prototype.CalculateMinimumScale=function(t){if(!t)return 0;var e=this.getPanZoomCanvas(),n=(this.Width-2*e.getZoomToFitPadding())/t.w,o=(this.Height-2*e.getZoomToFitPadding())/t.h;return Math.min(n,o)},u.prototype.GetViewBounds=function(){if(this._cachedViewBounds)return this._cachedViewBounds;for(var t,e,n,o,s,a,r,d,h,l=null,g=this.GetAllRoots(),u=0;u<g.length;u++)s=g[u],(o=this.getNodeById(s))&&o.getVisible()&&(t=o.GetNodeBounds(),e=o.getTranslateX(),n=o.getTranslateY(),t.x+=e,t.y+=n,l?(d=l.x,h=l.y,l.x=Math.min(l.x,t.x),l.y=Math.min(l.y,t.y),l.w=Math.max(d+l.w,t.x+t.w)-l.x,l.h=Math.max(h+l.h,t.y+t.h)-l.y):l=t);var p=this.GetAllLinks();for(u=0;u<p.length;u++)if(r=p[u],(a=this.getLinkById(r))&&a.getVisible()){if(a.getGroupId())continue;t=i.GetLinkBounds(a),e=a.getTranslateX(),n=a.getTranslateY(),t.x+=e,t.y+=n,l?(d=l.x,h=l.y,l.x=Math.min(l.x,t.x),l.y=Math.min(l.y,t.y),l.w=Math.max(d+l.w,t.x+t.w)-l.x,l.h=Math.max(h+l.h,t.y+t.h)-l.y):l=t}return l},u.RotateBounds=function(t,n,o){if(null==n&&!o)return t;var i=new e.Point(t.x,t.y),s=new e.Point(t.x+t.w,t.y),a=new e.Point(t.x,t.y+t.h),r=new e.Point(t.x+t.w,t.y+t.h),d=new e.Matrix;null!=n&&(o&&(d=d.translate(-o.x,-o.y)),d=d.rotate(n),o&&(d=d.translate(o.x,o.y)));var h=d.transformPoint(i),l=d.transformPoint(s),g=d.transformPoint(a),u=d.transformPoint(r),p=Math.min(Math.min(h.x,l.x),Math.min(g.x,u.x)),c=Math.max(Math.max(h.x,l.x),Math.max(g.x,u.x)),_=Math.min(Math.min(h.y,l.y),Math.min(g.y,u.y)),f=Math.max(Math.max(h.y,l.y),Math.max(g.y,u.y));return new e.Rectangle(p,_,c-p,f-_)},u.prototype.ConstrainPanning=function(t,e,n,o,i){var s,a,r,d,h=this.getPanZoomCanvas();if("fixed"===this.Options.panning){var l=h.getMinZoom(),g=(h.getSize().w-n*l)/2-t*l,u=(h.getSize().h-o*l)/2-e*l,p=i/l;s=h.getSize().w-h.getSize().w*p+g*p,r=h.getSize().h-h.getSize().h*p+u*p,a=g*p,d=u*p}else{var c=h.getSize().w/2,_=h.getSize().h/2;s=c-(n+t)*i,r=_-(o+e)*i,a=c-t*i,d=_-e*i}if(this.IsLayoutViewport()){var f,y,C=this.GetLayoutViewport();-C.x*i<s?(s-=f=s+C.x*i,a+=f):-C.x*i>a&&(s-=f=-C.x*i-a,a+=f),-C.y*i<r?(r-=y=r+C.y*i,d+=y):-C.y*i>d&&(r-=y=-C.y*i-d,d+=y)}h.setMinPanX(s),h.setMinPanY(r),h.setMaxPanX(a),h.setMaxPanY(d),this.Overview&&this.Overview.updateConstraints(s,r,a,d)},u.getContainerPadding=function(t){var e=new Object;return e.top=t.top,e.right=t.right,e.bottom=t.bottom,e.left=t.left,e},u.getLayoutContainerPadding=function(t){var e=new Object;return e.top=t.top,e.right=t.right,e.bottom=t.bottom,e.left=t.left,e},u.prototype.ApplyLabelPosition=function(t,n,o){var i=t.getLabelBounds();i=l.convertDiagramRectToRect(i);var s=t.getLabelPosition();if(i&&s){var a=new e.Point(s.x-o.x,s.y-o.y),r=t.getLabelRotationAngle(),d=l.convertDiagramPointToPoint(t.getLabelRotationPoint());n.setLabelBounds(i),n.setLabelPosition(a),n.setLabelAlignments(t.getLabelHalign(),t.getLabelValign()),null!=r&&n.setLabelRotationAngle(r),d&&n.setLabelRotationPoint(d)}},u.prototype.getLayoutOffset=function(){return this._layoutOffset?this._layoutOffset:new e.Point(0,0)},u.prototype.getCustomObjKeyboardBoundingBox=function(t){var n=t.getElem().getBoundingClientRect(),o=this.getPanZoomCanvas().getContentPane().getElem().getBoundingClientRect(),i=this.getPanZoomCanvas().getContentPane().getMatrix();return new e.Rectangle(n.left-o.left+i.getTx(),n.top-o.top+i.getTy(),n.width,n.height)};var p=function(t){this.Init({alta:p.SKIN_ALTA},t)};e.Obj.createSubclass(p,e.BaseComponentDefaults,"DvtDiagramDefaults"),p.SKIN_ALTA={skin:e.CSSStyle.SKIN_ALTA,emptyText:null,selectionMode:"none",animationOnDataChange:"none",animationOnDisplay:"none",maxZoom:1,highlightMatch:"all",nodeHighlightMode:"node",linkHighlightMode:"link",panning:"none",overview:{fitArea:"content",preserveAspectRatio:"meet"},touchResponse:"auto",zooming:"none",promotedLinkBehavior:"lazy",_statusMessageStyle:new e.CSSStyle(e.BaseComponentDefaults.FONT_FAMILY_ALTA),dnd:{drag:{nodes:{},ports:{}},drop:{background:{},nodes:{},links:{},ports:{}}},styleDefaults:{animationDuration:500,hoverBehaviorDelay:200,_highlightAlpha:.1,_overviewStyles:{overview:{backgroundColor:"rgb(228,229,230)"},overviewContent:{padding:"10px"},viewport:{backgroundColor:"rgb(255,255,255)",borderColor:"rgb(74,76,78)"},node:{shape:"inherit"}},nodeDefaults:{_containerStyle:new e.CSSStyle("border-color:#abb3ba;background-color:#f9f9f9;border-width:.5px;border-radius:1px;padding-top:20px;padding-left:20px;padding-bottom:20px;padding-right:20px;"),labelStyle:new e.CSSStyle(e.BaseComponentDefaults.FONT_FAMILY_ALTA_BOLD_12+"color:#383A47"),hoverInnerColor:"rgb(255,255,255)",hoverOuterColor:"rgba(0,0,0, .3)",selectionColor:"rgb(0,0,0)",icon:{width:10,height:10,pattern:"none",shape:"circle"}},linkDefaults:{startConnectorType:"none",endConnectorType:"none",width:1,_style:{_type:"solid"},hoverInnerColor:"rgb(255,255,255)",hoverOuterColor:"rgba(0,0,0, .3)",selectionColor:"rgb(0,0,0)",labelStyle:new e.CSSStyle(e.BaseComponentDefaults.FONT_FAMILY_ALTA_BOLD_12+"color:#383A47"),_hitDetectionOffset:10},promotedLink:{startConnectorType:"none",endConnectorType:"none",width:1,_style:{_type:"dot",strokeDasharray:"2,3"},color:"#778999",hoverInnerColor:"rgb(255,255,255)",hoverOuterColor:"rgba(0,0,0, .3)",selectionColor:"rgb(0,0,0)",_hitDetectionOffset:10}}},p.prototype.getNoCloneObject=function(){return{data:!0,nodeData:!0,linkData:!0,nodes:!0,links:!0}};var c=function(t,e){c.superclass.constructor.call(this,t,e),this.setHoverDelay(c._HOVER_DELAY),this._diagram=e};e.Obj.createSubclass(c,e.CategoryRolloverHandler,"DvtDiagramCategoryRolloverHandler"),c._HOVER_DELAY=100,c.prototype.GetRolloverCallback=function(t,n,o,i){return e.Obj.createCallback(this,function(){this.SetHighlightMode(!0),this._diagram.processEvent(t)})},c.prototype.GetRolloutCallback=function(t,n,o,i){return e.Obj.createCallback(this,function(){this.SetHighlightModeTimeout(),this._diagram.processEvent(t)})};var _=function(t,e,n){this.Init(t,e,n)};e.Obj.createSubclass(_,e.Container,"DvtBaseDiagramNode"),_.prototype.Init=function(t,e,n){_.superclass.Init.call(this,t,null,e),this._diagram=n,this._bDisclosed=!1,this._selected=!1,this._selectable=!0},_.prototype.getDisplayable=function(){return this},_.prototype.GetDiagram=function(){return this._diagram},_.prototype.getData=function(){return null},_.prototype.getLayoutBounds=function(t){return this.getContentBounds(t)},_.prototype.getContentBounds=function(t){return null},_.prototype.setLabelPosition=function(t){t&&(this._labelPos=t,_.PositionLabel(this._labelObj,t,this.getLabelBounds(!0),this.getLabelRotationAngle(),this.getLabelRotationPoint()))},_.prototype.getLabelPosition=function(){return this._labelPos},_.prototype.getLabelBounds=function(t){return null},_.prototype.setLabelBounds=function(t){},_.prototype.getContainerPadding=function(){return null},_.prototype.setContainerPadding=function(t,e,n,o){},_.prototype.isDisclosed=function(){return this._bDisclosed},_.prototype.setDisclosed=function(t){this._bDisclosed=t},_.prototype.isSelected=function(){return this._selected},_.prototype.setSelected=function(t){this._selected=t},_.prototype.setSelectable=function(t){this._selectable=t},_.prototype.isSelectable=function(){return this.GetDiagram().isSelectionSupported()&&this._selectable},_.prototype.setLabelRotationAngle=function(t){this._labelRotAngle=t,_.PositionLabel(this._labelObj,this.getLabelPosition(),this.getLabelBounds(!0),t,this.getLabelRotationPoint())},_.prototype.getLabelRotationAngle=function(){return this._labelRotAngle},_.prototype.setLabelRotationPoint=function(t){this._labelRotPoint=t,_.PositionLabel(this._labelObj,this.getLabelPosition(),this.getLabelBounds(!0),this.getLabelRotationAngle(),t)},_.prototype.getLabelRotationPoint=function(){return this._labelRotPoint},_.prototype.GetNodeBounds=function(){var t=this.getLayoutBounds(!0),n=new e.Rectangle(t.x,t.y,t.w,t.h),o=o=this.getLabelPosition(),i=this.getLabelRotationAngle(),s=this.getLabelRotationPoint(),a=this.getLabelBounds(!0);return o&&a&&(null!=i&&(a=u.RotateBounds(a,i,s)),n.x=Math.min(t.x,a.x+o.x),n.y=Math.min(t.y,a.y+o.y),n.w=Math.max(t.x+t.w,a.x+o.x+a.w)-n.x,n.h=Math.max(t.y+t.h,a.y+o.y+a.h)-n.y),n},_.CalcLabelMatrix=function(t,n,o,i){var s=new e.Matrix;return null!=o&&(i&&(s=s.translate(-i.x,-i.y)),s=s.rotate(o),i&&(s=s.translate(i.x,i.y))),t&&(s=s.translate(t.x,t.y)),s},_.PositionLabel=function(t,e,n,o,i){if(t){var s=_.CalcLabelMatrix(e,n,o,i);t.setMatrix(s)}},_.prototype.SetPosition=function(t,e){this.setTranslate(t,e)},_.prototype.GetPosition=function(){return new e.Point(this.getTranslateX(),this.getTranslateY())},_.prototype.getNextNavigable=function(t){return null},_.prototype.getKeyboardBoundingBox=function(t){if(this._customNodeContent)return this._diagram.getCustomObjKeyboardBoundingBox(this);var n=this.getContentBounds(t),o=this.localToStage(new e.Point(n.x,n.y)),i=this.localToStage(new e.Point(n.x+n.w,n.y+n.h));return new e.Rectangle(o.x,o.y,i.x-o.x,i.y-o.y)},_.prototype.getTargetElem=function(){return this.getElem()},_.prototype.showKeyboardFocusEffect=function(){},_.prototype.hideKeyboardFocusEffect=function(){},_.prototype.isShowingKeyboardFocusEffect=function(){},_.prototype.getCategories=function(){return null},_.prototype.addOutLinkId=function(t){this._outLinkIds||(this._outLinkIds=[]),this._outLinkIds.push(t)},_.prototype.removeOutLinkId=function(t){if(this._outLinkIds){var e=this._outLinkIds.indexOf(t);-1!=e&&this._outLinkIds.splice(e,1)}},_.prototype.getOutLinkIds=function(){return this._outLinkIds},_.prototype.addInLinkId=function(t){this._inLinkIds||(this._inLinkIds=[]),this._inLinkIds.push(t)},_.prototype.removeInLinkId=function(t){if(this._inLinkIds){var e=this._inLinkIds.indexOf(t);-1!=e&&this._inLinkIds.splice(e,1)}},_.prototype.getInLinkIds=function(){return this._inLinkIds},_.prototype.setLabelAlignments=function(t,e){},_.prototype.getGroupId=function(){return null};const f=0,y=1,C=2;var m=function(t,e,n){this.Init(t,e,n)};e.Obj.createSubclass(m,_,"DvtDiagramNode"),m.LTR_BUTTON_PATH="M1 0 19 0 A 1 1 0 0 1 19 1 L 1 19 A 1 1 0 0 1 0 19 L 0 1 A 1 1 0 0 1 1 0z",m.RTL_BUTTON_PATH="M1 0 19 0 A 1 1 0 0 1 20 1 L 20 19 A 1 1 0 0 1 19 19 L 1 1 A 1 1 0 0 1 1 0z",m.newInstance=function(t,e){return new m(t.getCtx(),t,e)},m.prototype.Init=function(t,n,o){m.superclass.Init.call(this,t,o.id,n),this._data=o,this._isHighlighted=!0,this._hasContentBoundToTouchEvent=!1,this._contentStoredInTouchEventContainer=null,this.isSelectable()&&this.setCursor(e.SelectionEffectUtils.getSelectingCursor())},m.prototype.getData=function(){return this._data},m.prototype.setData=function(t){this._data=t},m.prototype.getId=function(){return this._data.id},m.prototype.getContentBounds=function(t){return!this._contentDims&&t&&(this._contentDims=this._calcContentDims()),this._contentDims},m.prototype.getLabelBounds=function(t){var e=null;return this._labelObj&&t&&(e=this._labelObj.getDimensions()),e},m.prototype.setSelected=function(t){var e=this._getState();m.superclass.setSelected.call(this,t);var n=this._getCustomRenderer("selectionRenderer");n?this._applyCustomNodeContent(n,this._getState(),e):this.processDefaultSelectionEffect(t),this.UpdateAriaLabel()},m.prototype.processDefaultSelectionEffect=function(t){this.getSelectionShape()&&this.getSelectionShape().setSelected(t)},m.prototype.isSelectable=function(){return this.GetDiagram().isSelectionSupported()&&"off"!=this.getData().selectable},m.prototype.GetIcon=function(){return this._shape},m.prototype.render=function(){this._cleanUp();var t=this.getData(),e=this._getCustomRenderer("renderer");if(e){if(this._applyCustomNodeContent(e,this._getState(),null),this.isDisclosed()){var n=this.GetDiagram().getPanZoomCanvas().getZoom(),o=this.getElem().getBoundingClientRect(),i=this._childNodePane?this._childNodePane.getElem().getBoundingClientRect():null;this._containerPadding={left:(i.left-o.left)/n,right:(o.right-i.right)/n,top:(i.top-o.top)/n,bottom:(o.bottom-i.bottom)/n}}this._selectionShape&&(this.removeChild(this._selectionShape),this._selectionShape=null)}else this.isDisclosed()?m._renderContainer(this._diagram,t,this):(m._renderNodeBackground(this._diagram,t,this),m._renderNodeIcon(this._diagram,t,this)),m._addHoverSelectionDefaultStrokes(this.getSelectionShape(),t);m._renderNodeLabels(this._diagram,t,this),this._setDraggableStyleClass(),m._renderContainerButton(this._diagram,t,this),this.setAriaRole("img"),this.UpdateAriaLabel(),this._diagram.getEventManager().associate(this,this)},m.prototype._applyCustomNodeContent=function(t,n,o){var i=this._diagram.getOptions()._contextHandler;if(i){var s=this.getDataContext(),a=null;if(this.isDisclosed()){var r=this.GetChildNodePane(),d=r.getDimensions();a={element:r.getElem(),w:d?d.w-d.x:null,h:d?d.h-d.y:null}}var h=t(i("node",this.getElem(),this._customNodeContent,a,s,n,o));if(h||!this._customNodeContent||!this.getCtx().isCustomElement()){if(this._customNodeContent&&h!=this._customNodeContent)this._checkAndMoveContents()||(this._customNodeContent.namespaceURI===e.ToolkitUtils.SVG_NS?this.getContainerElem().removeChild(this._customNodeContent):Array.isArray(this._customNodeContent)?this._customNodeContent.forEach(function(t){this.getContainerElem().removeChild(t)}.bind(this)):this.removeChild(h)),this._customNodeContent=null;h===this._contentStoredInTouchEventContainer&&(this._hasContentBoundToTouchEvent=!0),h&&h.namespaceURI===e.ToolkitUtils.SVG_NS?this._customNodeContent||(e.ToolkitUtils.appendChildElem(this.getContainerElem(),h),this._customNodeContent=h):h&&Array.isArray(h)?this._customNodeContent||(h.forEach(function(t){e.ToolkitUtils.appendChildElem(this.getContainerElem(),t)}.bind(this)),this._customNodeContent=h):h instanceof e.BaseComponent?this._customNodeContent||(this.addChild(h),this._customNodeContent=h):h&&this._diagram.Log("Diagram: could not add custom node content for the node "+this.getId()+h,1)}}else this._diagram.Log("Diagram: could not add custom node content - context handler is undefined",1)},m._renderNodeBackground=function(t,n,o){if(!t.getCtx().isCustomElement()){var i=n.backgroundSvgStyle||n.backgroundStyle,s=e.JsonUtils.clone(i),a=[e.CSSStyle.WIDTH,e.CSSStyle.HEIGHT,e.CSSStyle.BACKGROUND_COLOR,e.CSSStyle.BORDER_COLOR,e.CSSStyle.BORDER_WIDTH,e.CSSStyle.BORDER_RADIUS];if(!(i=m._getNodeCSSStyle(s,n._backgroundStyle,a)).isEmpty()){var r=e.CSSStyle.toNumber(i.getStyle(e.CSSStyle.WIDTH)),d=e.CSSStyle.toNumber(i.getStyle(e.CSSStyle.HEIGHT)),h=i.getStyle(e.CSSStyle.BACKGROUND_COLOR),l=i.getStyle(e.CSSStyle.BORDER_COLOR),g=e.CSSStyle.toNumber(i.getStyle(e.CSSStyle.BORDER_WIDTH)),u=e.CSSStyle.toNumber(i.getStyle(e.CSSStyle.BORDER_RADIUS)),p=new e.Rect(t.getCtx(),0,0,r,d);p.setSolidFill(h),u&&(p.setRx(u),p.setRy(u)),l&&p.setStroke(new e.Stroke(l,1,g)),s&&a.forEach(function(t){delete s[e.CSSStyle.cssStringToObjectProperty(t)]});var c=n.backgroundSvgClassName||n.backgroundClassName;p.setStyle(s).setClassName(c),o.addChild(p),o.setSelectionShape(p),o._background=p}}},m._renderNodeIcon=function(t,n,o){var i=n.icon;if(i){var s,a=i.width,r=i.height,d=i.color,h=i.borderRadius;s=i.source?new e.ImageMarker(t.getCtx(),a/2,r/2,a,r,h,i.source,i.sourceSelected,i.sourceHover,i.sourceHoverSelected):new e.SimpleMarker(t.getCtx(),i.shape,a/2,r/2,a,r,h),"none"!=i.pattern?s.setFill(new e.PatternFill(i.pattern,d)):s.setSolidFill(d),null!=i.opacity&&s.setAlpha(i.opacity),i.borderColor&&s.setStroke(new e.Stroke(i.borderColor,1,i.borderWidth));var l=i.svgStyle||i.style,g=i.svgClassName||i.className;s.setStyle(l).setClassName(g),o.addChild(s),o._shape=s,m._setIconPosition(t,n,o),o._background||o.setSelectionShape(s)}},m._setIconPosition=function(t,n,o){if(o._background){var i=n.icon,s=o._background.getWidth(),a=o._background.getHeight(),r=i.width,d=i.height,h=.5*(s-r),l=.5*(a-d);if(void 0!==i.positionX)h=parseFloat(i.positionX),e.Agent.isRightToLeft(o.getCtx())&&(h=s-h-r);else{var g=i.halign;"start"==g?g=e.Agent.isRightToLeft(o.getCtx())?"right":"left":"end"==g&&(g=e.Agent.isRightToLeft(o.getCtx())?"left":"right"),h="left"==g?0:"right"==g?s-r:h}void 0!==i.positionY?l=parseFloat(i.positionY):"top"==i.valign?l=0:"bottom"==i.valign&&(l=a-d),o._shape.setTranslate(h,l)}},m._renderNodeLabels=function(t,n,o){var i=n.label;if(i){var s=e.Agent.isRightToLeft(t.getCtx()),a=i.indexOf("\n")>0,r=a?s?e.MultilineText.H_ALIGN_RIGHT:e.MultilineText.H_ALIGN_LEFT:s?e.OutputText.H_ALIGN_RIGHT:e.OutputText.H_ALIGN_LEFT,d=a?e.MultilineText.V_ALIGN_TOP:e.OutputText.V_ALIGN_TOP,h=m.createText(t.getCtx(),i,n.labelStyle,r,d,a),l=n.labelStyle.getMaxWidth()||n.labelStyle.getWidth(),g=e.CSSStyle.toNumber(l);l?g>0&&e.TextUtils.fitText(h,g,1/0,o)&&(o._labelObj=h):(o.addChild(h),o._labelObj=h)}},m.createText=function(t,n,o,i,s,a){var r;return o.hasBackgroundStyles()?r=a?new e.BackgroundMultilineText(t,n,0,0,o,null,!0):new e.BackgroundOutputText(t,n,0,0,o):(r=a?new e.MultilineText(t,n,0,0,null,!0):new e.OutputText(t,n,0,0)).setCSSStyle(o),r.setHorizAlignment(i),r.setVertAlignment(s),r},m._addHoverSelectionDefaultStrokes=function(t,n){var o=n.hoverInnerColor,i=n.hoverOuterColor,s=n.selectionColor;if("redwood"===t.getCtx().getThemeBehavior()){if(n.icon&&n.icon.color)var a=n.icon.color;else a=i;var r=new e.Stroke(o,1,1,!0),d=new e.Stroke(a,1,3,!0),h=new e.Stroke(o,1,1,!0),l=new e.Stroke(s,1,3,!0);t.setHoverStroke(r,d).setSelectedStroke(h,l)}else{r=new e.Stroke(o,1,4,!0),d=new e.Stroke(i,1,8,!0),h=new e.Stroke(o,1,2,!0),l=new e.Stroke(s,1,6,!0);var g=new e.Stroke(o,1,4,!0),u=new e.Stroke(s,1,8,!0);t.setHoverStroke(r,d).setSelectedStroke(h,l).setSelectedHoverStroke(g,u)}},m._addHoverSelectionOuterStrokes=function(t,n){var o=n.hoverInnerColor,i=n.hoverOuterColor,s=n.selectionColor;if("redwood"===t.getCtx().getThemeBehavior()){var a=new e.Stroke(o,1,1,!0),r=new e.Stroke(i,1,3,!0),d=new e.Stroke(o,1,1,!0),h=new e.Stroke(s,1,3,!0);t.setHoverStroke(a,r).setSelectedStroke(d,h)}else{a=new e.Stroke(o,1,2,!0),r=new e.Stroke(i,1,2,!0),d=new e.Stroke(o,1,1,!0),h=new e.Stroke(s,1,2,!0);var l=new e.Stroke(o,1,2,!0),g=new e.Stroke(s,1,2,!0);t.setHoverStroke(a,r).setSelectedStroke(d,h).setSelectedHoverStroke(l,g)}},m.prototype.setSelectionShape=function(t){this._selectionShape=t},m.prototype.getSelectionShape=function(){if(!this._selectionShape){var t=this.getContentBounds(!0);if(t){var n=new e.Rect(this._diagram.getCtx(),t.x,t.y,t.w,t.h);n.setInvisibleFill(),n.setStrokeAlignment("outer"),this.setSelectionShape(n),this.addChildAt(n,0),m._addHoverSelectionOuterStrokes(n,this.getData()),this._selectionShape=n}}return this._selectionShape},m.prototype.handleTouchStart=function(){this._hasContentBoundToTouchEvent=!0},m.prototype.handleTouchEnd=function(){this._hasContentBoundToTouchEvent=!1,this._contentStoredInTouchEventContainer=null},m.prototype.showHoverEffect=function(){if(!this._isShowingHoverEffect){var t=this._getState();this._isShowingHoverEffect=!0;var e=this._getCustomRenderer("hoverRenderer");e?this._applyCustomNodeContent(e,this._getState(),t):this.processDefaultHoverEffect(!0)}},m.prototype.hideHoverEffect=function(){if(this._isShowingHoverEffect){var t=this._getState();this._isShowingHoverEffect=!1;var e=this._getCustomRenderer("hoverRenderer");e?this._applyCustomNodeContent(e,this._getState(),t):this.processDefaultHoverEffect(!1)}},m.prototype.processDefaultHoverEffect=function(t){this.getSelectionShape()&&(t?this.getSelectionShape().showHoverEffect():this.getSelectionShape().hideHoverEffect())},m.prototype.getDatatip=function(t,e,n){var o=this.GetDiagram().getOptions().tooltip,i=o?o.renderer:null;return i?this.GetDiagram().getCtx().getTooltipManager().getCustomTooltip(i,this.getDataContext()):this.getShortDesc()},m.prototype.getShortDesc=function(){return this.getData().shortDesc},m.prototype.getDataContext=function(){var t=this.getData(),e={id:this.getId(),type:"node",label:t.label,data:this.GetDiagram().isDataProviderMode()?t._noTemplate?t._itemData:t:t._itemData,itemData:this.GetDiagram().isDataProviderMode()?t._itemData:null,component:this.GetDiagram().getOptions()._widgetConstructor};return this.getCtx().fixRendererContext(e)},m.getShortDescContext=function(t){var e=t.getData();return{id:t.getId(),label:e.label,data:t.GetDiagram().isDataProviderMode()?e._noTemplate?e._itemData:e:e._itemData,itemData:t.GetDiagram().isDataProviderMode()?e._itemData:null}},m.prototype.getAriaLabel=function(){var t=[],n=this.GetDiagram().getOptions().translations;return this.isSelectable()&&t.push(n[this.isSelected()?"stateSelected":"stateUnselected"]),this.isContainer()&&t.push(n[this.isDisclosed()?"stateExpanded":"stateCollapsed"]),e.Displayable.generateAriaLabel(this.getShortDesc(),t,()=>m.getShortDescContext(this))},m.prototype.UpdateAriaLabel=function(){if(!e.Agent.deferAriaCreation()){var t=this.getAriaLabel();t&&this.setAriaProperty("label",t)}},m.prototype.getNextNavigable=function(t){var n=null;if(t.keyCode==e.KeyboardEvent.SPACE&&t.ctrlKey)n=this;else if((t.keyCode==e.KeyboardEvent.OPEN_ANGLED_BRACKET||e.KeyboardEvent.CLOSE_ANGLED_BRACKET)&&t.altKey){var o=this.GetDiagram().getNavigableLinksForNodeId(this.getId()),i=this.GetDiagram().getEventManager().getKeyboardHandler();i&&i.getFirstNavigableLink&&(n=i.getFirstNavigableLink(this,t,o)),n?n.setKeyboardFocusNode(this):n=this}else if(t.keyCode==e.KeyboardEvent.OPEN_BRACKET){if(this.isDisclosed())n=this.getChildNodes()[0];else n=this}else if(t.keyCode==e.KeyboardEvent.CLOSE_BRACKET){n=(s=this.getGroupId()?this.GetDiagram().getNodeById(this.getGroupId()):null)||this}else if(t.type==e.MouseEvent.CLICK)n=this;else{var s,a=(s=this.getGroupId()?this.GetDiagram().getNodeById(this.getGroupId()):null)?s.getChildNodes():this.GetDiagram().GetRootNodeObjects();n=e.KeyboardHandler.getNextAdjacentNavigable(this,t,a)}return t instanceof e.KeyboardEvent&&this._diagram.ensureObjInViewport(t,n),n},m.prototype.HandleKeyboardEvent=function(t){t.keyCode==e.KeyboardEvent.SPACE&&t.ctrlKey&&t.shiftKey&&this.isContainer()&&this.GetDiagram().setNodeDisclosed(this.getId(),!this.isDisclosed())},m.prototype.isContainer=function(){if(this._diagram.isTreeDataProvider()){var t=this._diagram.getOptions().nodeData.getChildDataProvider(this.getId());return!!t&&"yes"!==t.isEmpty()}return!this._diagram.isDataProviderMode()&&0!=this.GetDiagram().getOptions().data.getChildCount(this.getData())},m.prototype.showKeyboardFocusEffect=function(){if(!this.isShowingKeyboardFocusEffect()){var t=this._getState();this._isShowingKeyboardFocusEffect=!0;var e=this._getCustomRenderer("focusRenderer");e?this._applyCustomNodeContent(e,this._getState(),t):this.processDefaultFocusEffect(!0)}},m.prototype.hideKeyboardFocusEffect=function(){if(this.isShowingKeyboardFocusEffect()){var t=this._getState();this._isShowingKeyboardFocusEffect=!1;var e=this._getCustomRenderer("focusRenderer");e?this._applyCustomNodeContent(e,this._getState(),t):this.processDefaultFocusEffect(!1)}},m.prototype.processDefaultFocusEffect=function(t){this.processDefaultHoverEffect(t)},m.prototype.isShowingKeyboardFocusEffect=function(){return this._isShowingKeyboardFocusEffect},m.prototype.getCategories=function(){return this.getData().categories?this.getData().categories:[this.getId()]},m.prototype.isHidden=function(){var t=this.GetDiagram().getOptions().hiddenCategories;return!(!t||!e.ArrayUtils.hasAnyItem(t,this.getCategories()))},m.prototype._calcContentDims=function(){var t,n=null;if(this._customNodeContent)if(this._customNodeContent instanceof e.BaseComponent)(t=this._customNodeContent.getDimensions())&&(n=new e.Rectangle(t.x,t.y,t.w,t.h));else{var o=this._customNodeContent;if(Array.isArray(o))for(var i=0;i<o.length;i++)if(o[i].namespaceURI===e.ToolkitUtils.SVG_NS){o=o[i];break}(t=o.getBBox())&&(n=new e.Rectangle(t.x,t.y,t.width,t.height))}else this.isDisclosed()?n=this._containerShape.GetDimensionsWithStroke(this):(n=this._background?this._background.GetDimensionsWithStroke(this):null)&&this._shape?n=n.getUnion(this._shape.GetDimensionsWithStroke(this)):!n&&this._shape&&(n=this._shape.GetDimensionsWithStroke(this));return n},m.prototype.animateUpdate=function(t,n){var o=new e.CustomAnimation(this.getCtx(),null,t.getAnimationDuration());if(this.isDisclosed()||n.isDisclosed())if(this.isDisclosed()&&n.isDisclosed()){if(n._labelObj&&this._labelObj){u=n._labelObj.getMatrix(),p=this._labelObj.getMatrix();u.equals(p)||(this._labelObj.setMatrix(u),o.getAnimator().addProp(e.Animator.TYPE_MATRIX,this._labelObj,this._labelObj.getMatrix,this._labelObj.setMatrix,p))}if(this._getCustomRenderer("renderer"))this._animateCustomUpdate(t,n);else{if(m._animatePosition(o,n,this),m._animateContainer(o,n._containerShape,this._containerShape),e.Agent.isRightToLeft(this.getCtx())&&n._containerButton&&this._containerButton){var i=n._containerButton.getTranslateX(),s=this._containerButton.getTranslateX();i!=s&&(this._containerButton.setTranslateX(i),o.getAnimator().addProp(e.Animator.TYPE_NUMBER,this._containerButton,this._containerButton.getTranslateX,this._containerButton.setTranslateX,s))}if(!n.partialUpdate){for(var a=[],r=[],d=this.getChildNodeIds(),h=0;h<d.length;h++)a.push(this.GetDiagram().getNodeById(d[h]));var l=n.getChildNodeIds(),g=t.getOldDiagram().NodesMap;for(h=0;h<l.length;h++)r.push(g.get(l[h]));t.constructAnimation(r,a)}}}else this._animateCustomUpdate(t,n);else{if(m._animatePosition(o,n,this),n._shape&&this._shape&&(o.getAnimator().addProp(e.Animator.TYPE_RECTANGLE,this._shape,this._shape.getCenterDimensions,this._shape.setCenterDimensions,this._shape.getCenterDimensions()),this._shape.setCenterDimensions(n._shape.getCenterDimensions())),n._labelObj&&this._labelObj){var u=n._labelObj.getMatrix(),p=this._labelObj.getMatrix();u.equals(p)||(this._labelObj.setMatrix(u),o.getAnimator().addProp(e.Animator.TYPE_MATRIX,this._labelObj,this._labelObj.getMatrix,this._labelObj.setMatrix,p))}m._animateFill(o,n._background,this._background),m._animateFill(o,n._shape,this._shape)}t.add(o,y)},m.prototype._animateCustomUpdate=function(t,n){var o=n.getContentBounds(),i=this.getContentBounds();if(o.equals(i)){var s=new e.CustomAnimation(this.getCtx(),null,t.getAnimationDuration());return m._animatePosition(s,n,this),void t.add(s,y)}var a=i.w/o.w,r=o.w/i.w,d=(s=new e.CustomAnimation(this.getCtx(),null,t.getAnimationDuration()),new e.Point(n.getTranslateX()+.5*o.w,n.getTranslateY()+.5*o.h)),h=this.getTranslateX(),l=this.getTranslateY();this.setTranslateX(d.x-i.w*r*.5),this.setTranslateY(d.y-i.w*r*.5),s.getAnimator().addProp(e.Animator.TYPE_NUMBER,this,this.getTranslateX,this.setTranslateX,h),s.getAnimator().addProp(e.Animator.TYPE_NUMBER,this,this.getTranslateY,this.setTranslateY,l),t.add(s,y),this.setScaleX(r),this.setScaleY(r);var g=new e.AnimScaleTo(this.getCtx(),this,new e.Point(1,1),t.getAnimationDuration());t.add(g,y);var u=n.partialUpdate?n.origContent:n;if(u){this.getParent().addChild(u);var p=new e.Point(this.getTranslateX()+.5*i.w,this.getTranslateY()+.5*i.h);s.getAnimator().addProp(e.Animator.TYPE_NUMBER,u,n.getTranslateX,u.setTranslateX,p.x-o.w*a*.5),s.getAnimator().addProp(e.Animator.TYPE_NUMBER,u,n.getTranslateY,u.setTranslateY,p.y-o.h*a*.5);var c=new e.AnimScaleTo(this.getCtx(),u,new e.Point(a,a),t.getAnimationDuration());t.add(c,y);var _=new e.AnimFadeOut(this.getCtx(),u,t.getAnimationDuration());t.add(_,y);var f=this;e.Playable.appendOnEnd(_,function(){f.getParent().removeChild(u)}),this.setAlpha(0);var C=new e.AnimFadeIn(this.getCtx(),this,t.getAnimationDuration());t.add(C,y)}},m._animatePosition=function(t,n,o){if(o&&n){var i=n.getTranslateX(),s=n.getTranslateY(),a=o.getTranslateX(),r=o.getTranslateY();i!=a&&(o.setTranslateX(i),t.getAnimator().addProp(e.Animator.TYPE_NUMBER,o,o.getTranslateX,o.setTranslateX,a)),s!=r&&(o.setTranslateY(s),t.getAnimator().addProp(e.Animator.TYPE_NUMBER,o,o.getTranslateY,o.setTranslateY,r))}},m._animateContainer=function(t,n,o){o&&n&&(m._animateFill(t,n,o),t.getAnimator().addProp(e.Animator.TYPE_NUMBER,o,o.getWidth,o.setWidth,o.getWidth()),o.setWidth(n.getWidth()),t.getAnimator().addProp(e.Animator.TYPE_NUMBER,o,o.getHeight,o.setHeight,o.getHeight()),o.setHeight(n.getHeight()))},m._animateFill=function(t,n,o){n&&o&&o.getFill()instanceof e.SolidFill&&!o.getFill().equals(n.getFill())&&(t.getAnimator().addProp(e.Animator.TYPE_FILL,o,o.getFill,o.setFill,o.getFill()),o.setFill(n.getFill()))},m.prototype.animateDelete=function(t,n){this.GetDiagram().getNodesPane().addChild(this);var o=this,i=new e.AnimFadeOut(this.getCtx(),this,t.getAnimationDuration());e.Playable.appendOnEnd(i,function(){o.getParent().removeChild(o),o.destroy()}),t.add(i,f)},m.prototype.animateInsert=function(t){this.setAlpha(0),t.add(new e.AnimFadeIn(this.getCtx(),this,t.getAnimationDuration()),C)},m.prototype._getState=function(t){return{hovered:this._isShowingHoverEffect,selected:this.isSelected(),focused:this._isShowingKeyboardFocusEffect,zoom:t||this.GetDiagram().getPanZoomCanvas().getZoom(),expanded:this.isDisclosed()}},m.prototype.rerenderOnZoom=function(t){var e=this._getCustomRenderer("zoomRenderer");if(e){var n=this._getState(t.oldZoom),o=this._getState(t.newZoom);this._applyCustomNodeContent(e,o,n)}},m.prototype.highlight=function(t){if(this._isHighlighted!==t){this._isHighlighted=t;var e=t?1:this._diagram.getOptions().styleDefaults._highlightAlpha;!this._customNodeContent&&this.isDisclosed()?(this._containerShape&&this._containerShape.setAlpha(e),this._containerButton&&this._containerButton.setAlpha(e),this._labelObj&&this._labelObj.setAlpha(e),this._selectionShape&&this._selectionShape.setAlpha(e)):this.setAlpha(e)}},m.prototype.setLabelAlignments=function(t,n){var o=this._labelObj instanceof e.MultilineText||this._labelObj instanceof e.BackgroundMultilineText;"baseline"==n&&(n=o?e.MultilineText.V_ALIGN_TOP:e.OutputText.V_ALIGN_AUTO),this._labelObj.setHorizAlignment(t),this._labelObj.setVertAlignment(n)},m.prototype.getContainerPadding=function(){if(!this._containerPadding&&this._getCustomRenderer("renderer")){var t=this.GetDiagram().getPanZoomCanvas().getZoom(),e=this.getElem().getBoundingClientRect(),n=this._childNodePane?this._childNodePane.getElem().getBoundingClientRect():null;this._containerPadding={left:(n.left-e.left)/t,right:(e.right-n.right)/t,top:(n.top-e.top)/t,bottom:(e.bottom-n.bottom)/t}}else if(!this._containerPadding){var o=this._data.containerSvgStyle||this._data.containerStyle,i=m._getNodeCSSStyle(o,this._data._containerStyle,["padding-left","padding-right","padding-top","padding-bottom"]);this._containerPadding={left:i.getPadding("padding-left"),right:i.getPadding("padding-right"),top:i.getPadding("padding-top"),bottom:i.getPadding("padding-bottom")}}return this._containerPadding},m.prototype.getChildNodeIds=function(){return this._childNodeIds},m.prototype.addChildNodeId=function(t){this._childNodeIds||(this._childNodeIds=[]),this._childNodeIds.push(t)},m.prototype.removeChildNodeId=function(t){this._childNodeIds&&e.ArrayUtils.removeItem(this._childNodeIds,t)},m.prototype.removeChildNode=function(t){t&&(this.removeChildNodeId(t.getId()),this._childNodePane.removeChild(t))},m.prototype.getChildNodes=function(){for(var t=[],e=this._childNodeIds?this._childNodeIds.length:-1,n=0;n<e;n++){var o=this.GetDiagram().getNodeById(this._childNodeIds[n]);o&&t.push(o)}return t},m.prototype.setGroupId=function(t){this._groupId=t},m.prototype.getGroupId=function(){return this._groupId},m.prototype.GetChildNodePane=function(){return this._childNodePane||(this._childNodePane=new e.Container(this.getCtx()),this.addChild(this._childNodePane)),this._childNodePane},m.prototype.handleDisclosure=function(t){e.EventManager.consumeEvent(t),this._diagram.setNodeDisclosed(this.getId(),!this.isDisclosed())},m._renderContainer=function(t,n,o){var i=t.getCtx().isCustomElement()?null:n.containerSvgStyle||n.containerStyle,s=e.JsonUtils.clone(i),a=[e.CSSStyle.BACKGROUND_COLOR,e.CSSStyle.BORDER_COLOR,e.CSSStyle.BORDER_WIDTH,e.CSSStyle.BORDER_RADIUS],r=m._getNodeCSSStyle(s,n._containerStyle,a),d=r.getStyle(e.CSSStyle.BACKGROUND_COLOR),h=r.getStyle(e.CSSStyle.BORDER_COLOR),l=e.CSSStyle.toNumber(r.getStyle(e.CSSStyle.BORDER_WIDTH)),g=e.CSSStyle.toNumber(r.getStyle(e.CSSStyle.BORDER_RADIUS)),u=o.GetChildNodePane(),p=o.getContainerPadding();u.setTranslate(p.left,p.top);var c=u.getDimensionsWithStroke(),_=new e.Rect(t.getCtx(),0,0,c.w+p.left+p.right,c.h+p.top+p.bottom);_.setSolidFill(d),g&&(_.setRx(g),_.setRy(g)),h&&_.setStroke(new e.Stroke(h,1,l)),s&&a.forEach(function(t){delete s[e.CSSStyle.cssStringToObjectProperty(t)]});var f=t.getCtx().isCustomElement()?null:n.containerSvgClassName||n.containerClassName;_.setStyle(s).setClassName(f),o.addChildAt(_,0),o.setSelectionShape(_),o._containerShape=_},m._getNodeCSSStyle=function(t,n,o){var i=new e.CSSStyle;return o.forEach(function(o){var s=null,a=e.CSSStyle.cssStringToObjectProperty(o);t&&null!=t[a]?s=t[a]:n&&(s=n.getStyle(o)),i.setStyle(o,s)}),i},m._renderContainerButton=function(t,n,o){if(o.isContainer()&&"off"!=n.showDisclosure){var i=t.getCtx(),s=e.Agent.isRightToLeft(i),a=t.getOptions(),r=s?m.RTL_BUTTON_PATH:m.LTR_BUTTON_PATH,d=new e.Path(i,r),h=a._resources[o.isDisclosed()?"collapse":"expand"],l=e.ToolkitUtils.getIconStyle(i,h.icon),g=h.width/2+1,u=s?20-g:g,p=new e.IconButton(t.getCtx(),"outlined",{style:l,size:h.width,pos:{x:u,y:g}},d,null,o.handleDisclosure,o);o.addChild(p);var c=o.getContentBounds(!0);if(c){var _=s?c.x+c.w-20-.5:c.x+.5,f=c.y+.5;p.setTranslate(_,f)}o._containerButton=p}},m.prototype.isDragAvailable=function(t){return!0},m.prototype.getDragTransferable=function(t,e){return this._isDraggable()?[this.getId()]:null},m.prototype.getDragFeedback=function(t,e){if(this._diagram.getEventManager().LinkCreationStarted)return null;if(this._diagram.isSelectionSupported()&&this._diagram.getSelectionHandler().getSelectedCount()>1){for(var n=this._diagram.getSelectionHandler().getSelection(),o=[],i=0;i<n.length;i++)o.push(n[i]);return o}return this},m.prototype.ShowDropEffect=function(){this._dropEffect||this._createDropEffect("oj-active-drop")},m.prototype.ShowRejectedDropEffect=function(){this._dropEffect||this._createDropEffect("oj-invalid-drop")},m.prototype.ClearDropEffect=function(){this._dropEffect&&(this.removeChild(this._dropEffect),this._dropEffect=null)},m.prototype._createDropEffect=function(t){var n;if(this._customNodeContent||this.isDisclosed()||this._background||this._shape&&this._shape instanceof e.ImageMarker){var o=this.getContentBounds(!0);if(o){n=new e.Rect(this._diagram.getCtx(),o.x,o.y,o.w,o.h);var i=this._customNodeContent?null:this.isDisclosed()?this._containerShape.getRx():this._background?this._background.getRx():null;i&&(n.setRx(i),n.setRy(i))}}else this._shape&&this._shape instanceof e.SimpleMarker&&(n=this._shape.copyShape());n.setInvisibleFill(),n.setClassName(t),n.setMouseEnabled(!1),this.addChild(n),this._dropEffect=n},m.prototype._setDraggableStyleClass=function(){if(this._diagram.getEventManager().IsDragSupported()&&this._isDraggable()){var t=this._customNodeContent?this:this.isDisclosed()?this._containerShape:this._background?this._background:this._shape,n=t.getElem()?t.getElem():t;e.ToolkitUtils.addClassName(n,"oj-draggable")}},m.prototype._isDraggable=function(){return"off"!==this.getData().draggable&&!1!==this.getData().draggable},m.ConvertNodeData=function(t){return{id:t.id,label:t.label,selectable:t.selectable,shortDesc:t.shortDesc,categories:t.categories,nodes:t.nodes,_itemData:t}},m.prototype._cleanUp=function(t){if(this._containerShape&&(this.removeChild(this._containerShape),t&&t.addChild(this._containerShape),this._containerShape=null),this._background&&(this.removeChild(this._background),t&&t.addChild(this._background),this._background=null),this._shape&&(this.removeChild(this._shape),t&&t.addChild(this._shape),this._shape=null),this._labelObj&&(this.removeChild(this._labelObj),t&&t.addChild(this._labelObj),this._labelObj=null),this._containerButton&&(this.removeChild(this._containerButton),t&&t.addChild(this._containerButton),this._containerButton=null),this._customNodeContent){if(this._childNodePane&&(this._childNodePane.setParent(null),this.addChild(this._childNodePane)),this._customNodeContent.namespaceURI===e.ToolkitUtils.SVG_NS)this.getContainerElem().removeChild(this._customNodeContent),t&&e.ToolkitUtils.appendChildElem(t.getContainerElem(),this._customNodeContent);else if(Array.isArray(this._customNodeContent))for(var n=0;n<this._customNodeContent.length;n++)this.getContainerElem().removeChild(this._customNodeContent[n]),t&&e.ToolkitUtils.appendChildElem(t.getContainerElem(),this._customNodeContent[n]);else this._customNodeContent instanceof e.BaseComponent&&(this.removeChild(this._customNodeContent),t&&t.addChild(this._customNodeContent));this._customNodeContent=null}this._contentDims=null},m.prototype.getAnimationState=function(t){var n,o,i,s,a,r=this.getContentBounds();return this._shape&&((n={centerDimensions:this._shape.getCenterDimensions(),fill:this._shape.getFill()}).getCenterDimensions=function(){return n.centerDimensions},n.getFill=function(){return n.fill}),this._labelObj&&((o={matrix:this._labelObj.getMatrix()}).getMatrix=function(){return o.matrix}),this.isDisclosed()&&this._containerShape&&((i={fill:this._containerShape.getFill(),width:this._containerShape.getWidth(),height:this._containerShape.getHeight()}).getFill=function(){return i.fill},i.getWidth=function(){return i.width},i.getHeight=function(){return i.height}),t&&(a=new e.Container(this.getCtx()),this._cleanUp(a),a.setTranslate(this.getTranslateX(),this.getTranslateY())),(s={partialUpdate:!0,id:this.getId(),disclosed:this.isDisclosed(),tx:this.getTranslateX(),ty:this.getTranslateY(),contentBounds:r,origContent:a,_shape:n,_labelObj:o,_containerShape:i}).getId=function(){return s.id},s.isDisclosed=function(){return s.disclosed},s.getTranslateX=function(){return s.tx},s.getTranslateY=function(){return s.ty},s.getContentBounds=function(){return s.contentBounds},s},m.prototype.appendChildNodesData=function(t,n){this._data.nodes instanceof Array||(this._data.nodes=[]),this._data.nodes=e.ArrayUtils.insert(this._data.nodes,t,n)},m.prototype.removeChildNodesData=function(t){if(this._data.nodes instanceof Array)for(var e=0;e<t.length;e++)for(var n=t[e].id,o=0;o<this._data.nodes.length;o++)if(this._data.nodes[o].id===n){this._data.nodes.splice(o,1);break}},m.prototype._getCustomRenderer=function(t){var e=this._diagram.getOptions().nodeContent,n=null;if(e){var o=e.renderer;n=e[t],n=o&&n?n:null}return n},m.prototype._checkAndMoveContents=function(){return!!this._hasContentBoundToTouchEvent&&(this.GetDiagram().storeTouchEventContent(this._customNodeContent,this),this._contentStoredInTouchEventContainer=this._customNodeContent,this._hasContentBoundToTouchEvent=!1,!0)};var v={};e.Obj.createSubclass(v,e.Obj,"DvtDiagramLinkConnectorUtils"),v.END_CONNECTOR="endConnector",v.START_CONNECTOR="startConnector",v.CONNECTOR_TYPE_ARROW_OPEN="arrowOpen",v.CONNECTOR_TYPE_ARROW="arrow",v.CONNECTOR_TYPE_ARROW_CONCAVE="arrowConcave",v.CONNECTOR_TYPE_RECTANGLE="rectangle",v.CONNECTOR_TYPE_RECTANGLE_ROUNDED="rectangleRounded",v.CONNECTOR_TYPE_CIRCLE="circle",v.CreateConnectorShape=function(t,e,n,o,i){if(n)return v.CreateCustomConnector(t,n,i);var s=i.GetAppliedLinkWidth();switch(e){case v.CONNECTOR_TYPE_ARROW:return v.CreateFilledArrowConnector(t,s,i.getLinkColor());case v.CONNECTOR_TYPE_ARROW_CONCAVE:return v.CreateFilledConcaveArrowConnector(t,s,i.getLinkColor());case v.CONNECTOR_TYPE_ARROW_OPEN:return v.CreateOpenArrowConnector(t,s,o);case v.CONNECTOR_TYPE_CIRCLE:return v.CreateCircleConnector(t,s,o);case v.CONNECTOR_TYPE_RECTANGLE:return v.CreateRectangleConnector(t,s,o);case v.CONNECTOR_TYPE_RECTANGLE_ROUNDED:return v.CreateRoundedRectangleConnector(t,s,o)}return null},v.TransformConnector=function(t,e,n,o,i){var s=v.CalcConnectorTransform(t,e,n,o,i);t.setMatrix(s)},v.CalcConnectorTransform=function(t,n,o,i,s){var a=-1,r=0,d=0,h=0;if(i){var l=i.length;1===s?(l>=2&&(d=i[l-2],h=i[l-1]),l>=4?(a=i[l-4],r=i[l-3]):(a=d-1e-4,r=h)):(l>=2&&(d=i[0],h=i[1]),l>=4?(a=i[2],r=i[3]):(a=d+1e-4,r=h))}else;var g=d,u=h,p=v.CalcConnectorRotation(a,r,d,h),c=t._connectorOrigMat;c||(c=t.getMatrix(),t._connectorOrigMat=c);var _=new e.Matrix;if(o){var f=v._getCachedDims(t),y=t.getScaleX(),C=t.getScaleY(),m=f.w*y*-.5,S=f.h*C*-.5;_=_.translate(m,S)}return(_=(_=_.rotate(p)).translate(g,u)).concat(c)},v._getCachedDims=function(t){var e=t._cachedDims;return e||(e=t.getDimensions(),t._cachedDims=e),e},v.CalcConnectorRotation=function(t,e,n,o){var i=o-e,s=n-t;return Math.atan2(i,s)},v.CreateFilledConcaveArrowConnector=function(t,n,o){var i=6*v._getReduce(n,.5),s=.8*i,a=[-.22*i,-.5*s,.78*i,0,-.22*i,.5*s,0,0],r=new e.Polygon(t,a);return r.setSolidFill(o),r},v.CreateFilledArrowConnector=function(t,n,o){var i=5*v._getReduce(n,.5),s=.8*i,a=[0,-.5*s,i,0,0,.5*s],r=new e.Polygon(t,a);return r.setSolidFill(o),r},v._getReduce=function(t,e){if(t<=1)return t;var n=t-1;return 1+(n*=e)},v.CreateOpenArrowConnector=function(t,n,o){var i=3*n,s=o.getWidth(),a=[-i+s*Math.sqrt(2)/2,-i,s*Math.sqrt(2)/2,0,-i+s*Math.sqrt(2)/2,i],r=new e.Polyline(t,a);return r.setStroke(o),r.setFill(null),r},v.getCircleRadius=function(t){return 2*t},v.getRectangleLength=function(t){return 3*t},v.CreateCircleConnector=function(t,n,o){var i=v.getCircleRadius(n),s=new e.Circle(t,i,0,i);return s.setStroke(o),s.setFill(null),s},v.CreateRectangleConnector=function(t,n,o){var i=v.getRectangleLength(n),s=new e.Rect(t,0,-i/2,i,i);return s.setStroke(o),s.setFill(null),s},v.CreateRoundedRectangleConnector=function(t,e,n){var o=v.CreateRectangleConnector(t,e,n);return o.setCornerRadius(e),o},v.CreateCustomConnector=function(t,n,o){var i=o.GetDiagram().createAfContext();return i.setELContext(o.getData().getElAttributes()),i.setContextCallback(o,o.eventContextCallback),i.setTabStopsArray(o.getTabStopsArray()),e.AfComponentFactory.parseAndLayout(i,n,o)},v.GetConnectorOffset=function(t,e,n,o,i){if(n){var s=v._getCachedDims(t),a=t.getScaleX();return s.w*a*.5}return v.getStandardConnectorOffset(e,i.GetAppliedLinkWidth(),o.getWidth())},v.getStandardConnectorOffset=function(t,e,n){switch(t){case v.CONNECTOR_TYPE_ARROW_OPEN:return n*Math.sqrt(2);case v.CONNECTOR_TYPE_ARROW:return 5*v._getReduce(e,.5);case v.CONNECTOR_TYPE_ARROW_CONCAVE:return.78*(6*v._getReduce(e,.5));case v.CONNECTOR_TYPE_CIRCLE:return 2*v.getCircleRadius(n)+n/2;case v.CONNECTOR_TYPE_RECTANGLE:case v.CONNECTOR_TYPE_RECTANGLE_ROUNDED:return v.getRectangleLength(n)+n/2;default:return 0}};var S=function(t,e,n,o,i){S.superclass.Init.call(this,t),this.Init(t,e,n,o,i)};e.Obj.createSubclass(S,e.Container,"DvtDiagramLinkUnderlay"),S.prototype.Init=function(t,n,o,i,s){n||(n=["M",0,0,"L",1,0]),this._stroke=o,this._stroke||(this._stroke=new e.Stroke("#ffffff",1,1,!0)),this._underlay=new e.Path(t,n),this._underlay.setStroke(this._stroke),this._underlay.setFill(null),this._underlay.setStyle(i).setClassName(s),this.addChild(this._underlay),this._underlayStart=null,this._underlayStartType=null,this._underlayEnd=null,this._underlayEndType=null},S.prototype.addUnderlayStart=function(t,e,n,o){var i=this.CreateConnectorUnderlay(t,e,n,o,0);this._underlayStart&&this.removeChild(this._underlayStart),this._underlayStart=i,this._underlayStartType=e,this.addChild(this._underlayStart)},S.prototype.addUnderlayEnd=function(t,e,n,o){var i=this.CreateConnectorUnderlay(t,e,n,o,1);this._underlayEnd&&this.removeChild(this._underlayEnd),this._underlayEnd=i,this._underlayEndType=e,this.addChild(this._underlayEnd)},S.prototype.CreateConnectorUnderlay=function(t,n,o,i,s){var a=new e.Stroke(this._stroke.getColor(),this._stroke.getAlpha(),this._stroke.getWidth(),!1,this._stroke.getDashProps()),r=v.CreateConnectorShape(this.getCtx(),n,o,a,i);return v.TransformConnector(r,n,o,t,s),r},S.prototype.getUnderlay=function(){return this._underlay},S.prototype.getUnderlayStart=function(){return this._underlayStart},S.prototype.getUnderlayEnd=function(){return this._underlayEnd},S.prototype.setStroke=function(t,n){var o,i;(this._stroke=t,this._underlay.setStroke(t),this._underlayStart)&&(this._underlayStartType==v.CONNECTOR_TYPE_ARROW||this._underlayStartType==v.CONNECTOR_TYPE_ARROW_CONCAVE?(o=new e.Stroke(t.getColor(),t.getAlpha(),n),this._underlayStart.setSolidFill(t.getColor())):o=new e.Stroke(t.getColor(),t.getAlpha(),t.getWidth()),this._underlayStart.setStroke(o));this._underlayEnd&&(this._underlayEndType==v.CONNECTOR_TYPE_ARROW||this._underlayEndType==v.CONNECTOR_TYPE_ARROW_CONCAVE?(i=new e.Stroke(t.getColor(),t.getAlpha(),n),this._underlayEnd.setSolidFill(t.getColor())):i=new e.Stroke(t.getColor(),t.getAlpha(),t.getWidth()),this._underlayEnd.setStroke(i))},S.prototype.getStroke=function(){return this._stroke},S.prototype.hideUnderlayStart=function(){this._underlayStart&&this.removeChild(this._underlayStart)},S.prototype.hideUnderlayEnd=function(){this._underlayEnd&&this.removeChild(this._underlayEnd)},S.prototype.showUnderlayStart=function(){this._underlayStart&&this.addChild(this._underlayStart)},S.prototype.showUnderlayEnd=function(){this._underlayEnd&&this.addChild(this._underlayEnd)};var b=function(t,e,n){this.Init(t,e,n)};e.Obj.createSubclass(b,e.Container,"DvtBaseDiagramLink"),b.prototype.Init=function(t,e,n){b.superclass.Init.call(this,t,null,e),this._diagram=n,this._selected=!1,this._selectable=!0},b.prototype.getDisplayable=function(){return this},b.prototype.GetDiagram=function(){return this._diagram},b.prototype.setEndConnectorType=function(t){},b.prototype.getEndConnectorType=function(){return null},b.prototype.setStartConnectorType=function(t){},b.prototype.setStartConnector=function(t){this._startConnector=t},b.prototype.getStartConnector=function(){return this._startConnector},b.prototype.setEndConnector=function(t){this._endConnector=t},b.prototype.getEndConnector=function(){return this._endConnector},b.prototype.setShape=function(t){this._shape=t},b.prototype.getShape=function(){return this._shape},b.prototype.setLabelRotationAngle=function(t){this._labelRotAngle=t,b.PositionLabel(this._labelObj,this.getLabelPosition(),this.getLabelBounds(),t,this.getLabelRotationPoint())},b.prototype.getLabelRotationAngle=function(){return this._labelRotAngle},b.prototype.setLabelRotationPoint=function(t){this._labelRotPoint=t,b.PositionLabel(this._labelObj,this.getLabelPosition(),this.getLabelBounds(),this.getLabelRotationAngle(),t)},b.prototype.getLabelRotationPoint=function(){return this._labelRotPoint},b.prototype.getLabelPosition=function(){return this._labelPos},b.prototype.setLabelPosition=function(t){t&&(this._labelPos=t,b.PositionLabel(this._labelObj,t,this.getLabelBounds(),this.getLabelRotationAngle(),this.getLabelRotationPoint()))},b.prototype.getLabelBounds=function(){return null},b.prototype.setLabelBounds=function(t){},b.prototype.getStartConnectorOffset=function(){return 0},b.prototype.getEndConnectorOffset=function(){return 0},b.prototype.setSelectable=function(t){this._selectable=t},b.prototype.isSelectable=function(){return this.GetDiagram().isSelectionSupported()&&this._selectable},b.prototype.isSelected=function(){return this._selected},b.prototype.setSelected=function(t){this._selected=t},b.prototype.setPromoted=function(t){this._bPromoted=t},b.prototype.isPromoted=function(){return this._bPromoted},b.prototype.setLinkWidth=function(t){},b.prototype.getLinkWidth=function(){return 1},b.prototype.setLinkStyle=function(t){},b.prototype.getLinkStyle=function(){return"solid"},b.prototype.setLinkColor=function(t){},b.prototype.getLinkColor=function(){return null},b.prototype.getConnectorTemplate=function(t){return null},b.prototype.GetAppliedLinkStyle=function(){return this.getLinkStyle()},b.prototype.GetAppliedLinkWidth=function(){return this.getLinkWidth()},b.prototype.GetAppliedLinkColor=function(){return this.getLinkColor()},b.prototype.CreateConnector=function(t,n,o,i){if(n||i){var s;if(!i){var a=this._shape.getStroke();s=new e.Stroke(a.getColor(),a.getAlpha(),a.getWidth())}var r=v.CreateConnectorShape(this.getCtx(),n,i,s,this);return r&&(this._shape.addChild(r),v.TransformConnector(r,n,i,t,o)),r}},b.prototype.setPoints=function(t){this._arPoints=t,i.IsPath(t)?(this._pathCmds=t,this._points=i.ConvertToPoints(t)):(this._points=t,this._pathCmds=i.ConvertToPath(t)),this._shape&&this._shape instanceof e.Path&&(this._shape.setCommandsArray(this._pathCmds),this._endConnector?v.TransformConnector(this._endConnector,this.getEndConnectorType(),this.getConnectorTemplate(v.END_CONNECTOR),this._points,1):this._endConnector=this.CreateConnector(this._points,this.getEndConnectorType(),1,this.getConnectorTemplate(v.END_CONNECTOR)),this._startConnector?v.TransformConnector(this._startConnector,this.getStartConnectorType(),this.getConnectorTemplate(v.START_CONNECTOR),this._points,0):this._startConnector=this.CreateConnector(this._points,this.getStartConnectorType(),0,this.getConnectorTemplate(v.START_CONNECTOR)));var n=null,o=null;this._linkUnderlay&&this._linkUnderlay.getUnderlay()instanceof e.Path&&this._linkUnderlay.getUnderlay().setCommandsArray(this._pathCmds),this._linkUnderlay&&(n=this._linkUnderlay.getUnderlayStart())&&v.TransformConnector(n,this.getStartConnectorType(),this.getConnectorTemplate(v.START_CONNECTOR),this._points,0),this._linkUnderlay&&(o=this._linkUnderlay.getUnderlayEnd())&&v.TransformConnector(o,this.getEndConnectorType(),this.getConnectorTemplate(v.END_CONNECTOR),this._points,1),this._hitDetectionUnderlay&&this._hitDetectionUnderlay.getUnderlay()instanceof e.Path&&this._hitDetectionUnderlay.getUnderlay().setCommandsArray(this._pathCmds),this._startHandle&&this._startHandle.setPosition(this.getLinkStart()),this._endHandle&&this._endHandle.setPosition(this.getLinkEnd())},b.prototype.getPoints=function(){return this._arPoints},b.prototype.getLinkStart=function(){if(!this._points)return null;var t=this._points[0],n=this._points[1];return new e.Point(t,n)},b.prototype.getLinkEnd=function(){if(!this._points)return null;var t=this._points.length,n=this._points[t-2],o=this._points[t-1];return new e.Point(n,o)},b.CalcLabelMatrix=function(t,n,o,i){var s=new e.Matrix;return null!=o&&(i&&(s=s.translate(-i.x,-i.y)),s=s.rotate(o),i&&(s=s.translate(i.x,i.y))),t&&(s=s.translate(t.x,t.y)),s},b.PositionLabel=function(t,e,n,o,i){if(t){var s=b.CalcLabelMatrix(e,n,o,i);t.setMatrix(s)}},b.prototype.CreateUnderlay=function(t,n,o,i,s){n||0==n||(n=1),o||0==o||(o=0);var a=this.GetAppliedLinkWidth()+o,r=new e.Stroke(t,n,a,!0);return new S(this.getCtx(),this._pathCmds,r,i,s)},b.prototype.CreateFeedbackUnderlay=function(t,e,n,o,i){var s=this.CreateUnderlay(t,e,n,o,i);return this._startConnector&&this.getStartConnectorType()&&s.addUnderlayStart(this._points,this.getStartConnectorType(),this.getConnectorTemplate(v.START_CONNECTOR),this),this._endConnector&&this.getEndConnectorType()&&s.addUnderlayEnd(this._points,this.getEndConnectorType(),this.getConnectorTemplate(v.END_CONNECTOR),this),s},b.prototype.GetStyledLinkStroke=function(t,n,o){var s,a=this.GetAppliedLinkStyle();return"solid"!==strokeType&&(s={dashArray:i.GetStrokeDash(a,!0),dashOffset:i.GetStrokeDashOffset(a,!0)}),new e.Stroke(n,t.getAlpha(),o,!0,s)},b.prototype.ReplaceConnectorColor=function(t,n){if(t){var o=null;if(n.getColor&&(o=n.getColor()),o){var i=t.getStroke(),s=t.getFill();i&&t.setStroke(new e.Stroke(o,i.getAlpha(),i.getWidth(),i.isFixedWidth(),i.getDashProps())),s&&t.setSolidFill(o)}}},b.prototype.getNextNavigable=function(t){return null},b.prototype.getKeyboardBoundingBox=function(t){return this.getGroupId()&&this._diagram.getOptions().renderer?this._diagram.getCustomObjKeyboardBoundingBox(this):this.getDimensions(t)},b.prototype.getTargetElem=function(){return this.getElem()},b.prototype.showKeyboardFocusEffect=function(){},b.prototype.hideKeyboardFocusEffect=function(){},b.prototype.isShowingKeyboardFocusEffect=function(){},b.prototype.setKeyboardFocusNode=function(t){this._keyboardNavNode=t},b.prototype.getKeyboardFocusNode=function(){return this._keyboardNavNode},b.prototype.getCategories=function(){return null},b.prototype.setLabelAlignments=function(t,e){},b.prototype.getGroupId=function(){return null};var D=function(t,e,n,o){this.Init(t,e,n,o)};e.Obj.createSubclass(D,b,"DvtDiagramLink"),D.CUSTOM_STYLE="customStyle",D.newInstance=function(t,e,n){return new D(t.getCtx(),t,e,n)},D.prototype.Init=function(t,n,o,i){D.superclass.Init.call(this,t,o.id,n),this._data=o,this._isHighlighted=!0,this._hasContentBoundToTouchEvent=!1,this._contentStoredInTouchEventContainer=null,this.setPromoted(i),this.isSelectable()&&this.setCursor(e.SelectionEffectUtils.getSelectingCursor()),this.setGroupId(D._getCommonAncestorId(this,n))},D.prototype.getData=function(){return this._data},D.prototype.setData=function(t){this._data=t},D.prototype.getId=function(){return this.getData().id},D.prototype.getStartId=function(){return this.getData().startNode},D.prototype.getEndId=function(){return this.getData().endNode},D.prototype.getLabelBounds=function(){var t=null;return this._labelObj&&(t=this._labelObj.getDimensions()),t},D.prototype.getLinkStyle=function(){return this.getData().svgStyle||this.getData().style},D.prototype.getLinkWidth=function(){return this.getData().width},D.prototype.getLinkColor=function(){return this.getData().color},D.prototype.getStartConnectorType=function(){return this.getData().startConnectorType},D.prototype.getEndConnectorType=function(){return this.getData().endConnectorType},D.prototype.getStartConnectorOffset=function(){return this.getStartConnectorType()?v.getStandardConnectorOffset(this.getStartConnectorType(),this.GetAppliedLinkWidth(),this.GetAppliedLinkWidth()):0},D.prototype.getEndConnectorOffset=function(){return this.getEndConnectorType()?v.getStandardConnectorOffset(this.getEndConnectorType(),this.GetAppliedLinkWidth(),this.GetAppliedLinkWidth()):0},D.prototype.render=function(){var t=this.GetDiagram(),e=this.getGroupId(),n=t.getNodeById(this.getStartId()).getGroupId(),o=t.getNodeById(this.getEndId()).getGroupId();if(e){var i=this.getCtx(),s=t.getNodeById(e).GetChildNodePane();a.compareValues(i,e,n)&&a.compareValues(i,e,o)?s.addChildAt(this,0):s.addChild(this)}else n||o?t.getNodesPane().addChild(this):t.getLinksPane().addChild(this);D._renderLinkLabels(t,this.getData(),this),this.setAriaRole("img"),this.UpdateAriaLabel(),this._diagram.getEventManager().associate(this,this)},D.prototype.setPoints=function(t){var e=this.GetDiagram(),n=this._getCustomRenderer("renderer");n?(this._customPoints=t,this._applyCustomLinkContent(n,this._getState(),null)):(!this._pathCmds&&t&&D._renderLinkShape(e,this.getData(),this),D.superclass.setPoints.call(this,t))},D.prototype._getState=function(){return{hovered:this._isShowingHoverEffect,selected:this.isSelected(),focused:this._isShowingKeyboardFocusEffect}},D.prototype._applyCustomLinkContent=function(t,n,o){var i=this._diagram.getOptions()._contextHandler;if(i){var s=t(i(this.isPromoted()?"promotedLink":"link",this.getElem(),this._customLinkContent,null,this.getDataContext(),n,o,this._customPoints));if(s||!this._customLinkContent){var a=D._processLinkContent(s);if(this._customLinkContent&&a!=this._customLinkContent)this._checkAndMoveContents()||(this._customLinkContent.namespaceURI===e.ToolkitUtils.SVG_NS?this.getContainerElem().removeChild(this._customLinkContent):Array.isArray(this._customLinkContent)&&this._customLinkContent.forEach(function(t){this.getContainerElem().removeChild(t)}.bind(this))),this._customLinkContent=null;a===this._contentStoredInTouchEventContainer&&(this._hasContentBoundToTouchEvent=!0),this._customLinkContent||(a&&a.namespaceURI===e.ToolkitUtils.SVG_NS?(D._insertCustomElem(this,a,this._labelObj),this._customLinkContent=a):a&&Array.isArray(a)?(a.forEach(function(t){D._insertCustomElem(this,t,this._labelObj)}.bind(this)),this._customLinkContent=a):this._diagram.Log("Diagram: could not add custom link content for the link "+this.getId()+s,1)),D._fixLinkPath(this)}}else this._diagram.Log("Diagram: could not add custom link content - context handler is undefined",1)},D._renderLinkShape=function(t,n,o){var s=o._pathCmds;s||(s=["M",0,0,"L",0,0]);var a=n.id,r=n.color,d=n.width,h=n.svgStyle||n.style,l=e.CSSStyle.toNumber(n._hitDetectionOffset);o._hitDetectionUnderlay=o.CreateUnderlay("#000000",0,l),o.addChildAt(o._hitDetectionUnderlay,0);var g,u=new e.Path(o.getCtx(),s,a),p=n.svgClassName||n.className;if(u.setFill(null),u.setClassName(p),o.getCtx().isCustomElement())u.setStyle(h);else if(h&&h instanceof Object){h._type==D.CUSTOM_STYLE&&h.strokeDasharray&&(h.strokeDasharray=i.processStrokeDashArray(h.strokeDasharray)),g={dashArray:h.strokeDasharray,dashOffset:h.strokeDashoffset};var c=e.JsonUtils.clone(h);["_type","strokeDasharray","strokeDashoffset"].forEach(function(t){delete c[t]}),u.setStyle(c)}else"solid"!==h&&(g={dashArray:i.GetStrokeDash(h),dashOffset:i.GetStrokeDashOffset(h)});var _=new e.Stroke(r,1,d,!0,g);u.setStroke(_),o.setShape(u),o.addChildAt(u,1)},D._renderLinkLabels=function(t,n,o){var i=n.label;if(i){var s=e.Agent.isRightToLeft(t.getCtx()),a=i.indexOf("\n")>0,r=a?s?e.MultilineText.H_ALIGN_RIGHT:e.MultilineText.H_ALIGN_LEFT:s?e.OutputText.H_ALIGN_RIGHT:e.OutputText.H_ALIGN_LEFT,d=a?e.MultilineText.V_ALIGN_TOP:e.OutputText.V_ALIGN_TOP,h=D.createText(t.getCtx(),i,n.labelStyle,r,d,a),l=n.labelStyle.getMaxWidth()||n.labelStyle.getWidth(),g=e.CSSStyle.toNumber(l);l?g>0&&e.TextUtils.fitText(h,g,1/0,o)&&(o._labelObj=h):(o.addChild(h),o._labelObj=h)}},D.createText=function(t,n,o,i,s,a){var r;return o.hasBackgroundStyles()?r=a?new e.BackgroundMultilineText(t,n,0,0,o,null,!0):new e.BackgroundOutputText(t,n,0,0,o):(r=a?new e.MultilineText(t,n,0,0,null,!0):new e.OutputText(t,n,0,0)).setCSSStyle(o),r.setHorizAlignment(i),r.setVertAlignment(s),r},D.prototype.setSelected=function(t){var e=this._getState();D.superclass.setSelected.call(this,t);var n=this._getCustomRenderer("selectionRenderer");n?this._applyCustomLinkContent(n,this._getState(),e):t?this._showFeedback(this._isShowingHoverEffect,!0):this._hideFeedback(),this.UpdateAriaLabel()},D.prototype.isSelectable=function(){return this.GetDiagram().isSelectionSupported()&&"off"!=this.getData().selectable},D.prototype._showFeedback=function(t,n){var o="redwood"===this.getCtx().getThemeBehavior();if(!t||o&&n)this._savedStroke&&(this.getShape().setStroke(this._savedStroke),this.ReplaceConnectorColor(this.getStartConnector(),this._savedStroke),this.ReplaceConnectorColor(this.getEndConnector(),this._savedStroke),this._savedStroke=null);else{this._savedStroke||(this._savedStroke=this.getShape().getStroke());var i=this.getShape().getStroke(),s=new e.Stroke(this.getData().hoverInnerColor,i.getAlpha(),i.getWidth(),i.isFixedWidth(),i.getDashProps());this.getShape().setStroke(s),this.ReplaceConnectorColor(this.getStartConnector(),s),this.ReplaceConnectorColor(this.getEndConnector(),s)}this._linkUnderlay||(this._linkUnderlay=this.CreateFeedbackUnderlay("#000000",1,0,this.getData().svgStyle,this.getData().svgClassName),this.addChildAt(this._linkUnderlay,0));var a=n?this.getData().selectionColor:this.getData().hoverOuterColor,r=this._linkUnderlay.getStroke(),d=2+this.GetAppliedLinkWidth(),h=this.GetStyledLinkStroke(r,a,d);this._linkUnderlay.setStroke(h,2)},D.prototype._hideFeedback=function(){this._savedStroke&&(this.getShape().setStroke(this._savedStroke),this.ReplaceConnectorColor(this.getStartConnector(),this._savedStroke),this.ReplaceConnectorColor(this.getEndConnector(),this._savedStroke),this._savedStroke=null),this._linkUnderlay&&(this.removeChild(this._linkUnderlay),this._linkUnderlay.destroy&&this._linkUnderlay.destroy(),this._linkUnderlay=null)},D.prototype.GetStyledLinkStroke=function(t,n,o){if(this.getCtx().isCustomElement())return new e.Stroke(n,t.getAlpha(),o,t.isFixedWidth());var s=this.GetAppliedLinkStyle();if(s&&s instanceof Object){var a,r=s._type;if(r==D.CUSTOM_STYLE){var d=null!=s.strokeDashoffset?e.CSSStyle.toNumber(s.strokeDashoffset)+1:1;a={dashArray:i.getCustomUnderlay(s.strokeDasharray),dashOffset:d}}else a={dashArray:i.GetStrokeDash(r,!0),dashOffset:i.GetStrokeDashOffset(r,!0)};return new e.Stroke(n,t.getAlpha(),o,!0,a)}return D.superclass.GetStyledLinkStroke.call(this,t,n,o)},D.prototype.handleTouchStart=function(){this._hasContentBoundToTouchEvent=!0},D.prototype.handleTouchEnd=function(){this._hasContentBoundToTouchEvent=!1,this._contentStoredInTouchEventContainer=null},D.prototype.showHoverEffect=function(){if(!this._isShowingHoverEffect){var t=this._getState();this._isShowingHoverEffect=!0;var e=this._getCustomRenderer("hoverRenderer");e?this._applyCustomLinkContent(e,this._getState(),t):this._showFeedback(!0,this.isSelected())}},D.prototype.hideHoverEffect=function(){var t=this._getState();this._isShowingHoverEffect=!1;var e=this._getCustomRenderer("hoverRenderer");e?this._applyCustomLinkContent(e,this._getState(),t):this.isSelected()?this._showFeedback(!1,!0):this._hideFeedback()},D.prototype.highlight=function(t){if(this._isHighlighted!==t){var e=t?1:this._diagram.getOptions().styleDefaults._highlightAlpha;this.setAlpha(e),this._isHighlighted=t}},D.prototype.getDatatip=function(t,e,n){var o=this.GetDiagram().getOptions().tooltip,i=o?o.renderer:null;return i?this.GetDiagram().getCtx().getTooltipManager().getCustomTooltip(i,this.getDataContext()):this.getShortDesc()},D.prototype.getShortDesc=function(){var t=this.GetDiagram().getOptions().translations;if(this.isPromoted()){var n=this.getData()._links.length;return e.ResourceUtils.format(t[n>1?"promotedLinks":"promotedLink"],[n])}return this.getData().shortDesc},D.prototype.getDataContext=function(){var t,e;this.GetDiagram().isDataProviderMode()?this.isPromoted()?(t=this.getData()._links.map(function(t){return t._itemData}),e=this.getData()._links[0]._noTemplate?t:this.getData()._links):(e=this.getData(),t=this.getData()._itemData):e=this.isPromoted()?this.getData()._links:this.getData()._itemData;var n={id:this.getId(),type:this.isPromoted()?"promotedLink":"link",label:this.getData().label,data:e,itemData:t,component:this.GetDiagram().getOptions()._widgetConstructor};return this.getCtx().fixRendererContext(n)},D.getShortDescContext=function(t){var e,n;return t.GetDiagram().isDataProviderMode()?t.isPromoted()?(e=t.getData()._links.map(function(t){return t._itemData}),n=t.getData()._links[0]._noTemplate?e:t.getData()._links):(n=t.getData(),e=t.getData()._itemData):n=t.isPromoted()?t.getData()._links:t.getData()._itemData,{id:t.getId(),label:t.getData().label,data:n,itemData:e}},D.prototype.getAriaLabel=function(){var t=[],n=this.GetDiagram().getOptions().translations;return this.isSelectable()&&t.push(n[this.isSelected()?"stateSelected":"stateUnselected"]),this.isPromoted()&&t.push(n.promotedLinkAriaDesc),e.Displayable.generateAriaLabel(this.getShortDesc(),t,()=>D.getShortDescContext(this))},D.prototype.UpdateAriaLabel=function(){if(!e.Agent.deferAriaCreation()){var t=this.getAriaLabel();t&&this.setAriaProperty("label",t)}},D.prototype.getNextNavigable=function(t){if(t.keyCode==e.KeyboardEvent.SPACE&&t.ctrlKey)return this;if(t.keyCode==e.KeyboardEvent.UP_ARROW||t.keyCode==e.KeyboardEvent.DOWN_ARROW){(a=this.getKeyboardFocusNode())||(a=this.GetDiagram().getNodeById(this.getStartId()));var n=this,o=this.GetDiagram().getNavigableLinksForNodeId(a.getId()),i=this.GetDiagram().getEventManager().getKeyboardHandler();return i&&i.getNextNavigableLink&&(n=i.getNextNavigableLink(a,this,t,o)),n.setKeyboardFocusNode(a),this._diagram.ensureObjInViewport(t,n),n}if(t.keyCode==e.KeyboardEvent.RIGHT_ARROW||t.keyCode==e.KeyboardEvent.LEFT_ARROW){var s;s=this._movingToStart(t.keyCode)?this.getStartId():this.getEndId();var a=this.GetDiagram().getNodeById(s);return this._diagram.ensureObjInViewport(t,a),a}return t.type==e.MouseEvent.CLICK?this:null},D.prototype._movingToStart=function(t){var n=this.getLinkStart(),o=this.getLinkEnd(),i=n.x<o.x;return!(t==e.KeyboardEvent.RIGHT_ARROW&&i||t==e.KeyboardEvent.LEFT_ARROW&&!i)},D.prototype.showKeyboardFocusEffect=function(){var t=this._getState();this._isShowingKeyboardFocusEffect=!0;var e=this._getCustomRenderer("focusRenderer");e?this._applyCustomLinkContent(e,this._getState(),t):this.showHoverEffect()},D.prototype.hideKeyboardFocusEffect=function(){var t=this._getState();this._isShowingKeyboardFocusEffect=!1;var e=this._getCustomRenderer("focusRenderer");e?this._applyCustomLinkContent(e,this._getState(),t):this.hideHoverEffect()},D.prototype.isShowingKeyboardFocusEffect=function(){return this._isShowingKeyboardFocusEffect},D.prototype.getCategories=function(){return this.getData().categories?this.getData().categories:[this.getId()]},D.prototype.isHidden=function(){var t=this.GetDiagram().getOptions().hiddenCategories;return!(!t||!e.ArrayUtils.hasAnyItem(t,this.getCategories()))||(!this.GetDiagram().getNodeById(this.getStartId())||!this.GetDiagram().getNodeById(this.getEndId()))},D.prototype.animateUpdate=function(t,n,o){var i=n.getPoints(),s=this.getPoints(),a=new e.CustomAnimation(this.getCtx(),null,t.getAnimationDuration());if(!e.ArrayUtils.equals(i,s)){this.setPoints(i);var r=e.Animator.TYPE_POLYLINE;s.length>0&&isNaN(s[0])&&(r=e.Animator.TYPE_PATH),a.getAnimator().addProp(r,this,this.getPoints,this.setPoints,s)}if(n._labelObj&&this._labelObj){var d=n._labelObj.getMatrix(),h=this._labelObj.getMatrix();d.equals(h)||(this._labelObj.setMatrix(d),a.getAnimator().addProp(e.Animator.TYPE_MATRIX,this._labelObj,this._labelObj.getMatrix,this._labelObj.setMatrix,h))}if(n.getShape()&&this.getShape()){var l=n.getShape().getStroke(),g=this.getShape().getStroke();l&&g&&l instanceof e.Stroke&&g instanceof e.Stroke&&(l.getColor()!=g.getColor()||l.getWidth()!=g.getWidth())&&(this.getShape().setStroke(l),a.getAnimator().addProp(e.Animator.TYPE_STROKE,this.getShape(),this.getShape().getStroke,this.getShape().setStroke,g))}var u=n.getTranslateX(),p=n.getTranslateY(),c=this.getTranslateX(),_=this.getTranslateY();if(u!=c&&(this.setTranslateX(u),a.getAnimator().addProp(e.Animator.TYPE_NUMBER,this,this.getTranslateX,this.setTranslateX,c)),p!=_&&(this.setTranslateY(p),a.getAnimator().addProp(e.Animator.TYPE_NUMBER,this,this.getTranslateY,this.setTranslateY,_)),this._getCustomRenderer("renderer")){var f=n.getContainerElem().querySelector(".oj-diagram-link-path"),m=this.getContainerElem().querySelector(".oj-diagram-link-path");if(f&&m){i=e.ToolkitUtils.getAttrNullNS(f,"d"),s=e.ToolkitUtils.getAttrNullNS(m,"d");e.ToolkitUtils.setAttrNullNS(m,"d",i);a.getAnimator().addProp(e.Animator.TYPE_PATH,m,function(t){var n=e.ToolkitUtils.getAttrNullNS(m,"d");return e.PathUtils.createPathArray(n)},function(t){e.ToolkitUtils.setAttrNullNS(m,"d",t.join(" "))},e.PathUtils.createPathArray(s))}for(var v=D._getFadeInCustomItems(this._customLinkContent,m,f),S=new e.CustomAnimation(this.getCtx(),null,t.getAnimationDuration()),b=0;b<v.length;b++){var N=v[b];e.ToolkitUtils.setAttrNullNS(N,"opacity","0");var E=function(t){e.ToolkitUtils.setAttrNullNS(this,"opacity",t)}.bind(N),k=function(){var t=e.ToolkitUtils.getAttrNullNS(this,"opacity");return Number(t)}.bind(N);S.getAnimator().addProp(e.Animator.TYPE_NUMBER,N,k,E,1)}t.add(S,C)}if(o){var P=this;e.Playable.appendOnEnd(a,function(){P.getParent().removeChild(P)})}t.add(a,y)},D.prototype.animateDelete=function(t,n){this.GetDiagram().getLinksPane().addChild(this);var o=this,i=new e.AnimFadeOut(this.getCtx(),this,t.getAnimationDuration());e.Playable.appendOnEnd(i,function(){o.getParent().removeChild(o),o.destroy()}),t.add(i,f)},D.prototype.animateInsert=function(t){this.setAlpha(0),t.add(new e.AnimFadeIn(this.getCtx(),this,t.getAnimationDuration()),C)},D.prototype.animateCollapse=function(t,n){if(n&&0!=n.length){var o=this._customPoints?this._customPoints:this.getPoints();Array.isArray(o)&&(o=o.slice());var i=this.getTranslateX(),s=this.getTranslateY();this.animateUpdate(t,n[0]);for(var a=1;a<n.length;a++){var r={id:"_fakeLink"+a+this.getId()};r=e.JsonUtils.merge(r,this.getData());var d=new D(this.GetDiagram().getCtx(),this.GetDiagram(),r,!0);d.render(),d.setPoints(o),d.setTranslate(i,s),d.animateUpdate(t,n[a],!0)}}},D.prototype.animateExpand=function(t,e){if(e&&0!=e.length)for(var n=0;n<e.length;n++)e[n].animateUpdate(t,this)},D.prototype.setLabelAlignments=function(t,n){var o=this._labelObj instanceof e.MultilineText||this._labelObj instanceof e.BackgroundMultilineText;"baseline"==n&&(n=o?e.MultilineText.V_ALIGN_TOP:e.OutputText.V_ALIGN_AUTO),this._labelObj.setHorizAlignment(t),this._labelObj.setVertAlignment(n)},D.prototype.setGroupId=function(t){this._groupId=t},D.prototype.getGroupId=function(){return this._groupId},D._getCommonAncestorId=function(t,e){for(var n=function(t,e){for(var n=[],o=e.getNodeById(t)?e.getNodeById(t).getGroupId():null;o;)n.push(o),o=e.getNodeById(o)?e.getNodeById(o).getGroupId():null;return n},o=n(t.getStartId(),e),i=n(t.getEndId(),e),s=0;s<o.length;s++)if(i.indexOf(o[s])>-1)return o[s];return null},D.GetPromotedLinkId=function(t,e,n){return t.isDataProviderMode()?{name:"_promoted",startId:e,endId:n}:"_plL"+e+"_L"+n},D.prototype.ShowDropEffect=function(){this._dropEffect||this._createDropEffect("oj-diagram-link oj-active-drop")},D.prototype.ShowRejectedDropEffect=function(){this._dropEffect||this._createDropEffect("oj-diagram-link oj-invalid-drop")},D.prototype.ClearDropEffect=function(){this._dropEffect&&(this.removeChild(this._dropEffect),this._dropEffect=null)},D.prototype._createDropEffect=function(t){var n=e.CSSStyle.toNumber(this.getData()._hitDetectionOffset);this._dropEffect=this.CreateFeedbackUnderlay("#000000",0,n,null,t),this._dropEffect.setMouseEnabled(!1),this.addChild(this._dropEffect)},D.ConvertLinkData=function(t){return{id:t.id,startNode:t.startNode,endNode:t.endNode,label:t.label,selectable:t.selectable,shortDesc:t.shortDesc,categories:t.categories,_itemData:t}},D.prototype.getAnimationState=function(){var t,e,n;this._labelObj&&((t={matrix:this._labelObj.getMatrix()}).getMatrix=function(){return t.matrix}),this.getShape()&&((e={stroke:this.getShape().getStroke()}).getStroke=function(){return e.stroke});var o=this.isPromoted()?this.getData()._links:null;return(n={partialUpdate:!0,id:this.getId(),promoted:this.isPromoted(),includedLinks:o,points:this.getPoints(),shape:e,tx:this.getTranslateX(),ty:this.getTranslateY(),_labelObj:t}).getId=function(){return n.id},n.isPromoted=function(){return n.promoted},n.getData=function(){return{_links:n.includedLinks}},n.getPoints=function(){return n.points},n.getShape=function(){return n.shape},n.getTranslateX=function(){return n.tx},n.getTranslateY=function(){return n.ty},n},D._fixLinkPath=function(t){var n=t.getContainerElem().querySelector(".oj-diagram-link-path");if(n){var o=t._customPoints,s=i.IsPath(o)?o:i.ConvertToPath(o);n.setAttributeNS(null,"d",e.PathUtils.getPathString(s))}},D._getFadeInCustomItems=function(t,e,n){var o,i=[];if(e&&n){var s=t;Array.isArray(t)&&t.forEach(function(t){t.contains(e)?s=t:i.push(t)});for(var a=e;a!==s;)i=i.concat(function(t,e){for(var n=[];t;)1===t.nodeType&&t!==e&&n.push(t),t=t.nextSibling;return n}((o=a).parentNode.firstChild,o)),a=a.parentNode}else t&&(i=Array.isArray(t)?t:[t]);return i},D._insertCustomElem=function(t,e,n){var o=n?n.getOuterElem():null;t&&t.getContainerElem().insertBefore(e,o)},D.prototype._getCustomRenderer=function(t){var e=this._diagram.getOptions().linkContent,n=null;if(e){var o=e.renderer;n=e[t],n=o&&n?n:o}return n},D.prototype.GetCreationFeedbackPoints=function(t){var e=this._customPoints?this._customPoints:this.getPoints();return[e[0],e[1],t.x,t.y]},D._processLinkContent=function(t){var n=null;if(t.namespaceURI===e.ToolkitUtils.SVG_NS&&"svg"===t.tagName)n=[],Array.prototype.forEach.call(t.childNodes,function(t){n.push(t)});else if(t.namespaceURI===e.ToolkitUtils.SVG_NS)n=t;else if(Array.isArray(t)){n=[];for(var o=0;o<t.length;o++){if(t[o].namespaceURI===e.ToolkitUtils.SVG_NS&&"svg"===t[o].tagName){Array.prototype.forEach.call(t[o].childNodes,function(t){n.push(t)});break}t[o].namespaceURI===e.ToolkitUtils.SVG_NS&&n.push(t[o])}}return Array.isArray(n)&&0===n.length?null:n},D.prototype._checkAndMoveContents=function(){return!!this._hasContentBoundToTouchEvent&&(this.GetDiagram().storeTouchEventContent(this._customLinkContent,this),this._contentStoredInTouchEventContainer=this._customLinkContent,this._hasContentBoundToTouchEvent=!1,!0)};var N=new Object;e.Obj.createSubclass(N,e.Obj),N.prepareNodeStyle=function(t,n){!t||null==t[n]||t[n]instanceof Object||(t[n]=e.CSSStyle.cssStringToObject(t[n]))},N.prepareLinkStyle=function(t,e){t&&null!=t[e]&&(t[e]instanceof Object?null==t[e]._type&&(t[e]._type=D.CUSTOM_STYLE):t[e]=i.getStrokeObject(t[e]))},N.getNodeDefaultStyles=function(t){var e=t.getOptions().styleDefaults.nodeDefaults;return N.prepareNodeStyle(e,"backgroundStyle"),N.prepareNodeStyle(e,"containerStyle"),e},N.getNodeStyles=function(t,n,o){if(t.isDataProviderMode())return e.JsonUtils.merge(n,o,{_itemData:!0,id:!0,nodes:!0});var i=m.ConvertNodeData(n);if(t.getOptions().nodeProperties){var s=e.JsonUtils.clone(t.getOptions().nodeProperties(n));N.prepareNodeStyle(s,"backgroundStyle"),N.prepareNodeStyle(s,"containerStyle"),i=e.JsonUtils.merge(i,s,{_itemData:!0})}return e.JsonUtils.merge(i,o,{_itemData:!0})},N.getLinkDefaultStyles=function(t,n){var o=t.getOptions().styleDefaults[n];N.prepareLinkStyle(o,"style");var i=t.getCtx().isCustomElement()?"svgStyle":"style";return o[i]=e.JsonUtils.merge(o[i],o._style),t.getCtx().isCustomElement()&&["_type"].forEach(function(t){delete o[i][t]}),o},N.getLinkStyles=function(t,n,o){if(t.isDataProviderMode())return e.JsonUtils.merge(n,o,{_itemData:!0,id:!0});var i=D.ConvertLinkData(n);if(t.getOptions().linkProperties){var s=e.JsonUtils.clone(t.getOptions().linkProperties(n));N.prepareLinkStyle(s,"style"),i=e.JsonUtils.merge(i,s,{_itemData:!0})}return e.JsonUtils.merge(i,o,{_itemData:!0})},N.getAnimationDuration=function(t){return e.CSSStyle.getTimeMilliseconds(t.getOptions().styleDefaults.animationDuration)/1e3},N.getAnimationOnDisplay=function(t){return t.getOptions().animationOnDisplay},N.getAnimationOnDataChange=function(t){return t.getOptions().animationOnDataChange};var E=function(t,e,n){this.Init(t,e,n,n),this._diagram=n,this._linkDragSelector=null,this._linkDropSelector=null,this._prevRolloverEvent=null};e.Obj.createSubclass(E,e.EventManager,"DvtDiagramEventManager"),E.prototype.showFocusEffect=function(t,e){this.ShowFocusEffect(t,e)},E.prototype.ShowFocusEffect=function(t,e){this._diagram.isPanning()||E.superclass.ShowFocusEffect.call(this,t,e)},E.prototype.ProcessRolloverEvent=function(t,n,o){var i=this._diagram.getOptions();if("dim"==i.hoverBehavior&&(!this._prevRolloverEvent||this._prevRolloverEvent.obj!==n||this._prevRolloverEvent.bOver!==o)){var s=n.getCategories?n.getCategories():[];i.highlightedCategories=o?s.slice():null;var a=e.EventFactory.newCategoryHighlightEvent(i.highlightedCategories,o),r=e.CSSStyle.getTimeMilliseconds(i.styleDefaults.hoverBehaviorDelay);this.RolloverHandler.processEvent(a,this._diagram.GetAllNodeObjects(),r,"any"==i.highlightMatch),this._prevRolloverEvent={obj:n,bOver:o}}},E.prototype.CreateCategoryRolloverHandler=function(t,e){return new c(t,e)},E.prototype.ProcessKeyboardEvent=function(t){var n=!0,o=t.keyCode,i=this.getFocus(),s=i instanceof m?i._customNodeContent:null;if(o!=e.KeyboardEvent.TAB&&this._bPassOnEvent)s.fireKeyboardListener(t),t.preventDefault();else if(o==e.KeyboardEvent.TAB&&s instanceof e.BaseComponent)!t.shiftKey&&i.isShowingKeyboardFocusEffect()?(i.hideKeyboardFocusEffect(),s.fireKeyboardListener(t),t.preventDefault(),this._bPassOnEvent=!0):t.shiftKey&&this._bPassOnEvent?(this.ShowFocusEffect(t,i),t.preventDefault(),this._bPassOnEvent=!1):(this._bPassOnEvent&&i.showKeyboardFocusEffect(),n=E.superclass.ProcessKeyboardEvent.call(this,t),this._bPassOnEvent=!1);else if(o==e.KeyboardEvent.SPACE&&t.ctrlKey&&t.shiftKey)i&&i.HandleKeyboardEvent&&i.HandleKeyboardEvent(t);else if((o==e.KeyboardEvent.ZERO||o==e.KeyboardEvent.NUMPAD_ZERO)&&t.ctrlKey&&t.altKey){if(i){var a=this._diagram.getPanZoomCanvas(),r=i.getKeyboardBoundingBox(this.getCtx().getStage()),d=a.getContentPane().stageToLocal({x:r.x,y:r.y}),h=a.getContentPane().stageToLocal({x:r.x+r.w,y:r.y+r.h}),l={x:d.x,y:d.y,w:h.x-d.x,h:h.y-d.y},g="none"!=N.getAnimationOnDataChange(this._diagram)?new e.Animator(this.getCtx(),this._diagram.getAnimationDuration()):null;a.zoomToFit(g,l),g&&g.play()}}else o==e.KeyboardEvent.TAB&&i&&this._diagram.ensureObjInViewport(t,i),n=E.superclass.ProcessKeyboardEvent.call(this,t);return n},E.prototype.GetTouchResponse=function(){var t=this._diagram.getOptions();return"none"!==t.panning||"none"!==t.zooming?e.EventManager.TOUCH_RESPONSE_TOUCH_HOLD:t.touchResponse===e.EventManager.TOUCH_RESPONSE_TOUCH_START?e.EventManager.TOUCH_RESPONSE_TOUCH_START:e.EventManager.TOUCH_RESPONSE_AUTO},E.prototype.HandleTouchClickInternal=function(t){return this.GetEventInfo(t,n.PanZoomCanvasEventManager.EVENT_INFO_PANNED_KEY)},E.prototype.StoreInfoByEventType=function(t){return t!=n.PanZoomCanvasEventManager.EVENT_INFO_PANNED_KEY&&E.superclass.StoreInfoByEventType.call(this,t)},E.prototype.isDndSupported=function(){return!0},E.prototype.GetDragSourceType=function(t){var e,n=this.DragSource.getDragObject();return n&&n.__dragType?n.__dragType:n instanceof m?(null===this._linkDragSelector&&(this._linkDragSelector=this._diagram.getOptions().dnd.drag.ports.selector),this._linkDragSelector&&(e=this._getPortElement(document.elementFromPoint(t.getNativeEvent().clientX,t.getNativeEvent().clientY),this._linkDragSelector))&&(this.LinkCreationStarted=!0,n.__dragPort=e),n.__dragType=e?"ports":"nodes",n.__dragType):null},E.prototype.GetDragDataContexts=function(t){var n=this.DragSource.getDragObject();if(this._diagram.isSelectionSupported()&&this._diagram.getSelectionHandler().getSelectedCount()>1){for(var o=this._diagram.getSelectionHandler().getSelection(),i=this._getTopLeftContentCorner(o),s=this._diagram.getPanZoomCanvas().getZoom(),a=[],r=0;r<o.length;r++)if(o[r]instanceof m){var d=o[r].getDataContext(),h=o[r].getDimensions(this._context.getStage());d.nodeOffset=new e.Point((h.x-i.x)/s,(h.y-i.y)/s),t&&e.ToolkitUtils.cleanDragDataContext(d),a.push(d)}return a}if(n instanceof m){d=n.getDataContext();return t&&e.ToolkitUtils.cleanDragDataContext(d),"ports"===n.__dragType&&n.__dragPort?t?{dataContext:d}:{dataContext:d,portElement:n.__dragPort}:(d.nodeOffset=new e.Point(0,0),[d])}return[]},E.prototype.GetDropOffset=function(t){var n;if(this._diagram.isSelectionSupported()&&this._diagram.getSelectionHandler().getSelectedCount()>1)n=this._getTopLeftContentCorner(this._diagram.getSelectionHandler().getSelection());else{var o=this.DragSource.getDragObject();o instanceof m&&(n=o.getDimensions(this._context.getStage()))}if(n){var i=this._context.pageToStageCoords(t.pageX,t.pageY),s=this._diagram.getPanZoomCanvas().getZoom();return new e.Point((n.x-i.x)/s,(n.y-i.y)/s)}return null},E.prototype._getTopLeftContentCorner=function(t){if(!t)return null;for(var n=Number.MAX_VALUE,o=Number.MAX_VALUE,i=0;i<t.length;i++)if(t[i]instanceof m){var s=t[i].getDimensions(this._context.getStage());n=s?Math.min(s.x,n):n,o=s?Math.min(s.y,o):o}return new e.Point(n,o)},E.prototype.OnDndDragStart=function(t){var e=this.DragSource.getDragObject();e&&e.__dragType&&(e.__dragType=null,e.__dragPort=null),this.LinkCreationStarted=!1,E.superclass.OnDndDragStart.call(this,t)},E.prototype.OnDndDragOver=function(t){E.superclass.OnDndDragOver.call(this,t),this.LinkCreationStarted&&this._diagram.ShowLinkCreationFeedback(t)},E.prototype.OnDndDragEnd=function(t){E.superclass.OnDndDragEnd.call(this,t),this.LinkCreationStarted&&(this._diagram.HideLinkCreationFeedback(),this.LinkCreationStarted=!1),this._diagram.getPanZoomCanvas().panZoomEnd(),this._setPanningEnabled(!0)},E.prototype._setPanningEnabled=function(t){this._diagram.IsPanningEnabled()&&this._diagram.getPanZoomCanvas().setPanningEnabled(t)},E.prototype.IsDragSupported=function(){if(!this._isDragSupported){var t=this._diagram.getOptions();this._isDragSupported=this.isDndSupported()&&(t.dnd.drag.nodes.dataTypes||t.dnd.drag.ports.dataTypes)}return this._isDragSupported},E.prototype.OnMouseDown=function(t){var e=this.GetLogicalObject(t.target);this.IsDragSupported()&&e instanceof m&&this._setPanningEnabled(!1),E.superclass.OnMouseDown.call(this,t)},E.prototype.OnMouseUp=function(t){E.superclass.OnMouseUp.call(this,t),this._setPanningEnabled(!0)},E.prototype.HandleImmediateTouchStartInternal=function(t){var e=this.GetLogicalObject(t.target);this.IsDragSupported()&&1==t.targetTouches.length&&e instanceof m&&this._setPanningEnabled(!1),(e instanceof m||e instanceof D)&&e.handleTouchStart(),this._diagram.handleTouchStart()},E.prototype.HandleImmediateTouchEndInternal=function(t){var e=this.GetLogicalObject(t.target);this.IsDragSupported()&&this._setPanningEnabled(!0),(e instanceof m||e instanceof D)&&e.handleTouchEnd(),this._diagram.handleTouchEnd()},E.prototype.GetDropTargetType=function(t){var e,n=this.GetLogicalObject(t.target);return this._diagram.getCache().putToCache("dropTarget",n),n?n instanceof m?(null===this._linkDropSelector&&(this._linkDropSelector=this._diagram.getOptions().dnd.drop.ports.selector),this._linkDropSelector&&(e=this._getPortElement(t.getNativeEvent().target,this._linkDropSelector)),n.__dropPort=e,e?"ports":"nodes"):n instanceof D?"links":null:"background"},E.prototype.GetDropEventPayload=function(t){var n=t.getNativeEvent().dataTransfer,o=Number(n.getData(e.EventManager.DROP_OFFSET_X_DATA_TYPE))||0,i=Number(n.getData(e.EventManager.DROP_OFFSET_Y_DATA_TYPE))||0,s=this._diagram.getPanZoomCanvas().getContentPane().stageToLocal(this.getCtx().pageToStageCoords(t.pageX,t.pageY)),a=this._diagram.getLayoutOffset(),r={x:s.x-a.x+o,y:s.y-a.y+i},d=this.GetLogicalObject(t.target);if(d instanceof m){d.__dropPort?(r.dataContext=d.getDataContext(),r.portElement=d.__dropPort):r.nodeContext=d.getDataContext();var h=d.getDimensions(this._context.getStage()),l=h?this._diagram.getPanZoomCanvas().getContentPane().stageToLocal({x:h.x,y:h.y}):null;r.nodeX=l?s.x-l.x+o:null,r.nodeY=l?s.y-l.y+i:null}else d instanceof D&&(r.linkContext=d.getDataContext());return r},E.prototype.ShowDropEffect=function(t){var n=this.GetDropTargetType(t),o=this._diagram.getCache().getFromCache("dropTarget");"background"===n?this._diagram.getPanZoomCanvas().getBackgroundPane().setClassName("oj-active-drop"):"nodes"===n||"links"===n?o&&o.ShowDropEffect&&o.ShowDropEffect():o&&"ports"===n&&o.__dropPort&&e.ToolkitUtils.addClassName(o.__dropPort,"oj-active-drop")},E.prototype.ShowRejectedDropEffect=function(t){var n=this.GetDropTargetType(t),o=this._diagram.getCache().getFromCache("dropTarget");"background"===n?this._diagram.getPanZoomCanvas().getBackgroundPane().setClassName("oj-invalid-drop"):"nodes"===n||"links"===n?o&&o.ShowRejectedDropEffect&&o.ShowRejectedDropEffect():o&&"ports"===n&&o.__dropPort&&e.ToolkitUtils.addClassName(o.__dropPort,"oj-invalid-drop")},E.prototype.ClearDropEffect=function(){this._diagram.getPanZoomCanvas().getBackgroundPane().setClassName(null);var t=this._diagram.getCache().getFromCache("dropTarget");t&&t.ClearDropEffect&&t.ClearDropEffect(),t&&t.__dropPort&&(e.ToolkitUtils.removeClassName(t.__dropPort,"oj-active-drop"),e.ToolkitUtils.removeClassName(t.__dropPort,"oj-invalid-drop")),this._diagram.getCache().putToCache("dropTarget",null)},E.prototype._getPortElement=function(t,e){return t&&t.closest?t.closest(e):null};var k=function(t,e){this.Init(t,e)};e.Obj.createSubclass(k,n.PanZoomCanvasKeyboardHandler,"DvtBaseDiagramKeyboardHandler"),k._OUTGOING=0,k._INGOING=1,k.prototype.Init=function(t,e){k.superclass.Init.call(this,t,e),this._diagram=t},k.prototype.GetDiagram=function(){return this._diagram},k.prototype.isSelectionEvent=function(t){return t.keyCode!=e.KeyboardEvent.TAB&&(this.isNavigationEvent(t)&&!t.ctrlKey)},k.prototype.isMultiSelectEvent=function(t){return t.keyCode==e.KeyboardEvent.SPACE&&t.ctrlKey},k.prototype.getFirstNavigableLink=function(t,n,o){var i=n.keyCode;if(!o||o.length<1||!t)return null;for(var s=o[0],a=t.getKeyboardBoundingBox(),r=a.x+a.w/2,d=0;d<o.length;d++){var h=o[d],l=h.getKeyboardBoundingBox(),g=l.x+l.w/2;if(i==e.KeyboardEvent.OPEN_ANGLED_BRACKET&&g<=r||i==e.KeyboardEvent.CLOSE_ANGLED_BRACKET&&g>=r){s=h;break}}return s},k.prototype.getNextNavigableLink=function(t,n,o,i){if(!i)return null;if(!n)return i[0];if(!t)return n;this._addSortingAttributes(t,i),i.sort(this._getLinkComparator()),this._removeSortingAttributes(i);for(var s=o.keyCode==e.KeyboardEvent.DOWN_ARROW,a=0,r=0;r<i.length;r++){if(i[r]===n){a=s?r==i.length-1?0:r+1:0==r?i.length-1:r-1;break}}return i[a]},k.prototype.GetVisibleNode=function(t){return null},k.prototype._getClockwiseAngle=function(t,e){var n=this.GetVisibleNode(e.getStartId?e.getStartId():e.getData().getStartId()),o=this.GetVisibleNode(e.getEndId?e.getEndId():e.getData().getEndId()),i=t==n?o:n,s=this._getNodeCenter(t),a=this._getNodeCenter(i),r=Math.atan2(a.y-s.y,a.x-s.x);return r=r<0?r+2*Math.PI:r},k.prototype._getNodeCenter=function(t){var n=t.getKeyboardBoundingBox();return new e.Point(n.x+n.w/2,n.y+n.h/2)},k.prototype._getNodesDistance=function(t){var e=this.GetVisibleNode(t.getStartId?t.getStartId():t.getData().getStartId()),n=this.GetVisibleNode(t.getEndId?t.getEndId():t.getData().getEndId()),o=this._getNodeCenter(e),i=this._getNodeCenter(n);return Math.sqrt(Math.pow(i.x-o.x,2)+Math.pow(i.y-o.y,2))},k.prototype._getLinkDirection=function(t,e){return t==this.GetVisibleNode(e.getEndId?e.getEndId():e.getData().getEndId())?k._INGOING:k._OUTGOING},k.prototype._getLinkComparator=function(){return function(t,e){var n=t.__angle,o=e.__angle,i=-1;return!k._anglesAreEqualWithinTolerance(n,o)&&n>o?i=1:k._anglesAreEqualWithinTolerance(n,o)&&(t.__distance>e.__distance||e.__distance==t.__distance&&t.__direction>e.__direction?i=1:e.__distance==t.__distance&&t.__direction==e.__direction&&(i=0)),i}},k.prototype._removeSortingAttributes=function(t){for(var e=0;e<t.length;e++){var n=t[e];n.__angle=void 0,n.__distance=void 0,n.__direction=void 0}},k.prototype._addSortingAttributes=function(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.__angle=this._getClockwiseAngle(t,o),o.__distance=this._getNodesDistance(o),o.__direction=this._getLinkDirection(t,o)}},k._anglesAreEqualWithinTolerance=function(t,e){var n=Math.abs(t-e)<=1e-7;return n||(n=Math.abs(2*Math.PI+Math.min(t,e)-Math.max(t,e))<=1e-7),n};var P=function(t,e){this.Init(t,e)};e.Obj.createSubclass(P,k,"DvtDiagramKeyboardHandler"),P.prototype.isNavigationEvent=function(t){var n=!1;switch(t.keyCode){case e.KeyboardEvent.OPEN_BRACKET:case e.KeyboardEvent.CLOSE_BRACKET:n=!0;break;case e.KeyboardEvent.OPEN_ANGLED_BRACKET:case e.KeyboardEvent.CLOSE_ANGLED_BRACKET:n=!!t.altKey;break;default:n=P.superclass.isNavigationEvent.call(this,t)}return n},P.prototype.processKeyDown=function(t){if(t.keyCode==e.KeyboardEvent.TAB){var n=this._eventManager.getFocus();if(n)return e.EventManager.consumeEvent(t),n;var o=this.GetDiagram().GetRootNodeObjects();if(o.length>0){e.EventManager.consumeEvent(t);var i=this.getDefaultNavigable(o);return this.GetDiagram().ensureObjInViewport(t,i),i}}return P.superclass.processKeyDown.call(this,t)},P.prototype.GetVisibleNode=function(t){return this.GetDiagram().getNodeById(t)};var O={};e.Obj.createSubclass(O,e.Obj,"DvtDiagramOverviewUtils"),O.CalcViewportFromMatrix=function(t){var n=t.getPanZoomCanvas().getContentPaneMatrix(),o=new e.Rectangle(0,0,t.getWidth(),t.getHeight()),i=n.getTx(),s=n.getTy(),a=n.getA(),r=o.x-i/a,d=o.y-s/a,h=o.w/a,l=o.h/a;return new e.Rectangle(r,d,h,l)},O.ConfigureOverviewWindow=function(t,n){var o=new e.Container(t.getCtx());o.addChild(n),t.addChild(o),n.render(),O._positionOverviewWindow(t,n);var i=n.getOverviewWidth(),s=n.getOverviewHeight(),a=new e.ClipPath(t.getId()+"dgr_ovClip");a.addRect(n.getTranslateX(),n.getTranslateY(),i,s),n.setClipPath(a),n.UpdateViewport();var r=t.Options.styleDefaults._overviewStyles,d=new e.Rect(t.getCtx(),0,0,i,s);d.setInvisibleFill(),d.setStroke(new e.Stroke(r.overview.backgroundColor,1,1)),d.setMouseEnabled(!1),o.addChild(d)},O.CreateOverviewContent=function(t,n,o,i){var s=new e.Container(t.getCtx());s.setMouseEnabled(!1),n.Nodes=new(t.getCtx().ojMap);var a=t.GetViewBounds();n.ContentBounds=a?a.clone():null,n.StretchFactor={h:1,v:1};var r=t.GetRootNodeObjects();return r.length>0&&(r.forEach(function(e){O.CreateOverviewNode(t,n,e,s)}),O._adjustNodePositionsForAspectRatio(t,n,o,i),O.ZoomToFitOverviewContent(t,n,s,o,i)),s},O.CreateOverviewNode=function(t,n,o,i){if(o){var s=O._createOverviewNodeShape(t,o);if(O._positionOverviewNode(o,s),n.Nodes.set(o.getId(),s),i.addChild(s),o.isDisclosed()){s._ovChildNodePane=new e.Container(t.getCtx()),s.addChild(s._ovChildNodePane);var a=o.getContainerPadding();s._ovChildNodePane.setTranslate(a.left,a.top),o.getChildNodeIds().forEach(function(e){var o=t.getNodeById(e);O.CreateOverviewNode(t,n,o,s._ovChildNodePane)})}}},O.RemoveOverviewWindow=function(t,e){if(e){e.setClipPath(null);var n=e.getParent();t.removeChild(n)}},O.UpdateOverviewWindow=function(t,n){n.ContentBounds=t.GetViewBounds(),O._positionOverviewWindow(t,n),O._updateOverviewNodes(t,n),n.Nodes.size>0&&O.ZoomToFitOverviewContent(t,n,n.Content,n.Width,n.Height),n.UpdateViewport();var o=n.getOverviewWidth(),i=n.getOverviewHeight();n.setClipPath(null);var s=new e.ClipPath(t.getId()+"dgr_ovClip");s.addRect(n.getTranslateX(),n.getTranslateY(),o,i),n.setClipPath(s);var a=n.getParent().getChildIndex(1);a instanceof e.Rect&&(a.setWidth(o),a.setHeight(i))},O.UpdateOverviewContent=function(t,e,n,o){var i=o.data.nodes;if(i&&0!==i.length){var s=o.parentId,a=s?t.getNodeById(s):null,r=[];if("add"==n)if(a){var d=O._findRootNode(t,a);O._removeNode(t,e,d.getId()),r.push(d)}else i.forEach(function(e){r.push(t.getNodeById(e.id))});else if("change"==n){var h=new(t.getCtx().ojMap);i.forEach(function(e){var n=O._findRootNode(t,t.getNodeById(e.id));n&&h.set(n.getId(),n)}),h.forEach(function(n,o,i){O._removeNode(t,e,o),r.push(n)})}else if("remove"==n)if(a){d=O._findRootNode(t,a);O._removeNode(t,e,d.getId()),r.push(d)}else i.forEach(function(n){O._removeNode(t,e,n.id)});r.forEach(function(n){O.CreateOverviewNode(t,e,n,e.Content)})}},O.TransformFromContentToViewportCoords=function(t,n,o){var i=o.Content,s=i.getTranslateX(),a=i.getTranslateY(),r=i.getScaleX(),d=i.getScaleY(),h=t*r*o.StretchFactor.h+s,l=n*d*o.StretchFactor.v+a;return new e.Point(h,l)},O.TransformFromViewportToContentCoords=function(t,n,o){var i=o.Content,s=i.getTranslateX(),a=i.getTranslateY(),r=i.getScaleX(),d=i.getScaleY(),h=(t-s)/r/o.StretchFactor.h,l=(n-a)/d/o.StretchFactor.v;return new e.Point(h,l)},O.ZoomToFitOverviewContent=function(t,e,n,o,i){var s=e.ContentBounds,a=O._calcOverviewScale(t,s,o,i,e);n.setScale(a,a);var r=(o-s.w*a)/2-s.x*a,d=(i-s.h*a)/2-s.y*a;n.setTranslate(r,d)},O._adjustNodePositionsForAspectRatio=function(t,n,o,i){if("meet"!==t.Options.overview.preserveAspectRatio){var s=t.GetViewBounds(),a=2*e.CSSStyle.toNumber(t.Options.styleDefaults._overviewStyles.overviewContent.padding);if("canvas"===t.Options.overview.fitArea)var r=O._getCanvasDimensions(t),d=r.w/r.h;else d=s.w/s.h;var h=(o-a)/(i-a);if(h==d)return;var l=h>d?h/d:1,g=h<d?d/h:1;n.ContentBounds=s.clone(),n.ContentBounds.w=n.ContentBounds.w*l,n.ContentBounds.h=n.ContentBounds.h*g,n.StretchFactor={h:l,v:g};var u=t.GetRootNodeObjects();if(u.length>0){var p=O._getNodesStretchFactor(n,u,n.StretchFactor);if(1===p.h&&1===p.v)return n.ContentBounds=s.clone(),void(n.StretchFactor={h:1,v:1});u.forEach(function(t){O._adjustNodePosition(n.Nodes.get(t.getId()),p)})}}},O._getCanvasDimensions=function(t){var n;if("fixed"===t.Options.panning||"none"===t.Options.panning)n=new e.Dimension(t.Width,t.Height);else{var o=t.GetViewBounds(),i=t.getPanZoomCanvas().getMinZoom();n=new e.Dimension(2*o.w*i,2*o.h*i)}return n},O._adjustNodePosition=function(t,e){var n=t.getCenterDimensions(),o=t.getTranslateX(),i=t.getTranslateY();if(e.h>1){var s=(o+n.x-e.tx)*e.h+e.tx;t.setTranslateX(s-.5*n.w)}else if(e.v>1){var a=(i+n.y-e.ty)*e.v+e.ty;t.setTranslateY(a-.5*n.h)}},O._getNodesStretchFactor=function(t,e,n){var o={h:1,v:1};if(n.h>1){var i=Number.MAX_VALUE,s=-Number.MAX_VALUE;e.forEach(function(t){var e=t.getContentBounds(),n=t.getTranslateX()+e.x+.5*e.w;d=n<i?e:d,h=n>s?e:h,i=Math.min(n,i),s=Math.max(n,s)});var a=.5*d.w,r=.5*h.w;o={h:s===i?1:(t.ContentBounds.w-a-r)/(s-i),v:1,tx:a}}if(n.v>1){var d,h,l=Number.MAX_VALUE,g=-Number.MAX_VALUE;e.forEach(function(t){var e=t.getContentBounds(),n=t.getTranslateY()+e.y+.5*e.h;d=n<l?e:d,h=n>g?e:h,l=Math.min(n,l),g=Math.max(n,g)});a=.5*d.h,r=.5*h.h;o={h:1,v:g===l?1:(t.ContentBounds.h-a-r)/(g-l),ty:a}}return o},O._calcOverviewScale=function(t,n,o,i,s){var a=2*e.CSSStyle.toNumber(t.Options.styleDefaults._overviewStyles.overviewContent.padding),r=o-a,d=i-a;if("canvas"===t.Options.overview.fitArea){var h=t.GetViewBounds(),l=t.getPanZoomCanvas().getMinZoom(),g=O._getCanvasDimensions(t),u=Math.min((g.h-h.h*l)/2,(g.w-h.w*l)/2),p=s.StretchFactor.h,c=s.StretchFactor.v,_=r/g.w*p,f=d/g.h*c,y=Math.min(_,f);r-=2*u*p*y,d-=2*u*c*y}var C=r/n.w,m=d/n.h;return Math.min(C,m)},O._createOverviewNodeShape=function(t,n){var o=t.Options.styleDefaults._overviewStyles.node,i=n.getData();i.overview&&(o=e.JsonUtils.merge(i.overview.icon,o));var s=o.shape;n.isDisclosed()||t.Options.renderer&&"inherit"==s?s="rectangle":"inherit"==s&&(s=i.icon.shape);var a=n.getLayoutBounds(),r=a.w,d=a.h,h=new e.SimpleMarker(t.getCtx(),s,r/2,d/2,r,d,0);h.setSolidFill(i.icon.color);var l=[n.isDisclosed()?"oj-diagram-overview-container-node":"oj-diagram-overview-node"];return o.svgClassName&&l.push(o.svgClassName),h.setStyle(o.svgStyle).setClassName(l.join(" ")),h},O._findRootNode=function(t,e){for(var n=e,o=e?e.getGroupId():null;o;)o=(n=t.getNodeById(o)?t.getNodeById(o):n).getGroupId();return n},O._positionOverviewNode=function(t,e){var n=t.getTranslateX(),o=t.getTranslateY();e.setTranslate(n,o)},O._positionOverviewWindow=function(t,n){var o=t.Options.overview.halign,i=t.Options.overview.valign,s=e.CSSStyle.toNumber(t.Options.styleDefaults._overviewStyles.overview.padding),a=n.getOverviewWidth(),r=n.getOverviewHeight(),d=t.Width,h=t.Height;switch(o){case"start":o=e.Agent.isRightToLeft(t.getCtx())?"right":"left";break;case"end":o=e.Agent.isRightToLeft(t.getCtx())?"left":"right"}var l="center"==o?(d-a)/2:"right"==o?d-a-s:s,g="middle"==i?(h-r)/2:"bottom"==i?h-r-s:s;n.getParent().setTranslate(l,g)},O._removeNode=function(t,e,n){var o=e.Nodes.get(n);o&&o.getParent().removeChild(o)},O._updateOverviewNodes=function(t,e){e.Nodes.forEach(function(n,o,i){var s=t.getNodeById(o);s&&n?O._positionOverviewNode(s,n):n&&!s&&e.Nodes.delete(o)}),O._adjustNodePositionsForAspectRatio(t,e,e.Width,e.Height)};var I=function(t){this.Init(t.getCtx(),t.processEvent,t),this.Diagram=t,this._id=t.getId()+"_overview"};e.Obj.createSubclass(I,o.Overview),I.prototype.renderData=function(t,e){this.Content=O.CreateOverviewContent(this.Diagram,this,t,e),this.addChild(this.Content),this.Content.setMouseEnabled(!1)},I.prototype.render=function(){var t=Math.min(this.Diagram.Width,this.Diagram.Options.overview.width),e=Math.min(this.Diagram.Height,this.Diagram.Options.overview.height),n=this.Diagram.Options.styleDefaults._overviewStyles,o={xMin:0,xMax:t,yMin:0,yMax:e,x1:0,x2:t,y1:0,y2:e,style:{overviewBackgroundColor:n.overview.backgroundColor,windowBackgroundColor:n.viewport.backgroundColor,windowBorderTopColor:n.viewport.borderColor,windowBorderRightColor:n.viewport.borderColor,windowBorderBottomColor:n.viewport.borderColor,windowBorderLeftColor:n.viewport.borderColor,timeAxisBarColor:"#00000000"},animationOnClick:"off",featuresOff:"zoom"},i=0===this.Diagram.GetAllRoots().length;this._viewportConstraints={xMin:i?0:-Number.MAX_VALUE,yMin:i?0:-Number.MAX_VALUE,xMax:i?t:Number.MAX_VALUE,yMax:i?e:Number.MAX_VALUE},this.Diagram.IsPanningEnabled()||this.setMouseEnabled(!1),I.superclass.render.call(this,o,t,e)},I.prototype.animateInsert=function(t){},I.prototype.animateDelete=function(t,e){},I.prototype.animateUpdate=function(t,n){this.Content.setAlpha(0),t.add(new e.AnimFadeIn(this.getCtx(),this.Content,t.getAnimationDuration()),y);var o=this.getChildIndex(this.Content);this.addChildAt(n.Content,o+1);var i=new e.AnimFadeOut(this.getCtx(),n.Content,t.getAnimationDuration());e.Playable.appendOnEnd(i,function(){n.Content.getParent().removeChild(n.Content)}),t.add(i,y);var s=new e.CustomAnimation(this.getCtx(),null,t.getAnimationDuration()),a=n.GetAnimationParams(),r=this.GetAnimationParams();this.SetAnimationParams(a),s.getAnimator().addProp(e.Animator.TYPE_NUMBER_ARRAY,this,this.GetAnimationParams,this.SetAnimationParams,r),t.add(s,y)},I.prototype.updateConstraints=function(t,e,n,o){var i=this.Diagram.getPanZoomCanvas().getZoom(),s=O.TransformFromContentToViewportCoords(-n/i,-o/i,this),a=O.TransformFromContentToViewportCoords(-t/i,-e/i,this),r=this._viewportPosition.x2-this._viewportPosition.x1,d=this._viewportPosition.y2-this._viewportPosition.y1,h=this.Diagram.getPanDirection();this._viewportConstraints={xMin:"y"===h?this._viewportPosition.x1:s.x,xMax:"y"===h?this._viewportPosition.x2:a.x+r,yMin:"x"===h?this._viewportPosition.y1:s.y,yMax:"x"===h?this._viewportPosition.y2:a.y+d}},I.prototype.getMinimumPositionX=function(){return this._viewportConstraints.xMin},I.prototype.getMinimumPositionY=function(){return this._viewportConstraints.yMin},I.prototype.getMaximumPositionX=function(){return this._viewportConstraints.xMax},I.prototype.getMaximumPositionY=function(){return this._viewportConstraints.yMax},I.prototype.getMinimumWindowWidth=function(){return 0},I.prototype.getMaximumWindowWidth=function(){return Number.MAX_VALUE},I.prototype.getMinimumWindowHeight=function(){return 0},I.prototype.getMaximumWindowHeight=function(){return Number.MAX_VALUE},I.prototype.UpdateViewport=function(){if(!this._bCancelUpdateViewport){var t=O.CalcViewportFromMatrix(this.Diagram),e=O.TransformFromContentToViewportCoords(t.x,t.y,this),n=O.TransformFromContentToViewportCoords(t.x+t.w,t.y+t.h,this);this._viewportPosition={x1:e.x,x2:n.x,y1:e.y,y2:n.y},this.setViewportRange(e.x,n.x,e.y,n.y)}},I.prototype.HandleViewportChange=function(t){var e=void 0!==t.newX1?t.newX1:this._viewportPosition.x1,n=void 0!==t.newY1?t.newY1:this._viewportPosition.y1,o=O.TransformFromViewportToContentCoords(this._viewportPosition.x1,this._viewportPosition.y1,this),i=O.TransformFromViewportToContentCoords(e,n,this);this._viewportPosition.x1=e,this._viewportPosition.y1=n;var s=this.Diagram.getPanZoomCanvas().getZoom(),a=(i.x-o.x)*s,r=(i.y-o.y)*s;0===a&&0===r||(this._bCancelUpdateViewport=!0,this.Diagram.getPanZoomCanvas().panBy(-a,-r),this._bCancelUpdateViewport=!1)},I.prototype.GetAnimationParams=function(){var t=[],e=this.getSlidingWindow(),n=this.getLeftHandle(),o=this.getRightHandle(),i=this.getBottomBar(),s=this.getTopBar();return t.push(e.getTranslateX()),t.push(e.getTranslateY()),t.push(e.getWidth()),t.push(e.getHeight()),t.push(n.getX1()),t.push(n.getY1()),t.push(n.getX2()),t.push(n.getY2()),t.push(o.getX1()),t.push(o.getY1()),t.push(o.getX2()),t.push(o.getY2()),t.push(i.getX1()),t.push(i.getY1()),t.push(i.getX2()),t.push(i.getY2()),t.push(s.getX1()),t.push(s.getY1()),t.push(s.getX2()),t.push(s.getY2()),t},I.prototype.SetAnimationParams=function(t){var e=this.getSlidingWindow(),n=this.getLeftHandle(),o=this.getRightHandle(),i=this.getBottomBar(),s=this.getTopBar(),a=0;e.setTranslateX(t[a++]),e.setTranslateY(t[a++]),e.setWidth(t[a++]),e.setHeight(t[a++]),n.setX1(t[a++]),n.setY1(t[a++]),n.setX2(t[a++]),n.setY2(t[a++]),o.setX1(t[a++]),o.setY1(t[a++]),o.setX2(t[a++]),o.setY2(t[a++]),i.setX1(t[a++]),i.setY1(t[a++]),i.setX2(t[a++]),i.setY2(t[a++]),s.setX1(t[a++]),s.setY1(t[a++]),s.setX2(t[a++]),s.setY2(t[a++])},I.prototype.CreateAnimationClone=function(){var t=this.getCtx(),n=new e.Container(t,this.getId());n.ContentBounds=this.Diagram.GetViewBounds(),n.setMouseEnabled(!1);var o=new e.Container(t,"ovContentClone");n.addChild(o),n.Content=o,n.Nodes=new t.ojMap,n.Diagram=this.Diagram;var i=this.Diagram.GetRootNodeObjects();i.length>0&&(i.forEach(function(t){O.CreateOverviewNode(n.Diagram,n,t,o)}),O.ZoomToFitOverviewContent(n.Diagram,n,o,this.Width,this.Height));var s=this.GetAnimationParams();return n.GetAnimationParams=function(){return s},n};var L=function(t){this.Init(t)};e.Obj.createSubclass(L,e.Automation,"DvtDiagramAutomation"),L.prototype.Init=function(t){this._diagram=t},L.prototype.GetSubIdForDomElement=function(t){var e=this._diagram.getEventManager().GetLogicalObject(t);return e&&e instanceof m?"node["+this._diagram.GetAllNodes().indexOf(e.getId())+"]":e&&e instanceof D?"link["+this._diagram.GetAllLinks().indexOf(e.getId())+"]":null},L.prototype.getDomElementForSubId=function(t){if(t==e.Automation.TOOLTIP_SUBID)return this.GetTooltipElement(this._diagram);var n=this._parseSubId(t),o=n.component,i=n.index,s=null;return"node"==o?s=this._getNode(i):"link"==o&&(s=this._getLink(i)),s?s.getElem():null},L.prototype._parseSubId=function(t){var e=t,n=-1,o=t.substring(0,t.indexOf("["));return o&&(e="node"==o||"link"==o?o:null,n=parseInt(t.substring(t.indexOf("[")+1,t.indexOf("]")))),{component:e,index:n}},L.prototype.getNodeCount=function(){return this._diagram.GetAllNodes().length},L.prototype.getLinkCount=function(){return this._diagram.GetAllLinks().length},L.prototype.getNode=function(t){var n=this._getNode(t);if(n){var o={};o.id=n.getId(),o.selected=n.isSelected(),o.tooltip=n.getShortDesc(),o.label=n.getData().label;var i=n.getData().backgroundStyle;return i&&i instanceof Object&&(i=e.CSSStyle.cssObjectToString(i)),o.background=i,o.icon=this._getMarkerData(n.GetIcon()),o.expanded=n.isDisclosed(),o}return null},L.prototype.getLink=function(t){var n=this._getLink(t);if(n){var o={};return o.id=n.getId(),o.selected=n.isSelected(),o.tooltip=n.getShortDesc(),o.label=n.getData().label,o.color=n.getLinkColor(),o.width=n.getLinkWidth(),o.style=this._getLinkStyleFromObject(n.getLinkStyle()),o.startNode=n.getStartId(),o.endNode=n.getEndId(),o.startConnectorType=n.getStartConnectorType(),o.endConnectorType=n.getEndConnectorType(),o.promoted=n.isPromoted(),n.isPromoted()&&(o.links=e.JsonUtils.clone(n.getData()._links)),o}return null},L.prototype.getPromotedLink=function(t,e){var n=this._getNode(t),o=this._getNode(e);if(!n||!o)return null;var i=D.GetPromotedLinkId(this._diagram,n.getId(),o.getId()),s=this._diagram.getLinkById(i);if(s){var a={};return a.id=s.getId(),a.selected=s.isSelected(),a.tooltip=s.getShortDesc(),a.color=s.getLinkColor(),a.width=s.getLinkWidth(),a.style=this._getLinkStyleFromObject(s.getLinkStyle()),a.startNode=s.getStartId(),a.endNode=s.getEndId(),a.startConnectorType=s.getStartConnectorType(),a.endConnectorType=s.getEndConnectorType(),a.count=s.getData()._links.length,a}return null},L.prototype._getLinkStyleFromObject=function(t){if(this._diagram.getCtx().isCustomElement())return e.CSSStyle.cssObjectToString(t);if(t&&t instanceof Object){if(t._type==D.CUSTOM_STYLE){var n=e.JsonUtils.clone(t);return delete n._type,e.CSSStyle.cssObjectToString(n)}return t._type}return t},L.prototype.getExpanded=function(){return this._diagram.DisclosedNodes},L.prototype._getMarkerData=function(t){if(t){var n={};return n.shape=t instanceof e.SimpleMarker?t.getType():"none",t.getFill()&&(n.color=t.getFill().getColor()),n}return null},L.prototype._getNode=function(t){var e=this._diagram.GetAllNodes();return t>=0&&t<e.length?this._diagram.getNodeById(e[t]):null},L.prototype._getLink=function(t){var e=this._diagram.GetAllLinks();return t>=0&&t<e.length?this._diagram.getLinkById(e[t]):null};var T=function(t,e,n){this.Init(t,e,n)};e.Obj.createSubclass(T,e.Obj,"DvtDiagramDataAnimationState"),T.prototype.Init=function(t,e,n){this._diagram=t,this._context=t.getCtx(),this._nodes=[],this._newNodes=[],this._links=[],this._newLinks=[],this._processedObjMap=new this._context.ojMap,this.PanZoomMatrix=this._diagram.getPanZoomCanvas().getContentPane().getMatrix(),this.IsPartialUpdate=!(!e||!n),t.Overview&&(this.Overview=this.IsPartialUpdate?t.Overview.CreateAnimationClone():t.Overview),this.NodesMap=this._diagram.GetAllNodesMap(),this.LinksMap=this._diagram.GetAllLinksMap(),this._setNodes(e,n),this._setLinks(e,n)},T.prototype.getId=function(){return this._diagram.getId()},T.prototype.getOptions=function(){return this._diagram.getOptions()},T.prototype.getNodes=function(){return this._nodes},T.prototype.getLinks=function(){return this._links},T.prototype.getNewNodes=function(){return this._newNodes},T.prototype.getNewLinks=function(){return this._newLinks},T.prototype.updateStateFromEvent=function(t,e){if(e){var n,o,i,s=e.data.nodes,a=e.data.links;if("add"==t){for(n=0;s&&n<s.length;n++){var r=this._diagram.getNodeById(s[n].id);r&&(!0===this._wasParentDisclosed&&this._newNodes.push(r),this._processedObjMap.set(r.getId(),!0))}for(n=0;a&&n<a.length;n++)i=a[n].id,(o=this._diagram.getLinkById(i)||this._diagram._linkToPromotedMap&&this._diagram.getLinkById(this._diagram._linkToPromotedMap[i]))&&(this._newLinks.push(o),this._processedObjMap.set(o.getId(),!0))}else if("change"==t)for(n=0;a&&n<a.length;n++)i=a[n].id,(o=this._diagram.getLinkById(i)||this._diagram._linkToPromotedMap&&this._diagram.getLinkById(this._diagram._linkToPromotedMap[i]))&&(this._newLinks.push(o),this._processedObjMap.set(o.getId(),!0))}},T.prototype.updateStateFromLayoutContext=function(t){if(this.IsPartialUpdate){var e=this;t.getDirtyContext().forEach(function(t,n,o){e._processedObjMap.has(n)||((t=e._diagram.getNodeById(n)||e._diagram.getLinkById(n))instanceof m?(e._nodes.push(t.getAnimationState()),e._newNodes.push(t),e._processedObjMap.set(n,!0)):t instanceof D&&(e._links.push(t.getAnimationState()),e._newLinks.push(t),e._processedObjMap.set(n,!0)))})}},T.prototype._setNodes=function(t,e){if(this.IsPartialUpdate){var n=e.data.nodes,o=e.parentId;if("add"==t)this._addAncestorStates(o);else if("change"==t)for(var i=0;n&&i<n.length;i++){(s=this._diagram.getNodeById(n[i].id))&&(this._addAncestorStates(s.getGroupId()),this._nodes.push(s.getAnimationState()),this._newNodes.push(s),this._processedObjMap.set(s.getId(),!0))}else if("remove"==t&&(this._addAncestorStates(o),n&&!o))for(i=0;i<n.length;i++){var s;(s=this._diagram.getNodeById(n[i].id))&&(this._nodes.push(s),this._processedObjMap.set(s.getId(),!0))}}else this._nodes=this._diagram.GetRootNodeObjects()},T.prototype._setLinks=function(t,e){if(this.IsPartialUpdate){var n,o,i,s=e.data.links;if(!s)return;if("change"==t)for(n=0;n<s.length;n++)i=s[n].id,(o=this._diagram.getLinkById(i)||this._diagram._linkToPromotedMap&&this._diagram.getLinkById(this._diagram._linkToPromotedMap[i]))&&(this._links.push(o.getAnimationState()),this._processedObjMap.set(o.getId(),!0));else if("remove"==t)for(n=0;n<s.length;n++)i=s[n].id,(o=this._diagram.getLinkById(i)||this._diagram._linkToPromotedMap&&this._diagram.getLinkById(this._diagram._linkToPromotedMap[i]))&&(this._links.push(o),this._processedObjMap.set(o.getId(),!0))}else this._links=this._diagram.GetAllLinkObjects()},T.prototype._addAncestorStates=function(t){var e=t?this._diagram.getNodeById(t):null;for(this._wasParentDisclosed=!e||e.isDisclosed();e;){var n=a.compareValues(this._context,e.getId(),t)||e.isDisclosed()&&this._diagram.getOptions().renderer,o=e.getAnimationState(n);this._nodes.push(o),this._newNodes.push(e),this._processedObjMap.set(e.getId(),!0),e=e.getGroupId()?this._diagram.getNodeById(e.getGroupId()):null}};var x=function(t,e,n,o){this.Init(t,e,n,o)};e.Obj.createSubclass(x,e.DataAnimationHandler,"DvtDiagramDataAnimationHandler"),x.prototype.Init=function(t,e,n,o){x.superclass.Init.call(this,t,e),this._oldDiagram=n,this._newDiagram=o},x.prototype.getOldDiagram=function(){return this._oldDiagram},x.prototype.getNewDiagram=function(){return this._newDiagram},x.prototype.getAnimationDuration=function(){return N.getAnimationDuration(this._oldDiagram)},x.prototype.constructAnimation=function(t,e){var n=!1;if(e&&e.length>0&&(n=e[0]instanceof D),n&&!this.getCtx().isOffscreen()){var o,i,s=this.getCtx(),a=x._expandLinksArrayToMap(s,t),r=x._expandLinksArrayToMap(s,e),d=new s.ojMap,h=this;a.forEach(function(t,e,n){if(o=t,i=r.get(e))if(o.isPromoted()||i.isPromoted()){var s=o.isPromoted()?o.getData()._links.length:1,l=i.isPromoted()?i.getData()._links.length:1;s>l&&!d.has(o.getId())?h._constructExpandCollapseAnimation(o,r,d,!0):s<l&&!d.has(i.getId())?h._constructExpandCollapseAnimation(i,a,d,!1):s!=l||d.has(i.getId())||(i.animateUpdate(h,o),d.set(i.getId(),!0))}else i.animateUpdate(h,o);else-1==h.getNewDiagram().GetAllLinks().indexOf(o.getId())&&o.animateDelete(h)}),r.forEach(function(t,e,n){o=a.get(e),i=t,o||h.getOldDiagram().LinksMap.has(i.getId())||i.animateInsert(h)})}else x.superclass.constructAnimation.call(this,t,e)},x.prototype._constructExpandCollapseAnimation=function(t,e,n,o){for(var i=[],s=t.getData()._links,a=0;a<s.length;a++){var r=e.get(s[a].id);r&&-1===i.indexOf(r)&&i.push(r)}i.length>0&&(o?t.animateExpand(this,i):t.animateCollapse(this,i),n.set(t.getId(),!0))},x._expandLinksArrayToMap=function(t,e){for(var n=new t.ojMap,o=0;o<e.length;o++){var i=e[o];if(i)if(i.isPromoted())for(var s=i.getData()._links,a=0;a<s.length;a++)n.set(s[a].id,i);else n.set(i.getId(),i)}return n};var A=function(t,e,n){this.Init(t,e,n)};e.Obj.createSubclass(A,u),A.prototype.Init=function(t,n,o){A.superclass.Init.call(this,t,n,o),this.Defaults=new p(t),this.EventManager=new E(t,this.processEvent,this),this.EventManager.addListeners(this),e.Agent.isTouchDevice()||this.EventManager.setKeyboardHandler(new P(this,this.EventManager)),this._nodes=new t.ojMap,this._arNodeIds=[],this._arRootIds=[],this._links=new t.ojMap,this._arLinkIds=[],this._renderCount=0,this._deferredObjCount=0,this._allNodeIdsMap=new t.ojMap,this._unresolvedNodeIds=[],this._nodesToResolve=[],this._touchEventContentDiagramObjRef=null,this.setId("diagram")},A.newInstance=function(t,e,n){return new A(t,e,n)},A.prototype.PreRender=function(){!this.IsResize()&&this._bRendered&&("none"!=N.getAnimationOnDataChange(this)&&(this._oldDataAnimState=new T(this)),this._currentViewport=this.getPanZoomCanvas().getViewport(),this._bRendered=!1,this._oldPanZoomCanvas=this.getPanZoomCanvas(),this._setDataSourceListeners(this.getOptions().data,!1)),this.IsResize()?this._layoutContext&&(this._layoutContext.setEventData(null),this._layoutContext.setComponentSize(new d(0,0,this.getWidth(),this.getHeight())),this._layoutContext.setCurrentViewport(null)):(this.ResetNodesAndLinks(),this._oldLayoutContext=this._layoutContext,this._layoutContext=null)},A.prototype.ResetNodesAndLinks=function(){var t=this.getCtx();this.setLinksPane(new e.Container(t)),this.setNodesPane(new e.Container(t)),this.setTopPane(new e.Container(t)),this._nodes=new t.ojMap,this._arNodeIds=[],this._arRootIds=[],this._links=new t.ojMap,this._arLinkIds=[],this._highlightedObjects=null,this._promotedLinksMap=null,this._linkToPromotedMap=null,this._collapsedNodes=null,this.isDataProviderMode()||(this.getOptions().nodes=[],this.getOptions().links=[]),this._allNodeIdsMap=new t.ojMap,this._unresolvedNodeIds=[],O.RemoveOverviewWindow(this,this.Overview),this.Overview=null},A.prototype._onAnimationEnd=function(){this._deleteContainer&&(this.removeChild(this._deleteContainer),this._deleteContainer.destroy()),this._deleteContainer=null,this.Animation&&this.getEventManager().addListeners(this),this.AnimationStopped||this.RenderComplete(),this.Animation=null,this.AnimationStopped=!1,this._bRendered&&(this._oldDataAnimState=null)},A.prototype.animateUpdate=function(t,n){var o=new e.CustomAnimation(this.getCtx(),null,t.getAnimationDuration()),i=n.PanZoomMatrix,s=this.getPanZoomCanvas().getContentPane().getMatrix();i.equals(s)||(this.getPanZoomCanvas().getContentPane().setMatrix(i),o.getAnimator().addProp(e.Animator.TYPE_MATRIX,this.getPanZoomCanvas().getContentPane(),this.getPanZoomCanvas().getContentPane().getMatrix,this.getPanZoomCanvas().getContentPane().setMatrix,s));var a=n.IsPartialUpdate?n.getNewNodes():this.GetRootNodeObjects(),r=n.IsPartialUpdate?n.getNewLinks():this.GetAllLinkObjects();t.constructAnimation(n.getNodes(),a),t.constructAnimation(n.getLinks(),r),t.constructAnimation([n.Overview],[this.Overview]),t.add(o,y)},A.prototype._resolveDeferredData=function(t,e){if(null==e||this._isNodeDisclosed(e.id)||this._discoverLinks(t,e)){var n=t.getData(e);this._deferredObjCount++;var o=this,i=this._renderCount;n.then(function(n){o._renderDeferredData(i,t,e||o.getOptions(),n)},function(n){o._renderDeferredData(i,t,e||o.getOptions(),null)})}},A.prototype._renderDeferredData=function(t,e,n,o){if(t===this._renderCount&&this.getCtx().isReadyToRender()){if(null!=o){if(n.nodes=o.nodes,Array.isArray(o.links)&&(this.getOptions().links=this.getOptions().links.concat(o.links)),this._findUnresolvedLinks(o),Array.isArray(n.nodes))for(this._nodesToResolve=this._nodesToResolve.concat(n.nodes);this._nodesToResolve.length>0;)this._resolveDeferredData(e,this._nodesToResolve.shift())}else n.nodes=null;this._deferredObjCount--,0===this._deferredObjCount&&this.RenderComponentInternal()}},A.prototype._findUnresolvedLinks=function(t,e){if(!("none"===this.getOptions().promotedLinkBehavior||this.isDataProviderMode()&&"lazy"===this.getOptions().promotedLinkBehavior)){var n=function(t,o){Array.isArray(t.nodes)&&t.nodes.forEach(function(t){o.set(t.id,!0),e&&n(t,o)})};n(t,this._allNodeIdsMap);for(var o=this._unresolvedNodeIds.length-1;o>=0;o--)this._allNodeIdsMap.has(this._unresolvedNodeIds[o])&&this._unresolvedNodeIds.splice(o,1);if(Array.isArray(t.links))for(o=0;o<t.links.length;o++){var i=t.links[o];this._allNodeIdsMap.has(i.startNode)||this._unresolvedNodeIds.push(i.startNode),this._allNodeIdsMap.has(i.endNode)||this._unresolvedNodeIds.push(i.endNode)}}},A.prototype._discoverLinks=function(t,e){var n=this.getOptions().promotedLinkBehavior;return!("none"===n||0==this._unresolvedNodeIds.length||"lazy"==n&&t.getChildCount(e)<=0)&&"disjoint"!=t.getDescendantsConnectivity(e)},A.prototype._setDataSourceListeners=function(t,e){t&&(this._dataSourceAddEventHandler||(this._dataSourceAddEventHandler=this.handleDataSourceChangeEvent.bind(this,"add")),this._dataSourceRemoveEventHandler||(this._dataSourceRemoveEventHandler=this.handleDataSourceChangeEvent.bind(this,"remove")),this._dataSourceChangeEventHandler||(this._dataSourceChangeEventHandler=this.handleDataSourceChangeEvent.bind(this,"change")),e?(t.on("add",this._dataSourceAddEventHandler),t.on("remove",this._dataSourceRemoveEventHandler),t.on("change",this._dataSourceChangeEventHandler)):(t.off("add",this._dataSourceAddEventHandler),t.off("remove",this._dataSourceRemoveEventHandler),t.off("change",this._dataSourceChangeEventHandler)))},A.prototype.addDataSourceEventListeners=function(){this._setDataSourceListeners(this.getOptions().data,!0)},A.prototype.removeDataSourceEventListeners=function(){this._setDataSourceListeners(this.getOptions().data,!1)},A.prototype._fetchDataProviderData=function(t,e){var n=this.isTreeDataProvider()?a.GetCollapsedContainers(t,e,[]):[];if(n.length>0){var o=this,i=n.map(function(e){return o.Options._fetchDataHandler(t,o._context.KeySetImpl([e.id]),e,e.id)}),s=this._renderCount;Promise.all(i).then(function(n){if(s===o._renderCount&&o.getCtx().isReadyToRender()){e=[],n.forEach(function(t){Array.isArray(t)&&t.forEach(function(t){o._allNodeIdsMap.set(t.id,!0),e.push(t)})});for(var i=o._unresolvedNodeIds.length-1;i>=0;i--)o._allNodeIdsMap.has(o._unresolvedNodeIds[i])&&o._unresolvedNodeIds.splice(i,1);o._unresolvedNodeIds.length>0?o._fetchDataProviderData(t,e):o.RenderComponentInternal()}})}else this.RenderComponentInternal()},A.prototype.isDataProviderMode=function(){return!!this.getOptions().nodeData},A.prototype.isTreeDataProvider=function(){var t=this.getOptions().nodeData;return!(!t||!t.getChildDataProvider)},A.prototype.Render=function(){if(A.superclass.Render.call(this),this.InitComponentInternal(),this._deferredObjCount=0,this._nodesToResolve=[],this._bRendered||this.IsResize())0===this._deferredObjCount&&this.RenderComponentInternal();else if(this._renderCount++,this.isDataProviderMode()){this._findUnresolvedLinks({nodes:this.Options.nodes,links:this.Options.links},!0);var t=this._unresolvedNodeIds.length>0?this.Options.nodes.slice():[];this._fetchDataProviderData(this.Options.nodeData,t)}else if(this.getOptions().data){var e=this.getOptions().data;this._setDataSourceListeners(e,!1),this._resolveDeferredData(e,null)}else this.RenderComponentInternal()},A.prototype.RenderComponentInternal=function(){var t;if(this._bRendered||this.IsResize()||(this._setDataSourceListeners(this.getOptions().data,!0),this.prepareNodes(this.getOptions().nodes),this.renderLinks(this.getOptions().links),this.getCtx().setKeyboardFocusArray([this])),t=0===this._nodes.size)this._processContent(t);else{this.contains(this._oldPanZoomCanvas)||this.addChild(this._oldPanZoomCanvas);var e=this.layout(),n=this,o=this._renderCount;e.then(function(){o===n._renderCount&&n._processContent(t)},function(){o===n._renderCount&&(n._oldPanZoomCanvas&&(n.removeChild(n._oldPanZoomCanvas),n._oldPanZoomCanvas.destroy(),n._oldPanZoomCanvas=null),n._bRendered=!0,this._currentViewport=null)})}},A.prototype._processContent=function(t){var n;if(t||(this.removeChild(this._oldPanZoomCanvas),this._processHighlighting(),this._processInitialSelections(),this._updateKeyboardFocusEffect(),(n=null==this._cachedViewBounds)&&(this._cachedViewBounds=this.GetViewBounds()),this._fitContent()),!this._bRendered){var o=this.getPanZoomCanvas();o.setPanningEnabled(this.IsPanningEnabled()),o.setPanDirection(this.getPanDirection()),o.setZoomingEnabled(this.IsZoomingEnabled()),o.setZoomToFitEnabled(this.IsZoomingEnabled())}!this.Overview&&this.Options.overview&&"on"==this.Options.overview.rendered?(this.Overview=new I(this),O.ConfigureOverviewWindow(this,this.Overview)):this.Overview&&O.UpdateOverviewWindow(this,this.Overview),this.StopAnimation(!0);var i=N.getAnimationOnDisplay(this),s=N.getAnimationOnDataChange(this);if(this._bRendered||"none"===i||this._oldDataAnimState){if("none"!==s&&this._oldDataAnimState){this._deleteContainer=new e.Container(this.getCtx(),"Delete Container"),this.addChild(this._deleteContainer);var a=new x(this.getCtx(),this._deleteContainer,this._oldDataAnimState,this);a.constructAnimation([this._oldDataAnimState],[this]),this.Animation=a.getAnimation()}}else this.Animation=e.BlackBoxAnimationHandler.getInAnimation(this.getCtx(),e.BlackBoxAnimationHandler.ALPHA_FADE,this,null,N.getAnimationDuration(this));if(this.Animation?(this.getEventManager().hideTooltip(),this.getEventManager().removeListeners(this),this.Animation.setOnEnd(this._onAnimationEnd,this),this.Animation.play()):this._onAnimationEnd(),this._oldPanZoomCanvas&&(this._oldPanZoomCanvas.destroy(),this._oldPanZoomCanvas=null),this._bRendered=!0,this._currentViewport=null,this.RefreshEmptyText(t),this.IsPanningEnabled()){var r=this._cachedViewBounds;if(null!=r){var d=this.getPanZoomCanvas().getZoom();this.ConstrainPanning(r.x,r.y,r.w,r.h,d)}}this.ClearLayoutViewport(),n&&(this._cachedViewBounds=null)},A.prototype._fitContent=function(){var t=this.getPanZoomCanvas();if(this._bRendered){if(this.IsResize()||this._partialUpdate){var e=this.AdjustMinZoom();i=(o=this.IsLayoutViewport())?this.GetLayoutViewport():e||this._cachedViewBounds;t.setZoomToFitPadding(o?0:n.PanZoomCanvas.DEFAULT_PADDING),t.setZoomToFitEnabled(!0),t.zoomToFit(null,i),t.setZoomToFitEnabled(this.IsZoomingEnabled())}}else{this.AdjustMinZoom();var o,i=(o=this.IsLayoutViewport())?this.GetLayoutViewport():this._cachedViewBounds;o&&t.setZoomToFitPadding(0),t.zoomToFit(null,i)}},A.prototype.SetOptions=function(t){A.superclass.SetOptions.call(this,t),this.isDataProviderMode()||(this.Options.nodes=[],this.Options.links=[]),this.SetPanningEnabled("none"!=this.Options.panning),this.SetZoomingEnabled("none"!=this.Options.zooming),this.setSelectionMode(this.Options.selectionMode),this.setEmptyText(this.Options.emptyText?this.Options.emptyText:this.Options.translations.labelNoData)},A.getDefaults=function(t){return(new p).getDefaults(t)},A.prototype.getMaxZoom=function(){var t=this.getOptions().maxZoom,e=parseFloat(t);return e>0?e:1},A.prototype.getMinZoom=function(){var t=this.getOptions().minZoom;if(t){var e=parseFloat(t);return e>0&&(t=Math.min(e,this.getMaxZoom())),t}return 0},A.prototype.getPanDirection=function(){return this.getOptions().panDirection},A.prototype.getAnimationDuration=function(){return N.getAnimationDuration(this)},A.prototype.processEvent=function(t,e){var n=t.type;if("categoryHighlight"==n)this._processHighlighting(!0);else if("selection"==n)this.getOptions().selection=t.selection;else if("overview"==n){var o=t.subtype;return void("scrollPos"!=o&&"scrollTime"!=o||this.Overview.HandleViewportChange(t))}t&&this.dispatchEvent(t)},A.prototype.prepareNodes=function(t){if(t){this._prepareNodes(null,t);var e=this.getOptions().expanded;e&&(e.has||this.DisclosedNodes)||(this.DisclosedNodes=e?"all"===e?this._arNodeIds.slice(0):e:[])}},A.prototype.renderLinks=function(t){if(t){for(var n=N.getLinkDefaultStyles(this,"linkDefaults"),o=0;o<t.length;o++){var i=t[o];if(!this._isLinkPromoted(i)){i=N.getLinkStyles(this,i,n);var s=D.newInstance(this,i,!1),a=s.getId();if(this._arLinkIds.push(a),!s.isHidden()){var r=this.getNodeById(s.getStartId()),d=this.getNodeById(s.getEndId());r.addOutLinkId(a),d.addInLinkId(a),s.render(),this._links.set(a,s)}}}if(this._promotedLinksMap){var h=N.getLinkDefaultStyles(this,"promotedLink"),l=this;this._promotedLinksMap.forEach(function(t,n,o){if(!l._links.has(n)){var i=e.JsonUtils.merge(t,h),s=D.newInstance(l,i,!0),a=s.getId(),r=l.getNodeById(s.getStartId()),d=l.getNodeById(s.getEndId());r.addOutLinkId(a),d.addInLinkId(a),s.render(),l._arLinkIds.push(a),l._links.set(a,s)}})}}},A.prototype.layout=function(){var t=this.getOptions().layout,n=this._getLayoutContext();if(n.setDirtyContext(new(this.getCtx().ojMap)),this._currentViewport){var o=this._currentViewport,i=this.getLayoutOffset(),s=new d(o.x-i.x,o.y-i.y,o.w,o.h);n.setCurrentViewport(s)}if(null!=this.Options.panZoomState){var a=this.Options.panZoomState.centerX,r=this.Options.panZoomState.centerY,h=this.Options.panZoomState.zoom,l=a-.5*this.Width/h,g=r-.5*this.Height/h,u=this.Width/h,p=this.Height/h,c=new e.Rectangle(l,g,u,p);n.setViewport(c)}if(t&&"function"==typeof t){for(var _=n.getNodeCount(),f=0;f<_;f++){var y=n.getNodeByIndex(f);this.renderLeafNodeFromContext(y)}var C=this,m=t(n);m||(m={then:function(t,e){t()}}),this.setAlphas(0);var v=this._renderCount;return m.then(function(t){if(C._renderCount===v||C.IsResize()){C.setAlphas(1),C._oldDataAnimState&&C._oldDataAnimState.updateStateFromLayoutContext(n);for(var e=n.getNodeCount(),o=0;o<e;o++){var i=n.getNodeByIndex(o);C.renderNodeFromContext(i,!0)}C.ApplyLayoutContext(n,!0)}},function(t){}),m}this.Log("Diagram: Layout function is not defined",1)},A.prototype.setAlphas=function(t){this._bRendered||(this.getLinksPane().setAlpha(t),this.getNodesPane().setAlpha(t))},A.prototype.getNodeById=function(t){return this._nodes.get(t)},A.prototype.getLinkById=function(t){return this._links.get(t)},A.prototype.GetAllLinks=function(){return this._arLinkIds},A.prototype.GetAllLinksMap=function(){var t=new(this.getCtx().ojMap);return this._links&&this._links.forEach(function(e,n,o){t.set(n,e)}),t},A.prototype.GetAllLinkObjects=function(){var t=[];return this._links&&this._links.forEach(function(e,n,o){t.push(e)}),t},A.prototype.GetAllNodes=function(){return this._arNodeIds},A.prototype.GetAllNodesMap=function(){var t=new(this.getCtx().ojMap);return this._nodes&&this._nodes.forEach(function(e,n,o){t.set(n,e)}),t},A.prototype.GetAllNodeObjects=function(){var t=[];return this._nodes&&this._nodes.forEach(function(e,n,o){t.push(e)}),t},A.prototype.GetAllRoots=function(){return this._arRootIds},A.prototype.GetRootNodeObjects=function(){for(var t=[],e=0;this._arRootIds&&e<this._arRootIds.length;e++){var n=this._nodes.get(this._arRootIds[e]);n&&t.push(n)}return t},A.prototype.HandlePanEvent=function(t){A.superclass.HandlePanEvent.call(this,t),this.Overview&&this.Overview.UpdateViewport()},A.prototype.HandleZoomEvent=function(t){switch(A.superclass.HandleZoomEvent.call(this,t),this.Overview&&this.Overview.UpdateViewport(),t.subtype){case"adjustPanConstraints":if(this.IsPanningEnabled()){var n=t.newZoom,o=this.GetViewBounds();this.ConstrainPanning(o.x,o.y,o.w,o.h,n)}break;case"zoomed":var i=this.getOptions().nodeContent||{};!e.Agent.isTouchDevice()&&i.zoomRenderer&&t.oldZoom!==t.newZoom&&this._nodes.forEach(function(e,n,o){e.rerenderOnZoom(t)});break;case"zoomToFitEnd":case"zoomEnd":i=this.getOptions().nodeContent||{};e.Agent.isTouchDevice()&&i.zoomRenderer&&t.oldZoom!==t.newZoom&&this._nodes.forEach(function(e,n,o){e.rerenderOnZoom(t)})}},A.prototype.getNavigableLinksForNodeId=function(t){var e=[];return this._links.forEach(function(n,o,i){var s=n.getStartId(),a=n.getEndId();s!=t&&a!=t||!n.getVisible()||e.push(n)}),e},A.prototype._processInitialSelections=function(){if(this.Options.selection&&this.isSelectionSupported()){var t=[];this._nodes.forEach(function(e,n,o){t.push(e)}),this._links.forEach(function(e,n,o){t.push(e)}),this.getSelectionHandler().processInitialSelections(this.Options.selection,t)}},A.prototype._processHighlighting=function(t){t&&this.EventManager.removeListeners(this,!0),this._highlightedObjects&&(this._updateAlphas(!1,this._highlightedObjects),this._highlightedObjects=null);var n=this.Options.highlightedCategories;if(n&&0!==n.length){var o="any"==this.Options.highlightMatch;this._highlightedObjects=new(this.getCtx().ojMap);var i=[],s=this;this._nodes.forEach(function(t,a,r){(o?e.ArrayUtils.hasAnyItem(t.getCategories(),n):e.ArrayUtils.hasAllItems(t.getCategories(),n))&&(s._highlightedObjects.set(a,t),i.push(t))}),this._processNodeConnections(i);var a=[];if(this._links.forEach(function(t,i,r){(o?e.ArrayUtils.hasAnyItem(t.getCategories(),n):e.ArrayUtils.hasAllItems(t.getCategories(),n))&&(s._highlightedObjects.set(i,t),a.push(t))}),"linkAndNodes"==this.Options.linkHighlightMode&&this._processLinkConnections(a),this._updateAlphas(!0,this._highlightedObjects),t){s=this;setTimeout(function(){s.getEventManager().addListeners(s)},0)}}else t&&this.EventManager.addListeners(this)},A.prototype._processNodeConnections=function(t){var e=this.Options.nodeHighlightMode;if("node"!=e){for(var n="nodeAndIncomingLinks"==e||"nodeAndLinks"==e,o="nodeAndOutgoingLinks"==e||"nodeAndLinks"==e,i=[],s=0;s<t.length;s++){var a=t[s],r=n&&a.getInLinkIds()?a.getInLinkIds():[];r=o&&a.getOutLinkIds()?r.concat(a.getOutLinkIds()):r;for(var d=0;d<r.length;d++){var h=r[d];this._highlightedObjects.set(h,this.getLinkById(h)),i.push(this.getLinkById(h))}}this._processLinkConnections(i)}},A.prototype._processLinkConnections=function(t){for(var e=0;e<t.length;e++){var n=t[e],o=n.getStartId(),i=n.getEndId();this._highlightedObjects.set(o,this.getNodeById(o)),this._highlightedObjects.set(i,this.getNodeById(i))}},A.prototype._updateAlphas=function(t,e){var n=this._nodes.size+this._links.size;if(e.size!==n)if(this._arNodeIds.length==this._arRootIds.length){var o=t?this.Options.styleDefaults._highlightAlpha:1,i=this.getLinksPane(),s=this.getNodesPane();if(e.size>.5*n){var a=this.getBottomPane();a.setAlpha(o),this._links.forEach(function(n,o,s){var r=e.get(o);!r&&t?a.addChild(n):r||i.addChild(n)}),this._nodes.forEach(function(n,o,i){var r=e.get(o);!r&&t?a.addChild(n):r||s.addChild(n)})}else{var r=this.getTopPane();i.setAlpha(o),s.setAlpha(o);var d=[],h=[];e.forEach(function(t,e,n){t instanceof D?d.push(t):t instanceof m&&h.push(t)});for(var l=0;l<d.length;l++)t?r.addChild(d[l]):i.addChild(d[l]);for(l=0;l<h.length;l++)t?r.addChild(h[l]):s.addChild(h[l])}}else t?(e.forEach(function(t,e,n){t.highlight(!0)}),this._nodes.forEach(function(t,n,o){e.has(n)||t.highlight(!1)}),this._links.forEach(function(t,n,o){e.has(n)||t.highlight(!1)})):(this._nodes.forEach(function(t,e,n){t.highlight(!0)}),this._links.forEach(function(t,e,n){t.highlight(!0)}))},A.prototype.highlight=function(t){this.Options.highlightedCategories=e.JsonUtils.clone(t),this._processHighlighting()},A.prototype.select=function(t){this.Options.selection=e.JsonUtils.clone(t),this._processInitialSelections()},A.prototype.getAutomation=function(){return this.Automation||(this.Automation=new L(this)),this.Automation},A.prototype.Log=function(t,e){var n=this.getOptions()._logger;if(n)switch(e){case 1:n.error&&n.error(t);break;case 2:n.warn&&n.warn(t);break;case 3:n.info&&n.info(t);break;default:n.log&&n.log(t)}},A.prototype.processDefaultHoverEffect=function(t,e){var n=this.getNodeById(t);n&&n.processDefaultHoverEffect(e)},A.prototype.processDefaultSelectionEffect=function(t,e){var n=this.getNodeById(t);n&&n.processDefaultSelectionEffect(e)},A.prototype.processDefaultFocusEffect=function(t,e){var n=this.getNodeById(t);n&&n.processDefaultFocusEffect(e)},A.prototype.updateNodeDims=function(t){if(t.IsRendered){var e=this.getNodeById(t.getId());t.setBounds(l.convertRectToDiagramRect(e.getLayoutBounds(!0))),t.setContentBounds(l.convertRectToDiagramRect(e.getContentBounds(!0))),t.setLabelBounds(l.convertRectToDiagramRect(e.getLabelBounds(!0)))}else this.renderNodeFromContext(t,!0)},A.prototype.renderLeafNodeFromContext=function(t){if(this.getNodeById(t.getId()).isDisclosed())for(var e=t.getChildNodes(),n=0;n<e.length;n++){var o=e[n];this.renderLeafNodeFromContext(o)}else this.renderNodeFromContext(t,!1)},A.prototype.renderNodeFromContext=function(t,e){if(!t.IsRendered){var n=this.getNodeById(t.getId());if(n.isDisclosed()){var o=this.CreateEmptyLayoutContext();o.setDirtyContext(t.LayoutContext?t.LayoutContext.getDirtyContext():null),this._oldDataAnimState&&this._oldDataAnimState.updateStateFromLayoutContext(o);for(var i=t.getChildNodes(),s=0;s<i.length;s++){var a=i[s];this.renderNodeFromContext(a,!1),o.addNode(a)}for(s=0;s<i.length;s++)this.updateNodeDims(i[s]);this.ApplyLayoutContext(o)}n.render();var r=n.isDisclosed()?n.getContainerPadding():null;r&&t.setContainerPadding(r.top,r.right,r.bottom,r.left),t.setBounds(l.convertRectToDiagramRect(n.getLayoutBounds(e))),t.setContentBounds(l.convertRectToDiagramRect(n.getContentBounds(e))),t.setLabelBounds(l.convertRectToDiagramRect(n.getLabelBounds(e))),t.IsRendered=!0}},A.prototype._prepareNodes=function(t,e){if(e)for(var n=N.getNodeDefaultStyles(this),o=0;o<e.length;o++){var i=N.getNodeStyles(this,e[o],n),s=m.newInstance(this,i),a=s.getId();t?(t.addChildNodeId(a),s.setGroupId(t.getId())):this._arRootIds.push(a),this._arNodeIds.push(a),i.nodes&&i.nodes.length>0&&(this._isNodeDisclosed(a)?(s.setDisclosed(!0),this._prepareNodes(s,i.nodes)):this._addToCollapsedArray(s)),s.isHidden()||(t&&t.GetChildNodePane()?t.GetChildNodePane().addChild(s):this.getNodesPane().addChild(s),this._nodes.set(a,s))}},A.prototype.setNodeDisclosed=function(t,n){n!=this._isNodeDisclosed(t)&&this.dispatchEvent(new e.EventFactory.newEvent(n?"beforeExpand":"beforeCollapse",t))},A.prototype.expand=function(t){var n=!1,o=this.getOptions().expanded;o&&o.has&&!o.has(t)?(n=!0,o=o.add([t]),this.applyOptions({expanded:o},this.Defaults.getNoCloneObject())):(this.DisclosedNodes||(this.DisclosedNodes=[]),this.DisclosedNodes.indexOf(t)<0&&(this.DisclosedNodes.push(t),n=!0));if(n){var i=this.getNodeById(t);if(this.isDataProviderMode()&&!i.getData().nodes){var s=a.GetNodeOption(this,i),r=this,d=this._renderCount;this.getOptions()._fetchDataHandler(this.getOptions().nodeData,o,s,t).then(function(n){d===r._renderCount&&(r.render(r.getOptions(),r.Width,r.Height),r.dispatchEvent(new e.EventFactory.newEvent("expand",t)))})}else this.render(this.getOptions(),this.Width,this.Height),this.dispatchEvent(new e.EventFactory.newEvent("expand",t))}},A.prototype.collapse=function(t){var n=!1,o=this.getOptions().expanded;if(o&&o.has&&o.has(t))n=!0,o=o.delete([t]),this.applyOptions({expanded:o},this.Defaults.getNoCloneObject());else{var i=-1;this.DisclosedNodes&&(i=this.DisclosedNodes.indexOf(t)),i>-1&&(this.DisclosedNodes.splice(i,1),n=!0)}n&&(this.render(this.getOptions(),this.Width,this.Height),this.dispatchEvent(new e.EventFactory.newEvent("collapse",t)))},A.prototype._addLayoutContextForChildNodes=function(t,e,n,o){if(t.isDisclosed()){var i=t.getChildNodeIds(),s=this._createLayoutContextForChildNodes(e,n,i,o);e.setChildNodes(s)}},A.prototype._appendLayoutContextForChildNodes=function(t,n,o,i,s){if(t.isDisclosed()){var a=i.reduce(function(t,e){return t.push(e.id),t},[]),r=this._createLayoutContextForChildNodes(n,o,a,!0),d=n.getChildNodes()||[];r=e.ArrayUtils.insert(d,r,s),n.setChildNodes(r),n.setDisclosed(!0),n.SetContainerPaddingObj(u.getLayoutContainerPadding(t.getContainerPadding())),n.UpdateParentNodes()}},A.prototype._createLayoutContextForChildNodes=function(t,e,n,o){for(var i=[],s=0;s<n.length;s++){var a=this.getNodeById(n[s]);if(a.getVisible()){var r=this.CreateLayoutContextNode(a,null,o,e);r.copyFrom(this._oldLayoutContext?this._oldLayoutContext.getNodeById(n[s]):null),e.addNodeToMap(r),r.setParentNode(t),i.push(r),this._addLayoutContextForChildNodes(a,r,e,o)}}return i},A.prototype._isNodeDisclosed=function(t){var e=this.getOptions().expanded;if(e&&e.has)return e.has(t);var n=this.DisclosedNodes?this.DisclosedNodes:e;return n&&n.indexOf(t)>-1||n&&n.indexOf("all")>-1},A.prototype._isLinkPromoted=function(t){var e=this.getNodeById(t.startNode),n=this.getNodeById(t.endNode);if(e&&n||!this._collapsedNodes)return!1;if("none"===this.getOptions().promotedLinkBehavior)return!0;var o=e?e.getId():this._findFirstVisibleAncestor(t.startNode),i=n?n.getId():this._findFirstVisibleAncestor(t.endNode);if(!o||!i)return!1;if(o===i)return!1;var s=D.GetPromotedLinkId(this,o,i);return this._promotedLinksMap||(this._promotedLinksMap=new(this.getCtx().ojMap)),this._promotedLinksMap.has(s)?this._promotedLinksMap.get(s)._links.push(t):this._promotedLinksMap.set(s,{id:s,startNode:o,endNode:i,_links:[t]}),this._linkToPromotedMap||(this._linkToPromotedMap=new(this.getCtx().ojMap)),this._linkToPromotedMap.set(t.id,s),!0},A.prototype._addToCollapsedArray=function(t){this._collapsedNodes||(this._collapsedNodes=[]),this._collapsedNodes.push(t)},A.prototype._findFirstVisibleAncestor=function(t){for(var e=this.getCtx(),n=function(t,o){if(t)for(var i=0;i<t.length;i++)if(a.compareValues(e,t[i].id,o)||n(t[i].nodes,o))return!0;return!1},o=0;o<this._collapsedNodes.length;o++){var i=this._collapsedNodes[o];if(n(i.getData().nodes,t))return i.getId()}return null},A.prototype._updateKeyboardFocusEffect=function(){var t,e=this.getEventManager().getFocus(),n=!1;e&&(e instanceof m?t=this.getNodeById(e.getId()):e instanceof D&&(t=this.getLinkById(e.getId())),n=e.isShowingKeyboardFocusEffect(),t&&n&&t.showKeyboardFocusEffect(),this.getEventManager().setFocus(t))},A.prototype.clearDisclosedState=function(){this.DisclosedNodes=null},A.prototype.ShowLinkCreationFeedback=function(t){if(this.getEventManager().LinkCreationStarted){var n=this._context.pageToStageCoords(t.pageX,t.pageY),o=this.getPanZoomCanvas().getContentPane().stageToLocal({x:n.x,y:n.y});if(this._linkCreationFeedBack){var i=this._linkCreationFeedBack.GetCreationFeedbackPoints(o);this._linkCreationFeedBack.setPoints(i)}else{var s=this.getEventManager().DragSource.getDragObject();if(s instanceof m){var a=this.getEventManager().DragSource.getDragCoords(),r=this.getPanZoomCanvas().getContentPane().stageToLocal({x:a.x,y:a.y}),d=this.getOptions().styleDefaults.linkDefaults;N.prepareLinkStyle(d,"style");var h=this.getOptions().dnd.drag.ports.linkStyle;if(h&&"function"==typeof h){var l=h({dataContext:s.getDataContext(),portElement:s.__dragPort});l&&(d.style=e.JsonUtils.merge(l.svgStyle,d.style),d.svgClassName=l.svgClassName||d.className)}var g={id:"linkFeedback",startNode:s.getId(),endNode:s.getId()};g=e.JsonUtils.merge(g,d);var u=D.newInstance(this,g,!1);this.getNodesPane().addChild(u),u.setMouseEnabled(!1),u.setPoints([r.x,r.y,o.x,o.y]),this._linkCreationFeedBack=u}}}},A.prototype.HideLinkCreationFeedback=function(){this.getNodesPane().removeChild(this._linkCreationFeedBack),this._linkCreationFeedBack=null},A.prototype.handleDataSourceChangeEvent=function(t,n){if("none"!==N.getAnimationOnDataChange(this)&&(this.dispatchEvent(e.EventFactory.newEvent("notready")),this._oldDataAnimState=new T(this,t,n)),this._currentViewport=this.getPanZoomCanvas().getViewport(),this.IsPanningEnabled()){var o=this.getPanZoomCanvas();o.setMinPanY(null),o.setMaxPanY(null),o.setMinPanX(null),o.setMaxPanX(null)}var i,s,a=n.data.nodes,r=n.data.links;if("add"==t){if(s=(i=n.parentId)?this.getNodeById(i):null,"all"===this.getOptions().expanded&&a){var d=this.DisclosedNodes,h=function(t){for(var e=0;e<t.length;e++)d.push(t[e].id),t[e].nodes&&h(t[e].nodes)};h(a)}s?(s.appendChildNodesData(a,n.index),this._isNodeDisclosed(i)&&(s.setDisclosed(!0),this._prepareNodes(s,a))):this._prepareNodes(null,a),this.renderLinks(r)}else if("change"==t){if(a)for(var l=N.getNodeDefaultStyles(this),g=0;g<a.length;g++){var u=this.getNodeById(a[g].id);if(u){var p=N.getNodeStyles(this,a[g],l);u.setData(p)}}r&&(this._removeLinks(r),this.renderLinks(r))}else"remove"==t&&((s=(i=n.parentId)?this.getNodeById(i):null)?(this._removeNodes(s,a),s.removeChildNodesData(a),s.getData().nodes&&0!==s.getData().nodes.length||s.setDisclosed(!1)):this._removeNodes(null,a),this._removeLinks(r));this._oldDataAnimState&&this._oldDataAnimState.updateStateFromEvent(t,n),this._updateLayoutContext(t,n);var c=0===this.GetAllNodes().length;if(c)this._processContent(c);else{this._renderCount++;var _=this.layout(),f=this,y=this._renderCount;_.then(function(){y===f._renderCount&&(f._partialUpdate=!0,f._updateOverview(t,n),f._processContent(!1),f._partialUpdate=!1)},function(){y===f._renderCount&&(f.removeChild(f._oldPanZoomCanvas),f._oldPanZoomCanvas=null,f._bRendered=!0,this._currentViewport=null)})}},A.prototype._updateOverview=function(t,e){this.Overview&&O.UpdateOverviewContent(this,this.Overview,t,e)},A.prototype._updateLayoutContext=function(t,e){this._layoutContext||(this._layoutContext=this.CreateEmptyLayoutContext());var n=this._layoutContext;n.setEventData({type:t,data:e});var o,i,s,a,r,d,h=e.data.nodes,l=e.data.links;if(e.parentId&&(a=n.getNodeById(e.parentId),r=this.getNodeById(e.parentId)),"add"==t){if(h)if(a&&r)a.Reset(),this._appendLayoutContextForChildNodes(r,a,n,h,e.index);else for(o=0;o<h.length;o++)s=h[o].id,this.getNodeById(s)&&(i=this.CreateLayoutContextNode(this.getNodeById(s),null,!0,n),this._addLayoutContextForChildNodes(this.getNodeById(s),i,n,!0),n.addNode(i));if(l)for(o=0;o<l.length;o++){if(d=l[o].id,c=this.getLinkById(d)||this.getLinkById(this._linkToPromotedMap.get(d))){if(n.getLinkById(c.getId()))continue;var g=c.getData().startNode,u=c.getData().endNode;n.getNodeById(g)&&n.getNodeById(u)&&n.addLink(this.CreateLayoutContextLink(c,g,u,null,n))}}}else if("change"==t){if(h)for(o=0;o<h.length;o++)s=h[o].id,(i=n.getNodeById(s))&&(i.Reset(),i.UpdateParentNodes());if(l){for(o=n.getLinkCount()-1;o>=0;o--){var p=n.getLinkByIndex(o);this._links.get(p.getId())||n.removeLink(p)}for(o=0;o<l.length;o++){var c;if(d=l[o].id,c=this.getLinkById(d)||this.getLinkById(this._linkToPromotedMap.get(d))){n.removeLink(n.getLinkById(c.getId()));g=c.getData().startNode,u=c.getData().endNode;n.getNodeById(g)&&n.getNodeById(u)&&n.addLink(this.CreateLayoutContextLink(c,g,u,null,n))}}}}else if("remove"==t){if(h){for(o=0;o<h.length;o++)s=h[o].id,i=n.getNodeById(s),n.removeNode(a,i);a&&r&&(a.Reset(),a.UpdateParentNodes(),a.setDisclosed(r.isDisclosed()))}for(o=n.getLinkCount()-1;o>=0;o--){p=n.getLinkByIndex(o);this._links.get(p.getId())||n.removeLink(p)}}},A.prototype._getLayoutContext=function(){if(!this._layoutContext){for(var t=this.CreateEmptyLayoutContext(),e=0;e<this._arRootIds.length;e++){var n=this._arRootIds[e];if(this.getNodeById(n)){var o=!this._bRendered,i=this.getNodeById(n),s=this.CreateLayoutContextNode(i,null,o,t);s.copyFrom(this._oldLayoutContext?this._oldLayoutContext.getNodeById(n):null),this._addLayoutContextForChildNodes(i,s,t,o),t.addNode(s)}}var a=this;this._links.forEach(function(e,n,o){var i=e.getData().startNode,s=e.getData().endNode;if(t.getNodeById(i)&&t.getNodeById(s)){var r=a.CreateLayoutContextLink(e,i,s,null,t);r.copyFrom(a._oldLayoutContext?a._oldLayoutContext.getLinkById(n):null),t.addLink(r)}}),this._layoutContext=t,this._oldLayoutContext=null}return this._layoutContext},A.prototype._removeNodes=function(t,n){if(n&&(!t||t.isDisclosed())){for(var o=[],i=0;i<n.length;i++){var s=n[i].id,a=this.getNodeById(s);this._removeNodes(a,a.getData().nodes),this._links.forEach(function(t,e,n){t.getStartId()!=s&&t.getEndId()!=s||o.push(t.getData())}),t?t.removeChildNode(a):(e.ArrayUtils.removeItem(this._arRootIds,s),this.getNodesPane().removeChild(a)),e.ArrayUtils.removeItem(this._arNodeIds,s),this._nodes.delete(s)}this._removeLinks(o)}},A.prototype._removeLinks=function(t){if(t&&0!=t.length)for(var n=0;n<t.length;n++){var o=t[n].id,i=this.getLinkById(o);if(i){i.getParent().removeChild(i);var s=this.getNodeById(i.getStartId()),r=this.getNodeById(i.getEndId());s&&s.removeOutLinkId(o),r&&r.removeInLinkId(o),e.ArrayUtils.removeItem(this._arLinkIds,o),this._links.delete(o)}else if(this._linkToPromotedMap&&this._linkToPromotedMap.has(o)){var d=this._linkToPromotedMap.get(o),h=this._links.get(d),l=h?h.getData()._links:null;if(l&&1==l.length&&l[0].id==o){h.getParent().removeChild(h);s=this.getNodeById(h.getStartId()),r=this.getNodeById(h.getEndId());s&&s.removeOutLinkId(d),r&&r.removeInLinkId(d),e.ArrayUtils.removeItem(this._arLinkIds,h.getId()),this._links.delete(h.getId()),this._promotedLinksMap.delete(h.getId()),this._linkToPromotedMap.delete(o)}else if(l){for(n=0;n<l.length;n++)a.compareValues(this.getCtx(),l[n].id,o)&&l.splice(n,1);this._linkToPromotedMap.delete(o)}}}},A.prototype.handleTouchStart=function(){},A.prototype.handleTouchEnd=function(){this._clearTouchEventContent(),this._touchEventContentDiagramObjRef&&this._touchEventContentDiagramObjRef.handleTouchEnd&&(this._touchEventContentDiagramObjRef.handleTouchEnd(),this._touchEventContentDiagramObjRef=null)},A.prototype.storeTouchEventContent=function(t,n){this.getTouchEventPane()&&t&&(this._touchEventContentDiagramObjRef=n,t.namespaceURI===e.ToolkitUtils.SVG_NS?e.ToolkitUtils.appendChildElem(this.getTouchEventPane().getElem(),t):Array.isArray(t)&&t.forEach(function(t){e.ToolkitUtils.appendChildElem(this.getTouchEventPane().getElem(),t)}.bind(this)))},A.prototype._clearTouchEventContent=function(){if(this.getTouchEventPane())for(var t=this.getTouchEventPane().getElem();t.firstChild;)t.removeChild(t.firstChild)},t.Diagram=A,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=ojdiagram-toolkit.js.map