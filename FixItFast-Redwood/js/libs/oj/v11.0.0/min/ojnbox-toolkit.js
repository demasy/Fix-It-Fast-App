/**
 * @license
 * Copyright (c) 2014, 2021, Oracle and/or its affiliates.
 * Licensed under The Universal Permissive License (UPL), Version 1.0
 * as shown at https://oss.oracle.com/licenses/upl/
 * @ignore
 */
define(["exports","ojs/ojdvt-toolkit","ojs/ojtranslation"],function(e,t,n){"use strict";const o={};t.Obj.createSubclass(o,t.Obj),o.COLUMN="column",o.COLUMNS="columns",o.COLUMNS_TITLE="columnsTitle",o.COLUMNS_TITLE_STYLE="columnsTitleStyle",o.COLUMN_LABEL_STYLE="columnLabelStyle",o.MAXIMIZED_COLUMN="maximizedColumn",o.ROW="row",o.ROWS="rows",o.ROWS_TITLE="rowsTitle",o.ROWS_TITLE_STYLE="rowsTitleStyle",o.ROW_LABEL_STYLE="rowLabelStyle",o.MAXIMIZED_ROW="maximizedRow",o.CELL="cell",o.CELLS="cells",o.CELL_DEFAULTS="cellDefaults",o.NODES="nodes",o.NODE_DEFAULTS="nodeDefaults",o.CATEGORIES="categories",o.ICON="icon",o.ICON_DEFAULTS="iconDefaults",o.INITIALS="initials",o.BACKGROUND="background",o.INDICATOR="indicator",o.INDICATOR_ICON="indicatorIcon",o.INDICATOR_ICON_DEFAULTS="indicatorIconDefaults",o.INDICATOR_COLOR="indicatorColor",o.X_PERCENTAGE="xPercentage",o.Y_PERCENTAGE="yPercentage",o.SELECTION="selection",o.SELECTION_MODE="selectionMode",o.SELECTION_INFO="selectionInfo",o.HAS_SELECTION_LISTENER="hasSelectionListener",o.HIGHLIGHTED_CATEGORIES="highlightedCategories",o.HIGHLIGHT_MATCH="highlightMatch",o.HIDDEN_CATEGORIES="hiddenCategories",o.HOVER_BEHAVIOR="hoverBehavior",o.GROUP_CATEGORY="groupCategory",o.GROUP_ATTRIBUTES="groupAttributes",o.GROUP_BEHAVIOR="groupBehavior",o.GROUP_BEHAVIOR_WITHIN_CELL="withinCell",o.GROUP_BEHAVIOR_ACROSS_CELLS="acrossCells",o.OTHER_COLOR="otherColor",o.OTHER_THRESHOLD="otherThreshold",o.ANIMATION_ON_DATA_CHANGE="animationOnDataChange",o.ANIMATION_ON_DISPLAY="animationOnDisplay",o.ANIMATION_DURATION="animationDuration",o.DRAWER="_drawer",o.ID="id",o.LABEL="label",o.LABEL_STYLE="labelStyle",o.LABEL_HALIGN="labelHalign",o.SECONDARY_LABEL="secondaryLabel",o.SECONDARY_LABEL_STYLE="secondaryLabelStyle",o.SHORT_DESC="shortDesc",o.SHOW_COUNT="showCount",o.STYLE="style",o.STYLE_DEFAULTS="styleDefaults",o.BORDER_COLOR="borderColor",o.BORDER_RADIUS="borderRadius",o.BORDER_WIDTH="borderWidth",o.COLOR="color",o.PATTERN="pattern",o.OPACITY="opacity",o.SHAPE="shape",o.SOURCE="source",o.HEIGHT="height",o.WIDTH="width";var i=function(e,n){var o=e.getDimensions(),i=e.localToStage(new t.Point(o.x,o.y)),a=e.localToStage(new t.Point(o.x+o.w,o.y+o.h));return new t.Rectangle(i.x,i.y,a.x-i.x,a.y-i.y)},a=function(e,n,o,i,a){var r=new t.OutputText(e,n,0,0);return r.setCSSStyle(o),r.setHorizAlignment(i),r.setVertAlignment(a),r},r=function(e){for(var t=e.getMatrix(),n=e.getParent();n;){var o=n.getMatrix();t=t.translate(o.getTx(),o.getTy()),n=n.getParent()}return t},l=function(e,t,n,o){if(e.setX(t),e.setY(n),o){var i=e.getMatrix();i=(i=i.translate(-t,-n)).rotate(o),e.setMatrix(i.translate(t,n))}},s=function(e,n){if(0==n.indexOf("linear-gradient")){var o=t.GradientParser.parseCSSGradient(n);o&&e.setFill(new t.LinearGradientFill(o.getAngle(),o.getColors(),o.getAlphas(),o.getRatios()))}else e.setSolidFill(n)},g=function(e,t,n,o){var i=e.getDisplayables(),a=o?"__displayable:"+o:"__displayable",r=null==t.__cacheId?t.id:t.__cacheId,l=e.getOptions().__displayableCache,s=null==r?t[a]:l.getFromCachedMap(r,a);null!=s?i[s]=n:(null==r?t[a]=i.length:l.putToCachedMap(r,a,i.length),i.push(n))},d=function(e,t,n){if(!t)return null;var o=n?"__displayable:"+n:"__displayable",i=null==t.__cacheId?t.id:t.__cacheId,a=e.getOptions().__displayableCache,r=null==i?t[o]:a.getFromCachedMap(i,o),l=e.getDisplayables();return null==r?null:l[r]},u=new Object;t.Obj.createSubclass(u,t.Obj),u.processDataObject=function(e){if(u.hasValidData(e)){var t=e.getOptions(),n=t[o.CELLS],i={};if(n)for(var a=0;a<n.length;a++){var r=n[a];i[p=r[o.ROW]]||(i[p]={});var l=r[o.COLUMN];i[p][l]=r}for(var s=[],g={},d={},h=0;h<u.getRowCount(e);h++){(C=u.getRow(e,h)).__cacheId="row:"+C.id,g[C[o.ID]]=h}t.__rowMap=g;for(var c=0;c<u.getColumnCount(e);c++){(_=u.getColumn(e,c)).__cacheId="column:"+_.id,d[_[o.ID]]=c}t.__columnMap=d;for(h=0;h<u.getRowCount(e);h++){var C,p=(C=u.getRow(e,h))[o.ID];for(c=0;c<u.getColumnCount(e);c++){var _;l=(_=u.getColumn(e,c))[o.ID];if(i[p]&&i[p][l]){var f=i[p][l];s.push(f)}else s.push({row:p,column:l})}}t[o.CELLS]=s;for(var S=new(e.getCtx().ojMap),y=!1,b=0;b<u.getNodeCount(e);b++){var E=u.getNode(e,b);S.set(E[o.ID],b),!y&&(E[o.GROUP_CATEGORY]||E._groupCategories||E._groupLabels)&&(y=!0)}t.__nodeMap=S,t.__grouping="none"!=t[o.GROUP_BEHAVIOR]&&y,u.getGrouping(e)&&u.getGroupBehavior(e)==o.GROUP_BEHAVIOR_ACROSS_CELLS&&(t[o.MAXIMIZED_ROW]=null,u.fireOptionChangeEvent(e,o.MAXIMIZED_ROW,null),t[o.MAXIMIZED_COLUMN]=null,u.fireOptionChangeEvent(e,o.MAXIMIZED_COLUMN,null)),(t[o.MAXIMIZED_ROW]&&isNaN(g[t[o.MAXIMIZED_ROW]])||t[o.MAXIMIZED_COLUMN]&&isNaN(d[t[o.MAXIMIZED_COLUMN]]))&&(t[o.MAXIMIZED_ROW]=null,u.fireOptionChangeEvent(e,o.MAXIMIZED_ROW,null),t[o.MAXIMIZED_COLUMN]=null,u.fireOptionChangeEvent(e,o.MAXIMIZED_COLUMN,null))}},u.hasValidData=function(e){var t=e.getOptions();return!(!t||!t[o.ROWS]||t[o.ROWS].length<1||!t[o.COLUMNS]||t[o.COLUMNS].length<1)},u.getColumnCount=function(e){return e.getOptions()[o.COLUMNS].length},u.getRowCount=function(e){return e.getOptions()[o.ROWS].length},u.getColumnLabel=function(e,t){var n=u.getColumn(e,u.getColumnIndex(e,t));return n&&n[o.LABEL]?n[o.LABEL]:null},u.getRowLabel=function(e,t){var n=u.getRow(e,u.getRowIndex(e,t));return n&&n[o.LABEL]?n[o.LABEL]:null},u.getCellByRowColumn=function(e,t,n){var o=u.getCell(e,u.getCellIndexByRowColumn(e,t,n));return o?d(e,o):null},u.getCellIndexByRowColumn=function(e,t,n){return u.getColumnIndex(e,n)+u.getRowIndex(e,t)*u.getColumnCount(e)},u.getColumn=function(e,t){return e.getOptions()[o.COLUMNS][t]},u.getRow=function(e,t){return e.getOptions()[o.ROWS][t]},u.getMaximizedRow=function(e){return e.getOptions()[o.MAXIMIZED_ROW]},u.getMaximizedColumn=function(e){return e.getOptions()[o.MAXIMIZED_COLUMN]},u.getRowIndex=function(e,t){return e.getOptions().__rowMap[t]},u.getColumnIndex=function(e,t){return e.getOptions().__columnMap[t]},u.getCell=function(e,t){return e.getOptions()[o.CELLS][t]},u.getNodeCount=function(e){return e.getOptions()[o.NODES]?e.getOptions()[o.NODES].length:0},u.getNode=function(e,t){return e.getOptions()[o.NODES][t]},u.getNodeIndex=function(e,t){var n=e.getOptions().__nodeMap;return n?n.get(t):-1},u.getCellIndex=function(e,t){var n=u.getRowIndex(e,t[o.ROW]);return u.getColumnIndex(e,t[o.COLUMN])+n*u.getColumnCount(e)},u.getSelectedItems=function(e){return e.getOptions()[o.SELECTION]},u.setSelectedItems=function(e,t){e.getOptions()[o.SELECTION]=t},u.getHighlightedItems=function(e){var t,n=e.getOptions()[o.HIGHLIGHTED_CATEGORIES];if(n&&n.length>0){t=[];for(var i=0;i<u.getNodeCount(e);i++){var a=u.getNode(e,i);u.isNodeHighlighted(e,a)&&t.push(a)}}return t},u.getGrouping=function(e){return e.getOptions().__grouping},u.getGroupAttributes=function(e){return e.getOptions()[o.GROUP_ATTRIBUTES]},u.getGroupBehavior=function(e){return e.getOptions()[o.GROUP_BEHAVIOR]},u.getNodeGroupId=function(e){if(e[o.GROUP_CATEGORY])return e[o.GROUP_CATEGORY];var t=e._groupCategories;return t&&t.length>0?t.join(";"):null},u.getXPercentage=function(e,t){if(!isNaN(t[o.X_PERCENTAGE]))return t[o.X_PERCENTAGE];var n=u.getColumnCount(e);return(u.getColumnIndex(e,t[o.COLUMN])+.5)/n},u.getYPercentage=function(e,t){if(!isNaN(t[o.Y_PERCENTAGE]))return t[o.Y_PERCENTAGE];var n=u.getRowCount(e);return(u.getRowIndex(e,t[o.ROW])+.5)/n},u.getOtherThreshold=function(e){return e.getOptions()[o.OTHER_THRESHOLD]},u.getOtherColor=function(e){return e.getOptions()[o.OTHER_COLOR]},u.getDrawer=function(e){return e.getOptions()[o.DRAWER]},u.getCategoryNode=function(e,t){var n=u.getGroupBehavior(e),i=e.getOptions().__groups,a=t;if(n==o.GROUP_BEHAVIOR_WITHIN_CELL){var r=t.substring(0,t.indexOf(":"));a=t.substring(t.indexOf(":")+1),i=i[r]}return i?i[a]:null},u.getCategoryNodeLabels=function(e,t){if(t.__labels)return t.__labels;var n=u.getNode(e,t.nodeIndices[0]);if(n[o.GROUP_CATEGORY])return t.__labels=[n[o.GROUP_CATEGORY]];if(t.__labels=[],n._groupCategories)for(var i=e.getOptions()._groupLabels,a=0;a<n._groupCategories.length;a++)i&&i[n._groupCategories[a]]?t.__labels[a]=i[n._groupCategories[a]]:t.__labels[a]=n._groupCategories[a];return t.__labels},u.isMaximizeEnabled=function(e){return"off"!=e.getOptions().cellMaximize},u.getCellContent=function(e){return"counts"==e.getOptions().cellContent?"counts":"auto"},u.isCellMinimized=function(e,t){var n=u.getMaximizedRow(e),i=u.getMaximizedColumn(e);if(!n&&!i)return!1;var a=u.getCell(e,t),r=a[o.ROW],l=a[o.COLUMN];return n&&i?n!=r||i!=l:n!=r&&i!=l},u.isCellMaximized=function(e,t){var n=u.getMaximizedRow(e),i=u.getMaximizedColumn(e),a=u.getCell(e,t),r=a[o.ROW],l=a[o.COLUMN];return n==r&&i==l},u.isNodeHidden=function(e,n){var i=e.getOptions();return i[o.HIDDEN_CATEGORIES]&&!i.__hiddenMap&&(i.__hiddenMap=t.ArrayUtils.createBooleanMap(i[o.HIDDEN_CATEGORIES])),t.ArrayUtils.hasAnyMapItem(i.__hiddenMap,n[o.CATEGORIES])},u.isNodeHighlighted=function(e,n){var i=e.getOptions();return i[o.HIGHLIGHTED_CATEGORIES]&&!i.__highlightedMap&&(i.__highlightedMap=t.ArrayUtils.createBooleanMap(i[o.HIGHLIGHTED_CATEGORIES])),"all"==i[o.HIGHLIGHT_MATCH]?t.ArrayUtils.hasAllMapItems(i.__highlightedMap,n[o.CATEGORIES]):t.ArrayUtils.hasAnyMapItem(i.__highlightedMap,n[o.CATEGORIES])},u.getNodeScrollableContainer=function(e,t){if(!t)return null;var n=u.getDrawer(e);if(n){var o=d(e,n);if(o)return o.getChildContainer()}var i=u.getCellIndex(e,t.getData());if(u.isCellMaximized(e,i)){var a=u.getCell(e,i);return d(e,a).getChildContainer()}return null},u.fireOptionChangeEvent=function(e,n,o){var i=t.EventFactory.newOptionChangeEvent(n,o);e.processEvent(i)},u.getMaximizedCellIndex=function(e){var t=null,n=u.getMaximizedRow(e),o=u.getMaximizedColumn(e);if(n&&o){var i=u.getColumnCount(e);t=u.getColumnIndex(e,o)+i*u.getRowIndex(e,n)}return t},u.isDrawerSelected=function(e,t){var n=!1,i=u.getSelectedItems(e);if(i){for(var a={},r=0;r<i.length;r++)a[i[r]]=!0;var l=t.getData().nodeIndices;n=!0;for(var s=0;s<l.length;s++){if(!a[u.getNode(e,l[s])[o.ID]]){n=!1;break}}}return n},u.buildAriaDesc=function(e,n,i,a,r){var l=e.getOptions().translations,s="categoryNode"===n.nboxType||"drawer"===n.nboxType?t.ResourceUtils.format(l.labelAndValue,[l.labelGroup,i]):i,g=[];if(a?g.push(l.stateSelected):g.push(l.stateUnselected),"categoryNode"===n.nboxType){var d=n.getData().nodeIndices.length;g.push(l.stateCollapsed),g.push(t.ResourceUtils.format(l.labelAndValue,[l.labelSize,d]))}else if("drawer"===n.nboxType){d=u.getCategoryNode(e,n.getData()[o.ID]).nodeIndices.length;g.push(l.stateExpanded),g.push(t.ResourceUtils.format(l.labelAndValue,[l.labelSize,d]))}return t.Displayable.generateAriaLabel(s,g,r)},u.getFirstNavigableNode=function(e,t){var n=null;if(t.getNumChildren()>0){var o;n=t.getChildAt(0);do{"node"!==n.nboxType&&"overflow"!==n.nboxType||(o=n.previousNavigable),n=o||n}while(o)}return n},u.getLastNavigableNode=function(e,t){var n=null,o=t.getNumChildren();if(o>0){var i;n=t.getChildAt(o-1);do{n=(i="node"===n.nboxType?n.nextNavigable:null)||n}while(i)}return n},u.getNextNavigableNode=function(e,n,o){var i,a=o.keyCode==t.KeyboardEvent.RIGHT_ARROW||o.keyCode==t.KeyboardEvent.DOWN_ARROW;return"node"===n.nboxType?i=a?n.nextNavigable:n.previousNavigable:"overflow"===n.nboxType&&(i=a?null:n.previousNavigable),i||n},u.getCellCounts=function(e){return e.getOptions().__cellCounts||u._calculateCellCounts(e)},u._calculateCellCounts=function(e){var t=u.getRowCount(e)*u.getColumnCount(e),n=[],i=null,a=u.getHighlightedItems(e),r={};if(a){i=[];for(var l=0;l<a.length;l++)r[a[l][o.ID]]=!0}for(l=0;l<t;l++)n[l]=0,i&&(i[l]=0);var s=u.getNodeCount(e);for(l=0;l<s;l++){var g=u.getNode(e,l);if(!u.isNodeHidden(e,g)){var d=u.getCellIndex(e,g);n[d]++,i&&r[g[o.ID]]&&i[d]++}}var h={};return h.total=n,i&&(h.highlighted=i),e.getOptions().__cellCounts=h,h},u.getRowDimensions=function(e,n,o){var i=u.getRowCount(e),a=o.h/i,r=o.y+(i-n-1)*a,l=a;return new t.Rectangle(o.x,r,o.w,l)},u.getColumnDimensions=function(e,n,o){var i=u.getColumnCount(e),a=o.w/i,r=t.Agent.isRightToLeft(e.getCtx()),l=o.x+(r?o.w-a:0)+(r?-1:1)*n*a,s=a;return new t.Rectangle(l,o.y,s,o.h)},u.compareCategoryNodeSize=function(e,t){var n=e.nodeIndices.length,o=t.nodeIndices.length;return n==o?0:n<o?1:-1};var h=function(e,t){this.Init(e,t)};t.Obj.createSubclass(h,t.KeyboardHandler),h.prototype.Init=function(e,t){h.superclass.Init.call(this,e),this._nbox=t},h.prototype.processKeyDown=function(e){if(e.keyCode==t.KeyboardEvent.TAB){var n=this._eventManager.getFocus(),i=null;if(t.EventManager.consumeEvent(e),n)i=n;else{var a=u.getDrawer(this._nbox);if(a)i=d(this._nbox,a);else if(u.getGroupBehavior(this._nbox)==o.GROUP_BEHAVIOR_ACROSS_CELLS){var r=this._nbox.getOptions().__groups;if(r){var l=[];for(var s in r){var g=d(this._nbox,r[s]);g&&l.push(g)}i=h.getNextNavigableCategoryNode(null,e,l)}}if(!i){var c=u.getColumnCount(this._nbox)*(u.getRowCount(this._nbox)-1);i=d(this._nbox,u.getCell(this._nbox,c))}}return i}return h.superclass.processKeyDown.call(this,e)},h.prototype.isSelectionEvent=function(e){return e.keyCode!=t.KeyboardEvent.TAB&&(this.isNavigationEvent(e)&&!e.ctrlKey)},h.prototype.isMultiSelectEvent=function(e){return e.keyCode==t.KeyboardEvent.SPACE&&e.ctrlKey},h.prototype.isNavigationEvent=function(e){var n=!1;switch(e.keyCode){case t.KeyboardEvent.OPEN_BRACKET:case t.KeyboardEvent.CLOSE_BRACKET:n=!0;break;default:n=h.superclass.isNavigationEvent.call(this,e)}return n},h.getNextNavigableCategoryNode=function(e,n,o){if(!o||o.length<=0)return null;if("categoryNode"===o[0].nboxType&&o.sort(function(e,t){return u.compareCategoryNodeSize(e.getData(),t.getData())}),null==e)return o[0];for(var i=e,a=n.keyCode==t.KeyboardEvent.RIGHT_ARROW||n.keyCode==t.KeyboardEvent.DOWN_ARROW,r=o.length,l=0;l<r;l++){if(o[l]===e){i=o[a?l+1<r?l+1:l:l-1>=0?l-1:l];break}}return i};var c=new Object;t.Obj.createSubclass(c,t.Obj),c.getAnimationOnDisplay=function(e){if(!e.isAnimationAllowed())return"none";var n=e.getOptions()[o.ANIMATION_ON_DISPLAY];return"auto"==n&&(n=t.BlackBoxAnimationHandler.ALPHA_FADE),n},c.getAnimationOnDataChange=function(e){return e.isAnimationAllowed()?e.getOptions()[o.ANIMATION_ON_DATA_CHANGE]:"none"},c.getAnimationDuration=function(e){return t.CSSStyle.getTimeMilliseconds(e.getOptions()[o.STYLE_DEFAULTS][o.ANIMATION_DURATION])/1e3},c.getColumnLabelStyle=function(e,n){var i=e.getOptions()[o.STYLE_DEFAULTS][o.COLUMN_LABEL_STYLE],a=u.getColumn(e,n);return a[o.LABEL_STYLE]?t.JsonUtils.merge(new t.CSSStyle(a[o.LABEL_STYLE]),i):i},c.getRowLabelStyle=function(e,n){var i=e.getOptions()[o.STYLE_DEFAULTS][o.ROW_LABEL_STYLE],a=u.getRow(e,n);return a[o.LABEL_STYLE]?t.JsonUtils.merge(new t.CSSStyle(a[o.LABEL_STYLE]),i):i},c.getCellStyle=function(e,n){var i=e.getOptions(),a=c._getCellStyleKeys(e,n),r=c._getCellStyleOption(e,n,a[0],a[1]),l=i[o.STYLE_DEFAULTS][o.CELL_DEFAULTS]["_"+a[0]],s=new t.CSSStyle;return c._getCellStyleProperties().forEach(function(e){var n=t.CSSStyle.cssStringToObjectProperty(e),o=r&&null!=r[n]?r[n]:l.getStyle(e);s.setStyle(e,o)}),s},c.getCellStyleObject=function(e,n){var o=c._getCellStyleKeys(e,n),i=c._getCellStyleOption(e,n,o[0],o[1]);return i&&c._getCellStyleProperties().forEach(function(e){delete i[t.CSSStyle.cssStringToObjectProperty(e)]}),i},c._getCellStyleKeys=function(e,t){var n=o.STYLE,i="svgStyle",a=u.getMaximizedRow(e),r=u.getMaximizedColumn(e);return u.isCellMinimized(e,t)?(n="minimizedStyle",i="minimizedSvgStyle"):!a&&!r||u.isCellMinimized(e,t)||(n="maximizedStyle",i="maximizedSvgStyle"),[n,i]},c._getCellStyleOption=function(e,n,i,a){var r=e.getOptions(),l=u.getCell(e,n),s=r[o.STYLE_DEFAULTS][o.CELL_DEFAULTS],g=s[a]||s[i];!g||g instanceof Object||(g=t.CSSStyle.cssStringToObject(g));var d=l[a]||l[i];return d?(d instanceof Object||(d=t.CSSStyle.cssStringToObject(d)),d=t.JsonUtils.merge(d,g)):g&&(d=t.JsonUtils.clone(g)),d},c._getCellStyleProperties=function(){return[t.CSSStyle.BACKGROUND,t.CSSStyle.BACKGROUND_COLOR,t.CSSStyle.BORDER_STYLE,t.CSSStyle.BORDER_COLOR,t.CSSStyle.BORDER_WIDTH]},c.getCellClassName=function(e,t){var n="className",o="svgClassName",i=u.getMaximizedRow(e),a=u.getMaximizedColumn(e);u.isCellMinimized(e,t)?(n="minimizedClassName",o="minimizedSvgClassName"):!i&&!a||u.isCellMinimized(e,t)||(n="maximizedClassName",o="maximizedSvgClassName");var r=u.getCell(e,t);return r[o]||r[n]},c.getCellLabelStyle=function(e,n){var i=e.getOptions(),a=u.isCellMinimized(e,n)?"_labelMinimizedStyle":o.LABEL_STYLE,r=i[o.STYLE_DEFAULTS][o.CELL_DEFAULTS][a],l=u.getCell(e,n);return l[o.LABEL_STYLE]?t.JsonUtils.merge(new t.CSSStyle(l[o.LABEL_STYLE]),r):r},c.getCellShowCount=function(e,t){return t[o.SHOW_COUNT]?t[o.SHOW_COUNT]:e.getOptions()[o.STYLE_DEFAULTS][o.CELL_DEFAULTS][o.SHOW_COUNT]},c.getCellCountLabelStyle=function(e,t){var n=u.isCellMinimized(e,t)?"_labelMinimizedStyle":"countLabelStyle";return e.getOptions()[o.STYLE_DEFAULTS][o.CELL_DEFAULTS][n]},c.getCellBorderRadius=function(e){return e.getOptions()[o.STYLE_DEFAULTS][o.CELL_DEFAULTS]["_"+o.BORDER_RADIUS]},c.getCellBodyCountLabelStyle=function(e){return e.getOptions()[o.STYLE_DEFAULTS][o.CELL_DEFAULTS].bodyCountLabelStyle},c.getCellDropTargetStyle=function(e){return e.getOptions()[o.STYLE_DEFAULTS][o.CELL_DEFAULTS].dropTargetStyle},c.getNodeLabel=function(e,n){if(!n[o.LABEL])return null;var i=d(e,n,o.LABEL);if(i)return i;var r=t.Agent.isRightToLeft(e.getCtx())?t.OutputText.H_ALIGN_RIGHT:t.OutputText.H_ALIGN_LEFT;return i=a(e.getCtx(),n[o.LABEL],c.getNodeLabelStyle(e,n),r,t.OutputText.V_ALIGN_CENTRAL),n[o.SECONDARY_LABEL]&&i.setClassName("oj-typography-semi-bold"),g(e,n,i,o.LABEL),i},c.getNodeSecondaryLabel=function(e,n){if(!n[o.SECONDARY_LABEL])return null;var i=d(e,n,o.SECONDARY_LABEL);if(i)return i;var r=t.Agent.isRightToLeft(e.getCtx())?t.OutputText.H_ALIGN_RIGHT:t.OutputText.H_ALIGN_LEFT;return i=a(e.getCtx(),n[o.SECONDARY_LABEL],c.getNodeSecondaryLabelStyle(e,n),r,t.OutputText.V_ALIGN_CENTRAL),g(e,n,i,o.SECONDARY_LABEL),i},c.getNodeLabelStyle=function(e,t){return e.getOptions()[o.STYLE_DEFAULTS][o.NODE_DEFAULTS][o.LABEL_STYLE]},c.getNodeSecondaryLabelStyle=function(e,t){return e.getOptions()[o.STYLE_DEFAULTS][o.NODE_DEFAULTS][o.SECONDARY_LABEL_STYLE]},c.getNodeColor=function(e,t){return t[o.COLOR]?t[o.COLOR]:e.getOptions()[o.STYLE_DEFAULTS][o.NODE_DEFAULTS][o.COLOR]},c.getNodeBorderColor=function(e,t){var n=t[o.BORDER_COLOR]?t[o.BORDER_COLOR]:e.getOptions()[o.STYLE_DEFAULTS][o.NODE_DEFAULTS][o.BORDER_COLOR];return n||null},c.getNodeBorderWidth=function(e,t){var n=t[o.BORDER_WIDTH]?t[o.BORDER_WIDTH]:e.getOptions()[o.STYLE_DEFAULTS][o.NODE_DEFAULTS][o.BORDER_WIDTH];return n||null},c.getNodeIndicatorColor=function(e,t){return t[o.INDICATOR_COLOR]?t[o.INDICATOR_COLOR]:e.getOptions()[o.STYLE_DEFAULTS][o.NODE_DEFAULTS][o.INDICATOR_COLOR]},c.getIcon=function(e,t){return t[o.ICON]?c.getStyledIcon(e,t[o.ICON]):null},c.getIndicatorIcon=function(e,t){return t[o.INDICATOR_ICON]?c.getStyledIndicatorIcon(e,t[o.INDICATOR_ICON]):null},c.getStyledIcon=function(e,n){return t.JsonUtils.merge(n,e.getOptions()[o.STYLE_DEFAULTS][o.NODE_DEFAULTS][o.ICON_DEFAULTS])},c.getStyledIndicatorIcon=function(e,n){return t.JsonUtils.merge(n,e.getOptions()[o.STYLE_DEFAULTS][o.NODE_DEFAULTS][o.INDICATOR_ICON_DEFAULTS])},c.getFadedNodeAlpha=function(e){return e.getOptions()[o.STYLE_DEFAULTS][o.NODE_DEFAULTS].alphaFade},c.getScrollbarStyleMap=function(e){return e.getOptions()[o.STYLE_DEFAULTS].__scrollbar},c.getCategoryNodeColor=function(e,t){if("none"==u.getGroupBehavior(e)||u.getGroupAttributes(e)&&-1==u.getGroupAttributes(e).indexOf("color"))return e.getOptions()[o.STYLE_DEFAULTS][o.NODE_DEFAULTS][o.COLOR];if(t.otherNode)return u.getOtherColor(e);var n=t.nodeIndices,i=u.getNode(e,n[0])[o.COLOR];if(!i)return e.getOptions()[o.STYLE_DEFAULTS][o.NODE_DEFAULTS][o.COLOR];for(var a=1;a<n.length;a++){if(i!=u.getNode(e,n[a])[o.COLOR])return e.getOptions()[o.STYLE_DEFAULTS][o.NODE_DEFAULTS][o.COLOR]}return i},c.getCategoryNodeIndicatorColor=function(e,t){if("none"==u.getGroupBehavior(e)||u.getGroupAttributes(e)&&-1==u.getGroupAttributes(e).indexOf("indicatorColor"))return null;var n=t.nodeIndices,i=u.getNode(e,n[0])[o.INDICATOR_COLOR];if(!i)return e.getOptions()[o.STYLE_DEFAULTS][o.NODE_DEFAULTS][o.INDICATOR_COLOR];for(var a=1;a<n.length;a++){if(i!=u.getNode(e,n[a])[o.INDICATOR_COLOR])return e.getOptions()[o.STYLE_DEFAULTS][o.NODE_DEFAULTS][o.INDICATOR_COLOR]}return i},c.getStyledCategoryIndicatorIcon=function(e,n){if("none"==u.getGroupBehavior(e))return null;if(u.getGroupAttributes(e)&&-1==u.getGroupAttributes(e).indexOf("indicatorIconShape")&&-1==u.getGroupAttributes(e).indexOf("indicatorIconColor")&&-1==u.getGroupAttributes(e).indexOf("indicatorIconPattern"))return null;var i={},a=n.nodeIndices,r=u.getNode(e,a[0])[o.INDICATOR_ICON];if(!r)return null;r.width&&(i.width=r.width),r.height&&(i.height=r.height),r.borderWidth&&(i.borderWidth=r.borderWidth),r.borderStyle&&(i.borderStyle=r.borderStyle),r.borderColor&&(i.borderColor=r.borderColor),r.borderRadius&&(i.borderRadius=r.borderRadius),r.style&&(i.style=r.style),r.className&&(i.className=r.className);var l=!0;if(!u.getGroupAttributes(e)||-1!=u.getGroupAttributes(e).indexOf("indicatorIconShape")){for(var s=r[o.SHAPE],g=1;g<a.length;g++){(p=u.getNode(e,a[g])[o.INDICATOR_ICON])&&s!=p[o.SHAPE]&&(l=!1)}i[o.SHAPE]=l?s:e.getOptions()[o.STYLE_DEFAULTS][o.NODE_DEFAULTS][o.INDICATOR_ICON_DEFAULTS][o.SHAPE]}if(l=!0,!u.getGroupAttributes(e)||-1!=u.getGroupAttributes(e).indexOf("indicatorIconColor")){for(var d=r[o.COLOR],h=1;h<a.length;h++){(p=u.getNode(e,a[h])[o.INDICATOR_ICON])&&d!=p[o.COLOR]&&(l=!1)}i[o.COLOR]=l?d:e.getOptions()[o.STYLE_DEFAULTS][o.NODE_DEFAULTS][o.INDICATOR_ICON_DEFAULTS][o.COLOR]}if(l=!0,!u.getGroupAttributes(e)||-1!=u.getGroupAttributes(e).indexOf("indicatorIconPattern")){for(var c=r[o.PATTERN],C=1;C<a.length;C++){var p;(p=u.getNode(e,a[C])[o.INDICATOR_ICON])&&c!=p[o.PATTERN]&&(l=!1)}i[o.PATTERN]=l?c:e.getOptions()[o.STYLE_DEFAULTS][o.NODE_DEFAULTS][o.INDICATOR_ICON_DEFAULTS][o.PATTERN]}return t.JsonUtils.merge(i,e.getOptions()[o.STYLE_DEFAULTS][o.NODE_DEFAULTS][o.INDICATOR_ICON_DEFAULTS])},c.getDrawerBackground=function(e){return e.getOptions()[o.STYLE_DEFAULTS]._drawerDefaults.background},c.getDrawerHeaderBackground=function(e){return e.getOptions()[o.STYLE_DEFAULTS]._drawerDefaults.headerBackground},c.getDrawerBorderColor=function(e){return e.getOptions()[o.STYLE_DEFAULTS]._drawerDefaults[o.BORDER_COLOR]},c.getDrawerBorderRadius=function(e){return e.getOptions()[o.STYLE_DEFAULTS]._drawerDefaults[o.BORDER_RADIUS]},c.getDrawerLabelStyle=function(e){return e.getOptions()[o.STYLE_DEFAULTS]._drawerDefaults[o.LABEL_STYLE]},c.getDrawerCountLabelStyle=function(e){return e.getOptions()[o.STYLE_DEFAULTS]._drawerDefaults.countLabelStyle},c.getDrawerCountBorderRadius=function(e){return e.getOptions()[o.STYLE_DEFAULTS]._drawerDefaults.countBorderRadius},c.getCategoryNodeLabelStyle=function(e){return e.getOptions()[o.STYLE_DEFAULTS]._categoryNodeDefaults.labelStyle},c.getNodeBorderRadius=function(e){return e.getOptions()[o.STYLE_DEFAULTS][o.NODE_DEFAULTS]["_"+o.BORDER_RADIUS]},c.getNodeHoverColor=function(e){return e.getOptions()[o.STYLE_DEFAULTS][o.NODE_DEFAULTS].hoverColor},c.getNodeSelectionColor=function(e){return e.getOptions()[o.STYLE_DEFAULTS][o.NODE_DEFAULTS].selectionColor},c.getLabelHalign=function(e,n){var i=n[o.LABEL_HALIGN];i||(i=e.getOptions()[o.STYLE_DEFAULTS][o.CELL_DEFAULTS][o.LABEL_HALIGN]);var a=t.Agent.isRightToLeft(e.getCtx());return"end"==i?a?t.OutputText.H_ALIGN_LEFT:t.OutputText.H_ALIGN_RIGHT:"center"==i?t.OutputText.H_ALIGN_CENTER:a?t.OutputText.H_ALIGN_RIGHT:t.OutputText.H_ALIGN_LEFT};var C=function(e,t,n,o){this.Init(e,t,n,o)};t.Obj.createSubclass(C,t.DataAnimationHandler),C.DELETE=0,C.UPDATE=1,C.INSERT=2,C.prototype.Init=function(e,t,n,o){C.superclass.Init.call(this,e,t),this._oldNBox=n,this._newNBox=o},C.prototype.getOldNBox=function(){return this._oldNBox},C.prototype.getNewNBox=function(){return this._newNBox},C.prototype.getAnimationDuration=function(){return c.getAnimationDuration(this._oldNBox)};var p=new Object;t.Obj.createSubclass(p,t.Obj),p._MIN_CORNER_RADIUS=2.5,p._ASPECT_RATIO_SCALING="xMidYMid slice",p.render=function(e,t,n,o){p._renderNodeBackground(e,t,n,o),p._renderNodeIndicator(e,t,n,o),p._renderNodeIcon(e,t,n,o),p._renderNodeLabels(e,t,n,o),p._addAccessibilityAttributes(e,n);var i=n.getChildContainer();i&&p._clipIfNecessary(e,i,o)},p.calculateNodeLayout=function(e,n){for(var i=e.getOptions(),a=parseInt(i.__layout.gridGap),r=i.__layout.nodeStartLabelGap,l=i.__layout.nodeLabelOnlyStartLabelGap,s=i.__layout.nodeEndLabelGap,g=i.__layout.nodeSwatchSize,d=parseInt(i.__layout.maximumLabelWidth),h=p._calculateSimpleNodeLayout(e),C=h.nodeHeight,_=h.indicatorSectionWidth,f=h.iconSectionWidth,S=_||f?r:l,y=u.getNode(e,0),b=c.getIndicatorIcon(e,y),E=c.getIcon(e,y),x=0,v=[],A=0,I=0,O=u.getMaximizedRow(e),L=u.getMaximizedColumn(e),N=u.getRowCount(e),m=u.getColumnCount(e),T=0;T<N;T++)for(var D=0;D<m;D++)v.push({cellRows:0,cellColumns:0,overflow:!1});for(var R=[],w=u.getNodeCount(e),M=0;M<w;M++){var B=u.getNode(e,M);if(!u.isNodeHidden(e,B)){var H=u.getCellIndex(e,B);isNaN(R[H])&&(R[H]=0),R[H]++}}if(O&&L){var U=u.getColumnIndex(e,L)+m*u.getRowIndex(e,O),P=u.getCell(e,U).__childArea;if(null==(x=h.labelSectionWidth)){if("ifRequired"!=i.labelTruncation)x=d+S+s;else{var G=n[U];x=Math.max(d,p._getMaxLabelWidth(e,G))+S+s}x=Math.min(x,P.w-_-f)}if(I=Math.floor((P.w+a)/(_+f+x+a)),y[o.LABEL]){var F=new t.Container,W=!1,k=c.getNodeLabel(e,y),z=k.getDimensions().h;if(t.TextUtils.fitText(k,x-S-s,z,F)&&(W=!0),y[o.SECONDARY_LABEL]){var K=c.getNodeSecondaryLabel(e,y),Y=K.getDimensions().h;t.TextUtils.fitText(K,x-S-s,Y,F)&&(W=!0)}W||(x=0,y[o.COLOR]&&(b&&!c.getNodeIndicatorColor(e,y)||E&&!E[o.SOURCE]||(x=Math.max(0,Math.min(g,P.w-_-f)))))}if(P.w-_-f<0){var j=f;f=Math.max(0,P.w-_)}P.w-_<0&&(_=P.w),v[U]={cellRows:-1,cellColumns:I,overflow:!1}}else{var V=[];if(O){var X=u.getRowIndex(e,O);for(D=0;D<m;D++)V.push(D+X*m)}else if(L){var q=u.getColumnIndex(e,L);for(T=0;T<N;T++)V.push(q+T*m)}else for(M=0;M<v.length;M++)V.push(M);if(null!=h.labelSectionWidth){x=h.labelSectionWidth;P=u.getCell(e,V[0]).__childArea;A=Math.floor((P.h+a)/(C+a)),I=Math.floor((P.w+a)/(_+f+x+a))}else{for(var Z=0,J=0;J<V.length;J++)"number"==typeof R[V[J]]&&(R[V[J]]>R[Z]||"number"!=typeof R[Z])&&(Z=V[J]);if("ifRequired"!=i.labelTruncation){P=u.getCell(e,Z).__childArea;if(($=Math.floor((P.h+a)/(C+a)))*(ee=Math.floor((P.w+a)/(_+f+parseInt(i.__layout.minimumLabelWidth)+S+s+a)))<R[Z])x=Math.floor(Math.min(parseInt(i.__layout.maximumLabelWidth)+S+s,(P.w+a)/ee-(_+f+a))),A=$,I=ee;else{var Q=ee;for(x=Math.floor(Math.min(parseInt(i.__layout.maximumLabelWidth)+S+s,(P.w+a)/Q-(_+f+a)));x<parseInt(i.__layout.maximumLabelWidth)+S+s&&(Q-1)*$>=R[Z];)Q--,x=Math.floor(Math.min(parseInt(i.__layout.maximumLabelWidth)+S+s,(P.w+a)/Q-(_+f+a)));A=$,I=Q}}else{P=u.getCell(e,V[0]).__childArea;var $=Math.floor((P.h+a)/(C+a)),ee=Math.floor((P.w+a)/(_+f+parseInt(i.__layout.minimumLabelWidth)+S+s+a));A=$,I=0;for(var te=0,ne=0;I<=ee;){I++;var oe=Math.floor((P.w+a)/I-(_+f+a));if(te>oe){I=Math.max(I-1,1);break}var ie=I*A,ae=[];for(T=0;T<N;T++)for(D=0;D<m;D++){if((G=n[le=u.getColumnIndex(e,D)+m*u.getRowIndex(e,T)])&&G.length){var re=Math.min(G.length,ie);G.length>ie&&re--;for(B=ne;B<re;B++)ae.push(G[B])}}if((te=Math.max(te,Math.ceil(p._getMaxLabelWidth(e,ae)+S+s)))>oe){I=Math.max(I-1,1);break}if(ie>=R[Z])break;ne=ie}(x=te>(oe=Math.floor((P.w+a)/I-(_+f+a)))?oe:Math.max(te,Math.min(oe,d+S+s)))<parseInt(i.__layout.minimumLabelWidth)&&(I=0)}}for(J=0;J<V.length;J++){var le,se=!1;R[le=V[J]]>A*I&&(se=!0),v[le]={cellRows:A,cellColumns:I,overflow:se}}}var ge={nodeHeight:C,indicatorSectionWidth:_,iconSectionWidth:f,iconWidth:j,labelSectionWidth:x,cellLayouts:v};return i.__layout.__nodeLayout=ge,ge},p.calculateNodeDrawerLayout=function(e,n,i){var a,r=e.getOptions(),l=parseInt(r.__layout.gridGap),s=r.__layout.nodeStartLabelGap,g=r.__layout.nodeLabelOnlyStartLabelGap,d=r.__layout.nodeEndLabelGap,h=r.__layout.nodeSwatchSize,C=parseInt(r.__layout.maximumLabelWidth),_=u.getNode(e,0),f=c.getIndicatorIcon(e,_),S=c.getIcon(e,_),y=p._calculateSimpleNodeLayout(e),b=y.nodeHeight,E=y.indicatorSectionWidth,x=y.iconSectionWidth,v=E||x?s:g,A=n.__childArea;null==(a=y.labelSectionWidth)&&(a="ifRequired"!=r.labelTruncation?C+v+d:Math.max(C,p._getMaxLabelWidth(e,i))+v+d,a=Math.min(a,A.w-E-x));var I=Math.floor((A.w+l)/(E+x+a+l));if(_[o.LABEL]){var O=new t.Container,L=!1,N=c.getNodeLabel(e,_),m=N.getDimensions().h;if(t.TextUtils.fitText(N,a-v-d,m,O)&&(L=!0),_[o.SECONDARY_LABEL]){var T=c.getNodeSecondaryLabel(e,_),D=T.getDimensions().h;t.TextUtils.fitText(T,a-v-d,D,O)&&(L=!0)}L||(a=0,_[o.COLOR]&&(f&&!c.getNodeIndicatorColor(e,_)||S&&!S[o.SOURCE]||(a=Math.max(0,Math.min(h,A.w-E-x)))))}if(A.w-E-x<0){var R=x;x=Math.max(0,A.w-E)}A.w-E<0&&(E=A.w);var w={nodeHeight:b,indicatorSectionWidth:E,iconSectionWidth:x,iconWidth:R,labelSectionWidth:a,drawerLayout:{rows:-1,columns:I}};return r.__layout.__nodeDrawerLayout=w,w},p._calculateSimpleNodeLayout=function(e){var n=e.getOptions(),i=n.__layout.nodeIndicatorGap,a=parseInt(n.__layout.nodeSingleLabelGap),r=parseInt(n.__layout.nodeDualLabelGap),l=n.__layout.nodeInterLabelGap,s=n.__layout.nodeSwatchSize,g=u.getNode(e,0),d=0,h=0,C=0,p=null,_=c.getIndicatorIcon(e,g),f=c.getNodeIndicatorColor(e,g),S=c.getIcon(e,g);if(_){var y=_[o.WIDTH],b=_[o.HEIGHT];h=y+2*i,d=Math.max(d,b+2*i)}else f&&(h=s);if(g[o.LABEL]){var E=c.getNodeLabel(e,g).getDimensions().h;if(d=Math.max(d,E+2*a),g[o.SECONDARY_LABEL]){var x=c.getNodeSecondaryLabel(e,g).getDimensions().h;d=Math.max(d,E+x+2*r+l)}}else p=0,g[o.COLOR]&&(_&&!c.getNodeIndicatorColor(e,g)||S&&!S[o.SOURCE]||(p=h||s));if(S){var v=Math.max(d,g[o.LABEL]?t.Agent.isTouchDevice()?S.preferredSizeTouch:S.preferredSize:parseInt(S.preferredSizeNoLabel)),A=(S[o.SOURCE]?S.sourcePaddingRatio:S.shapePaddingRatio)*v,I=S[o.WIDTH]?S[o.WIDTH]:v-2*A,O=S[o.HEIGHT]?S[o.HEIGHT]:v-2*A;C=I+2*A,d=Math.max(d,O+2*A)}return{nodeHeight:d,indicatorSectionWidth:h,iconSectionWidth:C,labelSectionWidth:p}},p._renderNodeBackground=function(e,n,o,i){var a=i.indicatorSectionWidth+i.iconSectionWidth+i.labelSectionWidth,r=i.nodeHeight,l=c.getNodeBorderRadius(e),s=c.getNodeHoverColor(e),d=c.getNodeSelectionColor(e),u=new t.Rect(e.getCtx(),0,0,a,r);u.setFill(null),l&&(u.setRx(l),u.setRy(l)),u.setHoverStroke(new t.Stroke(s,1,2),new t.Stroke(d,1,4)),u.setSelectedStroke(new t.Stroke(d,1,4),null),u.setSelectedHoverStroke(new t.Stroke(s,1,2),new t.Stroke(d,1,6)),o.addChild(u),o.setSelectionShape(u);var h=new t.Rect(e.getCtx(),0,0,a,r);l&&(h.setRx(l),h.setRy(l));var C=c.getNodeColor(e,n);h.setSolidFill(C),c.getNodeBorderColor(e,n)&&c.getNodeBorderWidth(e,n)&&h.setSolidStroke(c.getNodeBorderColor(e,n),null,c.getNodeBorderWidth(e,n));var p=n.svgStyle||n.style,_=n.svgClassName||n.className;h.setStyle(p).setClassName(_),o.addChild(h),g(e,n,h,"background")},p._renderNodeIndicator=function(e,n,i,a){var r=c.getNodeColor(e,n),l=t.ColorUtils.getContrastingTextColor(r),s=t.Agent.isRightToLeft(e.getCtx())?a.labelSectionWidth+a.iconSectionWidth:0,d=c.getNodeIndicatorColor(e,n);if(d){l=t.ColorUtils.getContrastingTextColor(d);var u=new t.Rect(e.getCtx(),s,0,a.indicatorSectionWidth,a.nodeHeight);u.setSolidFill(d),p._clipIfNecessary(e,u,a),i.addChild(u),g(e,n,u,o.INDICATOR)}var h=c.getIndicatorIcon(e,n);if(h){var C,_=h[o.WIDTH],f=h[o.HEIGHT],S=s+a.indicatorSectionWidth/2,y=a.nodeHeight/2,b=_,E=h[o.COLOR]?h[o.COLOR]:l,x=h[o.BORDER_COLOR],v=h[o.BORDER_WIDTH],A=h[o.BORDER_RADIUS],I=h[o.PATTERN];h[o.SOURCE]?(C=new t.ImageMarker(e.getCtx(),S,y,_,f,A,h[o.SOURCE])).setPreserveAspectRatio(p._ASPECT_RATIO_SCALING):(C=new t.SimpleMarker(e.getCtx(),h[o.SHAPE],S,y,_,f,A),v>0&&(b+=v)),v&&C.setSolidStroke(x,null,v),"none"!=I?C.setFill(new t.PatternFill(I,E,r)):C.setSolidFill(E);var O=h.svgStyle||h.style,L=h.svgClassName||h.className;if(C.setStyle(O).setClassName(L),b>a.indicatorSectionWidth)if(A&&h[o.SOURCE])i.getChildContainer(!0).addChild(C);else p._clipIfNecessary(e,C,a),i.addChild(C);else i.addChild(C);g(e,n,C,o.INDICATOR_ICON)}},p._renderNodeIcon=function(e,n,i,r){var s=e.getOptions(),d=c.getNodeColor(e,n),u=t.ColorUtils.getContrastingTextColor(d),h=t.Agent.isRightToLeft(e.getCtx()),C=c.getIcon(e,n);if(C){var _,f,S=(C[o.SOURCE]||C[o.INITIALS]?C.sourcePaddingRatio:C.shapePaddingRatio)*r.nodeHeight,y=C[o.WIDTH]?C[o.WIDTH]:r.iconWidth?r.iconWidth:r.iconSectionWidth-2*S,b=C[o.HEIGHT]?C[o.HEIGHT]:r.nodeHeight-2*S,E=r[h?"labelSectionWidth":"indicatorSectionWidth"]+Math.max(r.iconSectionWidth/2,r.iconWidth?r.iconWidth/2:0),x=r.nodeHeight/2,v=C[o.COLOR]?C[o.COLOR]:u,A=C[o.BORDER_COLOR],I=C[o.BORDER_WIDTH],O=C[o.BORDER_RADIUS],L=C[o.PATTERN],N=C[o.SOURCE],m=s._resources["background_"+C[o.BACKGROUND]];if(N)(_=new t.ImageMarker(e.getCtx(),E,x,y,b,O,N)).setPreserveAspectRatio(p._ASPECT_RATIO_SCALING);else if(C[o.INITIALS]){var T=m.src,D=t.ToolkitUtils.getImageUrl(e.getCtx(),T).includes(".");_=new t.SimpleMarker(e.getCtx(),null,E,x,y,b);var R=C[o.BACKGROUND];if(_.setClassName("oj-nbox-node-initials-bg-color"+("neutral"===R?" oj-nbox-node-initials-neutral":" oj-avatar-bg-"+R+" oj-nbox-node-initials-"+R)),D){var w=new t.Container(e.getCtx()),M=C.backgroundSize,B=new t.ImageMarker(e.getCtx(),E,x,parseInt(M),parseInt(M),O,m.src);B.setClipPath(p._getIconClipPath(e,E,x,y,b)),w.addChild(_),w.addChild(B),B.setClassName("oj-nbox-node-initials-background-pattern"),_=w}f=a(e.getCtx(),C[o.INITIALS],null,t.OutputText.H_ALIGN_CENTER,t.OutputText.V_ALIGN_CENTRAL),l(f,E,x),n[o.LABEL]&&!n[o.SECONDARY_LABEL]||!n[o.LABEL]&&parseInt(s[o.STYLE_DEFAULTS][o.NODE_DEFAULTS].height)>0?f.setClassName("oj-nbox-node-initials"):f.setClassName("oj-nbox-node-initials oj-nbox-node-initials-lg")}else _=new t.SimpleMarker(e.getCtx(),C[o.SHAPE],E,x,y-I,b-I,O);if(I&&_.setSolidStroke(A,null,I),"none"!=L?_.setFill(new t.PatternFill(L,v,d)):_.setSolidFill(v),!C[o.INITIALS]){var H=C.svgStyle||C.style,U=C.svgClassName||C.className;_.setStyle(H).setClassName(U)}if(0==r.indicatorSectionWidth||0==r.labelSectionWidth)if(O&&C[o.SOURCE])i.getChildContainer(!0).addChild(_);else p._clipIfNecessary(e,_,r),i.addChild(_);else i.addChild(_);g(e,n,_,o.ICON),f&&i.addChild(f)}},p._renderNodeLabels=function(e,n,i,a){var r=e.getOptions(),s=r.__layout.nodeInterLabelGap,d=r.__layout.nodeLabelOnlyStartLabelGap,u=r.__layout.nodeStartLabelGap,h=r.__layout.nodeEndLabelGap,C=a.indicatorSectionWidth||a.iconSectionWidth?u:d,p=c.getNodeColor(e,n),_=t.ColorUtils.getContrastingTextColor(p),f=t.Agent.isRightToLeft(e.getCtx())?a.labelSectionWidth-C:a.indicatorSectionWidth+a.iconSectionWidth+C;if(n[o.LABEL]){var S=c.getNodeLabel(e,n),y=S.getDimensions().h;if(t.TextUtils.fitText(S,a.labelSectionWidth-C-h,y,i)&&(l(S,f,a.nodeHeight/2),S.getCSSStyle()&&S.getCSSStyle().getStyle("color")?S.setSolidFill(S.getCSSStyle().getStyle("color")):S.setSolidFill(_),g(e,n,S,o.LABEL)),n[o.SECONDARY_LABEL]){var b=c.getNodeSecondaryLabel(e,n),E=b.getDimensions().h;if(t.TextUtils.fitText(b,a.labelSectionWidth-C-h,E,i)){var x=(a.nodeHeight-y-E-s)/2;l(S,f,x+y/2),l(b,f,x+y+s+E/2),b.getCSSStyle()&&b.getCSSStyle().getStyle("color")?b.setSolidFill(b.getCSSStyle().getStyle("color")):b.setSolidFill(_),g(e,n,b,o.SECONDARY_LABEL)}}}},p._getMaxLabelWidth=function(e,n){for(var o=[],i=0;i<n.length;i++){var a=n[i];o.push(c.getNodeLabel(e,a)),o.push(c.getNodeSecondaryLabel(e,a))}return t.TextUtils.getMaxTextDimensions(o).w},p._clipIfNecessary=function(e,n,o){if(!(a=e.getNodeClipPath())){var i=c.getNodeBorderRadius(e);if(!(i=i<p._MIN_CORNER_RADIUS?0:i))return;var a,r=o.indicatorSectionWidth+o.iconSectionWidth+o.labelSectionWidth,l=o.nodeHeight;(a=new t.ClipPath).addRect(0,0,r,l,i,i),e.setNodeClipPath(a)}n.setClipPath(a)},p._getIconClipPath=function(e,n,o,i,a){var r=e.getNodeIconClipPath();return r||((r=new t.ClipPath).addRect(n-i/2,o-a/2,i,a),e.setNodeIconClipPath(r)),r},p.animateUpdate=function(e,n,i){var a=e.getOldNBox(),l=e.getNewNBox(),s=r(n),g=r(i),h=i.getMatrix(),c=i.getParent();n.setAlpha(0),e.getNewNBox().addChild(i),i.setMatrix(s);var _=u.getNodeScrollableContainer(a,n),f=u.getNodeScrollableContainer(l,i);if(_||f){var S,y=new t.ClipPath;if(_){var b=r(_),E=new t.Rectangle(b.getTx(),b.getTy(),_.getWidth(),_.getHeight()),x=u.getCellIndex(a,n.getData()),v=u.getCell(a,x),A=d(a,v,"background"),I=r(A),O=new t.Rectangle(I.getTx(),I.getTy(),A.getWidth(),A.getHeight());S=E.getUnion(O)}if(f){var L=r(f),N=new t.Rectangle(L.getTx(),L.getTy(),f.getWidth(),f.getHeight()),m=u.getCellIndex(l,i.getData()),T=u.getCell(l,m),D=d(l,T,"background"),R=r(D),w=new t.Rectangle(R.getTx(),R.getTy(),D.getWidth(),D.getHeight()),M=N.getUnion(w);S=S?S.getUnion(M):M}S&&(y.addRect(S.x,S.y,S.w,S.h),i.setClipPath(y))}var B=new t.AnimMoveTo(i.getCtx(),i,new t.Point(g.getTx(),g.getTy()),e.getAnimationDuration());t.Playable.appendOnEnd(B,function(){c.addChild(i),i.setMatrix(h),i.setClipPath(null)}),e.add(B,C.UPDATE);var H=new t.CustomAnimation(l.getCtx(),i,e.getAnimationDuration());p._animateFill(H,a,l,n,i,"background"),p._animateFill(H,a,l,n,i,o.LABEL),p._animateFill(H,a,l,n,i,o.SECONDARY_LABEL),p._animateFill(H,a,l,n,i,o.INDICATOR),p._animateFill(H,a,l,n,i,o.INDICATOR_ICON),p._animateFill(H,a,l,n,i,o.ICON),e.add(H,C.UPDATE)},p._animateFill=function(e,n,o,i,a,r){var l=d(n,i.getData(),r),s=d(o,a.getData(),r);l&&s&&s.getFill()instanceof t.SolidFill&&!s.getFill().equals(l.getFill())&&(e.getAnimator().addProp(t.Animator.TYPE_FILL,s,s.getFill,s.setFill,s.getFill()),s.setFill(l.getFill()))},p.animateDelete=function(e,n){var i=C.DELETE,a=e.getOldNBox(),l=e.getNewNBox(),s=a.getOptions().__layout.__nodeLayout;if(s){var g=n.getData(),h=g[o.ID],c=u.getNodeIndex(l,h);if(!isNaN(c)){var p=u.getNode(l,c);if(!u.isNodeHidden(l,p))if(i=C.UPDATE,u.getGrouping(l)){var _=l.getOptions().__groups;u.getGroupBehavior(l)==o.GROUP_BEHAVIOR_WITHIN_CELL&&(_=_[u.getCellIndex(l,p)]);var f=_[u.getNodeGroupId(p)];if(f){var S=d(l,f);if(S){var y=r(S),b=new t.Point((s.indicatorSectionWidth+s.iconSectionWidth+s.labelSectionWidth)/2,s.nodeHeight/2);e.add(new t.AnimMoveTo(l.getCtx(),n,new t.Point(y.getTx()-b.x,y.getTy()-b.y),e.getAnimationDuration()),i)}}}else if(g[o.ROW]!=p[o.ROW]||g[o.COLUMN]!=p[o.COLUMN]){var E=r(n),x=n.getDimensions();e.getNewNBox().addChild(n),n.setMatrix(E);var v=u.getCellByRowColumn(l,p[o.ROW],p[o.COLUMN]),A=d(l,v.getData(),"overflow");if(A){var I=r(A);e.add(new t.AnimMoveTo(l.getCtx(),n,new t.Point(I.getTx(),I.getTy()),e.getAnimationDuration()),C.UPDATE)}else{var O=r(v),L=v.getDimensions();b=new t.Point((s.indicatorSectionWidth+s.iconSectionWidth+s.labelSectionWidth)/2,s.nodeHeight/2);e.add(new t.AnimMoveTo(l.getCtx(),n,new t.Point(O.getTx()+L.w/2-b.x,O.getTy()+L.h/2-b.y),e.getAnimationDuration()),C.UPDATE)}var N=new t.CustomAnimation(l.getCtx(),p,e.getAnimationDuration());return N.getAnimator().addProp(t.Animator.TYPE_NUMBER,n,n.getScaleX,n.setScaleX,.01),N.getAnimator().addProp(t.Animator.TYPE_NUMBER,n,n.getScaleY,n.setScaleY,.01),t.Playable.appendOnEnd(N,function(){l.getDeleteContainer().addChild(n)}),e.add(N,C.INSERT),e.add(new t.AnimMoveBy(l.getCtx(),n,new t.Point(x.w/2,x.h/2),e.getAnimationDuration()),C.INSERT),void e.add(new t.AnimFadeOut(l.getCtx(),n,e.getAnimationDuration()),C.INSERT)}}n.setMatrix(r(n));var m=u.getNodeScrollableContainer(a,n);if(m){var T=new t.ClipPath,D=r(m),R=new t.Rectangle(D.getTx(),D.getTy(),m._width,m._height);T.addRect(R.x,R.y,R.w,R.h),n.setClipPath(T)}e.add(new t.AnimFadeOut(l.getCtx(),n,e.getAnimationDuration()),i),l.getDeleteContainer().addChild(n)}},p.animateInsert=function(e,n){var i=C.INSERT,a=e.getOldNBox(),l=e.getNewNBox(),s=l.getOptions().__layout.__nodeLayout;if(s){var g=n.getData()[o.ID],h=u.getNodeIndex(a,g);if(!isNaN(h)){var c=u.getNode(a,h);if(!u.isNodeHidden(a,c)&&(i=C.UPDATE,u.getGrouping(a))){var p=a.getOptions().__groups;u.getGroupBehavior(a)==o.GROUP_BEHAVIOR_WITHIN_CELL&&(p=p[u.getCellIndex(a,c)]);var _=p[u.getNodeGroupId(c)];if(_){var f=d(a,_);if(f){var S=n.getMatrix(),y=n.getParent(),b=r(n),E=r(f),x=new t.Point((s.indicatorSectionWidth+s.iconSectionWidth+s.labelSectionWidth)/2,s.nodeHeight/2);l.addChild(n),n.setMatrix(E.translate(-x.x,-x.y));var v=new t.AnimMoveTo(l.getCtx(),n,new t.Point(b.getTx(),b.getTy()),e.getAnimationDuration());t.Playable.appendOnEnd(v,function(){n.setMatrix(S),y.addChild(n)}),e.add(v,i)}}}}var A=new t.CustomAnimation(l.getCtx(),n,e.getAnimationDuration());A.getAnimator().addProp(t.Animator.TYPE_NUMBER,n,n.getAlpha,n.setAlpha,n.getAlpha()),e.add(A,i),n.setAlpha(0)}},p._addAccessibilityAttributes=function(e,n){if(n.setAriaRole("img"),!t.Agent.deferAriaCreation()){var i=n.getAriaLabel();i&&n.setAriaProperty(o.LABEL,i)}};var _=function(e,t){this.Init(e,t)};t.Obj.createSubclass(_,t.Container),_.prototype.nboxType="node",_.prototype.Init=function(e,n){_.superclass.Init.call(this,e.getCtx(),null,n[o.ID]),this._nbox=e,this._data=n,this._nbox.registerObject(this);var i=this._nbox.getOptions()[o.SELECTION_MODE];"single"!=i&&"multiple"!=i||this.setCursor(t.SelectionEffectUtils.getSelectingCursor()),this._maxAlpha=1},_.prototype.getData=function(){return this._data},_.prototype.render=function(e,t){p.render(this._nbox,this._data,this,t),e.addChild(this),g(this._nbox,this._data,this),this._nbox.EventManager.associate(this,this)},_.prototype.isSelectable=function(){return!0},_.prototype.isSelected=function(){return this.getSelectionShape().isSelected()},_.prototype.setSelected=function(e){this.getSelectionShape().setSelected(e),this.UpdateAccessibilityAttributes()},_.prototype.showHoverEffect=function(){this.getSelectionShape().showHoverEffect()},_.prototype.hideHoverEffect=function(){this.getSelectionShape().hideHoverEffect()},_.prototype.setSelectionShape=function(e){this._selectionShape=e},_.prototype.getSelectionShape=function(){return this._selectionShape},_.prototype.getDatatip=function(e,t,n){var o=this._nbox.getOptions().tooltip,i=o?o.renderer:null;if(i){var a={id:this._data.id,label:this._data.label,secondaryLabel:this._data.secondaryLabel,row:this._data.row,column:this._data.column,color:c.getNodeColor(this._nbox,this._data),indicatorColor:c.getNodeIndicatorColor(this._nbox,this._data)};return this._nbox.getCtx().getTooltipManager().getCustomTooltip(i,a)}return this.getShortDesc()},_.prototype.getShortDesc=function(){return this._data[o.SHORT_DESC]},_.prototype.getDatatipColor=function(){return c.getNodeColor(this._nbox,this._data)},_.prototype.setMaxAlpha=function(e){this._maxAlpha=e,this.setAlpha(this.getAlpha())},_.prototype.getMaxAlpha=function(){return this._maxAlpha},_.prototype.setAlpha=function(e){_.superclass.setAlpha.call(this,Math.min(e,this._maxAlpha))},_.prototype.animateUpdate=function(e,t){p.animateUpdate(e,t,this)},_.prototype.animateDelete=function(e,t){p.animateDelete(e,this)},_.prototype.animateInsert=function(e){p.animateInsert(e,this)},_.prototype.isDoubleClickable=function(){return!0},_.prototype.handleDoubleClick=function(){this._getParentContainer().handleDoubleClick()},_.prototype.isDragAvailable=function(e){return this._nbox.__isDragAvailable(e)},_.prototype.getDragTransferable=function(e,t){return this._nbox.__getDragTransferable(this)},_.prototype.getDragFeedback=function(e,t){return this._nbox.__getDragFeedback()},_.prototype._getParentContainer=function(){var e,t=u.getDrawer(this._nbox);if(t)e=d(this._nbox,t);else{var n=u.getCellIndex(this._nbox,this._data),o=u.getCell(this._nbox,n);e=d(this._nbox,o)}return e},_.prototype.UpdateAccessibilityAttributes=function(){if(!t.Agent.deferAriaCreation()){var e=this.getAriaLabel();e&&this.setAriaProperty(o.LABEL,e)}},_.prototype.getAriaLabel=function(){return u.buildAriaDesc(this._nbox,this,this.getShortDesc(),this.isSelected())},_.prototype.getAriaLabel=function(){return u.buildAriaDesc(this._nbox,this,this.getShortDesc(),this.isSelected(),()=>_.getShortDescContext(this))},_.getShortDescContext=function(e){var t=e.getData();return{id:t.id,label:t.label,secondaryLabel:t.secondaryLabel,row:t.row,column:t.column}},_.prototype.getCategories=function(){return this.getData()[o.CATEGORIES]?this.getData()[o.CATEGORIES]:[]},_.prototype.getKeyboardBoundingBox=function(e){return i(this,e)},_.prototype.getTargetElem=function(){return this.getElem()},_.prototype.showKeyboardFocusEffect=function(){this._isShowingKeyboardFocusEffect=!0,this.showHoverEffect();var e=u.getNodeScrollableContainer(this._nbox,this);e&&e.scrollIntoView(this)},_.prototype.hideKeyboardFocusEffect=function(){this._isShowingKeyboardFocusEffect=!1,this.hideHoverEffect()},_.prototype.isShowingKeyboardFocusEffect=function(){return this._isShowingKeyboardFocusEffect},_.prototype.getNextNavigable=function(e){var n=null;return e.keyCode==t.KeyboardEvent.SPACE&&e.ctrlKey?this:(this._nbox.EventManager.getKeyboardHandler().isNavigationEvent(e)?n=e.keyCode==t.KeyboardEvent.CLOSE_BRACKET?this._getParentContainer():e.keyCode==t.KeyboardEvent.OPEN_BRACKET?this:u.getNextNavigableNode(this._nbox,this,e):e.type==t.MouseEvent.CLICK&&(n=this),n)},_.prototype.HandleKeyboardEvent=function(e){if(u.getDrawer(this._nbox)&&e.keyCode==t.KeyboardEvent.ESCAPE)this.handleDoubleClick();else{var n=u.getMaximizedRow(this._nbox),i=u.getMaximizedColumn(this._nbox),a=n==this._data[o.ROW]&&i==this._data[o.COLUMN];(!a&&e.keyCode==t.KeyboardEvent.ENTER||a&&e.keyCode==t.KeyboardEvent.ESCAPE)&&this.handleDoubleClick()}},_.prototype.getDisplayable=function(){return this},_.prototype.getKeyboardFocusDisplayable=function(){var e=u.getNode(this._nbox,u.getNodeIndex(this._nbox,this.getData()[o.ID]));if(e){var t=d(this._nbox,e);if(t)return t;var n=u.getCell(this._nbox,u.getCellIndex(this._nbox,e)),i=d(this._nbox,n),a=u.getLastNavigableNode(this._nbox,i.getChildContainer());if("overflow"===a.nboxType)return a;var r=this._getParentDrawer();return r?r.getKeyboardFocusDisplayable():i.getKeyboardFocusDisplayable()}return null},_.prototype._getParentDrawer=function(){for(var e=this;e&&e.getParent;)if("drawer"===(e=e.getParent()).nboxType)return e;return null},_.prototype.getChildContainer=function(e){return!e||this._childContainer||(this._childContainer=new t.Container(this.getCtx()),this.addChild(this._childContainer)),this._childContainer},_.prototype.setChildContainer=function(e){this._childContainer=e};var f=new Object;t.Obj.createSubclass(f,t.Obj),f.render=function(e,n,i,a){var r=e.getOptions(),l=parseInt(r.__layout.cellGap),s=parseInt(r.__layout.cellInnerPadding),d=f.getCellLayout(e),h=u.getRowIndex(e,n[o.ROW]),C=u.getColumnIndex(e,n[o.COLUMN]),p=f.getCellDimensions(e,h,C,a);i.setTranslate(p.x+l/2,p.y+l/2);var _=h*u.getColumnCount(e)+C,S=new t.Rect(e.getCtx(),0,0,Math.max(p.w-l,0),Math.max(p.h-l,0));S.setPixelHinting(!0);var y=c.getCellStyle(e,_);f._applyStyleToRect(S,y);var b=c.getCellBorderRadius(e);S.setRx(b),S.setRy(b);var E=c.getCellStyleObject(e,_);S.setStyle(E);var x=c.getCellClassName(e,_);S.setClassName(x),i.addChild(S);var v=e.getCellFilter();void 0===v&&(v=f._createShadow(r[o.STYLE_DEFAULTS][o.CELL_DEFAULTS]._panelShadow),e.setCellFilter(v)),v&&S.addDrawEffect(v),g(e,n,S,"background");var A=new t.KeyboardFocusEffect(e.getCtx(),i,new t.Rectangle(-1,-1,S.getWidth()+2,S.getHeight()+2));g(e,n,A,"focusEffect"),f.renderHeader(e,n,i,!1);var I=u.isCellMaximized(e,_),O=I?d.maximizedHeaderSize:d.headerSize,L=I?d.maximizedLabelHeight:d.labelHeight,N=I?new t.SimpleScrollableContainer(e.getCtx(),S.getWidth(),S.getHeight()-O):new t.Container(e.getCtx());i.addChild(N),i.setChildContainer(N);var m=null;L?(m=f._isLabelVertical(e,n)?new t.Rectangle(O,s,S.getWidth()-O-s,S.getHeight()-s-s):new t.Rectangle(s,O,S.getWidth()-s-s,S.getHeight()-O-s),N instanceof t.SimpleScrollableContainer&&N.setTranslate(0,O)):m=new t.Rectangle(s,s,S.getWidth()-s-s,S.getHeight()-s-s),m.w=Math.max(m.w,0),m.h=Math.max(m.h,0),n.__childArea=m},f.renderHeader=function(e,n,i,r){var s=d(e,n,o.LABEL);s&&(s.getParent().removeChild(s),g(e,n,null,o.LABEL));var h=d(e,n,"countLabel");h&&(h.getParent().removeChild(h),g(e,n,null,"countLabel"));var C=d(e,n,"closeButton");C&&(C.getParent().removeChild(C),g(e,n,null,"closeButton"));var p=!1;if(n){var _=e.getOptions(),S=_.__layout.countLabelGap,y=_.__layout.cellCloseGap,b=parseInt(_.__layout.cellInnerPadding),E=f.getCellLayout(e),x=u.getCellCounts(e),v=d(e,n,"background"),A=u.getRowIndex(e,n[o.ROW]),I=u.getColumnIndex(e,n[o.COLUMN]),O=A*u.getColumnCount(e)+I,L=t.Agent.isRightToLeft(e.getCtx()),N=0;if(u.isCellMaximized(e,O)){var m=_._resources.close,T=m.width;if(v.getWidth()-b-b>T){var D=e.getCtx(),R=t.ToolkitUtils.getIconStyle(D,m.class),w=new t.IconButton(D,"borderless",{style:R,size:T},null,null,i.handleDoubleClick,i),M=L?Math.min((v.getWidth()-T)/2,b):Math.max((v.getWidth()-T)/2,v.getWidth()-b-T);w.setTranslate(M,b),i.addChild(w),N=T+y,g(e,n,w,"closeButton"),p=!0}}if(n[o.LABEL]){var B=E.labelHeight,H=!1,U=c.getLabelHalign(e,n),P=0,G=null,F=0,W=0,k=null,z=c.getCellShowCount(e,n);if(!r&&"off"!=z){var K=d(e,n).getCountLabel();K?k=K:"on"==z&&(k=""+x.total[O],x.highlighted&&(k=t.ResourceUtils.format(_.translations.highlightedCount,[x.highlighted[O],k])))}if(f._isLabelVertical(e,n)){k&&((G=a(e.getCtx(),k,c.getCellCountLabelStyle(e,O),t.OutputText.H_ALIGN_CENTER,t.OutputText.V_ALIGN_CENTRAL)).setClassName("oj-typography-semi-bold"),t.TextUtils.fitText(G,v.getHeight()-b-b,v.getWidth()-2*b,i)?(g(e,n,G,"countLabel"),p=!0,P=G.getDimensions().w+S,W=v.getHeight()/2,F=v.getWidth()/2):H=!0);var Y=0;if(!H){var j=a(e.getCtx(),n[o.LABEL],c.getCellLabelStyle(e,O),t.OutputText.H_ALIGN_CENTER,t.OutputText.V_ALIGN_CENTRAL);if(t.TextUtils.fitText(j,v.getHeight()-b-b-P,v.getWidth()-2*b,i)){g(e,n,j,o.LABEL);var V=j.getDimensions().w;p=!0,l(j,v.getWidth()/2,(v.getHeight()+P)/2,L?Math.PI/2:-Math.PI/2),Y=(V+S)/2}}G&&l(G,F,W-=Y,L?Math.PI/2:-Math.PI/2)}else{k&&((G=a(e.getCtx(),k,c.getCellCountLabelStyle(e,O),U,t.OutputText.V_ALIGN_CENTRAL)).setClassName("oj-typography-semi-bold"),t.TextUtils.fitText(G,v.getWidth()-b-b-N,v.getHeight()-2*b,i)?(g(e,n,G,"countLabel"),p=!0,P=G.getDimensions().w+S,F=U==t.OutputText.H_ALIGN_CENTER?v.getWidth()/2:U==t.OutputText.H_ALIGN_RIGHT?v.getWidth()-b:b,W=u.isCellMinimized(e,O)?v.getHeight()/2:b+B/2,l(G,F,W)):H=!0);Y=0;if(!H){j=a(e.getCtx(),n[o.LABEL],c.getCellLabelStyle(e,O),U,t.OutputText.V_ALIGN_CENTRAL);if(t.TextUtils.fitText(j,v.getWidth()-b-b-N-P,v.getHeight()-2*b,i)){g(e,n,j,o.LABEL);var X;V=j.getDimensions().w;p=!0,U==t.OutputText.H_ALIGN_CENTER?(X=(v.getWidth()-(L?-1:1)*P)/2,Y=(L?-1:1)*(V+S)/2):U==t.OutputText.H_ALIGN_RIGHT?(X=v.getWidth()-b-(L?0:1)*P,Y=(L?-1:0)*(V+S)):(X=b+(L?1:0)*P,Y=(L?0:1)*(V+S));var q=u.isCellMinimized(e,O)?v.getHeight()/2:b+B/2;l(j,X,q)}}G&&Y&&l(G,F+Y,W)}}}return f._addAccessibilityAttributes(e,n,i),p},f.renderBodyCountLabels=function(e,n){var i=parseInt(e.getOptions().__layout.cellInnerPadding),r=f.getCellLayout(e),s=u.getCellCounts(e),h=Number.MAX_VALUE,C=!1,p=u.getCell(e,n[0]),_=d(e,p,o.LABEL),S=d(e,p,"countLabel"),y=_&&_.getCSSStyle()?_.getCSSStyle().getFontSize():null,b=S&&S.getCSSStyle()?S.getCSSStyle().getFontSize():null;y=isNaN(y)?parseFloat(y):y,b=isNaN(b)?parseFloat(b):b,isNaN(y)&&isNaN(b)||(h=isNaN(y)?b:isNaN(b)?y:Math.max(y,b));for(var E=[],x=[],v=0;v<n.length;v++)O=n[v],u.isCellMinimized(e,O)?x.push(O):E.push(O);var A=[],I=[];for(v=0;v<E.length;v++){var O=E[v],L=s.total[O];A[v]=a(e.getCtx(),""+L,c.getCellBodyCountLabelStyle(e),t.OutputText.H_ALIGN_CENTER,t.OutputText.V_ALIGN_CENTRAL)}for(v=0;v<x.length;v++){O=x[v],L=s.total[O];I[v]=a(e.getCtx(),""+L,c.getCellBodyCountLabelStyle(e),t.OutputText.H_ALIGN_CENTER,t.OutputText.V_ALIGN_CENTRAL)}var N=f.getBodyCountLabelsFontSize(e,E,A);(N<=h||S&&!_)&&(C=!0);var m=f.getBodyCountLabelsFontSize(e,x,I);if((m<=h||S&&!_)&&(C=!0),C){for(v=0;v<n.length;v++){p=u.getCell(e,n[v]),_=d(e,p,o.LABEL),S=d(e,p,"countLabel");var T=p.__childArea,D=!1;_&&(_.getParent().removeChild(_),g(e,p,null,o.LABEL),D=!0),S&&(S.getParent().removeChild(S),g(e,p,null,"countLabel"),D=!0),D&&(f._isLabelVertical(e,p)?(T.x-=r.headerSize-i,T.w+=r.headerSize-i):(T.y-=r.headerSize-i,T.h+=r.headerSize-i),p.__childArea=T)}N=f.getBodyCountLabelsFontSize(e,E,A),m=f.getBodyCountLabelsFontSize(e,x,I)}for(v=0;v<E.length;v++){O=E[v],p=u.getCell(e,O);var R=d(e,p);T=p.__childArea;A[v].setFontSize(N),t.TextUtils.fitText(A[v],T.w,T.h,R)&&(C||f.renderHeader(e,p,R,!0),l(A[v],T.x+T.w/2,T.y+T.h/2))}for(v=0;v<x.length;v++){O=x[v],p=u.getCell(e,O);R=d(e,p),T=p.__childArea;I[v].setFontSize(m),t.TextUtils.fitText(I[v],T.w,T.h,R)&&(C||f.renderHeader(e,p,R,!0),l(I[v],T.x+T.w/2,T.y+T.h/2))}},f.getBodyCountLabelsFontSize=function(e,n,o){for(var i=Number.MAX_VALUE,a=0;a<n.length;a++){var r=u.getCell(e,n[a]).__childArea;i=Math.min(i,parseInt(t.TextUtils.getOptimalFontSize(o[a].getCtx(),o[a].getTextString(),o[a].getCSSStyle(),r)))}return i},f._isLabelVertical=function(e,t){var n=u.getMaximizedColumn(e),i=u.getMaximizedRow(e);return!(!n||n==t[o.COLUMN]||i&&i!=t[o.ROW])},f.getCellDimensions=function(e,n,o,i){var a=e.getOptions(),r=parseInt(a.__layout.cellGap),l=f.getCellLayout(e),s=t.Agent.isRightToLeft(e.getCtx()),g=r+parseInt(l.minimumCellSize),d=u.getRowCount(e),h=u.getColumnCount(e),c=u.getRowDimensions(e,n,i),C=u.getColumnDimensions(e,o,i),p=u.getMaximizedRow(e),_=u.getMaximizedColumn(e),S=C.x,y=c.y,b=C.w,E=c.h,x=!0;if(p){var v=u.getRowIndex(e,p),A=Math.min(i.h/(3*(d-1)),g);n<v?(y=i.y+i.h-(n+1)*A,E=A,x=!1):n==v?(y=i.y+(d-n-1)*A,E=i.h-(d-1)*A):(y=i.y+(d-n-1)*A,E=A,x=!1)}if(_&&x){var I=u.getColumnIndex(e,_),O=Math.min(i.w/(3*(h-1)),g);o<I?(b=O,S=i.x+(s?i.w-O:0)+(s?-1:1)*o*O):o==I?(b=i.w-(h-1)*O,S=i.x+(s?i.w-b:0)+(s?-1:1)*o*O):(b=O,S=i.x+(s?-O:i.w)+(s?1:-1)*(h-o)*O)}return new t.Rectangle(S,y,b,E)},f.getCellLayout=function(e){return e.getOptions().__layout.__cellLayout||f._calculateCellLayout(e)},f._calculateCellLayout=function(e){for(var n=e.getOptions(),i=u.getCellCounts(e),r=parseInt(n.__layout.cellInnerPadding),l=n.__layout.cellLabelGap,s=parseInt(n.__layout.minimumCellSize),g=0,d=0,h=u.getRowCount(e)*u.getColumnCount(e),C=0;C<h;C++){var p=u.getCell(e,C);if(p&&p[o.LABEL]){var _=p[o.LABEL_HALIGN],f=a(e.getCtx(),p[o.LABEL],c.getCellLabelStyle(e,C),_,t.OutputText.V_ALIGN_CENTRAL).getDimensions().h;if("on"==c.getCellShowCount(e,p)){var S=a(e.getCtx(),i.total[C],c.getCellCountLabelStyle(e,C),_,t.OutputText.V_ALIGN_CENTRAL).getDimensions().h;f=Math.max(f,S)}g=Math.max(g,f)}}u.getMaximizedRow(e)&&u.getMaximizedColumn(e)&&(d=Math.max(g,n._resources.close.height));var y=g+r+r,b={labelHeight:g,headerSize:g+r+l,maximizedLabelHeight:d,maximizedHeaderSize:d+r+l,minimumCellSize:s=Math.max(y,s)};return n.__layout.__cellLayout=b,b},f.animateUpdate=function(e,n,i){var a=e.getOldNBox(),l=e.getNewNBox(),s=new t.CustomAnimation(l.getCtx(),i,e.getAnimationDuration()),g=i.getChildContainer(),u=g.getMatrix();g.setMatrix(r(g));var h=i.getParent();h.addChildAt(g,h.getChildIndex(i)+1);var c=i.getTranslateX(),p=i.getTranslateY();s.getAnimator().addProp(t.Animator.TYPE_MATRIX,i,i.getMatrix,i.setMatrix,i.getMatrix()),i.setMatrix(n.getMatrix());var _=d(a,n.getData(),"background"),S=d(l,i.getData(),"background"),y=t.Agent.isRightToLeft(l.getCtx())?0:S.getWidth()-_.getWidth();if(S.getFill().equals(_.getFill())||(s.getAnimator().addProp(t.Animator.TYPE_FILL,S,S.getFill,S.setFill,S.getFill()),S.setFill(_.getFill())),s.getAnimator().addProp(t.Animator.TYPE_NUMBER,S,S.getWidth,S.setWidth,S.getWidth()),S.setWidth(_.getWidth()),s.getAnimator().addProp(t.Animator.TYPE_NUMBER,S,S.getHeight,S.setHeight,S.getHeight()),S.setHeight(_.getHeight()),i.isShowingKeyboardFocusEffect()){var b=d(l,i.getData(),"focusEffect").getEffect();b&&(s.getAnimator().addProp(t.Animator.TYPE_NUMBER,b,b.getWidth,b.setWidth,b.getWidth()),b.setWidth(_.getWidth()+2),s.getAnimator().addProp(t.Animator.TYPE_NUMBER,b,b.getHeight,b.setHeight,b.getHeight()),b.setHeight(_.getHeight()+2))}f._animateLabels(e,n,i,"countLabel"),f._animateLabels(e,n,i,o.LABEL);var E=d(a,n.getData(),"closeButton"),x=d(l,i.getData(),"closeButton");if(E)if(x)s.getAnimator().addProp(t.Animator.TYPE_MATRIX,x,x.getMatrix,x.setMatrix,x.getMatrix()),x.setMatrix(E.getMatrix());else{var v=r(E);E.setTranslate(E.getTranslateX()+y+c,E.getTranslateY()+p),e.add(new t.AnimFadeOut(l.getCtx(),E,e.getAnimationDuration()),C.UPDATE),s.getAnimator().addProp(t.Animator.TYPE_MATRIX,E,E.getMatrix,E.setMatrix,E.getMatrix()),E.setMatrix(v),l.getDeleteContainer().addChild(E)}else x&&(e.add(new t.AnimFadeIn(l.getCtx(),x,e.getAnimationDuration()),C.UPDATE),s.getAnimator().addProp(t.Animator.TYPE_MATRIX,x,x.getMatrix,x.setMatrix,x.getMatrix()),x.setTranslate(x.getTranslateX()-y,x.getTranslateY()),x.setAlpha(0));t.Playable.appendOnEnd(s,function(){i.addChild(g),g.setMatrix(u)}),e.add(s,C.UPDATE)},f._animateLabels=function(e,n,o,i){var a=e.getOldNBox(),l=e.getNewNBox(),s=d(a,n.getData(),i),g=d(l,o.getData(),i),u=f._isLabelVertical(a,n.getData()),h=f._isLabelVertical(l,o.getData());if(s||g)if(s&&g&&u==h){var c=new t.CustomAnimation(l.getCtx(),g,e.getAnimationDuration()),p=s.getHorizAlignment();p="left"==p?-1:"center"==p?0:1;var _=g.getHorizAlignment(),S=((_="left"==_?-1:"center"==_?0:1)-p)*g.getDimensions().w/2;if(c.getAnimator().addProp(t.Animator.TYPE_NUMBER,g,g.getX,g.setX,g.getX()),g.setX(s.getX()+S),c.getAnimator().addProp(t.Animator.TYPE_NUMBER,g,g.getY,g.setY,g.getY()),g.setY(s.getY()),c.getAnimator().addProp(t.Animator.TYPE_MATRIX,g,g.getMatrix,g.setMatrix,g.getMatrix()),g.setMatrix(s.getMatrix()),e.add(c,C.UPDATE),"countLabel"==i&&s.getTextString()!=g.getTextString()){g.setAlpha(0),o.addChild(s);var y=new t.AnimFadeOut(l.getCtx(),s,e.getAnimationDuration()),b=new t.AnimFadeIn(l.getCtx(),g,e.getAnimationDuration());e.add(y,C.UPDATE),e.add(b,C.INSERT),t.Playable.appendOnEnd(y,function(){l.getDeleteContainer().addChild(s)})}}else s&&(s.setMatrix(r(s)),l.getDeleteContainer().addChild(s),e.add(new t.AnimFadeOut(l.getCtx(),s,e.getAnimationDuration()),C.UPDATE)),g&&(g.setAlpha(0),e.add(new t.AnimFadeIn(l.getCtx(),g,e.getAnimationDuration()),C.UPDATE))},f.animateDelete=function(e,n){var o=e.getNewNBox(),i=n.getChildContainer();if(i){var a=r(i),l=n.getParent();l.addChildAt(i,l.getChildIndex(n)+1),i.setMatrix(a)}o.getDeleteContainer().addChild(n),e.add(new t.AnimFadeOut(o.getCtx(),n,e.getAnimationDuration()),C.UPDATE)},f.animateInsert=function(e,n){var o=e.getNewNBox(),i=n.getChildContainer(),a=null;if(i){a=i.getMatrix();var l=r(n),s=n.getParent();s.addChildAt(i,s.getChildIndex(n)+1),i.setMatrix(l)}n.setAlpha(0);var g=new t.AnimFadeIn(o.getCtx(),n,e.getAnimationDuration());i&&t.Playable.appendOnEnd(g,function(){n.addChild(i),i.setMatrix(a)}),e.add(g,C.UPDATE)},f.renderDropSiteFeedback=function(e,n){var o=d(e,n.getData(),"background"),i=new t.Rect(e.getCtx(),o.getX(),o.getY(),o.getWidth(),o.getHeight());i.setPixelHinting(!0);var a=c.getCellDropTargetStyle(e);return f._applyStyleToRect(i,a),n.addChildAt(i,n.getChildIndex(o)+1),i},f._applyStyleToRect=function(e,n){var o=n.getStyle(t.CSSStyle.BACKGROUND),i=n.getStyle(t.CSSStyle.BACKGROUND_COLOR),a=o||i;if(a&&s(e,a),"solid"==n.getStyle(t.CSSStyle.BORDER_STYLE)){var r=n.getStyle(t.CSSStyle.BORDER_COLOR);r=r||"#000000";var l=n.getStyle(t.CSSStyle.BORDER_WIDTH);l=null==l?1:parseFloat(l),e.setSolidStroke(r,null,l)}},f._addAccessibilityAttributes=function(e,n,i){var a=t.Agent.isTouchDevice()?d(e,n,"background"):i;if(a.setAriaRole("img"),!t.Agent.deferAriaCreation()){var r=i.getAriaLabel();r&&a.setAriaProperty(o.LABEL,r)}},f._createShadow=function(e){if(e&&e.length>0&&"none"!==e){var n=e.match(/\S+\([^\)]+\)|\S+/g),o=e.charAt(0);return o>="0"&&o<="9"?new t.Shadow(parseInt(n[0]),parseInt(n[1]),parseInt(n[2])/2,n[4]):new t.Shadow(parseInt(n[1]),parseInt(n[2]),parseInt(n[3])/2,n[0])}return null};var S=function(){};t.Obj.createSubclass(S,t.Container),S.prototype.nboxType="cell",S.newInstance=function(e,t){var n=new S;return n.Init(e,t),n},S.prototype.Init=function(e,t){var n=u.getRowIndex(e,t[o.ROW]),i=u.getColumnIndex(e,t[o.COLUMN]);S.superclass.Init.call(this,e.getCtx(),null,"c:"+n+","+i),this._nbox=e,this._data=t,this._data.__cacheId="cell:"+this.getId(),this._scrollContainer=!1},S.prototype.getData=function(){return this._data},S.prototype.render=function(e,t){e.addChild(this),g(this._nbox,this._data,this),f.render(this._nbox,this._data,this,t),this._nbox.EventManager.associate(this,this)},S.prototype.getChildContainer=function(){return this._childContainer},S.prototype.setChildContainer=function(e){this._childContainer=e},S.prototype.animateUpdate=function(e,t){f.animateUpdate(e,t,this)},S.prototype.animateDelete=function(e,t){f.animateDelete(e,this)},S.prototype.animateInsert=function(e){f.animateInsert(e,this)},S.prototype.isDoubleClickable=function(){return u.isMaximizeEnabled(this._nbox)},S.prototype.handleDoubleClick=function(){if(this.isDoubleClickable()){var e,n=u.getMaximizedRow(this._nbox),i=u.getMaximizedColumn(this._nbox);u.fireOptionChangeEvent(this._nbox,o.DRAWER,null),n==this._data[o.ROW]&&i==this._data[o.COLUMN]?(u.fireOptionChangeEvent(this._nbox,o.MAXIMIZED_ROW,null),u.fireOptionChangeEvent(this._nbox,o.MAXIMIZED_COLUMN,null)):(u.fireOptionChangeEvent(this._nbox,o.MAXIMIZED_ROW,this._data[o.ROW]),u.fireOptionChangeEvent(this._nbox,o.MAXIMIZED_COLUMN,this._data[o.COLUMN]));var a=this._nbox.EventManager.getFocus();a?"node"===a.nboxType?e=this.getCellIndex()!=u.getCellIndex(this._nbox,a.getData()):"overflow"===a.nboxType?e=this!=a.getParentCell():"cell"===a.nboxType?e=this.getCellIndex()!=a.getCellIndex():"categoryNode"===a.nboxType&&(e=this.getCellIndex()!=a.getData().cell):this._nbox.EventManager.setFocusObj(this),e&&(this._nbox.EventManager.setFocusObj(this),this._nbox.EventManager.setFocused(!1)),this._nbox.processEvent(t.EventFactory.newRenderEvent())}},S.prototype.contains=function(e,t){var n=d(this._nbox,this._data,"background"),o=this.getTranslateX()+n.getX(),i=this.getTranslateY()+n.getY(),a=o+n.getWidth(),r=i+n.getHeight();return o<=e&&e<=a&&i<=t&&t<=r},S.prototype.renderDropSiteFeedback=function(){return f.renderDropSiteFeedback(this._nbox,this)},S.prototype.HandleKeyboardEvent=function(e){var n=u.getMaximizedRow(this._nbox),i=u.getMaximizedColumn(this._nbox),a=n==this._data[o.ROW]&&i==this._data[o.COLUMN];(!a&&e.keyCode==t.KeyboardEvent.ENTER||a&&e.keyCode==t.KeyboardEvent.ESCAPE)&&this.handleDoubleClick()},S.prototype.getAriaLabel=function(){var e=this.getCellIndex(),n=[],o=this._nbox.getOptions().translations;return u.isCellMaximized(this._nbox,e)?n.push(o.stateMaximized):u.isCellMinimized(this._nbox,e)&&n.push(o.stateMinimized),n.push([o.labelSize,this.getNodeCount()]),t.Displayable.generateAriaLabel(this.getData().shortDesc,n)},S.prototype.getKeyboardBoundingBox=function(e){return i(this,e)},S.prototype.getTargetElem=function(){return this.getElem()},S.prototype.showKeyboardFocusEffect=function(){this._isShowingKeyboardFocusEffect=!0,d(this._nbox,this.getData(),"focusEffect").show()},S.prototype.hideKeyboardFocusEffect=function(){this._isShowingKeyboardFocusEffect=!1,d(this._nbox,this.getData(),"focusEffect").hide()},S.prototype.isShowingKeyboardFocusEffect=function(){return this._isShowingKeyboardFocusEffect},S.prototype.getNextNavigable=function(e){var n=null;return this._nbox.EventManager.getKeyboardHandler().isNavigationEvent(e)&&(n=e.keyCode==t.KeyboardEvent.OPEN_BRACKET?this._getFirstNavigableChild(e):this._getNextSibling(e)),n},S.prototype._getNextSibling=function(e){for(var n=[],o=u.getRowCount(this._nbox)*u.getColumnCount(this._nbox),i=0;i<o;i++)n.push(d(this._nbox,u.getCell(this._nbox,i)));return t.KeyboardHandler.getNextNavigable(this,e,n)},S.prototype._getFirstNavigableChild=function(e){var t=null,n=u.getMaximizedRow(this._nbox),i=u.getMaximizedColumn(this._nbox),a=u.getDrawer(this._nbox);if(a&&n==this.getData()[o.ROW]&&i==this.getData()[o.COLUMN])t=d(this._nbox,a);else{var r=this.getChildContainer();if(r.getScrollingPane&&(r=r.getScrollingPane()),r.getNumChildren()>0&&("node"===r.getChildAt(0).nboxType||"overflow"===r.getChildAt(0).nboxType))t=u.getFirstNavigableNode(this._nbox,r);else{for(var l=[],s=0;s<r.getNumChildren();s++){var g=r.getChildAt(s);"categoryNode"===g.nboxType&&l.push(g)}t=h.getNextNavigableCategoryNode(null,e,l)}}return t},S.prototype.getCellIndex=function(){return u.getCellIndexByRowColumn(this._nbox,this.getData()[o.ROW],this.getData()[o.COLUMN])},S.prototype.getLabel=function(){var e=this.getData()[o.LABEL];return e||null},S.prototype.getCountLabel=function(){var e=this.getData(),t=this._nbox.getOptions().countLabel;return t?t({row:e.row,column:e.column,nodeCount:this.getNodeCount(),highlightedNodeCount:this.getHighlightedNodeCount(),totalNodeCount:u.getNodeCount(this._nbox)}):e.countLabel},S.prototype.getBackground=function(){var e=c.getCellStyle(this._nbox,this.getCellIndex()),n=e.getStyle(t.CSSStyle.BACKGROUND),o=e.getStyle(t.CSSStyle.BACKGROUND_COLOR);return n||o},S.prototype.hasOverflowIndicator=function(){var e=this._nbox.getOptions();if(e&&e.__layout&&e.__layout.__nodeLayout&&e.__layout.__nodeLayout.cellLayouts){var t=this.getCellIndex(),n=e.__layout.__nodeLayout.cellLayouts[t];if(n)return n.overflow}return!1},S.prototype.getNodeCount=function(){return u.getCellCounts(this._nbox).total[this.getCellIndex()]},S.prototype.getHighlightedNodeCount=function(){var e=u.getCellCounts(this._nbox);return e.highlighted?e.highlighted[this.getCellIndex()]:null},S.prototype.getNode=function(e){var t=this._nbox.getOptions()[o.NODES];if(t)for(var n=0,i=0;i<t.length;i++)if(this.getData()[o.ROW]==t[i][o.ROW]&&this.getData()[o.COLUMN]==t[i][o.COLUMN]&&!u.isNodeHidden(this._nbox,t[i])){if(e==n)return t[i];n++}return null},S.prototype.getDisplayable=function(){return this},S.prototype.getKeyboardFocusDisplayable=function(){return u.getGroupBehavior(this._nbox)==o.GROUP_BEHAVIOR_ACROSS_CELLS&&this._nbox.getOptions().__groups?null:d(this._nbox,u.getCell(this._nbox,u.getCellIndex(this._nbox,this.getData())))};var y=new Object;t.Obj.createSubclass(y,t.Obj),y.render=function(e,t,n,o,i){y._renderNodeBackground(e,t,n,o,i);var a=y._renderNodeIndicator(e,t,n,o,i);y._renderNodeCount(e,t,n,o,a,i),y._addAccessibilityAttributes(e,n)},y._renderNodeBackground=function(e,n,o,i,a){n.__scale=i,n.__gap=a;var r=Math.max(0,y.getSideLength(n)),l=c.getNodeBorderRadius(e),s=c.getNodeHoverColor(e),g=c.getNodeSelectionColor(e),d=new t.Rect(e.getCtx(),-r/2,-r/2,r,r);d.setFill(null),l&&(d.setRx(l),d.setRy(l)),d.setHoverStroke(new t.Stroke(s,1,2),new t.Stroke(g,1,4)),d.setSelectedStroke(new t.Stroke(g,1,4),null),d.setSelectedHoverStroke(new t.Stroke(s,1,2),new t.Stroke(g,1,6)),o.addChild(d),o.setSelectionShape(d);var u=new t.Rect(e.getCtx(),-r/2,-r/2,r,r);l&&(u.setRx(l),u.setRy(l));var h=c.getCategoryNodeColor(e,n);u.setSolidFill(h),o.addChild(u)},y.getSideLength=function(e){return e.__scale*Math.sqrt(e.nodeIndices.length)-e.__gap},y._renderNodeIndicator=function(e,n,i,a,r){var l=!1,s=e.getOptions().__layout.markerGap,d=t.Agent.isRightToLeft(e.getCtx()),u=a*Math.sqrt(n.nodeIndices.length)-r,h=c.getCategoryNodeColor(e,n),C=t.ColorUtils.getContrastingTextColor(h),p=u/4,_=1,f=d?u/2-p:-u/2,S=c.getStyledCategoryIndicatorIcon(e,n);if(S){var y=p/(S[o.WIDTH]+2*s),b=u/(S[o.HEIGHT]+2*s);_=Math.min(y,b)}var E=c.getCategoryNodeIndicatorColor(e,n);if(E){C=t.ColorUtils.getContrastingTextColor(E);var x=new t.Rect(e.getCtx(),f,-u/2,p,u);x.setSolidFill(E),i.addChild(x),l=!0}if(S){var v=S[o.COLOR]?S[o.COLOR]:C,A=new t.SimpleMarker(e.getCtx(),S[o.SHAPE],(d?1:-1)*(u-p)/2,0,S[o.WIDTH]*_,S[o.HEIGHT]*_,S[o.BORDER_RADIUS]);S[o.BORDER_WIDTH]&&A.setSolidStroke(S[o.BORDER_COLOR],null,S[o.BORDER_WIDTH]),S[o.PATTERN]&&"none"!=S[o.PATTERN]?A.setFill(new t.PatternFill(S[o.PATTERN],v,h)):A.setSolidFill(v),A.setStyle(S.style).setClassName(S.className),i.addChild(A),g(e,n,A,o.INDICATOR_ICON),l=!0}return l},y._renderNodeCount=function(e,n,o,i,r,s){var h,C=e.getOptions().__layout.categoryNodeLabelGap,p=t.Agent.isRightToLeft(e.getCtx()),_=c.getFadedNodeAlpha(e),f=u.getHighlightedItems(e),S=d(e,n,"label");if(f){if(0==(h=n.highlightedCount))return S&&S.setTextString(""),void o.setAlpha(_)}else h=n.nodeIndices.length;var y=i*Math.sqrt(n.nodeIndices.length)-s,b=r?.75*y:y,E=(p?-1:1)*(y-b)/2,x=c.getCategoryNodeColor(e,n),v=t.ColorUtils.getContrastingTextColor(x),A=new t.Rectangle(0,0,b-2*C,y-2*C);S?S.setTextString(""+h):(S=a(e.getCtx(),""+h,c.getCategoryNodeLabelStyle(e),t.OutputText.H_ALIGN_CENTER,t.OutputText.V_ALIGN_CENTRAL),g(e,n,S,"label"));var I=t.TextUtils.getOptimalFontSize(S.getCtx(),S.getTextString(),S.getCSSStyle(),A);S.setFontSize(I),t.TextUtils.fitText(S,b-2*C,y-2*C,o)&&(l(S,E,0),S.setSolidFill(v))},y.animateUpdate=function(e,n,o){var i=r(n),a=r(o),l=o.getMatrix(),s=o.getParent();n.setAlpha(0),e.getNewNBox().addChild(o),o.setMatrix(i);var g=new t.AnimMoveTo(o.getCtx(),o,new t.Point(a.getTx(),a.getTy()),e.getAnimationDuration());t.Playable.appendOnEnd(g,function(){s.addChild(o),o.setMatrix(l)}),e.add(g,C.UPDATE)},y.animateDelete=function(e,n){var o=C.UPDATE,i=e.getOldNBox(),a=e.getNewNBox();y.isMaximizeEqual(i,a)&&y.isGroupingEqual(i,a)&&(o=C.DELETE);var l=new t.AnimScaleTo(a.getCtx(),n,new t.Point(.01,.01),e.getAnimationDuration());e.add(l,o);var s=new t.AnimFadeOut(a.getCtx(),n,e.getAnimationDuration());e.add(s,o),n.setMatrix(r(n)),a.getDeleteContainer().addChild(n)},y.animateInsert=function(e,n){var o=C.UPDATE,i=e.getOldNBox(),a=e.getNewNBox();y.isMaximizeEqual(i,a)&&y.isGroupingEqual(i,a)&&(o=C.INSERT),n.setScaleX(.01),n.setScaleY(.01);var r=new t.AnimScaleTo(a.getCtx(),n,new t.Point(1,1),e.getAnimationDuration());e.add(r,o);var l=new t.CustomAnimation(a.getCtx(),n,e.getAnimationDuration());l.getAnimator().addProp(t.Animator.TYPE_NUMBER,n,n.getAlpha,n.setAlpha,n.getAlpha()),e.add(l,o),n.setAlpha(0)},y.isGroupingEqual=function(e,t){var n=u.getGroupBehavior(e),o=u.getGroupBehavior(t),i=u.getNodeCount(e),a=u.getNodeCount(t),r=!1;if(n==o&&i==a){r=!0;for(var l=0;l<i;l++){if(u.getNodeGroupId(u.getNode(e,l))!=u.getNodeGroupId(u.getNode(t,l))){r=!1;break}}}return r},y.isMaximizeEqual=function(e,t){var n=u.getMaximizedRow(e),o=u.getMaximizedColumn(e),i=u.getMaximizedRow(t),a=u.getMaximizedColumn(t);return n==i&&o==a},y._addAccessibilityAttributes=function(e,n){if(n.setAriaRole("img"),!t.Agent.deferAriaCreation()){var i=n.getAriaLabel();i&&n.setAriaProperty(o.LABEL,i)}};var b=new Object;t.Obj.createSubclass(b,t.Obj),b.render=function(e,n,o,i){var a=b.getDrawerBounds(e,n,i);n.__drawerBounds=a,o.setTranslate(a.x,a.y);var r=new t.KeyboardFocusEffect(e.getCtx(),o,new t.Rectangle(-1,-1,a.w+2,a.h+2));g(e,n,r,"focusEffect"),b._renderBody(e,n,o),b._renderHeader(e,n,o),b._addAccessibilityAttributes(e,n,o)},b._renderHeader=function(e,n,i){var r=e.getOptions(),s=r.__layout.drawerButtonGap,g=r.__layout.drawerStartGap,h=r.__layout.drawerLabelGap,C=r.__layout.drawerCountHorizontalGap,p=r.__layout.drawerCountVerticalGap,_=r.__layout.drawerHeaderHeight,f=r.__layout.nodeIndicatorGap,S=r.__layout.nodeSwatchSize,y=t.Agent.isRightToLeft(e.getCtx()),b=u.getCategoryNode(e,n[o.ID]),E=b.nodeIndices.length,x=n.__drawerBounds,v=r._resources.close,A=v.width;if(x.w>A){var I=v.height,O=e.getCtx(),L=t.ToolkitUtils.getIconStyle(O,v.class),N=new t.IconButton(O,"borderless",{style:L,size:A},null,null,i.closeDrawer,i),m=y?Math.min((x.w-A)/2,s):Math.max((x.w-A)/2,x.w-s-A);N.setTranslate(m,_/2-I/2),i.addChild(N)}var T=c.getCategoryNodeColor(e,b),D=t.ColorUtils.getContrastingTextColor(T),R=c.getCategoryNodeIndicatorColor(e,b),w=R?t.ColorUtils.getContrastingTextColor(R):D,M=c.getStyledCategoryIndicatorIcon(e,b),B=S,H=1;if(M){var U=M[o.WIDTH];B=(H=S/M[o.HEIGHT])*U,w=M[o.COLOR]?M[o.COLOR]:w}var P,G=c.getDrawerCountBorderRadius(e),F=y?t.OutputText.H_ALIGN_RIGHT:t.OutputText.H_ALIGN_LEFT,W=a(e.getCtx(),""+E,c.getDrawerCountLabelStyle(e),F,t.OutputText.V_ALIGN_CENTRAL),k=W.getDimensions(),z=k.w,K=k.h+2*p,Y=M?B+2*f:R?S:0,j=z+2*C,V=Y+j;if(x.w-A-2*s-g>V){var X=t.PathUtils.roundedRectangle(0,0,V,K,G,G,G,G);(P=new t.Path(e.getCtx(),X)).setSolidFill(T),i.addChild(P);var q=y?j:0;if(Y>0){if(R){var Z=t.PathUtils.roundedRectangle(q,0,Y,K,y?0:G,y?G:0,y?G:0,y?0:G),J=new t.Path(e.getCtx(),Z);J.setSolidFill(R),P.addChild(J)}if(M){var Q=new t.SimpleMarker(e.getCtx(),M[o.SHAPE],q+Y/2,K/2,M[o.WIDTH]*H,M[o.HEIGHT]*H,M[o.BORDER_RADIUS]);M[o.BORDER_WIDTH]&&Q.setSolidStroke(M[o.BORDER_COLOR],null,M[o.BORDER_WIDTH]),M[o.PATTERN]&&"none"!=M[o.PATTERN]?Q.setFill(new t.PatternFill(M[o.PATTERN],w,R||T)):Q.setSolidFill(w),Q.setStyle(M.style).setClassName(M.className),P.addChild(Q)}}P.addChild(W),W.setSolidFill(D),l(W,y?j-C:Y+C,K/2)}var $=d(e,b).getLabel(),ee=a(e.getCtx(),$,c.getDrawerLabelStyle(e),F,t.OutputText.V_ALIGN_CENTRAL),te=0;if(t.TextUtils.fitText(ee,x.w-g-h-V-2*s-A,_,i)){var ne=y?x.w-g:g;l(ee,ne,_/2),te=ee.getDimensions().w+h}if(P){var oe=y?x.w-g-V-te:g+te;P.setTranslate(oe,(_-K)/2)}},b._renderBody=function(e,n,i){var a=e.getOptions(),r=parseInt(a.__layout.gridGap),l=a.__layout.drawerHeaderHeight,h=n.__drawerBounds,C=t.Agent.isRightToLeft(e.getCtx()),f=c.getDrawerBorderRadius(e),S=c.getDrawerBorderColor(e),y=t.PathUtils.roundedRectangle(0,0,h.w,h.h,f,f,f,f),E=new t.Path(e.getCtx(),y);s(E,c.getDrawerBackground(e)),E.setSolidStroke(S),E.setPixelHinting(!0),i.addChild(E),g(e,n,E,"background"),n.__childArea=new t.Rectangle(r,l+r,Math.max(h.w-2*r,0),Math.max(h.h-l-2*r,0));var x=new t.SimpleScrollableContainer(e.getCtx(),h.w,h.h-l);x.setTranslate(0,l),i.addChild(x),i.setChildContainer(x);var v=c.getFadedNodeAlpha(e),A=u.getHighlightedItems(e),I={};if(A)for(var O=0;O<A.length;O++)I[A[O][o.ID]]=!0;for(var L=b.calculateNodeOrders(e,n),N=p.calculateNodeDrawerLayout(e,n,L),m=N.indicatorSectionWidth+N.iconSectionWidth+N.labelSectionWidth+r,T=N.nodeHeight+r,D=d(e,n).getChildContainer(),R=0;R<L.length;R++){var w=L[R];if(0!=N.drawerLayout[o.COLUMNS]&&0!=N.drawerLayout[o.ROWS]){var M=new _(e,w),B=n.__childArea.x+(n.__childArea.w-N.drawerLayout[o.COLUMNS]*m+r)/2,H=r,U=R%N.drawerLayout[o.COLUMNS];C&&(U=N.drawerLayout[o.COLUMNS]-U-1);var P=Math.floor(R/N.drawerLayout[o.COLUMNS]);M.setTranslate(B+m*U,H+T*P),M.render(D.getScrollingPane(),N),A&&!I[w[o.ID]]&&M.setAlpha(v);var G=R>0?L[R-1]:null;if(G){var F=d(e,G);M.previousNavigable=F,F.nextNavigable=M}}}D.prepareContentPane()},b.calculateNodeOrders=function(e,t){var n=["normal"],i=u.getHighlightedItems(e),a={};if(i)for(var r=0;r<i.length;r++)a[i[r][o.ID]]=!0;var l=u.getSelectedItems(e),s={};if(l)for(r=0;r<l.length;r++)s[l[r]]=!0;i?n=l?["highlighted-selected","highlighted-unselected","unhighlighted-selected","unhighlighted-unselected"]:["highlighted-unselected","unhighlighted-unselected"]:l&&(n=["unhighlighted-selected","unhighlighted-unselected"]);for(var g=[],d=u.getCategoryNode(e,t[o.ID]),h=d.nodeIndices.length,c=0;c<n.length;c++)for(var C=0;C<h;C++){var p=u.getNode(e,d.nodeIndices[C]);("normal"==n[c]||"highlighted-selected"==n[c]&&a[p[o.ID]]&&s[p[o.ID]]||"highlighted-unselected"==n[c]&&a[p[o.ID]]&&!s[p[o.ID]]||"unhighlighted-selected"==n[c]&&!a[p[o.ID]]&&s[p[o.ID]]||"unhighlighted-unselected"==n[c]&&!a[p[o.ID]]&&!s[p[o.ID]])&&g.push(p)}return g},b.getDrawerBounds=function(e,n,i){var a=e.getOptions(),r=parseInt(a.__layout.gridGap),l=f.getCellLayout(e),s=new t.Rectangle(i.x+r,i.y+r,Math.max(i.w-2*r,0),Math.max(i.h-2*r,0));if(u.getGroupBehavior(e)==o.GROUP_BEHAVIOR_WITHIN_CELL){var g=parseInt(n.id.substring(0,n[o.ID].indexOf(":")));if(u.isCellMaximized(e,g)){var d=u.getCell(e,g),h=u.getRowIndex(e,d[o.ROW]),c=u.getColumnIndex(e,d[o.COLUMN]),C=f.getCellDimensions(e,h,c,i);s=new t.Rectangle(C.x+r,C.y+r+l.maximizedHeaderSize,Math.max(C.w-2*r,0),Math.max(C.h-l.maximizedHeaderSize-2*r,0))}}return s},b.animateUpdate=function(e,t,n){},b.animateDelete=function(e,n){var i=C.UPDATE,a=e.getNewNBox(),l=n.getData().__drawerBounds,s=n.getData()[o.ID],g=u.getCategoryNode(a,s);if(g){var h=y.getSideLength(g),c=h/l.w,p=h/l.h,_=d(a,g);if(_){var f=r(_),S=new t.Matrix(c,0,0,p,f.getTx()-h/2,f.getTy()-h/2),b=new t.CustomAnimation(a.getCtx(),n,e.getAnimationDuration());b.getAnimator().addProp(t.Animator.TYPE_MATRIX,n,n.getMatrix,n.setMatrix,S),e.add(b,i)}}a.getDeleteContainer().addChild(n);var E=new t.AnimFadeOut(a.getCtx(),n,e.getAnimationDuration());e.add(E,i)},b.animateInsert=function(e,n){var i=C.UPDATE,a=e.getNewNBox(),l=n.getData().__drawerBounds,s=n.getData()[o.ID],g=u.getCategoryNode(a,s);if(g){var h=y.getSideLength(g),c=h/l.w,p=h/l.h,_=d(a,g);if(_){var f=r(_),S=new t.Matrix(c,0,0,p,f.getTx()-h/2,f.getTy()-h/2),b=new t.CustomAnimation(a.getCtx(),n,e.getAnimationDuration());b.getAnimator().addProp(t.Animator.TYPE_MATRIX,n,n.getMatrix,n.setMatrix,n.getMatrix());var E=n.getParent();a.addChild(n),t.Playable.appendOnEnd(b,function(){E.addChild(n)}),n.setMatrix(S),e.add(b,i)}}n.setAlpha(0);var x=new t.AnimFadeIn(a.getCtx(),n,e.getAnimationDuration());e.add(x,i)},b._addAccessibilityAttributes=function(e,n,i){var a=t.Agent.isTouchDevice()?d(e,n,"background"):i;if(a.setAriaRole("img"),!t.Agent.deferAriaCreation()){var r=i.getAriaLabel();r&&a.setAriaProperty(o.LABEL,r)}};var E=function(){};t.Obj.createSubclass(E,t.Container),E.prototype.nboxType="drawer",E.newInstance=function(e,t){var n=new E;return n.Init(e,t),n},E.prototype.Init=function(e,t){E.superclass.Init.call(this,e.getCtx(),null,t.id+"_d"),this._nbox=e,this._data=t,this._data.__cacheId="drawer:"+this.getId(),this._nbox.registerObject(this)},E.prototype.getData=function(){return this._data},E.prototype.render=function(e,t){e.addChild(this),g(this._nbox,this._data,this),b.render(this._nbox,this._data,this,t),this._nbox.EventManager.associate(this,this)},E.prototype.getChildContainer=function(){return this._childContainer},E.prototype.setChildContainer=function(e){this._childContainer=e},E.prototype.isDoubleClickable=function(){return!0},E.prototype.handleDoubleClick=function(){this.closeDrawer()},E.prototype.closeDrawer=function(){u.fireOptionChangeEvent(this._nbox,o.DRAWER,null),this._nbox.processEvent(t.EventFactory.newRenderEvent())},E.prototype.animateUpdate=function(e,t){b.animateUpdate(e,t,this)},E.prototype.animateDelete=function(e,t){b.animateDelete(e,this)},E.prototype.animateInsert=function(e){b.animateInsert(e,this)},E.prototype.HandleKeyboardEvent=function(e){e.keyCode==t.KeyboardEvent.ESCAPE&&this.closeDrawer()},E.prototype.UpdateAccessibilityAttributes=function(){if(!t.Agent.deferAriaCreation()){var e=this.getAriaLabel();if(e)(t.Agent.isTouchDevice()?d(this._nbox,this.getData(),"background"):this).setAriaProperty("label",e)}},E.prototype.getAriaLabel=function(){var e=d(this._nbox,u.getCategoryNode(this._nbox,this.getData().id)),t=u.isDrawerSelected(this._nbox,e);return u.buildAriaDesc(this._nbox,this,e.getShortDesc(),t)},E.prototype.getKeyboardBoundingBox=function(e){return i(this,e)},E.prototype.getTargetElem=function(){return this.getElem()},E.prototype.showKeyboardFocusEffect=function(){this._isShowingKeyboardFocusEffect=!0,d(this._nbox,this.getData(),"focusEffect").show()},E.prototype.hideKeyboardFocusEffect=function(){this._isShowingKeyboardFocusEffect=!1,d(this._nbox,this.getData(),"focusEffect").hide()},E.prototype.isShowingKeyboardFocusEffect=function(){return this._isShowingKeyboardFocusEffect},E.prototype.getNextNavigable=function(e){var n=null;if(this._nbox.EventManager.getKeyboardHandler().isNavigationEvent(e))if(e.keyCode==t.KeyboardEvent.OPEN_BRACKET){var o=this.getChildContainer();o.getScrollingPane&&(o=o.getScrollingPane());n=u.getFirstNavigableNode(this._nbox,o)}else if(e.keyCode==t.KeyboardEvent.CLOSE_BRACKET){var i=u.getMaximizedCellIndex(this._nbox);n=d(this._nbox,u.getCell(this._nbox,i))}return n},E.prototype.getDisplayable=function(){return this},E.prototype.getKeyboardFocusDisplayable=function(){if(this._nbox.getOptions()._drawer)return this;var e=u.getCategoryNode(this._nbox,this.getData()[o.ID]);return e?d(this._nbox,e):null};var x=function(){};t.Obj.createSubclass(x,t.Container),x.prototype.nboxType="overflow",x.newInstance=function(e,t){var n=new x;return n.Init(e,t),n},x.prototype.Init=function(e,t){x.superclass.Init.call(this,e.getCtx()),this._nbox=e,this._cell=t,this._button},x.prototype.render=function(e,n,o){var i=this._nbox.getCtx(),a=this._nbox.getOptions()._resources.overflow,r=a.width,l=a.height,s=t.ToolkitUtils.getIconStyle(i,a.class),d=1;(n<r||o<l)&&(d=Math.min(n/r,o/l)),r*=d,l*=d;Math.max(r,l);var h=new t.Rect(i,0,0,n,o);this._button=new t.IconButton(i,"borderless",{style:s,size:Math.max(r,l),pos:{x:n/2,y:o/2}},h,null,this.HandleClick,this),u.isMaximizeEnabled(this._nbox)||this._button.setEnabled(!1),this.addChild(this._button);var c=new t.KeyboardFocusEffect(this._nbox.getCtx(),this,new t.Rectangle(-1,-1,n+2,o+2));g(this._nbox,this,c,"focusEffect"),e.addChild(this),this._addAccessibilityAttributes(),this._nbox.EventManager.associate(this,this)},x.prototype.getParentCell=function(){return this._cell},x.prototype.getButton=function(){return this._button},x.prototype.HandleClick=function(e){t.EventManager.consumeEvent(e),this._cell.handleDoubleClick(!0)},x.prototype.HandleKeyboardEvent=function(e){e.keyCode==t.KeyboardEvent.ENTER&&this._cell.handleDoubleClick()},x.prototype._addAccessibilityAttributes=function(){if(this.setAriaRole("button"),!t.Agent.deferAriaCreation()){var e=this.getAriaLabel();e&&this.setAriaProperty(o.LABEL,e)}},x.prototype.getDatatip=function(e,t,n){return this._nbox.getOptions().translations.labelAdditionalData},x.prototype.getAriaLabel=function(){return this.getDatatip()},x.prototype.getKeyboardBoundingBox=function(e){return i(this,e)},x.prototype.getTargetElem=function(){return this.getElem()},x.prototype.showKeyboardFocusEffect=function(){this._isShowingKeyboardFocusEffect=!0,d(this._nbox,this,"focusEffect").show()},x.prototype.hideKeyboardFocusEffect=function(){this._isShowingKeyboardFocusEffect=!1,d(this._nbox,this,"focusEffect").hide()},x.prototype.isShowingKeyboardFocusEffect=function(){return this._isShowingKeyboardFocusEffect},x.prototype.getNextNavigable=function(e){var n=null;return this._nbox.EventManager.getKeyboardHandler().isNavigationEvent(e)&&(n=e.keyCode==t.KeyboardEvent.CLOSE_BRACKET?this.getParentCell():u.getNextNavigableNode(this._nbox,this,e)),n},x.prototype.getDisplayable=function(){return this},x.prototype.getKeyboardFocusDisplayable=function(){var e=this.previousNavigable.getData(),t=u.getNode(this._nbox,u.getNodeIndex(this._nbox,e[o.ID]));return d(this._nbox,t).nextNavigable};var v=function(e){this.Init(e)};t.Obj.createSubclass(v,t.Automation),v.prototype.Init=function(e){this._nBox=e},v.prototype.GetSubIdForDomElement=function(e){for(var n=this._getParentObject(e,S),o=this._getParentObject(e,E);e&&"nbox"!==e.nboxType;){var i,a,r=this.getComponent();if("node"===e.nboxType){var l=u.getNodeIndex(r,e.getData().id);return i="node"+this._createBrackets([l]),this._createSubId(i,a)}if(n){var s=n.getData().row,g=n.getData().column,h=n.getChildContainer();if(h.getScrollingPane&&(h=h.getScrollingPane()),i="cell"+this._createBrackets([s,g]),"cell"===e.nboxType)return this._createSubId(i,a);if(e instanceof t.IconButton){if(this._getParentObject(e,x))return a="overflow",this._createSubId(i,a);if(e==d(r,n.getData(),"closeButton"))return a="closeButton",this._createSubId(i,a)}if("categoryNode"===e.nboxType){var c=e.getData().id;return a="groupNode",u.getNode(r,e.getData().nodeIndices[0]).groupCategory?a+=this._createBrackets([c]):a+=this._createBraces(c.split(";")),this._createSubId(i,a)}}if(o){if(i="dialog","drawer"===e.nboxType)return this._createSubId(i,a);if(e instanceof t.IconButton)return a="closeButton",this._createSubId(i,a)}if("categoryNode"===e.nboxType){c=e.getData().id;return i="groupNode",u.getNode(r,e.getData().nodeIndices[0]).groupCategory?i+=this._createBrackets([c]):i+=this._createBraces(c.split(";")),this._createSubId(i,a)}e=e.getParent()}return null},v.prototype._createSubId=function(e,t){var n=e;return t&&(n+="#"+t),n},v.prototype.getDomElementForSubId=function(e){var n=this.getComponent();if(e==t.Automation.TOOLTIP_SUBID)return this.GetTooltipElement(n);var o=this._parseSubId(e),i=o.component,a=o.action,r=null,l=null,s=null;if(0===i.lastIndexOf("node",0)){r=this._parseBrackets(i,!0);var g=u.getNode(n,r[0]);s=d(n,g)}if(0===i.lastIndexOf("cell",0)){r=this._parseBrackets(i);var h=this._getCellIndexFromValues(r);if(!(g=u.getCell(n,h)))return null;var c=d(n,g);if(a){if((l=c.getChildContainer()).getScrollingPane&&(l=l.getScrollingPane()),"overflow"==a)for(var C=l.getNumChildren();C>0;C--)if("overflow"===l.getChildAt(C-1).nboxType){s=l.getChildAt(C-1).getButton();break}if("closeButton"==a&&(s=d(n,c.getData(),"closeButton")),0===a.lastIndexOf("node",0)){if((E=(r=this._parseBrackets(a,!0))[0])<0)return null;for(var p=u.getFirstNavigableNode(n,l),_=0;"node"===p.nboxType;){if(_==E){s=p;break}p=p.nextNavigable,_++}}if(0===a.lastIndexOf("groupNode",0)){a.indexOf("{")>-1?r=this._parseBraces(a):f=a.substring(a.indexOf("[")+1,a.indexOf("]"));for(C=0;C<l.getNumChildren();C++)if("categoryNode"===(p=l.getChildAt(C)).nboxType){if(S=p.getData().id,r&&this._compareCategories(r,S.split(";"))){s=p;break}if(f&&f==S){s=p;break}}}}else s=c}else if(0===i.lastIndexOf("groupNode",0)){var f,S;l=n.getChildContainer(),i.indexOf("{")>-1?r=this._parseBraces(i):f=i.substring(i.indexOf("[")+1,i.indexOf("]"));for(C=0;C<l.getNumChildren();C++)if("categoryNode"===(p=l.getChildAt(C)).nboxType){if(S=p.getData().id,r&&this._compareCategories(r,S.split(";"))){s=p;break}if(f&&f==S){s=p;break}}}else if("dialog"===i&&(l=n.getChildContainer()))for(C=0;C<l.getNumChildren();C++)if("drawer"===l.getChildAt(C).nboxType){var y=l.getChildAt(C);if(a){if("closeButton"==a)for(var b=0;b<y.getNumChildren();b++)y.getChildAt(b)instanceof t.IconButton&&(s=y.getChildAt(b));if(0===a.lastIndexOf("node",0)){var E,x=y.getChildContainer().getScrollingPane();if((E=(r=this._parseBrackets(a,!0))[0])<0)return null;for(p=u.getFirstNavigableNode(n,x),_=0;"node"===p.nboxType;){if(_==E){s=p;break}p=p.nextNavigable,_++}}}else s=y;break}return s?s.getElem():null},v.prototype._parseSubId=function(e){var t=null,n=null,o=e.indexOf("#");return-1!==o?(t=e.substring(0,o),n=e.substring(o+1)):t=e,{component:t,action:n}},v.prototype.getComponent=function(){return this._nBox},v.prototype._parseBrackets=function(e,t){var n=e.substring(e.indexOf("[")+1,e.indexOf("]")).split(",");if(t)for(var o=0;o<n.length;o++)n[o]=parseInt(n[o]);return n.length>0?n:null},v.prototype._createBrackets=function(e){return e.length>0?"["+e.join(",")+"]":""},v.prototype._parseBraces=function(e){return e.substring(e.indexOf("{")+1,e.lastIndexOf("}")).split(",")},v.prototype._createBraces=function(e){for(var t="{",n=0;n<e.length;n++)t+=e[n].trim()+",";return t.substring(0,t.length-1)+"}"},v.prototype._compareCategories=function(e,t){if(e.length!=t.length)return!1;e.sort(),t.sort();for(var n=0;n<e.length;n++)if(e[n].trim()!=t[n].trim())return!1;return!0},v.prototype._getCellIndexFromValues=function(e){var t=this.getComponent();if(u.hasValidData(t)){var n=u.getColumnCount(t),o=u.getRowIndex(t,e[0]),i=u.getColumnIndex(t,e[1]);if(null!=i&&null!=o)return i+n*o}return null},v.prototype._getParentObject=function(e,t){for(var n=e;n;){if(n instanceof t)return n;n=n.getParent()}return null},v.prototype.getData=function(e,t){if(this._nBox&&u.hasValidData(this._nBox))if("rowsTitle"==e){if(this._nBox.getOptions().rowsTitle)return this._nBox.getOptions().rowsTitle}else if("rowCount"==e){var n=this._nBox.getOptions().rows;if(n)return n.length}else if("row"==e){if(u.getRowIndex(this._nBox,t)>=0)return(i={}).label=u.getRowLabel(this._nBox,t),i}else if("columnsTitle"==e){if(this._nBox.getOptions().columnsTitle)return this._nBox.getOptions().columnsTitle}else if("columnCount"==e){var o=this._nBox.getOptions().columns;if(o)return o.length}else if("column"==e){var i;if(u.getColumnIndex(this._nBox,t)>=0)return(i={}).label=u.getColumnLabel(this._nBox,t),i}else if("groupBehavior"==e)return u.getGroupBehavior(this._nBox);return null},v.prototype.getGroupNode=function(e){if(e&&u.getGrouping(this._nBox)&&u.getGroupBehavior(this._nBox)==o.GROUP_BEHAVIOR_ACROSS_CELLS){if("string"==typeof e)return this._getGroupNodeData(e);var t="";for(var n in e)e[n]?t+=n+":"+e[n]+";":t+=n+";";return this._getGroupNodeData(t.substring(0,t.length-1))}return null},v.prototype._getGroupNodeData=function(e){var t=u.getCategoryNode(this._nBox,e);if(t){var n=d(this._nBox,t);if(n){var o={};o.selected=n.isSelected(),o.color=c.getCategoryNodeColor(this._nBox,t),o.indicatorColor=c.getCategoryNodeIndicatorColor(this._nBox,t),o.tooltip=n.getShortDesc(),o.size=t.nodeIndices?t.nodeIndices.length:-1;var i=d(this._nBox,t,"indicatorIcon");return o.indicatorIcon=this._getMarkerData(i),o}}return null},v.prototype.getCell=function(e,t){if(this._nBox&&u.hasValidData(this._nBox)){var n=u.getCellByRowColumn(this._nBox,e,t);if(n){var o=n.getCellIndex(),i={};return i.label=n.getLabel(),i.background=n.getBackground(),i.getNodeCount=function(){return n.getNodeCount()},i.rowValue=e,i.columnValue=t,i.cellIndex=o,i}}return null},v.prototype.getCellNode=function(e,t){if(this._nBox&&u.hasValidData(this._nBox)&&!u.getGrouping(this._nBox)){var n=u.getCellByRowColumn(this._nBox,e.rowValue,e.columnValue).getNode(t);return this._getNode(n)}return null},v.prototype.getNode=function(e){var t=u.getNode(this._nBox,e);return this._getNode(t)},v.prototype._getNode=function(e){if(e){var t=d(this._nBox,e);if(t){var n={};n.selected=t.isSelected(),n.tooltip=t.getShortDesc(),n.color=c.getNodeColor(this._nBox,e),n.indicatorColor=c.getNodeIndicatorColor(this._nBox,e),e.label&&(n.label=e.label),e.secondaryLabel&&(n.secondaryLabel=e.secondaryLabel);var o=d(this._nBox,e,"icon");n.icon=this._getMarkerData(o);var i=d(this._nBox,e,"indicatorIcon");return n.indicatorIcon=this._getMarkerData(i),n}}return null},v.prototype.getCellGroupNode=function(e,t){if(t&&u.getGrouping(this._nBox)&&u.getGroupBehavior(this._nBox)==o.GROUP_BEHAVIOR_WITHIN_CELL){if("string"==typeof t)return this._getGroupNodeData(e.cellIndex+":"+t);var n=e.cellIndex+":";for(var i in t)t[i]?n+=i+":"+t[i]+";":n+=i+";";return this._getGroupNodeData(n.substring(0,n.length-1))}return null},v.prototype._getMarkerData=function(e){if(e){var n={};return n.shape=e instanceof t.SimpleMarker?e.getType():"none",e.getFill()&&(n.color=e.getFill().getColor()),n}return null},v.prototype.getDialog=function(){var e=u.getDrawer(this._nBox);if(e){var t=u.getCategoryNode(this._nBox,e.id);if(t){var n=d(this._nBox,t),o={};o.label=n.getLabel(),o.getNodeCount=function(){return t.nodeIndices?t.nodeIndices.length:-1};for(var i={},a=t.id.split(";"),r=0;r<a.length;r++){var l=a[r].split(":");l&&2==l.length&&(i[l[0]]=l[1])}return o.groupInfo=i,o}}return null},v.prototype.getDialogNode=function(e){var t=u.getDrawer(this._nBox);if(t){var n=u.getCategoryNode(this._nBox,t.id);if(n&&n.nodeIndices&&null!=n.nodeIndices[e]){var o=u.getNode(this._nBox,n.nodeIndices[e]);return this._getNode(o)}}return null},v.prototype.getNodeIdFromIndex=function(e){return u.getNode(this._nBox,e).id},v.prototype.getNodeIndexFromId=function(e){return u.getNodeIndex(this._nBox,e)};var A=function(e){this.Init({alta:A.SKIN_ALTA},e)};t.Obj.createSubclass(A,t.BaseComponentDefaults),A.SKIN_ALTA={skin:t.CSSStyle.SKIN_ALTA,selectionMode:"multiple",animationOnDataChange:"none",animationOnDisplay:"none",cellMaximize:"on",cellContent:"auto",groupBehavior:"withinCell",otherColor:"#636363",otherThreshold:0,hoverBehavior:"none",highlightMatch:"all",highlightedCategories:[],touchResponse:"auto",_statusMessageStyle:new t.CSSStyle,styleDefaults:{animationDuration:500,hoverBehaviorDelay:200,columnLabelStyle:new t.CSSStyle,rowLabelStyle:new t.CSSStyle,columnsTitleStyle:new t.CSSStyle,rowsTitleStyle:new t.CSSStyle,cellDefaults:{_style:new t.CSSStyle,_borderRadius:0,_maximizedStyle:new t.CSSStyle,_minimizedStyle:new t.CSSStyle,labelStyle:new t.CSSStyle,_labelMinimizedStyle:new t.CSSStyle,_labelMaximizedStyle:new t.CSSStyle,countLabelStyle:new t.CSSStyle,bodyCountLabelStyle:new t.CSSStyle,dropTargetStyle:new t.CSSStyle("background-color:rgba(217, 244, 250, .75);border-color:#ccf6ff"),showCount:"auto",showMaximize:"on",_panelShadow:"none"},__scrollbar:{scrollbarBackground:"linear-gradient(bottom, #dce2e7 0%, #f8f8f8 8%)",scrollbarBorderColor:"#dce2e7",scrollbarHandleColor:"#abb0b4",scrollbarHandleHoverColor:"#333333",scrollbarHandleActiveColor:"#333333"},_drawerDefaults:{background:"#e9e9e9",borderColor:"#bcc7d2",borderRadius:1,headerBackground:"linear-gradient(to bottom, #f5f5f5 0%, #f0f0f0 100%)",labelStyle:new t.CSSStyle,countLabelStyle:new t.CSSStyle,countBorderRadius:1},nodeDefaults:{color:"#FFFFFF",labelStyle:new t.CSSStyle,secondaryLabelStyle:new t.CSSStyle,alphaFade:.2,_borderRadius:1,hoverColor:"#FFFFFF",selectionColor:"#000000",iconDefaults:{preferredSize:19,preferredSizeTouch:34,shapePaddingRatio:.15,sourcePaddingRatio:0,opacity:1,pattern:"none",borderColor:"#000000",borderWidth:0,borderRadius:0,shape:t.SimpleMarker.CIRCLE,background:"neutral",backgroundSize:196},indicatorIconDefaults:{width:10,height:10,opacity:1,pattern:"none",borderColor:"#000000",borderWidth:0,borderRadius:0,shape:t.SimpleMarker.CIRCLE}},_categoryNodeDefaults:{labelStyle:new t.CSSStyle}},__layout:{componentGap:8,titleGap:4,titleComponentGap:4,nodeLabelOnlyStartLabelGap:5,nodeStartLabelGap:3,nodeEndLabelGap:5,nodeSingleLabelGap:2,nodeDualLabelGap:2,nodeInterLabelGap:0,nodeIndicatorGap:3,nodeSwatchSize:10,categoryNodeLabelGap:5,minimumCellSize:34,cellGap:3,gridGap:6,cellInnerPadding:6,cellLabelGap:6,cellCloseGap:6,countLabelGap:10,markerGap:3,minimumLabelWidth:55,maximumLabelWidth:148,drawerButtonGap:6,drawerCountHorizontalGap:5,drawerCountVerticalGap:3,drawerStartGap:6,drawerLabelGap:6,drawerHeaderHeight:31}};var I=function(e,t){I.superclass.constructor.call(this,e,t),this._nbox=t};t.Obj.createSubclass(I,t.CategoryRolloverHandler),I.prototype.GetRolloverCallback=function(e,t,n,o){return function(){this.SetHighlightMode(!0),this._nbox.processEvent(e),this._callback&&this._callback.call(this._callbackObj,e,this._source)}.bind(this)},I.prototype.GetRolloutCallback=function(e,t,n,o){return function(){this.SetHighlightModeTimeout(),this._nbox.processEvent(e),this._callback&&this._callback.call(this._callbackObj,e,this._source)}.bind(this)};var O=function(e){this.Init(e.getCtx(),e.processEvent,e,e),this._nbox=e};t.Obj.createSubclass(O,t.EventManager),O.prototype.OnClickInternal=function(e){var t=this.GetLogicalObject(e.target);"categoryNode"!==t.nboxType||t.isSelectable()||t.openDrawer()},O.prototype.OnDblClickInternal=function(e){this._handleDblClick(e.target)},O.prototype.HandleTouchDblClickInternal=function(e){this._handleDblClick(e.target)},O.prototype.HandleTouchClickInternal=function(e){var t=this.GetLogicalObject(e.target);"categoryNode"!==t.nboxType||t.isSelectable()||t.openDrawer()},O.prototype._handleDblClick=function(e){var t=this.GetLogicalObject(e);t&&t.isDoubleClickable&&t.isDoubleClickable()&&t.handleDoubleClick&&t.handleDoubleClick()},O.prototype.ProcessKeyboardEvent=function(e){var n=!1,o=e.keyCode,i=this.getFocus();return o==t.KeyboardEvent.ENTER||o==t.KeyboardEvent.ESCAPE?(i&&i.HandleKeyboardEvent&&i.HandleKeyboardEvent(e),i=null):e.keyCode==t.KeyboardEvent.SPACE&&e.ctrlKey&&"categoryNode"!==i.nboxType&&"node"!==i.nboxType||(n=O.superclass.ProcessKeyboardEvent.call(this,e)),n},O.prototype.ProcessRolloverEvent=function(e,n,o){var i=this._nbox.getOptions();if("dim"==i.hoverBehavior){var a=n.getCategories?n.getCategories():[];i.highlightedCategories=o?a.slice():null;var r=t.EventFactory.newCategoryHighlightEvent(i.highlightedCategories,o),l=t.CSSStyle.getTimeMilliseconds(i.styleDefaults.hoverBehaviorDelay);this.RolloverHandler.processEvent(r,this._nbox.getNodeDisplayables(),l,"any"==i.highlightMatch)}},O.prototype.CreateCategoryRolloverHandler=function(e,t){return new I(e,t)},O.prototype.GetTouchResponse=function(){var e=this._nbox.getOptions(),n=u.getDrawer(this._nbox),o=u.getCell(this._nbox,u.getMaximizedCellIndex(this._nbox));return n&&d(this._nbox,n).getChildContainer().hasScrollingContent()||o&&d(this._nbox,o).getChildContainer().hasScrollingContent()?t.EventManager.TOUCH_RESPONSE_TOUCH_HOLD:e.touchResponse===t.EventManager.TOUCH_RESPONSE_TOUCH_START?t.EventManager.TOUCH_RESPONSE_TOUCH_START:t.EventManager.TOUCH_RESPONSE_AUTO};var L=function(){};t.Obj.createSubclass(L,t.Container),L.prototype.nboxType="categoryNode",L.newInstance=function(e,t){var n=new L;return n.Init(e,t),n},L.prototype.Init=function(e,n){L.superclass.Init.call(this,e.getCtx(),null,isNaN(n[o.CELL])?n[o.ID]:n[o.CELL]+":"+n[o.ID]),this._nbox=e,this._data=n,this._data.__cacheId="categoryNode:"+this.getId(),this._nbox.registerObject(this),this.setCursor(t.SelectionEffectUtils.getSelectingCursor()),this._maxAlpha=1},L.prototype.getData=function(){return this._data},L.prototype.render=function(e,t,n){y.render(this._nbox,this._data,this,t,n),e.addChild(this),g(this._nbox,this._data,this),this._nbox.EventManager.associate(this,this)},L.prototype.isSelectable=function(){return"multiple"==this._nbox.getOptions()[o.SELECTION_MODE]},L.prototype.isSelected=function(){return this.getSelectionShape().isSelected()},L.prototype.setSelected=function(e){this.getSelectionShape().setSelected(e),this.UpdateAccessibilityAttributes()},L.prototype.showHoverEffect=function(){this.getSelectionShape().showHoverEffect()},L.prototype.hideHoverEffect=function(){this.getSelectionShape().hideHoverEffect()},L.prototype.setSelectionShape=function(e){this._selectionShape=e},L.prototype.getSelectionShape=function(){return this._selectionShape},L.prototype.getLabel=function(){var e=n.getTranslatedString("oj-converter.plural-separator");return u.getCategoryNodeLabels(this._nbox,this._data).join(e)},L.prototype.getDatatip=function(e,n,o){var i=this._nbox.getOptions().tooltip,a=i?i.renderer:null;if(a){var r={id:this._data.id,color:c.getCategoryNodeColor(this._nbox,this._data),indicatorColor:c.getCategoryNodeIndicatorColor(this._nbox,this._data),size:this._data.nodeIndices.length};return"withinCell"==u.getGroupBehavior(this._nbox)&&(r.row=u.getCell(this._nbox,this._data.cell).row,r.column=u.getCell(this._nbox,this._data.cell).column),this._nbox.getCtx().getTooltipManager().getCustomTooltip(a,r)}var l=this._nbox.getOptions().translations;return this.getShortDesc()+"\n"+t.ResourceUtils.format(l.labelAndValue,[l.labelSize,this._data.nodeIndices.length])},L.prototype.getShortDesc=function(){return u.getCategoryNodeLabels(this._nbox,this._data).join("\n")},L.prototype.getDatatipColor=function(){return c.getCategoryNodeColor(this._nbox,this._data)},L.prototype.setMaxAlpha=function(e){this._maxAlpha=e,this.setAlpha(this.getAlpha())},L.prototype.getMaxAlpha=function(){return this._maxAlpha},L.prototype.setAlpha=function(e){L.superclass.setAlpha.call(this,Math.min(e,this._maxAlpha))},L.prototype.isDoubleClickable=function(){return this.isSelectable()},L.prototype.handleDoubleClick=function(){this.isSelectable()&&this.openDrawer()},L.prototype.openDrawer=function(){u.fireOptionChangeEvent(this._nbox,o.DRAWER,{id:this.getId()}),this._nbox.processEvent(t.EventFactory.newRenderEvent())},L.prototype.animateUpdate=function(e,t){y.animateUpdate(e,t,this)},L.prototype.animateDelete=function(e,t){y.animateDelete(e,this)},L.prototype.animateInsert=function(e){y.animateInsert(e,this)},L.prototype.isDragAvailable=function(e){return this._nbox.__isDragAvailable(e)},L.prototype.getDragTransferable=function(e,t){return this._nbox.__getDragTransferable(this)},L.prototype.getDragFeedback=function(e,t){return this._nbox.__getDragFeedback()},L.prototype.HandleKeyboardEvent=function(e){if(e.keyCode==t.KeyboardEvent.ENTER)this.openDrawer();else if(e.keyCode==t.KeyboardEvent.ESCAPE&&u.getGroupBehavior(this._nbox)==o.GROUP_BEHAVIOR_WITHIN_CELL){var n=u.getCell(this._nbox,this._data.cell);d(this._nbox,n).HandleKeyboardEvent(e)}},L.prototype.UpdateAccessibilityAttributes=function(){if(!t.Agent.deferAriaCreation()){var e=this.getAriaLabel();e&&this.setAriaProperty(o.LABEL,e)}},L.prototype.getAriaLabel=function(){return u.buildAriaDesc(this._nbox,this,this.getShortDesc(),this.isSelected())},L.prototype.getCategories=function(){var e=this.getData()[o.CATEGORIES];if(!e){var t=function(e,t){return e.filter(function(e){return t.indexOf(e)>-1})},n=this.getData().nodeIndices;e=null;for(var i=0;i<n.length;i++){var a=u.getNode(this._nbox,n[i])[o.CATEGORIES];if(!a){e=[];break}e=null==e?a:t(e,a)}this.getData()[o.CATEGORIES]=e}return e},L.prototype.getKeyboardBoundingBox=function(e){return i(this,e)},L.prototype.getTargetElem=function(){return this.getElem()},L.prototype.showKeyboardFocusEffect=function(){this._isShowingKeyboardFocusEffect=!0,this.showHoverEffect()},L.prototype.hideKeyboardFocusEffect=function(){this._isShowingKeyboardFocusEffect=!1,this.hideHoverEffect()},L.prototype.isShowingKeyboardFocusEffect=function(){return this._isShowingKeyboardFocusEffect},L.prototype.getNextNavigable=function(e){var n=null;if(e.keyCode==t.KeyboardEvent.SPACE&&e.ctrlKey)return this;if(e.keyCode==t.KeyboardEvent.CLOSE_BRACKET&&u.getGroupBehavior(this._nbox)==o.GROUP_BEHAVIOR_WITHIN_CELL){var i=u.getCell(this._nbox,this.getData()[o.CELL]);n=d(this._nbox,i)}else if(e.keyCode==t.KeyboardEvent.CLOSE_BRACKET||e.keyCode==t.KeyboardEvent.OPEN_BRACKET)n=this;else if(this._nbox.EventManager.getKeyboardHandler().isNavigationEvent(e))if(u.getGroupBehavior(this._nbox)==o.GROUP_BEHAVIOR_ACROSS_CELLS){var a=this._nbox.getOptions().__groups,r=[];for(var l in a){var s=d(this._nbox,a[l]);s&&r.push(s)}n=h.getNextNavigableCategoryNode(this,e,r)}else{for(var g=this.getParent(),c=[],C=0;C<g.getNumChildren();C++)"categoryNode"===g.getChildAt(C).nboxType&&c.push(g.getChildAt(C));n=h.getNextNavigableCategoryNode(this,e,c)}else e.type==t.MouseEvent.CLICK&&(n=this);return n},L.prototype.getDisplayable=function(){return this},L.prototype.getKeyboardFocusDisplayable=function(){var e=u.getDrawer(this._nbox);if(e)return d(this._nbox,e);if(u.getGrouping(this._nbox)){var t=u.getCategoryNode(this._nbox,this.getId());if(t)return d(this._nbox,t)}return null};var N={create:function(e,t){return{x:e,y:t}},add:function(e,t){return N.create(e.x+t.x,e.y+t.y)},subtract:function(e,t){return N.create(e.x-t.x,e.y-t.y)},scale:function(e,t){return N.create(e.x*t,e.y*t)},getMagnitude:function(e){return Math.sqrt(e.x*e.x+e.y*e.y)}},m=new Object;t.Obj.createSubclass(m,t.Obj),m.render=function(e,t,n){m._renderBackground(e,t,n),u.hasValidData(e)?(m._adjustAvailSpace(n),m._renderTitles(e,t,n),m._adjustAvailSpace(n),m._renderCells(e,t,n),m._renderNodes(e,t,n),m._renderInitialSelection(e)):m._renderEmptyText(e,t,n)},m._renderBackground=function(e,n,o){var i=new t.Rect(e.getCtx(),o.x,o.y,o.w,o.h);i.setInvisibleFill(),n.addChild(i);var a=new t.ClipPath;a.addRect(o.x,o.y,o.w,o.h),n.setClipPath(a)},m._renderTitles=function(e,n,i){var r=e.getOptions(),s=u.getColumnCount(e),d=u.getRowCount(e),h=r.__layout.componentGap,C=r.__layout.titleGap,p=r.__layout.titleComponentGap,_=t.Agent.isRightToLeft(e.getCtx());i.x+=h,i.y+=h,i.w-=2*h,i.h-=2*h;var S=u.getMaximizedColumn(e),y=S?u.getColumnIndex(e,S):-1,b=u.getMaximizedRow(e),E=b?u.getRowIndex(e,b):-1,x=null,v=null,A=[],I=[],O=0,L=0,N=0,m=0,T=0,D=0,R=0,w=0;r[o.COLUMNS_TITLE]&&(x=a(e.getCtx(),r[o.COLUMNS_TITLE],r[o.STYLE_DEFAULTS][o.COLUMNS_TITLE_STYLE],t.OutputText.H_ALIGN_CENTER,t.OutputText.V_ALIGN_MIDDLE),n.addChild(x),O=x.getDimensions().h),r[o.ROWS_TITLE]&&(v=a(e.getCtx(),r[o.ROWS_TITLE],r[o.STYLE_DEFAULTS][o.ROWS_TITLE_STYLE],t.OutputText.H_ALIGN_CENTER,t.OutputText.V_ALIGN_MIDDLE),n.addChild(v),L=v.getDimensions().h);for(var M=0;M<s;M++){var B=u.getColumn(e,M);if(B[o.LABEL]){var H=a(e.getCtx(),B[o.LABEL],c.getColumnLabelStyle(e,M),t.OutputText.H_ALIGN_CENTER,t.OutputText.V_ALIGN_MIDDLE);T=Math.max(T,H.getDimensions().h),S&&S!=B[o.ID]||(A[M]=H,n.addChild(A[M]))}}for(M=0;M<d;M++){var U=u.getRow(e,M);if(U[o.LABEL]){var P=a(e.getCtx(),U[o.LABEL],c.getRowLabelStyle(e,M),t.OutputText.H_ALIGN_CENTER,t.OutputText.V_ALIGN_MIDDLE);D=Math.max(D,P.getDimensions().h),b&&b!=U[o.ID]||(I[M]=P,n.addChild(I[M]))}}(L||D)&&(R=p,L&&D&&(N=C)),(O||T)&&(w=p,O&&T&&(m=C));var G=L+N+D+R,F=O+m+T+w;i.x+=_?0:G,i.w-=G,i.h-=F,x&&t.TextUtils.fitText(x,i.w,O,n)&&(l(x,i.x+i.w/2,i.y+i.h+F-O/2),g(e,e.getOptions(),x,o.COLUMNS_TITLE)),v&&t.TextUtils.fitText(v,i.h,L,n)&&(l(v,i.x+(_?i.w:0)+(_?1:-1)*(G-L/2),i.y+i.h/2,_?Math.PI/2:-Math.PI/2),g(e,e.getOptions(),v,o.ROWS_TITLE));for(M=0;M<s;M++)if(A[M]){var W=f.getCellDimensions(e,-1==E?0:E,M,i);t.TextUtils.fitText(A[M],W.w,T,n)&&(l(A[M],W.x+W.w/2,i.y+i.h+w+T/2),g(e,u.getColumn(e,M),A[M],o.LABEL))}for(M=0;M<d;M++)if(I[M]){W=f.getCellDimensions(e,M,-1==y?0:y,i);t.TextUtils.fitText(I[M],W.h,D,n)&&(l(I[M],i.x+(_?i.w:0)+(_?1:-1)*(R+D/2),W.y+W.h/2,_?Math.PI/2:-Math.PI/2),g(e,u.getRow(e,M),I[M],o.LABEL))}},m._renderCells=function(e,t,n){for(var o=u.getRowCount(e),i=u.getColumnCount(e),a=0;a<o;a++)for(var r=0;r<i;r++){var l=u.getCell(e,a*i+r);S.newInstance(e,l).render(t,n)}},m.calculateNodeOrders=function(e){var t=["normal"],n=u.getHighlightedItems(e),i={};if(n)for(var a=0;a<n.length;a++)i[n[a][o.ID]]=!0;var r=u.getSelectedItems(e),l={};if(r)for(a=0;a<r.length;a++)l[r[a]]=!0;n?t=r?["highlighted-selected","highlighted-unselected","unhighlighted-selected","unhighlighted-unselected"]:["highlighted-unselected","unhighlighted-unselected"]:r&&(t=["unhighlighted-selected","unhighlighted-unselected"]);for(var s={},g=u.getNodeCount(e),d=0;d<t.length;d++)for(var h=0;h<g;h++){var c=u.getNode(e,h);if(!u.isNodeHidden(e,c)&&("normal"==t[d]||"highlighted-selected"==t[d]&&i[c[o.ID]]&&l[c[o.ID]]||"highlighted-unselected"==t[d]&&i[c[o.ID]]&&!l[c[o.ID]]||"unhighlighted-selected"==t[d]&&!i[c[o.ID]]&&l[c[o.ID]]||"unhighlighted-unselected"==t[d]&&!i[c[o.ID]]&&!l[c[o.ID]])){var C=u.getCellIndex(e,c);u.isCellMinimized(e,C)||(s[C]||(s[C]=[]),s[C].push(c))}}return s},m._renderNodes=function(e,t,n){if(u.getNodeCount(e)>0){if("counts"==u.getCellContent(e)){for(var o=u.getRowCount(e),i=u.getColumnCount(e),a=[],r=0;r<o;r++)for(var l=0;l<i;l++)a.push(r*i+l);return void f.renderBodyCountLabels(e,a)}u.getGrouping(e)?(m._renderCategoryNodes(e,t,n),m._renderDrawer(e,t,n)):m._renderIndividualNodes(e,t,n),e.setNodeClipPath(null),e.setNodeIconClipPath(null)}},m._renderIndividualNodes=function(e,n,i){var a=e.getOptions(),r=parseInt(a.__layout.gridGap),l=t.Agent.isRightToLeft(e.getCtx()),s=c.getFadedNodeAlpha(e),h=u.getHighlightedItems(e),C={};if(h)for(var S=0;S<h.length;S++)C[h[S][o.ID]]=!0;for(var y=m.calculateNodeOrders(e),b=p.calculateNodeLayout(e,y),E=b.indicatorSectionWidth+b.iconSectionWidth+b.labelSectionWidth+r,v=b.nodeHeight+r,A=u.getRowCount(e),I=u.getColumnCount(e),O=0;O<A;O++)for(var L=0;L<I;L++){var N=O*I+L,T=y[N];if(T&&T.length){var D=u.getCell(e,N),R=(X=b.cellLayouts[N]).cellRows,w=X.cellColumns;if(!(0==R||0==w||1==R&&1==w&&X.overflow))for(var M=R*w-(X.overflow?1:0),B=0;B<T.length;B++){var H=T[B];if(M<0||B<M){var U=(j=d(e,D).getChildContainer())instanceof t.SimpleScrollableContainer,P=new _(e,H),G=D.__childArea.x+(D.__childArea.w-X.cellColumns*E+r)/2,F=U?r:D.__childArea.y,W=B%w;l&&(W=w-W-1);var k=Math.floor(B/w);P.setTranslate(G+E*W,F+v*k),P.render(U?j.getScrollingPane():j,b),h&&!C[H[o.ID]]&&P.setAlpha(s);var z=B>0?T[B-1]:null;if(z){var K=d(e,z);P.previousNavigable=K,K.nextNavigable=P}}}}}A=u.getRowCount(e),I=u.getColumnCount(e);var Y=[];for(O=0;O<A;O++)for(L=0;L<I;L++){var j,V=O*I+L;if(!u.isCellMinimized(e,V)){var X,q=u.getCell(e,V);D=d(e,q);if((X=b.cellLayouts[V]).overflow){R=X.cellRows,w=X.cellColumns;if(0==R||0==w||1==R&&1==w&&X.overflow)Y.push(V);else{var Z=x.newInstance(e,D);(K=u.getLastNavigableNode(e,D.getChildContainer()))&&"node"===K.nboxType&&(Z.previousNavigable=K,K.nextNavigable=Z),g(e,Z,Z),g(e,q,Z,"overflow");G=q.__childArea.x+(q.__childArea.w-X.cellColumns*E+r)/2,F=q.__childArea.y,W=X.cellColumns-1;l&&(W=0);k=X.cellRows-1;Z.setTranslate(G+E*W,F+v*k),Z.render(D.getChildContainer(),E-r,v-r)}}}if(u.isCellMaximized(e,V))(j=d(e,u.getCell(e,V)).getChildContainer()).prepareContentPane()}Y.length>0&&f.renderBodyCountLabels(e,Y)},m._renderCategoryNodes=function(e,n,i){var a,r={},l=u.getNodeCount(e),s=u.getGroupBehavior(e),g=t.Agent.isRightToLeft(e.getCtx()),h=u.getHighlightedItems(e),c={};if(h)for(var C=0;C<h.length;C++)c[h[C][o.ID]]=!0;for(var p=0;p<l;p++){var _=u.getNode(e,p);if(!u.isNodeHidden(e,_)){var f=r;if(s==o.GROUP_BEHAVIOR_WITHIN_CELL){var S=u.getCellIndex(e,_)+"";(f=r[S])||(f={},r[S]=f)}(E=f[S=u.getNodeGroupId(_)])||((E={})[o.ID]=S,s==o.GROUP_BEHAVIOR_WITHIN_CELL&&(E[o.CELL]=u.getCellIndex(e,_)),E.nodeIndices=[],E.highlightedCount=0,f[S]=E),E.nodeIndices.push(p),c[u.getNode(e,p)[o.ID]]&&E.highlightedCount++}}if(s==o.GROUP_BEHAVIOR_WITHIN_CELL)for(var y in a={},r)a[y]=m._processOtherThreshold(e,r[y]);else a=m._processOtherThreshold(e,r);r=a;if(e.getOptions().__groups=r,s==o.GROUP_BEHAVIOR_ACROSS_CELLS){var b=[];for(var E in r)b.push(E);b.sort(function(e,t){return u.compareCategoryNodeSize(r[e],r[t])});var x=Math.sqrt(i.w*i.h*.15/l);for(C=0;C<b.length;C++){E=b[C];for(var v=0,A=0,I=(l=r[E].nodeIndices.length,0);I<l;I++){_=u.getNode(e,r[E].nodeIndices[I]);v+=u.getXPercentage(e,_),A+=u.getYPercentage(e,_)}v/=l,A/=l,(B=L.newInstance(e,r[E])).setTranslate(i.x+(g?1-v:v)*i.w,i.y+(1-A)*i.h),B.render(n,x,0),B.setMaxAlpha(.8)}}else if(s==o.GROUP_BEHAVIOR_WITHIN_CELL){var O=u.getRowCount(e)*u.getColumnCount(e),N=[];for(C=0;C<O;C++)if(r[C]&&!u.isCellMinimized(e,C)){var T=u.getCell(e,C);N[C]=m._forceLayoutGroups(r[C],T.__childArea.w,T.__childArea.h)}for(x=40,C=0;C<O;C++)r[C]&&!u.isCellMinimized(e,C)&&(x=Math.min(x,N[C].scale));for(C=0;C<O;C++)if(r[C]&&!u.isCellMinimized(e,C)){var D=N[C].positions,R=N[C].center,w=(T=u.getCell(e,C),d(e,T).getChildContainer()),M=w instanceof t.SimpleScrollableContainer;for(var E in D){var B;(B=L.newInstance(e,r[C][E])).setTranslate(T.__childArea.x+T.__childArea.w/2+x*(D[E].x-R.x),(M?0:T.__childArea.y)+T.__childArea.h/2+x*(D[E].y-R.y)),B.render(M?w.getScrollingPane():w,x,3)}}}},m._adjustAvailSpace=function(e){e.x=Math.round(e.x),e.y=Math.round(e.y),e.w=Math.round(e.w),e.h=Math.round(e.h)},m._renderInitialSelection=function(e){if(e.isSelectionSupported()){var t={},n=[],i=u.getSelectedItems(e);if(i){for(var a=0;a<i.length;a++)t[i[a]]=!0;var r=e.getObjects();if(u.getGrouping(e))for(a=0;a<r.length;a++)if("categoryNode"===r[a].nboxType){for(var l=r[a].getData().nodeIndices,s=!0,g=0;g<l.length;g++){var d=u.getNode(e,l[g]);if(!t[d[o.ID]]){s=!1;break}}if(s){var h=u.getDrawer(e);if(!h||h[o.ID]!==r[a].getId()){for(g=0;g<l.length;g++)t[(d=u.getNode(e,l[g]))[o.ID]]=!1;n.push(r[a].getId())}}}for(var c in t)t[c]&&n.push(c)}e.getSelectionHandler().processInitialSelections(n,r)}},m._forceLayoutGroups=function(e,n,o){var i=[];for(var a in e)i.push(a);i.sort(function(t,n){return u.compareCategoryNodeSize(e[t],e[n])});for(var r={},l=2*Math.PI/i.length,s=0;s<i.length;s++){var g=s*Math.cos(l*s),d=s*Math.sin(l*s);r[i[s]]=N.create(g,d)}for(var h=1,c=-.25*o/Math.max(n,o),C=-.25*n/Math.max(n,o);h>.005;){var p={};for(s=0;s<i.length;s++){var _=r[L=i[s]],f=e[L].nodeIndices.length;p[L]=N.create(h*c*_.x,h*C*_.y);for(var S=0;S<i.length;S++)if(s!=S){for(var y,b=i[S],E=r[b],x=e[b].nodeIndices.length,v=N.subtract(_,E),A=N.getMagnitude(v),I=Math.atan2(v.y,v.x);I<0;)I+=Math.PI/2;for(;I>=Math.PI/2;)I-=Math.PI/2;if(A<(y=I<Math.PI/4?.5*(Math.sqrt(f)+Math.sqrt(x))/Math.cos(I):.5*(Math.sqrt(f)+Math.sqrt(x))/Math.sin(I))){var O=x/(f+x)*((y-A)/A);p[L]=N.add(p[L],N.scale(v,(1-h)*O))}}}for(s=0;s<i.length;s++){var L;r[L=i[s]]=N.add(r[L],p[L])}h*=.98}var m=Number.MAX_VALUE,T=-Number.MAX_VALUE,D=Number.MAX_VALUE,R=-Number.MAX_VALUE;for(s=0;s<i.length;s++){a=i[s];var w=Math.sqrt(e[a].nodeIndices.length),M=r[a];m=Math.min(m,M.x-w/2),T=Math.max(T,M.x+w/2),D=Math.min(D,M.y-w/2),R=Math.max(R,M.y+w/2)}var B=n/(T-m),H=o/(R-D),U=(m+T)/2,P=(D+R)/2;return{scale:Math.min(B,H),center:new t.Point(U,P),positions:r}},m._processOtherThreshold=function(e,t){var n=u.getNodeCount(e),i=u.getOtherThreshold(e)*n;if(i<=1)return t;var a={},r={};if(u.getGroupBehavior(e)==o.GROUP_BEHAVIOR_WITHIN_CELL)for(var l in t){var s=t[l];r.cell=s.cell;break}for(var l in r.id="other",r.nodeIndices=[],r.otherNode=!0,t){if((s=t[l]).nodeIndices.length<i)for(var g=0;g<s.nodeIndices.length;g++)r.nodeIndices.push(s.nodeIndices[g]);else a[l]=s}return r.nodeIndices.length>0&&(a.other=r),a},m._renderDrawer=function(e,t,n){var i=u.getDrawer(e);i&&(u.getCategoryNode(e,i.id)?E.newInstance(e,i).render(t,n):(e.getOptions()[o.DRAWER]=null,u.fireOptionChangeEvent(e,o.DRAWER,null)))},m.animateUpdate=function(e,t,n){m._animateCells(e,t,n),m._animateNodes(e,t,n);var o=u.getDrawer(t);o=o?o.id:null;var i=u.getDrawer(n);o!=(i=i?i.id:null)&&m._animateDrawer(e,t,n)},m._animateCells=function(e,t,n){for(var i=u.getRowCount(t),a=u.getRowCount(n),r=u.getColumnCount(t),l=u.getColumnCount(n),s=i*r,g=a*l,h=[],c=[],C=0;C<s;C++)h.push(d(t,u.getCell(t,C)));for(C=0;C<g;C++)c.push(d(n,u.getCell(n,C)));if(i==a&&r==l){var p=!0;for(C=0;C<a;C++){if(u.getRow(t,C)[o.ID]!=u.getRow(n,C)[o.ID]){p=!1;break}}if(p)for(C=0;C<l;C++){if(u.getColumn(t,C)[o.ID]!=u.getColumn(n,C)[o.ID]){p=!1;break}}if(p)return void e.constructAnimation(h,c)}e.constructAnimation(h,[]),e.constructAnimation([],c)},m._animateNodes=function(e,t,n){for(var o=u.getNodeCount(t),i=u.getNodeCount(n),a=[],r=[],l=0;l<o;l++)a.push(d(t,u.getNode(t,l)));for(l=0;l<i;l++)r.push(d(n,u.getNode(n,l)));e.constructAnimation(a,r);var s=u.getDrawer(t);if(!u.getDrawer(n)){var g=m._getSortedGroups(t),h=m._getSortedGroups(n);s&&(u.getMaximizedCellIndex(t)!=u.getMaximizedCellIndex(n)?(g=g.filter(function(e){return e.getData().cell!=u.getMaximizedCellIndex(t)}),h=h.filter(function(e){return e.getData().cell!=u.getMaximizedCellIndex(t)})):(g=null,h=null)),e.constructAnimation(g,h)}},m._getSortedGroups=function(e){var t=u.getGroupBehavior(e),n=e.getOptions().__groups,i=[];if(n)if(t==o.GROUP_BEHAVIOR_WITHIN_CELL)for(var a=u.getRowCount(e)*u.getColumnCount(e),r=0;r<a;r++)for(var l=n[r+""],s=m._getSortedGroupsFromContainer(e,l),g=0;g<s.length;g++)i.push(s[g]);else i=m._getSortedGroupsFromContainer(e,n);return i},m._getSortedGroupsFromContainer=function(e,t){var n=[];for(var o in t){var i=d(e,t[o]);i&&n.push(i)}return n.sort(function(e,t){var n=e.getId(),o=t.getId();return n==o?0:n<o?-1:1}),n},m._animateDrawer=function(e,t,n){var o=u.getDrawer(t);o=o?[d(t,o)]:null;var i=u.getDrawer(n);i=i?[d(n,i)]:[],e.constructAnimation(o,i)},m.getNodeOrderFunction=function(e){var n=[],o=u.getDrawer(e);if(o)for(var i=d(e,o).getChildContainer().getScrollingPane(),a=0;a<i.getNumChildren();a++)n.push(i.getChildAt(a));else for(var r=u.getRowCount(e)*u.getColumnCount(e),l=0;l<r;l++){var s=[],g=u.getCell(e,l),h=d(e,g).getChildContainer();h instanceof t.SimpleScrollableContainer&&(h=h.getScrollingPane());for(var c=0;c<h.getNumChildren();c++)s.push(h.getChildAt(c));n.push(s)}return function(){if(n.length)if(n[0]&&isNaN(n[0].length)){var o=u.getDrawer(e);if(o)for(var i=d(e,o).getChildContainer().getScrollingPane(),a=0;a<n.length;a++)i.addChild(n[a])}else for(var r=0;r<n.length;r++){var l=n[r],s=u.getCell(e,r);if(l.length&&s){var g=d(e,s).getChildContainer();g instanceof t.SimpleScrollableContainer&&(g=g.getScrollingPane());for(a=0;a<l.length;a++)g.addChild(l[a])}}}},m._renderEmptyText=function(e,n,o){var i=e.getOptions(),a=i.translations.labelInvalidData;e.renderEmptyText(n,a,new t.Rectangle(o.x,o.y,o.w,o.h),e.getEventManager(),i._statusMessageStyle)};const T=function(e,t,n){this.Init(e,t,n)};t.Obj.createSubclass(T,t.BaseComponent),T.prototype.nboxType="nbox",T.newInstance=function(e,t,n){return new T(e,t,n)},T.getDefaults=function(e){return(new A).getDefaults(e)},T.prototype.Init=function(e,n,o){T.superclass.Init.call(this,e,n,o),this.Defaults=new A(e),this.EventManager=new O(this),this.EventManager.addListeners(this),t.Agent.isTouchDevice()||this.EventManager.setKeyboardHandler(this.CreateKeyboardHandler(this.EventManager)),this.setId("nbox1000"+Math.floor(1e9*Math.random())),this._peers=[],this._animationAllowed=!0},T.prototype.SetOptions=function(e){e||(e=this.getSanitizedOptions()),e?(this.Options=this.Defaults.calcOptions(e),u.processDataObject(this),t.Agent.isEnvironmentTest()&&(this.Options[o.ANIMATION_ON_DISPLAY]="none",this.Options[o.ANIMATION_ON_DATA_CHANGE]="none")):this.Options||(this.Options=this.GetDefaults()),this._displayables=[],this.Options.__displayableCache=new t.BaseComponentCache;var n=this.Options[o.SELECTION_MODE];this._selectionHandler="single"==n?new t.SelectionHandler(this.getCtx(),t.SelectionHandler.TYPE_SINGLE):"multiple"==n?new t.SelectionHandler(this.getCtx(),t.SelectionHandler.TYPE_MULTIPLE):null,this.EventManager.setSelectionHandler(this._selectionHandler)},T.prototype.render=function(e,n,o){var i=c.getAnimationOnDataChange(this),a=null;this.Options&&"none"!==i&&((a={options:this.Options,getOptions:function(){return this.options},displayables:this._displayables,getDisplayables:function(){return this.displayables},id:this.getId(),getId:function(){return this.id}}).getOptions=a.getOptions,a.getDisplayables=a.getDisplayables,a.getId=a.getId),this.__cleanUp(),this.SetOptions(e),isNaN(n)||isNaN(o)||(this.Width=n,this.Height=o);var r=new t.Container(this.getCtx());if(this.addChild(r),m.render(this,r,new t.Rectangle(0,0,this.Width,this.Height)),e&&u.getDrawer(this)&&u.getGrouping(this)){var l=d(this,u.getDrawer(this));this.EventManager.setFocus(l),this.EventManager.setFocused(!1)}this._updateKeyboardFocusEffect(),this.StopAnimation();var s=c.getAnimationOnDisplay(this),g=c.getAnimationDuration(this),h=new t.Rectangle(0,0,this.Width,this.Height),p=!1;if(this._container){if("none"!=i&&e)if(this.Animation=t.BlackBoxAnimationHandler.getCombinedAnimation(this.getCtx(),i,this._container,r,h,g),this.Animation)p=!0;else{this._deleteContainer=new t.Container(this.getCtx(),"DeleteContainer"),this.addChild(this._deleteContainer);var _=new C(this.getCtx(),this._deleteContainer,a,this),f=m.getNodeOrderFunction(this);_.constructAnimation([a],[this]),this.Animation=_.getAnimation(),t.Playable.appendOnEnd(this.Animation,f,this)}}else"none"!==s&&(this.Animation=t.BlackBoxAnimationHandler.getInAnimation(this.getCtx(),s,r,h,g));this.Animation?(this.setMouseEnabled(!1),t.Playable.appendOnEnd(this.Animation,this._getOnAnimationEndFunction(e),this),this.Animation.play()):this._getOnAnimationEndFunction(e).call(this),p?this._oldContainer=this._container:this._container&&(this.removeChild(this._container),this._container.destroy()),this._container=r,this.UpdateAriaAttributes()},T.prototype.__cleanUp=function(){this.EventManager.hideTooltip(),this._peers.length=0},T.prototype._getOnAnimationEndFunction=function(e){return function(){this._oldContainer&&(this.removeChild(this._oldContainer),this._oldContainer.destroy(),this._oldContainer=null),this._deleteContainer&&(this.removeChild(this._deleteContainer),this._deleteContainer.destroy()),this._deleteContainer=null,this.setMouseEnabled(!0),this.AnimationStopped||(this.Animation&&("ie"===t.Agent.browser||"edge"===t.Agent.browser)&&t.Agent.version>=12&&(this.Animation=null,this.setAnimationAllowed(!1),this.render(e),this.setAnimationAllowed(!0)),this.RenderComplete()),this.Animation=null,this.AnimationStopped=!1}},T.prototype.CreateKeyboardHandler=function(e){return new h(e,this)},T.prototype.getChildContainer=function(){return this._container},T.prototype.getDeleteContainer=function(){return this._deleteContainer},T.prototype.getDisplayables=function(){return this._displayables},T.prototype._updateKeyboardFocusEffect=function(){var e,t=this.EventManager.getFocus(),n=!1;t&&(n=t.isShowingKeyboardFocusEffect(),t.getKeyboardFocusDisplayable&&(e=t.getKeyboardFocusDisplayable()),e&&n&&e.showKeyboardFocusEffect(),this.EventManager.setFocus(e))},T.prototype.processEvent=function(e,t){var n=e.type;"categoryHighlight"==n?e=this._processRolloverEvent(e):"selection"==n&&(e=this._processSelectionEvent(e)),e&&this.dispatchEvent(e)},T.prototype._processRolloverEvent=function(e){return this._processHighlighting(e.categories),e},T.prototype._processSelectionEvent=function(e){var n=e.selection,i=null;if(n){for(var a={},r=0;r<n.length;r++)a[n[r]]=!0;var l=this.getObjects(),s=null;if(u.getGrouping(this))for(r=0;r<l.length;r++)if("categoryNode"===l[r].nboxType){if(a[l[r].getId()]){a[l[r].getId()]=!1;for(var g=l[r].getData().nodeIndices,d=0;d<g.length;d++){a[u.getNode(this,g[d])[o.ID]]=!0}}}else"drawer"===l[r].nboxType&&(s=l[r]);var h=[];for(var c in i=[],a)a[c]&&(h.push(c),i.push(c));e=t.EventFactory.newSelectionEvent(h)}return u.setSelectedItems(this,i),s&&s.UpdateAccessibilityAttributes(),e},T.prototype.registerObject=function(e){this._peers.push(e)},T.prototype.getObjects=function(){return this._peers},T.prototype.getWidth=function(){return this.Width},T.prototype.getHeight=function(){return this.Height},T.prototype.getSelectionHandler=function(){return this._selectionHandler},T.prototype.isSelectionSupported=function(){return!!this._selectionHandler},T.prototype.animateUpdate=function(e,t){m.animateUpdate(e,t,this)},T.prototype.getSanitizedOptions=function(){return t.JsonUtils.clone(this.getOptions(),function(e){return 0!=e.indexOf("__")})},T.prototype.getSubcomponentStyles=function(){return{}},T.prototype.__isDragAvailable=function(e){return this._selectionHandler?e[0]:null},T.prototype.__getDragTransferable=function(e){e.isSelected()||(this._selectionHandler.processClick(e,!1),this.EventManager.fireSelectionEvent());for(var t=[],n={},i=this._selectionHandler.getSelection(),a=0;a<i.length;a++){var r=i[a];if("node"===r.nboxType){var l=r.getData()[o.ID];t.push(l),n[l]=!0}else if("categoryNode"===r.nboxType){for(var s=r.getData().nodeIndices,g=0;g<s.length;g++){var d=u.getNode(this,s[g])[o.ID];t.push(d),n[d]=!0}n[r.getData()[o.ID]]=!0}}var h=this._selectionHandler.getSelectedIds();for(a=0;a<h.length;a++){if(!n[l=h[a]])if(isNaN(u.getNodeIndex(this,l))){if(u.getGrouping(this)&&u.getCategoryNode(this,l)){for(s=u.getCategoryNode(this,l).nodeIndices,g=0;g<s.length;g++){n[d=u.getNode(this,s[g])[o.ID]]||(t.push(d),n[d]=!0)}n[l]=!0}}else t.push(l),n[l]=!0}return t},T.prototype.__getDragFeedback=function(){return this._selectionHandler.getSelection().slice(0)},T.prototype.__getCellUnderPoint=function(e,t){for(var n=u.getRowCount(this)*u.getColumnCount(this),o=0;o<n;o++){var i=d(this,u.getCell(this,o));if(i.contains(e,t))return i}return null},T.prototype.__showDropSiteFeedback=function(e){return this._dropSiteFeedback&&(this._dropSiteFeedback.getParent().removeChild(this._dropSiteFeedback),this._dropSiteFeedback=null),e&&(this._dropSiteFeedback=e.renderDropSiteFeedback()),this._dropSiteFeedback},T.prototype.getAutomation=function(){return this.Automation||(this.Automation=new v(this)),this.Automation},T.prototype.GetComponentDescription=function(){var e=this.getOptions().translations;return u.hasValidData(this)?t.ResourceUtils.format(e.componentName,[u.getColumnCount(this)*u.getRowCount(this)]):e.labelInvalidData},T.prototype.highlight=function(e){this.Options.highlightedCategories=t.JsonUtils.clone(e),this._processHighlighting(e)},T.prototype._processHighlighting=function(e){var n=this.getNodeDisplayables(),i=this,a=function(n){if("node"===n.nboxType){if(n.getCategories())return"all"==i.getOptions()[o.HIGHLIGHT_MATCH]?t.ArrayUtils.hasAllItems(e,n.getCategories()):t.ArrayUtils.hasAnyItem(e,n.getCategories())}else if("categoryNode"===n.nboxType)for(var a=n.getData(),r=a.nodeIndices.length,l=0;l<r;l++){var s=u.getNode(i,a.nodeIndices[l]);if(s[o.CATEGORIES]&&("all"==i.getOptions()[o.HIGHLIGHT_MATCH]?t.ArrayUtils.hasAllItems(e,s[o.CATEGORIES]):t.ArrayUtils.hasAnyItem(e,s[o.CATEGORIES])))return!0}return!1},r=u.getRowCount(i)*u.getColumnCount(i);for(i.getOptions().__highlightedMap=null,C=0;C<r;C++){var l=u.getCell(i,C),s=d(i,l);f.renderHeader(i,l,s,!1)}var g=u.getHighlightedItems(i),h={};if(g)for(var C=0;C<g.length;C++)h[g[C][o.ID]]=!0;for(C=0;C<n.length;C++)if(e&&e.length>0&&!a(n[C])?n[C].setAlpha(c.getFadedNodeAlpha(this)):n[C].setAlpha(1),"categoryNode"===n[C].nboxType){for(var p=0,_=n[C].getData(),S=0;S<_.nodeIndices.length;S++)h[_.nodeIndices[S]]&&(p+=1);_.highlightedCount=p;var b=null!=c.getStyledCategoryIndicatorIcon(i,_)||null!=c.getCategoryNodeIndicatorColor(i,_);y._renderNodeCount(i,n[C].getData(),n[C],_.__scale,b,_.__gap)}},T.prototype.getNodeDisplayables=function(){for(var e=[],t=u.getNodeCount(this),n=0;n<t;n++)e.push(u.getNode(this,n));var i=u.getGroupBehavior(this),a=this.getOptions().__groups;if(a)if(i==o.GROUP_BEHAVIOR_WITHIN_CELL){var r=u.getRowCount(this)*u.getColumnCount(this);for(n=0;n<r;n++){var l=a[n+""];for(var s in l)e.push(l[s])}}else for(var s in a)e.push(a[s]);var g=[];for(n=0;n<e.length;n++){var h=d(this,e[n]);h&&g.push(h)}return g},T.prototype.isAnimationAllowed=function(){return this._animationAllowed},T.prototype.setAnimationAllowed=function(e){this._animationAllowed=e},T.prototype.setCellFilter=function(e){this._filter=e},T.prototype.getCellFilter=function(){return this._filter},T.prototype.setNodeClipPath=function(e){this._nodeClipPath=e},T.prototype.getNodeClipPath=function(){return this._nodeClipPath},T.prototype.setNodeIconClipPath=function(e){this._nodeIconClipPath=e},T.prototype.getNodeIconClipPath=function(){return this._nodeIconClipPath},e.NBox=T,e.NBoxConstants=o,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ojnbox-toolkit.js.map