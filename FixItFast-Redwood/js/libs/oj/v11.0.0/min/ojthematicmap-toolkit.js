/**
 * @license
 * Copyright (c) 2014, 2021, Oracle and/or its affiliates.
 * Licensed under The Universal Permissive License (UPL), Version 1.0
 * as shown at https://oss.oracle.com/licenses/upl/
 * @ignore
 */
define(["exports","ojs/ojdvt-toolkit","ojs/ojdvt-panzoomcanvas"],function(t,e,a){"use strict";window.DvtBaseMapManager?t.DvtBaseMapManager=window.DvtBaseMapManager:(t.DvtBaseMapManager={},window.DvtBaseMapManager=t.DvtBaseMapManager,t.DvtBaseMapManager._UNPROCESSED_MAPS=[[],[],[]],t.DvtBaseMapManager._UNPROCESSED_PARENT_UPDATES=[[]]),e.Obj.createSubclass(t.DvtBaseMapManager,e.Obj),t.DvtBaseMapManager.TYPE_LABELS=0,t.DvtBaseMapManager.TYPE_PATH=1,t.DvtBaseMapManager.TYPE_PARENTREGION_CHILDREN=2,t.DvtBaseMapManager.TYPE_LABELINFO=3,t.DvtBaseMapManager.TYPE_DIM=4,t.DvtBaseMapManager._INDEX="__index",t.DvtBaseMapManager._GLOBAL_MAPS=new Object,t.DvtBaseMapManager.getBaseMapDim=function(a,i){t.DvtBaseMapManager._processUnprocessedMaps();var r=t.DvtBaseMapManager._GLOBAL_MAPS[a][i];if(r){var n=r[t.DvtBaseMapManager.TYPE_DIM];if(n)return new e.Rectangle(n[0],n[1],n[2],n[3])}return null},t.DvtBaseMapManager.getAreaLabelInfo=function(e,a){t.DvtBaseMapManager._processUnprocessedMaps();var i=t.DvtBaseMapManager._GLOBAL_MAPS[e][a];return i?i[t.DvtBaseMapManager.TYPE_LABELINFO]:null},t.DvtBaseMapManager.getAreaIds=function(e,a){var i=[],r=t.DvtBaseMapManager.getAreaPaths(e,a);for(var n in r)i.push(n);return i},t.DvtBaseMapManager.getAreaLabels=function(e,a){t.DvtBaseMapManager._processUnprocessedMaps();var i=t.DvtBaseMapManager._GLOBAL_MAPS[e][a];return i?i[t.DvtBaseMapManager.TYPE_LABELS]:null},t.DvtBaseMapManager.getLongAreaLabel=function(e,a,i){t.DvtBaseMapManager._processUnprocessedMaps();var r,n=t.DvtBaseMapManager._GLOBAL_MAPS[e][a];return n&&(r=n[t.DvtBaseMapManager.TYPE_LABELS]),r&&r[i]?r[i][1]:null},t.DvtBaseMapManager.getCityCoordinates=function(a,i){t.DvtBaseMapManager._processUnprocessedMaps();var r=t.DvtBaseMapManager._GLOBAL_MAPS[a];if(r){var n=r.cities;if(n){var o=n[t.DvtBaseMapManager.TYPE_PATH][i];if(o)return new e.Point(o[0],o[1])}}return null},t.DvtBaseMapManager.getCityLabel=function(e,a){t.DvtBaseMapManager._processUnprocessedMaps();var i=t.DvtBaseMapManager._GLOBAL_MAPS[e];if(i){var r=i.cities;if(r){var n=r[t.DvtBaseMapManager.TYPE_LABELS][a];if(n)return n[1]}}return null},t.DvtBaseMapManager.getAreaCenter=function(a,i,r){t.DvtBaseMapManager._processUnprocessedMaps();var n=t.DvtBaseMapManager._GLOBAL_MAPS[a];if(n){var o=n[i];if(o){var s=o[t.DvtBaseMapManager.TYPE_LABELINFO];if(s&&s[r]){var l=s[r][0];return e.Rectangle.create(l).getCenter()}}}return null},t.DvtBaseMapManager.getAreaPaths=function(e,a,i,r,n){t.DvtBaseMapManager._processUnprocessedMaps();var o=t.DvtBaseMapManager._GLOBAL_MAPS[e][a],s=o[t.DvtBaseMapManager.TYPE_PATH],l=o[t.DvtBaseMapManager.TYPE_DIM];return l?t.DvtBaseMapManager._simplifyAreaPaths(s,l[2],l[3],i,r,n):s},t.DvtBaseMapManager.getPathForArea=function(e,a,i){t.DvtBaseMapManager._processUnprocessedMaps();var r=t.DvtBaseMapManager._GLOBAL_MAPS[e][a];return r?r[t.DvtBaseMapManager.TYPE_PATH][i]:null},t.DvtBaseMapManager.registerBaseMapLayer=function(e,a,i,r,n,o,s,l){var h=t.DvtBaseMapManager._GLOBAL_MAPS[e];h||((h=new Object)[t.DvtBaseMapManager._INDEX]=new Array,t.DvtBaseMapManager._GLOBAL_MAPS[e]=h);var c=h[a];c||(c=new Object,h[a]=c,null!=s&&(h[t.DvtBaseMapManager._INDEX][s]=a)),c[t.DvtBaseMapManager.TYPE_LABELS]=i,c[t.DvtBaseMapManager.TYPE_PATH]=r,c[t.DvtBaseMapManager.TYPE_PARENTREGION_CHILDREN]=n,c[t.DvtBaseMapManager.TYPE_LABELINFO]=o,c[t.DvtBaseMapManager.TYPE_DIM]=l,c[t.DvtBaseMapManager._INDEX]=s},t.DvtBaseMapManager.registerResourceBundle=function(e,a,i){var r,n=t.DvtBaseMapManager._GLOBAL_MAPS[e];n||(n=new Object,t.DvtBaseMapManager._GLOBAL_MAPS[e]=n),(r=n[a])||(r=new Object,n[a]=r),(r=n[a])&&(r[t.DvtBaseMapManager.TYPE_LABELS]=i)},t.DvtBaseMapManager.updateResourceBundle=function(e,a,i){var r=t.DvtBaseMapManager._GLOBAL_MAPS[e];if(r){var n=r[a];if(n)for(var o in i)n[t.DvtBaseMapManager.TYPE_LABELS][o]=i[o]}},t.DvtBaseMapManager._processUnprocessedMaps=function(){var e,a=t.DvtBaseMapManager._UNPROCESSED_MAPS;if(a){for(_=0;_<a[0].length;_++)e=a[0][_],t.DvtBaseMapManager.registerBaseMapLayer(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]);for(_=0;_<a[1].length;_++)e=a[1][_],t.DvtBaseMapManager.registerResourceBundle(e[0],e[1],e[2]);for(_=0;_<a[2].length;_++)e=a[2][_],t.DvtBaseMapManager.updateResourceBundle(e[0],e[1],e[2]);t.DvtBaseMapManager._UNPROCESSED_MAPS=[[],[],[]]}var i=t.DvtBaseMapManager._UNPROCESSED_PARENT_UPDATES;if(i){for(_=0;_<i[0].length;_++){var r,n,o=(e=i[0][_])[0],s=e[1],l=e[2],h=t.DvtBaseMapManager._GLOBAL_MAPS[o];if(h){if(n=h[s]){n[t.DvtBaseMapManager.TYPE_PARENTREGION_CHILDREN]=e[3],r=n[t.DvtBaseMapManager.TYPE_DIM];var c=n[t.DvtBaseMapManager._INDEX],p=h[t.DvtBaseMapManager._INDEX];p.splice(c,0,l),h[l][t.DvtBaseMapManager._INDEX]=c;for(var _=c+1;_<p.length;_++){var g=h[p[_]];g&&g[t.DvtBaseMapManager._INDEX]++}}(n=h[e[2]])&&(n[t.DvtBaseMapManager.TYPE_DIM]=r)}}t.DvtBaseMapManager._UNPROCESSED_PARENT_UPDATES=[[]]}},t.DvtBaseMapManager._simplifyAreaPaths=function(t,a,i,r,n,o){if(o>0){var s=r/a,l=n/i,h=1/(Math.min(s,l)*o);if(h<=1)return t;var c=[];if(t)for(var p in t){var _=t[p];isNaN(_)&&(_=e.PathUtils.createPathArray(t[p])),c[p]=e.PathUtils.simplifyPath(_,h)}return c}return t},t.DvtBaseMapManager.getLayerIds=function(e,a){t.DvtBaseMapManager._processUnprocessedMaps();var i=t.DvtBaseMapManager._GLOBAL_MAPS[e][a],r={};if(i){var n=i[t.DvtBaseMapManager.TYPE_LABELS];for(var o in n)r[o]=n[o][1];if("cities"!==a&&!n)for(var s=t.DvtBaseMapManager.getAreaIds(e,a),l=0;l<s.length;l++)r[s[l]]=null}return r};var i=function(t,e,a,i,r,n){this.Init(t,e,a,i,r,n)};e.Obj.createSubclass(i,e.Container),i._DEFAULT_STROKE_WIDTH=1,i.prototype.Init=function(t,e,a,r,n,o){i.superclass.Init.call(this,t),this._areaId=r,this._areaName=n,this._shape=a,this.addChild(this._shape),this._view=e,this._bSupportsVectorEffects=o;var s=a.getStroke();s&&(this._areaStrokeWidth=s.getWidth())},i.prototype.getAreaId=function(){return this._areaId},i.prototype.getDatatip=function(){if("none"!=this._view.getDisplayTooltips()){var t=this._view.getOptions()._tooltip;return t?this._view.getCtx().getTooltipManager().getCustomTooltip(t.renderer,this.getDataContext()):this._tooltip}return null},i.prototype.setDatatip=function(t){this._tooltip=t},i.prototype.getDataContext=function(){return{color:null,component:this._view.getOptions()._widgetConstructor,data:null,id:null,label:null,location:this.getAreaId(),locationName:this._areaName,tooltip:this._tooltip,x:null,y:null}},i.prototype.getStroke=function(){return this._shape instanceof e.Shape?this._shape.getStroke():null},i.prototype.setStroke=function(t){this._shape instanceof e.Shape&&this._shape.setStroke(t)},i.prototype.setFill=function(t){this._shape instanceof e.Shape&&this._shape.setFill(t)},i.prototype.getFill=function(){return this._shape instanceof e.Shape?this._shape.getFill():null},i.prototype.getCmds=function(){return this._shape instanceof e.Path?this._shape.getCmds():null},i.prototype.setCmds=function(t){this._shape instanceof e.Path&&this._shape.setCmds(t)},i.prototype.setSrc=function(t){this._shape instanceof e.Image&&this._shape.setSrc(t)},i.prototype.getDropSiteFeedback=function(){return this._shape.copyShape()},i.prototype.contains=function(t,e){var a=this.getDimensions();return t>=a.x&&t<=a.x+a.w&&e>=a.y&&e<=a.y+a.h},i.prototype.HandleZoomEvent=function(t){if(!this._bSupportsVectorEffects&&this._shape&&this._areaStrokeWidth){var a=this._shape.getStroke(),i=new e.Stroke(a.getColor(),a.getAlpha(),this._areaStrokeWidth/t.getA(),a.isFixedWidth());this._shape.setStroke(i)}};var r=function(t,e,a,i,r,n){this.Init(t,e,a,i,r,n)};e.Obj.createSubclass(r,e.OutputText),r.prototype.Init=function(t,a,i,n,o,s){if(r.superclass.Init.call(this,t,a,0,0),this._bSupportsVectorEffects=s,this._boundRectangle=new Array,this.setMouseEnabled(!1),this.alignCenter(),this.alignMiddle(),this._center=null,this._labelDisplay=n,this._parentContainer=o,i&&(this._boundRectangle.push(e.Rectangle.create(i[0])),i.length>1)){this._leaderLines=new Array;for(var l=1;l<i.length;l++){var h=i[l];this._boundRectangle.push(e.Rectangle.create(h[0]));var c=new e.Polyline(t,h[1]);c.setPixelHinting(!0);var p=new e.Stroke("#000000",1,1,this._bSupportsVectorEffects);c.setStroke(p),this._leaderLines.push(c)}}},r.prototype.addBounds=function(t){this._boundRectangle.push(t)},r.prototype.hasBounds=function(){return this._boundRectangle.length>0},r.prototype.update=function(t){for(var a=t.getA(),i=-1,r=this.getDimensions(),n=0;n<this._boundRectangle.length;n++){var o=this._boundRectangle[n].w*a,s=this._boundRectangle[n].h*a;if(r.h<=s&&r.w<=o){i=n;break}}if(-1==i&&"on"==this._labelDisplay&&(i=this._boundRectangle.length-1),this._currentState!=i){if(-1==i)this.reset();else{this.getParent()||this._parentContainer.addChild(this);var l=this._boundRectangle[i].getCenter();if(this.setCenter(l),this._leaderLines)if(this._parentContainer.removeChild(this._leaderLine),this._leaderLine=null,i>0){this._leaderLine=this._leaderLines[i-1],this._parentContainer.addChild(this._leaderLine),(_=this.getCSSStyle()).setStyle(e.CSSStyle.COLOR,"#000000"),this.setCSSStyle(_);var h=this._boundRectangle[i],c=this._leaderLine.getPoints(),p=c.length;h.x>c[p-2]?(this.alignLeft(),this.alignMiddle(),this.setCenter(new e.Point(h.x,l.y))):h.y>c[p-1]?(this.alignTop(),this.alignCenter(),this.setCenter(new e.Point(l.x,h.y))):h.x+h.w<c[p-2]?(this.alignRight(),this.alignMiddle(),this.setCenter(new e.Point(h.x+h.w,l.y))):h.y+h.h<c[p-1]&&(this.alignBottom(),this.alignCenter(),this.setCenter(new e.Point(l.x,h.y+h.h)))}else{var _;this.alignCenter(),this.alignMiddle(),(_=this.getCSSStyle()).setStyle(e.CSSStyle.COLOR,this._labelColor),this.setCSSStyle(_)}}this._currentState=i}if(-1!=this._currentState){var g=new e.Matrix;if(this.setMatrix(g.translate(a*this._center.x-this._center.x,a*this._center.y-this._center.y)),this._leaderLine&&(this._leaderLine.setMatrix(new e.Matrix(a,0,0,a)),!this._bSupportsVectorEffects)){var d=this._leaderLine.getStroke(),u=new e.Stroke(d.getColor(),d.getAlpha(),1/a,d.isFixedWidth());this._leaderLine.setStroke(u)}}},r.prototype.setCenter=function(t){this._center=t,this.setX(t.x),this.setY(t.y)},r.prototype.getLeaderLine=function(){return this._leaderLine},r.prototype.getCenter=function(){return this._center},r.prototype.setCSSStyle=function(t){r.superclass.setCSSStyle.call(this,t),this._labelColor||(this._labelColor=t.getStyle(e.CSSStyle.COLOR))},r.prototype.reset=function(){this._parentContainer.removeChild(this),this._currentState=-1,this._leaderLine&&(this._parentContainer.removeChild(this._leaderLine),this._leaderLine=null)};var n=function(t,e,a){this.Init(t,e,a)};e.Obj.createSubclass(n,e.Obj),n.prototype.Init=function(t,a,i){this._tmap=t,this.LayerName=a,this.EventHandler=i,this.DataLayers={},this.PzcMatrix=new e.Matrix},n.prototype.addDataLayer=function(t){this.DataLayers[t.getClientId()]=t},n.prototype.PreDataLayerUpdate=function(){},n.prototype.PostDataLayerUpdate=function(){},n.prototype.updateDataLayer=function(t,a,i){if(this._animation&&this._animation.stop(!0),this.PzcMatrix=a,this._oldDataLayer=this.getDataLayer(t.getClientId()),this.addDataLayer(t),t.render(this.PzcMatrix),t.HandleZoomEvent(e.EventFactory.newZoomEvent("zoomed"),this.PzcMatrix),this._oldDataLayer){var r=t.getAnimation(),n=t.getAnimationDuration();if("auto"==r){var o=new e.DataAnimationHandler(this._tmap.getCtx());o.constructAnimation(this._oldDataLayer.getAllObjects(),t.getAllObjects()),this._animation=o.getAnimation()}else if(e.BlackBoxAnimationHandler.isSupported(r)){this._removeAnimRect=!0;for(var s=new e.Rectangle(0,0,this._tmap.getWidth(),this._tmap.getHeight()),l=this._oldDataLayer.getNonScaledContainers(),h=0;h<l.length;h++){(u=new e.Rect(this._tmap.getCtx(),0,0,this._tmap.getWidth(),this._tmap.getHeight())).setFill(null),l[h].addChild(u)}var c=t.getNonScaledContainers();for(h=0;h<c.length;h++){(u=new e.Rect(this._tmap.getCtx(),0,0,this._tmap.getWidth(),this._tmap.getHeight())).setFill(null),c[h].addChild(u)}var p=e.BlackBoxAnimationHandler.getCombinedAnimation(this._tmap.getCtx(),r,l,c,s,n),_=new e.Rectangle(0,0,this._tmap.getWidth()/this.PzcMatrix.getA(),this._tmap.getHeight()/this.PzcMatrix.getA()),g=this._oldDataLayer.getScaledContainers();for(h=0;h<g.length;h++){(u=new e.Rect(this._tmap.getCtx(),0,0,this._tmap.getWidth()/this.PzcMatrix.getA(),this._tmap.getHeight()/this.PzcMatrix.getA())).setFill(null),g[h].addChild(u)}var d=t.getScaledContainers();for(h=0;h<d.length;h++){var u;(u=new e.Rect(this._tmap.getCtx(),0,0,this._tmap.getWidth()/this.PzcMatrix.getA(),this._tmap.getHeight()/this.PzcMatrix.getA())).setFill(null),d[h].addChild(u)}var y=e.BlackBoxAnimationHandler.getCombinedAnimation(this._tmap.getCtx(),r,g,d,_,n);this._animation=new e.ParallelPlayable(this._tmap.getCtx(),[p,y])}else{var f=this._oldDataLayer.getContainers();for(h=0;h<f.length;h++){f[h].getParent().removeChild(f[h])}}if(this.PreDataLayerUpdate(),this._animation){this.EventHandler.removeListeners(this._callbackObj);var v=this;this._animation.setOnEnd(function(){v.OnAnimationEnd(t)},this),this._animation.play()}}else this.PostDataLayerUpdate(),this._tmap.OnUpdateLayerEnd()},n.prototype.getDataLayers=function(){return this.DataLayers},n.prototype.getDataLayer=function(t){return this.DataLayers?this.DataLayers[t]:null},n.prototype.getLayerName=function(){return this.LayerName},n.prototype.render=function(t){for(var e in this.PzcMatrix=t,this.DataLayers)this.DataLayers[e].render(t)},n.prototype.HandleZoomEvent=function(t,e){for(var a in this.PzcMatrix=e,this.DataLayers)this.DataLayers[a].HandleZoomEvent(t,e)},n.prototype.HandlePanEvent=function(t){for(var e in this.PzcMatrix=t,this.DataLayers)this.DataLayers[e].HandlePanEvent(t)},n.prototype.OnAnimationEnd=function(t){if(this._oldDataLayer)for(var e=this._oldDataLayer.getContainers(),a=0;a<e.length;a++){var i=e[a].getParent();i&&i.removeChild(e[a])}if(this._removeAnimRect){this._removeAnimRect=!1;var r=t.getNonScaledContainers();for(a=0;a<r.length;a++)r[a].removeChildAt(r[a].getNumChildren()-1);var n=t.getScaledContainers();for(a=0;a<n.length;a++)n[a].removeChildAt(n[a].getNumChildren()-1)}this.PostDataLayerUpdate(),this._tmap.OnUpdateLayerEnd(),this._animation=null,this.EventHandler.addListeners(this._callbackObj)},n.prototype.destroy=function(){var t=this.getDataLayers();for(var e in t)t[e].destroy()};var o=function(t,e,a,i,r){this.Init(t,e,a,i,r)};e.Obj.createSubclass(o,n),o._SHORT_NAME=0,o._LONG_NAME=1,o.prototype.Init=function(t,a,i,r,n){o.superclass.Init.call(this,t,a,n),this._labelDisplay=i,this._labelType=r,this._areaLabels=new Object,this.Areas=new Object,this.AreaShapes={},this.AreaLabels=null,this._labelInfo=null,this._renderArea={},this._renderLabel={},this._renderedLabels={},this.AreaContainer=new e.Container(this._tmap.getCtx()),this.LabelContainer=new e.Container(this._tmap.getCtx()),this._tmap.getAreaLayerContainer().addChildAt(this.AreaContainer,0),this._tmap.getLabelContainer().addChildAt(this.LabelContainer,0)},o.prototype.getLabelType=function(){return this._labelType},o.prototype.setAreaShapes=function(t){for(var e in this.AreaShapes=t,t)this.setAreaRendered(e,!0)},o.prototype.setAreaLabels=function(t){for(var e in this.AreaLabels=t,t)this.setLabelRendered(e,!0)},o.prototype.getShortAreaName=function(t){return this.AreaLabels&&this.AreaLabels[t]?this.AreaLabels[t][o._SHORT_NAME]:null},o.prototype.getLongAreaName=function(t){return this.AreaLabels&&this.AreaLabels[t]?this.AreaLabels[t][o._LONG_NAME]:null},o.prototype.setAreaLabelInfo=function(t){this._labelInfo=t},o.prototype.getLabelInfoForArea=function(t){return this._labelInfo?this._labelInfo[t]:null},o.prototype.getArea=function(t){return this.Areas[t]},o.prototype.getAreaShape=function(t){return this.AreaShapes[t]},o.prototype.getLabelDisplay=function(){return this._labelDisplay},o.prototype.setDropSiteCSSStyle=function(t){this._dropSiteCSSStyle=t},o.prototype.setLayerCSSStyle=function(t){this._layerCSSStyle=t},o.prototype.getLayerCSSStyle=function(){return this._layerCSSStyle},o.prototype.setAreaRendered=function(t,e){this._renderArea[t]=e},o.prototype.setLabelRendered=function(t,e){this._renderLabel[t]=e},o.prototype.setIsolatedArea=function(t){for(var e in this._isolatedArea=t,this._layerDim=null,this.AreaShapes)e!=t&&(this._renderArea[e]=!1)},o.prototype.getIsolatedArea=function(){return this._isolatedArea},o.prototype.getLayerDim=function(){if(!this._layerDim){var a=this._tmap.getMapName();if(this._isolatedArea)this._layerDim=a?e.PathUtils.getDimensions(e.PathUtils.createPathArray(t.DvtBaseMapManager.getPathForArea(this._tmap.getMapName(),this.LayerName,this._isolatedArea))):e.DisplayableUtils.getDimensionsForced(this._tmap.getCtx(),this.getAreaShape(this._isolatedArea));else if(a&&"world"!=a&&"worldRegions"!=a&&(this._layerDim=t.DvtBaseMapManager.getBaseMapDim(this._tmap.getMapName(),this.LayerName)),!this._layerDim){var i=this.AreaContainer.getDimensions().getUnion(this._tmap.getDataAreaContainer().getDimensions());i.w>0&&i.h>0&&(this._layerDim=i)}}return this._layerDim},o.prototype._createAreaAndLabel=function(t){var a=this.AreaShapes[t];if(a){if(!this.Areas[t]){var n=this._tmap.getCtx(),s=this.AreaLabels&&this.AreaLabels[t]?this.AreaLabels[t][o._LONG_NAME]:null,l=new i(n,this._tmap,a,t,s,this._tmap.supportsVectorEffects());this.Areas[t]=l,this.EventHandler.associate(a,l),l.setDatatip(s)}if(this._renderLabel[t]){var h=this._areaLabels[t];if(!h&&"off"!=this._labelDisplay&&this.AreaLabels){var c="short"==this._labelType?this.AreaLabels[t][o._SHORT_NAME]:this.AreaLabels[t][o._LONG_NAME];if(c){if(this._labelInfo&&this._labelInfo[t])h=new r(this._tmap.getCtx(),c,this._labelInfo[t],this._labelDisplay,this.LabelContainer,this._tmap.supportsVectorEffects());else{var p=e.DisplayableUtils.getDimensionsForced(this._tmap.getCtx(),a);h=new r(this._tmap.getCtx(),c,[[p.x,p.y,p.w,p.h]],this._labelDisplay,this.LabelContainer,this._tmap.supportsVectorEffects())}this._areaLabels[t]=h,this._layerCSSStyle&&h.setCSSStyle(this._layerCSSStyle)}}}}},o.prototype._addAreaAndLabel=function(t,e){if(this.AreaShapes[t]){this.AreaContainer.addChild(this.Areas[t]);var a=this._areaLabels[t];a&&(this._renderLabel[t]?a.update(this.PzcMatrix):a.reset(),this._renderedLabels[t]=this._renderLabel[t]),e&&(e.push(this.Areas[t]),a&&(e.push(a),e.push(a.getLeaderLine())))}},o.prototype.resetRenderedAreas=function(){for(var t in this.AreaLabels)this.setAreaRendered(t,!0),this.setLabelRendered(t,!0)},o.prototype.updateDataLayer=function(t,e,a){if(o.superclass.updateDataLayer.call(this,t,e,a),a==this.getLayerName())for(var i in this.AreaShapes)this._createAreaAndLabel(i),this._renderArea[i]&&this._addAreaAndLabel(i)},o.prototype.render=function(t){for(var e in this.AreaShapes)this._createAreaAndLabel(e),this._renderArea[e]&&this._addAreaAndLabel(e);o.superclass.render.call(this,t)},o.prototype.PreDataLayerUpdate=function(){for(var t in this._renderArea)this._renderArea[t]||(this._createAreaAndLabel(t),this._addAreaAndLabel(t))},o.prototype.PostDataLayerUpdate=function(){for(var t in this._renderArea)if(!this._renderArea[t]){this.AreaContainer.removeChild(this.Areas[t]);var e=this._areaLabels[t];if(e){this._renderedLabels[t]=!1,this.LabelContainer.removeChild(e);var a=e.getLeaderLine();a&&this.LabelContainer.removeChild(a)}}},o.prototype._renderSelectedAreasAndLabels=function(t,e){for(var a=0;a<t.length;a++)this._createAreaAndLabel(t[a]),this._renderArea[t[a]]&&this._addAreaAndLabel(t[a],e)},o.prototype.__getObjectUnderPoint=function(t,e){for(var a in this.Areas)if(this.Areas[a].contains(t,e))return this.Areas[a];return null},o.prototype.__showDropSiteFeedback=function(t){if(this._dropSiteFeedback&&(this.AreaContainer.removeChild(this._dropSiteFeedback),this._dropSiteFeedback=null),t&&(this._dropSiteFeedback=t.getDropSiteFeedback(),this._dropSiteFeedback)){this._dropSiteFeedback.setFill(new e.SolidFill(this._dropSiteCSSStyle.getStyle(e.CSSStyle.BACKGROUND_COLOR)));var a=this._dropSiteCSSStyle.getStyle(e.CSSStyle.BORDER_WIDTH)?this._dropSiteCSSStyle.getStyle(e.CSSStyle.BORDER_WIDTH).substring(0,this._dropSiteCSSStyle.getStyle(e.CSSStyle.BORDER_WIDTH).indexOf("px")):1;this._tmap.supportsVectorEffects()||(a/=this.PzcMatrix.getA());var i=new e.Stroke(this._dropSiteCSSStyle.getStyle(e.CSSStyle.BORDER_COLOR),1,a,this._tmap.supportsVectorEffects());this._dropSiteFeedback.setStroke(i),this.AreaContainer.addChild(this._dropSiteFeedback)}return this._dropSiteFeedback},o.prototype.HandleZoomEvent=function(t,e){if(o.superclass.HandleZoomEvent.call(this,t,e),!this._tmap.supportsVectorEffects())for(var a in this.Areas)this.Areas[a].HandleZoomEvent(e);for(var a in this._renderedLabels)if(this._renderedLabels[a]){var i=this._areaLabels[a];i&&i.update(e)}};var s=function(t,e,a){this.Init(t,e,a)};e.Obj.createSubclass(s,e.Container),s.prototype.Init=function(t,a,i){if(s.superclass.Init.call(this,t),this._dataItem=a,a instanceof e.BaseComponent)this._width=a.getWidth(),this._height=a.getHeight(),this.addChild(a);else{Array.isArray(a)?a.forEach(function(t){this.getElem().appendChild(t)}.bind(this)):this.getElem().appendChild(a);var r=e.DisplayableUtils.getDimensionsForced(t,this);this._width=r.w,this._height=r.h}this._boundingRect=new e.Rect(t,0,0,this._width,this._height),this._boundingRect.setInvisibleFill();var n=new e.Stroke(i.selectedInnerColor,1,2),o=new e.Stroke(i.hoverColor,1,2),l=new e.Stroke(i.selectedInnerColor,1,1),h=new e.Stroke(i.selectedOuterColor,1,2),c=new e.Stroke(i.selectedInnerColor,1,2),p=new e.Stroke(i.selectedOuterColor,1,2);this._boundingRect.setHoverStroke(n,o).setSelectedStroke(l,h).setSelectedHoverStroke(c,p),this._boundingRect.setStrokeAlignment("outer"),this.addChildAt(this._boundingRect,0)},s.prototype.setAriaProperty=function(t,a){e.Agent.isTouchDevice()?this._boundingRect.setAriaProperty(t,a):s.superclass.setAriaProperty.call(this,t,a)},s.prototype.setAriaRole=function(t){e.Agent.isTouchDevice()?this._boundingRect.setAriaRole(t):s.superclass.setAriaRole.call(this,t)},s.prototype.getWidth=function(){return this._width},s.prototype.getHeight=function(){return this._height},s.prototype.setSelectable=function(t){this._boundingRect.setSelectable(t)},s.prototype.isSelectable=function(){return this._boundingRect.isSelectable()},s.prototype.isSelected=function(){return this._boundingRect.isSelected()},s.prototype.setSelected=function(t){this._boundingRect.setSelected(t)},s.prototype.showHoverEffect=function(){this._boundingRect.showHoverEffect()},s.prototype.hideHoverEffect=function(){this._boundingRect.hideHoverEffect()},s.prototype.getRootElement=function(){return this._dataItem},s.prototype.updateRootElement=function(t,a){this._dataItem!==t&&(this._dataItem&&a&&(this._dataItem instanceof e.BaseComponent?this.removeChild(this._dataItem):Array.isArray(this._dataItem)?this._dataItem.forEach(function(t){this.getElem().removeChild(t)}.bind(this)):this.getElem().removeChild(this._dataItem)),t instanceof e.BaseComponent?this.addChild(t):Array.isArray(t)?t.forEach(function(t){this.getElem().appendChild(t)}.bind(this)):this.getElem().appendChild(t),this._dataItem=t)},s.prototype.fireKeyboardListener=function(t){this._dataItem instanceof e.BaseComponent&&this._dataItem.fireKeyboardListener(t)};const l="linkNode",h=function(t,a,i,r,n){var o=r.x,s=r.y,l=n.x,h=n.y,c=t.getMap(),p=e.PathUtils.moveTo(o,s),_=t.trackLink(a,i),g=Math.min(c.getWidth(),c.getHeight())/35;if(l-o==0||h-s==0){if(_>1){if(g*=_-1,l-o==0){var d=.3*Math.abs(s-h);C=s>h?s-d:s+d,S=v=o+g,O=h>s?h-d:h+d}else{d=.3*Math.abs(o-l);v=o>l?o-d:o+d,S=l>o?l-d:l+d,O=C=s-g}p+=e.PathUtils.cubicTo(v,C,S,O,l,h)}else p+=e.PathUtils.lineTo(l,h)}else{var u=(d=Math.sqrt(Math.pow(l-o,2),Math.pow(h-s,2)))/4;_>1&&(u+=(_-1)*g);var y=(h-s)/(l-o),f=-1/y;f>0&&(u*=-1);var v,S,A=.3*d/Math.sqrt(1+Math.pow(y,2)),m=l-o>0,b=o+(m?1:-1)*A,D=y*(b-o)+s,E=l+(m?-1:1)*A,L=y*(E-l)+h,M=u/Math.sqrt(1+Math.pow(f,2)),C=f*((v=b+M)-b)+D,O=f*((S=E+M)-E)+L;p+=e.PathUtils.cubicTo(v,C,S,O,l,h)}return p},c=function(t,a,i){var r=a.keyCode;if(!i||i.length<1||!t)return null;for(var n=t.getCenter(),o=t.getDisplayable().getCtx(),s=0;s<i.length;s++){var l,h=i[s];if(l=e.Obj.compareValues(o,t.getId(),h.getStartMarker().getId())?h.getEndPoint():h.getStartPoint(),r==e.KeyboardEvent.OPEN_ANGLED_BRACKET&&l.x<=n.x||r==e.KeyboardEvent.CLOSE_ANGLED_BRACKET&&l.x>=n.x)break}return h};var p=function(t,e,a,i,r,n,o){this.Init(t,e,a,i,r,n,o)};e.Obj.createSubclass(p,e.Obj),p.ANIMATION_DELETE_PRIORITY=0,p.ANIMATION_UPDATE_PRIORITY=1,p.ANIMATION_INSERT_PRIORITY=2,p.prototype.Init=function(t,e,a,i,r,n,o){if(this._data=t,this._itemData=this._data._itemData,this._dataLayer=e,this.Displayable=a,this._isSelected=!1,this._isShowingHoverEffect=!1,this._isShowingKeyboardFocusEffect=!1,this._hasContentBoundToTouchEvent=!1,this._contentStoredInTouchEventContainer=null,this.Displayable.setDataColor&&!o&&this.Displayable.setDataColor(t.color),this._label=i,this._center=r,this.Zoom=1,this._view=e.getMap(),this._locationName=n,this._data.categories||this._label&&(this._data.categories=[this._label.getTextString()]),"auto"==this._view.getDisplayTooltips()&&n&&(this._data.shortDesc=t.shortDesc?n+": "+this._resolveShortDesc(t.shortDesc):n),this.Displayable){var s=t.svgStyle||t.style,l=t.svgClassName||t.className;this.Displayable.setStyle(s).setClassName(l),this.Displayable.setAriaRole("img")}this.UpdateAriaLabel(),this.setSelectable(this.isSelectable())},p.prototype._resolveShortDesc=function(t){return"function"==typeof t?t(this.getShortDescContext(this)):t},p.prototype.getId=function(){return this._data.id},p.prototype.getLocation=function(){return this._data.location},p.prototype.getLocationName=function(){return this._locationName},p.prototype.getCenter=function(){return this._center},p.prototype._setCenter=function(t){this._center=t,this.__recenter()},p.prototype.getDisplayable=function(){return this.Displayable},p.prototype.getLabel=function(){return this._label},p.prototype.getDataLayer=function(){return this._dataLayer},p.prototype.setVisible=function(t){this.Displayable.setVisible(t),this._label&&this._label.setVisible(t)},p.prototype.getShortDesc=function(){return this._resolveShortDesc(this._data.shortDesc)},p.prototype.removeLabel=function(){this._label=null},p.prototype.getSize=function(){return this.Displayable.getWidth?this.Displayable.getWidth()*this.Displayable.getHeight():0},p.prototype.getCategories=function(){var t=this._data.categories;return t||[]},p.prototype.getDatatip=function(){if("none"!=this._view.getDisplayTooltips()){var t=this._view.getOptions()._tooltip;return t?this._view.getCtx().getTooltipManager().getCustomTooltip(t.renderer,this.getDataContext()):this.getShortDesc()}return null},p.prototype.getDataContext=function(){var t=this._data._noTemplate?this._itemData:this._data;return{color:this.getDatatipColor(),component:this._view.getOptions()._widgetConstructor,data:t,id:this.getId(),itemData:this._itemData,label:this._label?this._label.getTextString():null,location:this.getLocation(),locationName:this.getLocationName(),tooltip:this.getShortDesc(),x:this._data.x,y:this._data.y}},p.prototype.getShortDescContext=function(t){return{data:t._data._noTemplate?t._itemData:t._data,id:t.getId(),itemData:t._itemData,label:t._label?t._label.getTextString():null,location:t.getLocation(),locationName:t.getLocationName(),x:t._data.x,y:t._data.y}},p.prototype.getDatatipColor=function(){return this._data.color?this._data.color:"#000000"},p.prototype.getAriaLabel=function(){var t=[];return this.isSelectable()&&t.push(this._view.getOptions().translations[this.isSelected()?"stateSelected":"stateUnselected"]),e.Displayable.generateAriaLabel(this.getShortDesc(),t)},p.prototype.getDisplayables=function(){return[this.getDisplayable()]},p.prototype.UpdateAriaLabel=function(){if(!e.Agent.deferAriaCreation()){var t=this.getAriaLabel();t&&this.Displayable.setAriaProperty("label",t)}},p.prototype.setSelectable=function(t){var a=this.getLabel();this.Displayable.setSelectable&&(this.Displayable.setSelectable(t),a&&t&&a.setCursor(e.SelectionEffectUtils.getSelectingCursor()))},p.prototype.isSelectable=function(){return!!this.Displayable.isSelectable&&("off"!==this._data.selectable&&this._dataLayer.isSelectable())},p.prototype.isSelected=function(){return this._isSelected},p.prototype.setSelected=function(t){if(this.isSelectable()){var e=this._getState();this._isSelected=t,this._dataLayer.getOptions().selectionRenderer?this._callCustomRenderer(this._dataLayer.getOptions().selectionRenderer,this._getState(),e):this.processDefaultSelectionEffect(t),this.UpdateAriaLabel()}},p.prototype.showHoverEffect=function(){if(!this.IsHoverEffectShown()){var t=this._getState();this._isShowingHoverEffect=!0,this._dataLayer.getOptions().hoverRenderer?this._callCustomRenderer(this._dataLayer.getOptions().hoverRenderer,this._getState(),t):this.processDefaultHoverEffect(!0)}},p.prototype.hideHoverEffect=function(){if(this.IsHoverEffectShown()){var t=this._getState();this._isShowingHoverEffect=!1,this._dataLayer.getOptions().hoverRenderer?this._callCustomRenderer(this._dataLayer.getOptions().hoverRenderer,this._getState(),t):this.processDefaultHoverEffect(!1)}},p.prototype.isDragAvailable=function(t){for(var e=this._dataLayer.getClientId(),a=0;a<t.length;a++)if(t[a]==e)return e;return e},p.prototype.getDragTransferable=function(t,e){return this._dataLayer.__getDragTransferable(this)},p.prototype.getDragFeedback=function(t,e){return this._dataLayer.__getDragFeedback()},p.prototype.getNextNavigable=function(t){var a;if(t.type==e.MouseEvent.CLICK)return this;if(t.keyCode==e.KeyboardEvent.SPACE&&t.ctrlKey)return this;if((t.keyCode==e.KeyboardEvent.OPEN_ANGLED_BRACKET||e.KeyboardEvent.CLOSE_ANGLED_BRACKET)&&t.altKey){var i=this.getDataLayer().getNavigableLinksForNodeId(this.getId());a=c(this,t,i)}else a=e.KeyboardHandler.getNextAdjacentNavigable(this,t,this.GetNavigables());return this.getDataLayer().getMap().ensureObjInViewport(t,a),a},p.prototype.GetNavigables=function(){return this.getDataLayer().getMap().getNavigableMarkers()},p.prototype.getKeyboardBoundingBox=function(t){return this.Displayable.getParent()?this.Displayable.getDimensions(t||this.Displayable.getCtx().getStage()):new e.Rectangle(0,0,0,0)},p.prototype.getTargetElem=function(){return this.Displayable.getElem()},p.prototype.showKeyboardFocusEffect=function(){if(!this.isShowingKeyboardFocusEffect()){var t=this._getState();this._isShowingKeyboardFocusEffect=!0,this._dataLayer.getOptions().focusRenderer?this._callCustomRenderer(this._dataLayer.getOptions().focusRenderer,this._getState(),t):this.processDefaultFocusEffect(!0)}},p.prototype.hideKeyboardFocusEffect=function(){if(this.isShowingKeyboardFocusEffect()){var t=this._getState();this._isShowingKeyboardFocusEffect=!1,this._dataLayer.getOptions().focusRenderer?this._callCustomRenderer(this._dataLayer.getOptions().focusRenderer,this._getState(),t):this.processDefaultFocusEffect(!1)}},p.prototype.isShowingKeyboardFocusEffect=function(){return this._isShowingKeyboardFocusEffect},p.prototype.HandleZoomEvent=function(t){this.Displayable.getParent()&&(this.Zoom=t.getA(),this.__recenter())},p.prototype.positionLabel=function(){if(this._label){this._label.alignCenter();var t,a=this.Displayable.getCx()*this.Zoom,i=this.Displayable.getCy()*this.Zoom,r=this.Displayable.getHeight(),n=this.Displayable instanceof e.SimpleMarker?this.Displayable.getType():"image",o=this._data.labelPosition;"top"==o?(t=i-r/2-4,this._label.alignBottom()):"bottom"==o?(t=i+r/2,this._label.alignTop()):n==e.SimpleMarker.TRIANGLE_UP?(t=i+r/6,this._label.alignMiddle()):n==e.SimpleMarker.TRIANGLE_DOWN?(t=i-r/6,this._label.alignMiddle()):(t=i,this._label.alignMiddle()),this._label.setX(a).setY(t)}},p.prototype.__recenter=function(){var t=this.Displayable.getWidth(),a=this.Displayable.getHeight();if(null!=t&&null!=a&&this.Displayable.getParent()){var i=0,r=this._center.x,n=this._center.y;this.Displayable.getRotation&&(i=this.Displayable.getRotation(),r=this._center.x*Math.cos(i)-this._center.y*Math.sin(i),n=this._center.x*Math.sin(i)+this._center.y*Math.cos(i)),r=this._center.x*this.Zoom-r,n=this._center.y*this.Zoom-n,this.Displayable instanceof s&&(r+=this._center.x-t/2,n+=this._center.y-a/2),this.Displayable.setTranslate(r,n),e.Agent.workaroundFirefoxRepaint(this.Displayable),this.positionLabel()}},p.prototype.animateUpdate=function(t,a){var i=new e.CustomAnimation(this._view.getCtx(),this.Displayable,this.getDataLayer().getAnimationDuration()),r=a.getDisplayable();if(this.Displayable.getFill){var n=r.getFill(),o=this.Displayable.getFill();if(o instanceof e.SolidFill&&!o.equals(n)){if(this.Displayable.setFill(n),a.getLabel()&&this._label){var s=this._label.getFill();this._label.setFill(a.getLabel().getFill()),s.equals(this._label.getFill())||i.getAnimator().addProp(e.Animator.TYPE_FILL,this._label,this._label.getFill,this._label.setFill,s)}i.getAnimator().addProp(e.Animator.TYPE_FILL,this.Displayable,this.Displayable.getFill,this.Displayable.setFill,o)}}if(this.Displayable.getCenterDimensions){var l=a.getDisplayable().getCenterDimensions(),h=this.Displayable.getCenterDimensions();l.x==h.x&&l.y==h.y&&l.w==h.w&&l.h==h.h||(this.Displayable.setCenterDimensions(l),i.getAnimator().addProp(e.Animator.TYPE_RECTANGLE,this.Displayable,this.Displayable.getCenterDimensions,this.Displayable.setCenterDimensions,h))}var c=r.getRotation(),_=this.Displayable.getRotation();if(c!=_){var g=c-_;g>Math.PI?c-=2*Math.PI:g<-Math.PI&&(c+=2*Math.PI),this.Displayable.setRotation(c),i.getAnimator().addProp(e.Animator.TYPE_NUMBER,this.Displayable,this.Displayable.getRotation,this.Displayable.setRotation,_)}var d=a.getCenter(),u=this.getCenter();if(d&&u&&(d.x==u.x&&d.y==u.y&&c==_||(this._setCenter(new e.Point(d.x,d.y)),i.getAnimator().addProp(e.Animator.TYPE_POINT,this,this.getCenter,this._setCenter,new e.Point(u.x,u.y)))),this._label&&a.getLabel()){var y=a.getLabel().getX(),f=this._label.getX();y!=f&&(this._label.setX(y),i.getAnimator().addProp(e.Animator.TYPE_NUMBER,this._label,this._label.getX,this._label.setX,f));var v=a.getLabel().getY(),S=this._label.getY();v!=S&&(this._label.setY(v),i.getAnimator().addProp(e.Animator.TYPE_NUMBER,this._label,this._label.getY,this._label.setY,S)),a.getLabel().setAlpha(0)}else a.getLabel()&&a.getLabel().setAlpha(0);r.setAlpha(0),t.add(i,p.ANIMATION_UPDATE_PRIORITY)},p.prototype.animateDelete=function(t,a){var i=[this.Displayable],r=this.getLabel();r&&i.push(r);var n=new e.AnimFadeOut(this._view.getCtx(),i,this.getDataLayer().getAnimationDuration());t.add(n,p.ANIMATION_DELETE_PRIORITY)},p.prototype.animateInsert=function(t){var a=[this.Displayable];this.Displayable.setAlpha(0);var i=this.getLabel();i&&(i.setAlpha(0),a.push(i));var r=new e.AnimFadeIn(this._view.getCtx(),a,this.getDataLayer().getAnimationDuration());t.add(r,p.ANIMATION_INSERT_PRIORITY)},p.prototype.processDefaultSelectionEffect=function(t){this.Displayable.setSelected&&this.Displayable.setSelected(t)},p.prototype.processDefaultFocusEffect=function(t){this.processDefaultHoverEffect(t)},p.prototype.processDefaultHoverEffect=function(t){t?this.Displayable.showHoverEffect&&this.Displayable.showHoverEffect():this.Displayable.hideHoverEffect&&!this.isShowingKeyboardFocusEffect()&&this.Displayable.hideHoverEffect()},p.prototype.handleTouchStart=function(){this._hasContentBoundToTouchEvent=!0},p.prototype.handleTouchEnd=function(){this._hasContentBoundToTouchEvent=!1,this._contentStoredInTouchEventContainer=null},p.prototype._callCustomRenderer=function(t,e,a){if(this.Displayable instanceof s){var i=this._view.getOptions()._contextHandler;if(i){var r=this.Displayable.getRootElement(),n=t(i(this.Displayable.getElem(),r,this._data,this._itemData,e,a));if(n||!r||!this._view.getCtx().isCustomElement()){var o=!1;n!=r&&(o=this._checkAndMoveContents(r)),n===this._contentStoredInTouchEventContainer&&(this._hasContentBoundToTouchEvent=!0),this.Displayable.updateRootElement(n,!o)}}}},p.prototype.IsHoverEffectShown=function(){return this._isShowingHoverEffect},p.prototype._getState=function(){return{hovered:this.IsHoverEffectShown(),selected:this.isSelected(),focused:this.isShowingKeyboardFocusEffect()}},p.prototype._checkAndMoveContents=function(t){return!!this._hasContentBoundToTouchEvent&&(this._view.storeTouchEventContent(t,this),this._contentStoredInTouchEventContainer=t,this._hasContentBoundToTouchEvent=!1,!0)};var _=function(t,e,a,i,r){this.Init(t,e,a,i,r)};e.Obj.createSubclass(_,p),_.prototype.Init=function(t,e,a,i,r){_.superclass.Init.call(this,t,e,a,i,null,r)},_.prototype.setAreaLayer=function(t){this._dataAreaLayer=t},_.prototype.setSelected=function(t){this.isSelectable()&&(t&&!this.IsHoverEffectShown()&&this._dataAreaLayer.addChild(this.Displayable),_.superclass.setSelected.call(this,t))},_.prototype.showHoverEffect=function(){this._dataAreaLayer.addChild(this.Displayable),_.superclass.showHoverEffect.call(this)},_.prototype.hideHoverEffect=function(){this.isSelected()?this._dataAreaLayer.addChild(this.Displayable):this._dataAreaLayer.addChildAt(this.Displayable,0),_.superclass.hideHoverEffect.call(this)},_.prototype.HandleZoomEvent=function(t){_.superclass.HandleZoomEvent.call(this,t),this.Displayable.getParent()&&(this.Displayable.handleZoomEvent(t),this.positionLabel(t))},_.prototype.positionLabel=function(t){this.getLabel()&&this.getLabel().update(t)},_.prototype.GetNavigables=function(){return this.getDataLayer().getMap().getNavigableAreas()},_.prototype.animateUpdate=function(t,e){_.superclass.animateUpdate.call(this,t,e),this.getDataLayer().getMapLayer().setAreaRendered(this.getLocation(),!1)},_.prototype.__recenter=function(){};var g=function(t){this._tmap=t};e.Obj.createSubclass(g,e.Automation),g.prototype.GetSubIdForDomElement=function(t){var e=this._tmap.getEventManager().GetLogicalObject(t);return e&&(e instanceof _||e instanceof p)?this._getSubId(e):null},g.prototype.getDomElementForSubId=function(t){if(t==e.Automation.TOOLTIP_SUBID)return this.GetTooltipElement(this._tmap);var a=t.indexOf(":"),i=t.indexOf("[");if(a>0&&i>0){var r=t.substring(0,a),n=t.substring(a+1,i),o=parseInt(t.substring(i+1,t.length-1));return this._getDomElement(r,n,o)}return null},g.prototype.getData=function(t,e,a){var i=this._getDataObject(t,e,a);if(i){var r={};r.color=i.getDatatipColor(),r.tooltip=i.getShortDesc();var n=i.getLabel();return r.label=n?n.getTextString():null,r.selected=i.isSelected(),r}return null},g.prototype._getDomElement=function(t,e,a){var i=this._getDataObject(t,e,a);return i?i.getDisplayable().getElem():null},g.prototype._getSubId=function(t){for(var a=t.getDisplayable(),i=this._tmap.getAllLayers(),r=0;r<i.length;r++){var n=i[r].getDataLayers();for(var o in n)if(a instanceof e.Path){for(var s=n[o].getAreaObjects(),l=0;l<s.length;l++)if(s[l]===t)return this._getDataLayerId(o)+":area["+l+"]";var h=n[o].getLinkObjects();for(l=0;l<h.length;l++)if(h[l]===t)return this._getDataLayerId(o)+":link["+l+"]"}else{var c=n[o].getMarkerObjects();for(l=0;l<c.length;l++)if(c[l]===t)return this._getDataLayerId(o)+":marker["+l+"]"}}return null},g.prototype._getDataObject=function(t,e,a){for(var i=this._tmap.getAllLayers(),r=0;r<i.length;r++){var n=i[r].getDataLayers();for(var o in n)if(this._getDataLayerId(o)==t){if("area"==e)return n[o].getDataAreaCollection()[a];if("marker"==e)return n[o].getDataMarkerCollection()[a];if("link"==e)return n[o].getDataLinkCollection()[a]}}return null},g.prototype._getDataLayerId=function(t){var e=t.lastIndexOf(":");return e>0?t.substring(e+1):t};var d=function(t){this.Init({alta:d.SKIN_ALTA},t)};e.Obj.createSubclass(d,e.BaseComponentDefaults),d.SKIN_ALTA={animationDuration:500,animationOnDisplay:"none",animationOnMapChange:"none",highlightMatch:"all",hoverBehavior:"none",initialZooming:"none",markerZoomBehavior:"fixed",panning:"none",tooltipDisplay:"auto",touchResponse:"auto",visualEffects:"none",zooming:"none",styleDefaults:{skin:"alta",_areaStyle:{backgroundColor:"#DDDDDD",borderColor:"#FFFFFF"},hoverBehaviorDelay:200,dataAreaDefaults:{borderColor:"#FFFFFF",hoverColor:"#FFFFFF",opacity:1,selectedInnerColor:"#FFFFFF",selectedOuterColor:"#000000"},dataMarkerDefaults:{borderColor:"#FFFFFF",borderStyle:"solid",borderWidth:.5,color:"rgb(51,51,51)",height:8,labelStyle:new e.CSSStyle(e.BaseComponentDefaults.FONT_FAMILY_ALTA_12+"color:#333333"),opacity:1,scaleX:1,scaleY:1,shape:"circle",width:8},linkDefaults:{color:"#9bb2c7",_hoverColor:"#FFFFFF",_selectedColor:"#000000",width:2},labelStyle:new e.CSSStyle(e.BaseComponentDefaults.FONT_FAMILY_ALTA_12)},resources:{images:{},translations:{}}},d.DEFAULT_AREA_LAYER={animationOnLayerChange:"none",labelDisplay:"auto",labelType:"short"},d.DEFAULT_DATA_LAYER={animationOnDataChange:"none",selectionMode:"none"},d.prototype.calcAreaLayerOptions=function(t,a){var i=d.DEFAULT_AREA_LAYER;return a&&(i=e.JsonUtils.merge({labelDisplay:"off"},i)),e.JsonUtils.merge(t,i)},d.prototype.calcDataLayerOptions=function(t){return e.JsonUtils.merge(t,d.DEFAULT_DATA_LAYER)},d.getGapSize=function(t,e){return Math.ceil(e*t.getGapRatio())},d.prototype.getNoCloneObject=function(){return{mapProvider:!0,areaLayers:{areaDataLayer:{areas:!0,markers:!0,links:!0}},pointDataLayers:{markers:!0,links:!0},areas:!0,markers:!0,links:!0}},d.prototype.getAnimationDuration=function(t){return t.animationDuration};var u=function(t,e,a){this.Init(t,e,a,a)};e.Obj.createSubclass(u,e.EventManager),u.prototype.Init=function(t,e,a,i){u.superclass.Init.call(this,t,e,a,i),this._selectionHandlers=new Object,this._tmap=a,this._bPassOnEvent=!1},u.prototype.getSelectionHandler=function(t){if(t&&t.getDataLayer){var e=t.getDataLayer().getClientId();return this._selectionHandlers[e]}},u.prototype.setSelectionHandler=function(t,e){this._selectionHandlers[t]=e},u.prototype.setInitialFocus=function(t){t&&u.superclass.setFocus.call(this,t)},u.prototype.OnClick=function(t){var a=this.GetLogicalObject(t.target);if(this.SetClickInfo(a),!(a&&a.isSelectable&&a.isSelectable()))for(var i in this._selectionHandlers){if(this._selectionHandlers[i].processClick(null,t.ctrlKey)){var r=e.EventFactory.newSelectionEvent([]);r.clientId=i,this._callback.call(this._callbackObj,r)}}u.superclass.OnClick.call(this,t)},u.prototype.SetClickInfo=function(t){var e=null,a=null,r=null;if(t&&(t instanceof p?r=t.getDisplayable():t instanceof i&&(r=t),t.getDataLayer)){var n=t.getDataLayer();e=n.getClientId(),a=n.getMapLayer().getLayerName()}this._tmap.setClickInfo(e,a,r)},u.prototype.ProcessKeyboardEvent=function(t){var a=!0,i=t.keyCode,r=this.getFocus(),n=r.getDisplayable();return i!=e.KeyboardEvent.TAB&&this._bPassOnEvent?(n.fireKeyboardListener(t),t.preventDefault()):i==e.KeyboardEvent.SPACE&&t.ctrlKey?(this.SetClickInfo(r),this.ProcessSelectionEventHelper(r,!0),t.preventDefault()):i!=e.KeyboardEvent.ZERO&&i!=e.KeyboardEvent.NUMPAD_ZERO||!t.ctrlKey?i==e.KeyboardEvent.TAB&&n instanceof s?!t.shiftKey&&r.isShowingKeyboardFocusEffect()?(r.hideKeyboardFocusEffect(),n.fireKeyboardListener(t),t.preventDefault(),this._bPassOnEvent=!0):t.shiftKey&&this._bPassOnEvent?(this.ShowFocusEffect(t,r),t.preventDefault(),this._bPassOnEvent=!1):(this._bPassOnEvent&&r.showKeyboardFocusEffect(),a=u.superclass.ProcessKeyboardEvent.call(this,t),this._bPassOnEvent=!1):(i==e.KeyboardEvent.TAB&&r&&this._tmap.ensureObjInViewport(t,r),a=u.superclass.ProcessKeyboardEvent.call(this,t)):(t.altKey?this._tmap.fitRegion(n):this._tmap.fitSelectedRegions(),t.preventDefault()),a},u.prototype.OnComponentTouchClick=function(t){if(!this.GetEventInfo(t,a.PanZoomCanvasEventManager.EVENT_INFO_PANNED_KEY)){var i=this.GetLogicalObject(t.target);if(this.SetClickInfo(i),i===this._tmap)for(var r in this._selectionHandlers){if(this._selectionHandlers[r].processClick(null,t.ctrlKey)){for(var n=this._selectionHandlers[r].getSelection(),o=[],s=0;s<n.length;s++)o.push(n[s].getId());var l=e.EventFactory.newSelectionEvent(o);this._callback.call(this._callbackObj,l)}}u.superclass.OnComponentTouchClick.call(this,t)}},u.prototype.HandleTouchActionsEnd=function(t,e){var a=this.GetLogicalObject(t.target);this.SetClickInfo(a),u.superclass.HandleTouchActionsEnd.call(this,t,e)},u.prototype.HandleImmediateTouchStartInternal=function(t){u.superclass.HandleImmediateTouchStartInternal.call(this,t);var e=this.GetLogicalObject(t.target);e instanceof p&&e.handleTouchStart(),this._tmap.handleTouchStart()},u.prototype.HandleImmediateTouchEndInternal=function(t){u.superclass.HandleImmediateTouchEndInternal.call(this,t);var e=this.GetLogicalObject(t.target);e instanceof p&&e.handleTouchEnd(),this._tmap.handleTouchEnd()},u.prototype.ProcessRolloverEvent=function(t,a,i){var r=this._tmap.getOptions();if("dim"==r.hoverBehavior){var n=a.getCategories?a.getCategories():[];r.highlightedCategories=i?n.slice():null;var o=e.EventFactory.newCategoryHighlightEvent(r.highlightedCategories,i),s=e.CSSStyle.getTimeMilliseconds(r.styleDefaults.hoverBehaviorDelay);this.RolloverHandler.processEvent(o,this._tmap.getNavigableAreas().concat(this._tmap.getNavigableMarkers()).concat(this._tmap.getNavigableLinks()),s,"any"==r.highlightMatch)}},u.prototype.GetTouchResponse=function(){var t=this._tmap.getOptions();return"none"!==t.panning||"none"!==t.zooming?e.EventManager.TOUCH_RESPONSE_TOUCH_HOLD:t.touchResponse===e.EventManager.TOUCH_RESPONSE_TOUCH_START?e.EventManager.TOUCH_RESPONSE_TOUCH_START:e.EventManager.TOUCH_RESPONSE_AUTO},u.prototype.StoreInfoByEventType=function(t){return t!=a.PanZoomCanvasEventManager.EVENT_INFO_PANNED_KEY&&u.superclass.StoreInfoByEventType.call(this,t)},u.prototype.showFocusEffect=function(t,e){this.ShowFocusEffect(t,e)},u.prototype.ShowFocusEffect=function(t,e){this._tmap.isPanning()||u.superclass.ShowFocusEffect.call(this,t,e)};var y=function(t,e,a,i,r){this.Init(t,e,a,i,r)};e.Obj.createSubclass(y,e.Obj),y.prototype.Init=function(t,a,i,r,n){this._tmap=t,this._clientId=i,this._options=n,this._areaObjs=[],this._markerObjs=[],this._linkObjs=[],this._dataAreaCollection=[],this._dataMarkerCollection=[],this._dataLinkCollection=[],this._eventHandler=r,this._linkMap={},this._dataAreaLayer=new e.Container(this._tmap.getCtx()),this._dataPointLayer=new e.Container(this._tmap.getCtx()),this._dataLabelLayer=new e.Container(this._tmap.getCtx()),this._dataLinkLayer=new e.Container(this._tmap.getCtx()),this._tmap.getDataAreaContainer().addChildAt(this._dataAreaLayer,0),this._tmap.getDataPointContainer().addChildAt(this._dataPointLayer,0),this._tmap.getLabelContainer().addChildAt(this._dataLabelLayer,0),this._tmap.getLinkContainer().addChildAt(this._dataLinkLayer,0),this._parentLayer=a},y.prototype.getOptions=function(){return this._options},y.prototype.getContainers=function(){return[this._dataAreaLayer,this._dataPointLayer,this._dataLabelLayer,this._dataLinkLayer]},y.prototype.getScaledContainers=function(){return[this._dataAreaLayer]},y.prototype.getNonScaledContainers=function(){var t=[this._dataLabelLayer,this._dataLinkLayer];return this._tmap.isMarkerZoomBehaviorFixed()&&t.push(this._dataPointLayer),t},y.prototype.getDataLabelContainer=function(){return this._dataLabelLayer},y.prototype.getMapLayer=function(){return this._parentLayer},y.prototype.getMap=function(){return this._tmap},y.prototype.getAllObjects=function(){return this._markerObjs.concat(this._areaObjs).concat(this._linkObjs)},y.prototype.getAreaObjects=function(){return this._areaObjs},y.prototype.getMarkerObjects=function(){return this._markerObjs},y.prototype.getLinkObjects=function(){return this._linkObjs},y.prototype.getNavigableAreaObjects=function(){for(var t=[],e=0;e<this._areaObjs.length;e++)t.push(this._areaObjs[e]);return t},y.prototype.addMarkerObject=function(t){if(this._dataMarkerCollection.push(t),t){this._markerObjs.push(t),this._eventHandler.associate(t.getDisplayable(),t);var e=t.getLabel();e&&this._eventHandler.associate(e,t)}},y.prototype.addAreaObject=function(t){this._dataAreaCollection.push(t),t&&(this._areaObjs.push(t),this._eventHandler.associate(t.getDisplayable(),t),t.setAreaLayer(this._dataAreaLayer))},y.prototype.addLinkObject=function(t){this._dataLinkCollection.push(t),t&&(this._linkObjs.push(t),this._eventHandler.associate(t.getDisplayable(),t))},y.prototype.trackLink=function(t,e){var a=y._getLinkKey(t,e);return this._linkMap[a]?this._linkMap[a]++:this._linkMap[a]=1,this._linkMap[a]},y._getLinkKey=function(t,e){return t.x<e.x?t.x.toString()+t.y.toString()+e.x.toString()+e.y.toString():e.x.toString()+e.y.toString()+t.x.toString()+t.y.toString()},y.prototype.getDataAreaCollection=function(){return this._dataAreaCollection},y.prototype.getDataMarkerCollection=function(){return this._dataMarkerCollection},y.prototype.getDataLinkCollection=function(){return this._dataLinkCollection},y.prototype._removeAreaObject=function(t){var e=this._areaObjs.indexOf(t);-1!==e&&this._areaObjs.splice(e,1)},y.prototype.getClientId=function(){return this._clientId},y.prototype.setAnimation=function(t){this._animType=t},y.prototype.getAnimation=function(){return this._animType},y.prototype.setAnimationDuration=function(t){this._animDur=t},y.prototype.getAnimationDuration=function(){return this._animDur},y.prototype.setSelectionMode=function(t){this._selectionMode=t,this._selectionMode&&(this._selectionHandler=new e.SelectionHandler(this._tmap.getCtx(),this._selectionMode),this._eventHandler.setSelectionHandler(this._clientId,this._selectionHandler))},y.prototype.isSelectable=function(){return null!=this._selectionMode},y.prototype.setIsolatedAreaRowKey=function(t){this._isolatedAreaRowKey=t},y.prototype._updateAreaShape=function(t){var e=t.getDisplayable(),a=this._parentLayer.getAreaShape(t.getLocation());return a?(e.setCmds(a.getCmds()),!0):(this._removeAreaObject(t),!1)},y.prototype._renderAreaAndLabel=function(t){if(this._updateAreaShape(this._areaObjs[t])){var e=this._areaObjs[t].getDisplayable();this._dataAreaLayer.addChild(e);var a=this._areaObjs[t].getLabel();if(a){if(!a.hasBounds()){var i=e.getDimensions();a.addBounds(i)}a.update(this._pzcMatrix)}return!0}return!1},y.prototype.render=function(t){this._pzcMatrix=t;var a={},i=this._markerObjs.slice();i.sort(function(t,e){return t.getSize()<e.getSize()?1:t.getSize()>e.getSize()?-1:0});for(var r=0;r<i.length;r++){var n=i[r],o=n.getDisplayable(),s=n.getLabel();if(s){var l=new e.Container(o.getCtx());this._dataPointLayer.addChild(l),l.addChild(o),l.addChild(s),n.positionLabel()}else this._dataPointLayer.addChild(o);var h=n.getLocation();h&&(a[h]=!0)}for(r=0;r<this._areaObjs.length;r++)a[this._areaObjs[r].getLocation()]&&this._areaObjs[r].removeLabel(),this._renderAreaAndLabel(r)||r--;for(r=0;r<this._linkObjs.length;r++)this._dataLinkLayer.addChild(this._linkObjs[r].getDisplayable());this._initSelections&&this._processInitialSelections()},y.prototype.HandleZoomEvent=function(t,e){this._pzcMatrix=e;for(var a=this.getAreaObjects(),i=0;i<a.length;i++)a[i].HandleZoomEvent(e);if(this._tmap.isMarkerZoomBehaviorFixed()){var r=this.getMarkerObjects();for(i=0;i<r.length;i++)r[i].HandleZoomEvent(e)}this._linkMap={};var n=this.getLinkObjects();for(i=0;i<n.length;i++)n[i].HandleZoomEvent(e)},y.prototype.HandlePanEvent=function(t){this._pzcMatrix=t},y.prototype.setInitialSelections=function(t){this._initSelections=t},y.prototype._processInitialSelections=function(){this._selectionHandler&&(this._selectionHandler.processInitialSelections(this._initSelections,this.getAllObjects()),this._initSelections=null)},y.prototype.__getDragTransferable=function(t){if(this._selectionHandler){t.isSelected()||(this._selectionHandler.processClick(t,!1),this._eventHandler.fireSelectionEvent(t));for(var e=[],a=this._selectionHandler.getSelection(),i=0;i<a.length;i++)e.push(a[i].getId());return e}return null},y.prototype.__getDragFeedback=function(){for(var t=[],e=this._selectionHandler.getSelection(),a=0;a<e.length;a++)t.push(e[a].getDisplayable());return t},y.prototype.getSelectedAreas=function(t){for(var e=[],a=this.getAreaObjects(),i=new(this._tmap.getCtx().KeySetImpl)(t),r=0;r<a.length;r++)if(i.has(a[r].getId())){e.push(a[r].getLocation());break}return e},y.prototype.destroy=function(){for(var t=this.getAllObjects(),e=0;e<t.length;e++){var a=t[e].getDisplayable();if(a instanceof s){var i=a.getRootElement();Array.isArray(i)?i.forEach(function(t){i.destroy&&i.destroy()}.bind(this)):i.destroy&&i.destroy()}}this._eventHandler=null},y.prototype.getNavigableLinksForNodeId=function(t){for(var a=[],i=this._tmap.getCtx(),r=0;r<this._dataLinkCollection.length;r++){var n=this._dataLinkCollection[r],o=n.getStartMarker(),s=n.getEndMarker();(o&&e.Obj.compareValues(i,o.getId(),t)||s&&e.Obj.compareValues(i,s.getId(),t))&&a.push(n)}return a};var f=function(t,e,a,i,r,n,o){this.Init(t,e,a,i,r,n,o)};e.Obj.createSubclass(f,p),f.prototype.Init=function(t,e,a,i,r,n,o){f.superclass.Init.call(this,t,e,a),this._startPt=i,this._endPt=r,this._startMarker=n,this._endMarker=o},f.prototype.getStartMarker=function(){return this._startMarker},f.prototype.getEndMarker=function(){return this._endMarker},f.prototype.getStartPoint=function(){return this._startPt},f.prototype.getEndPoint=function(){return this._endPt},f.prototype.getNextNavigable=function(t){var a,i=this._dataLayer.getMap().EventManager.getKeyboardHandler();if(t.type==e.MouseEvent.CLICK)return this;if(t.keyCode==e.KeyboardEvent.SPACE&&t.ctrlKey)return this;if(i.getLinkNavigationType()===l)if(t.keyCode===e.KeyboardEvent.UP_ARROW){var r=i.getLinkMarker().getId(),n=(o=this.getDataLayer().getNavigableLinksForNodeId(r)).indexOf(this);++n===o.length&&(n=0),a=o[n]}else if(t.keyCode===e.KeyboardEvent.DOWN_ARROW){var o;r=i.getLinkMarker().getId(),n=(o=this.getDataLayer().getNavigableLinksForNodeId(r)).indexOf(this);-1===--n&&(n=o.length-1),a=o[n]}else if(t.keyCode===e.KeyboardEvent.LEFT_ARROW)a=this.getStartPoint().x<=this.getEndPoint().x?this.getStartMarker():this.getEndMarker();else{if(t.keyCode!==e.KeyboardEvent.RIGHT_ARROW)return this;a=this.getStartPoint().x>=this.getEndPoint().x?this.getStartMarker():this.getEndMarker()}else a=e.KeyboardHandler.getNextAdjacentNavigable(this,t,this.GetNavigables());return this.getDataLayer().getMap().ensureObjInViewport(t,a),a},f.prototype.GetNavigables=function(){return this.getDataLayer().getMap().getNavigableLinks()},f.prototype.__recenter=function(){if(this.Displayable.getParent()){var t=new e.Point(this._startPt.x*this.Zoom,this._startPt.y*this.Zoom),a=new e.Point(this._endPt.x*this.Zoom,this._endPt.y*this.Zoom),i=h(this._dataLayer,this._startPt,this._endPt,t,a);this.Displayable.setCmds(i),e.Agent.workaroundFirefoxRepaint(this.Displayable)}},f.prototype.animateUpdate=function(t,a){var i=new e.CustomAnimation(this._view.getCtx(),this.Displayable,this.getDataLayer().getAnimationDuration()),r=a.getDisplayable(),n=r.getStroke(),o=this.Displayable.getStroke();o.getColor()!=n.getColor()&&(this.Displayable.setStroke(n),i.getAnimator().addProp(e.Animator.TYPE_STROKE,this.Displayable,this.Displayable.getStroke,this.Displayable.setStroke,o));var s=a.getStartPoint(),l=a.getEndPoint(),h=this.getStartPoint(),c=this.getEndPoint(),_=!0;s.equals(h)&&l.equals(c)||(_=!1,this.Displayable.setAlpha(0),i.getAnimator().addProp(e.Animator.TYPE_NUMBER,this.Displayable,this.Displayable.getAlpha,this.Displayable.setAlpha,1),i.getAnimator().addProp(e.Animator.TYPE_NUMBER,r,r.getAlpha,r.setAlpha,0)),_&&r.setAlpha(0),t.add(i,p.ANIMATION_UPDATE_PRIORITY)},f.prototype.getShortDescContext=function(t){return{data:t._data._noTemplate?t._itemData:t._data,id:t.getId(),itemData:t._itemData,label:t._label?t._label.getTextString():null}};var v={_MANAGER:"DvtBaseMapManager",_UNPROCESSED:"_UNPROCESSED_MAPS",_TYPE:"type",_GEOMETRY:"geometry",_COORDINATES:"coordinates",_FEATURES:"features",_PROPERTIES:"properties",_TYPE_FEATURE_COLLECTION:"FeatureCollection",_TYPE_GEOMETRY_COLLECTION:"GeometryCollection",_TYPE_FEATURE:"Feature",_TYPE_POLYGON:"Polygon",_TYPE_MULTI_POLYGON:"MultiPolygon",_ID:"id",_SHORT_LABEL:"shortLabel",_LONG_LABEL:"longLabel",containsGeoJson:function(t){return t&&t.geo&&t.geo[v._TYPE]},parseMapInfo:function(t,e){var a={},i={},r=e.geo,n=e.propertiesKeys||{};if(!n[v._ID])throw new Error("Missing required mapProvider.propertiesKeys.id property.");var o=r[v._TYPE];if(o===v._TYPE_FEATURE_COLLECTION)for(var s=r[v._FEATURES],l=0;l<s.length;l++)v._parseFeature(t,s[l],n,i,a);else{if(o!==v._TYPE_FEATURE)throw new Error("GeoJSON type of "+o+" is not supported. Only Feature and FeatureCollection types are supported.");v._parseFeature(t,r,n,i,a)}if(0===Object.keys(i).length)throw new Error("No valid Features found in GeoJSON.");return{labels:a,areas:i}},_parseFeature:function(t,e,a,i,r){var n=e[v._PROPERTIES],o=e[v._GEOMETRY];if(v._isSupportedGeometry(o)){var s=n[a[v._ID]];if(s){var l=n[a[v._SHORT_LABEL]],h=n[a[v._LONG_LABEL]];(l||h)&&(r[s]=[l,h]),i[s]=v._geomToPath(o)}else t.oj.Logger.warn("No 'id' value found in the mapProvider.propertiesKey object. A Feature's 'properties' object must have an id in the field specified by the mapProvider.propertiesKey.id value.")}else t.oj.Logger.warn("A geometry of type "+o[v._TYPE]+" is not supported and will be skipped.")},_isSupportedGeometry:function(t){var e=t[v._TYPE];return e===v._TYPE_POLYGON||e===v._TYPE_MULTI_POLYGON},_geomToPath:function(t){var e="",a=t[v._TYPE],i=t[v._COORDINATES];if(a===v._TYPE_POLYGON)e=v._polygonToPath(i);else if(a===v._TYPE_MULTI_POLYGON)for(var r=0;r<i.length;r++)e+=v._polygonToPath(i[r]);return e},_polygonToPath:function(t){for(var e="",a=0;a<t.length;a++)e+=v._linearRingToPath(t[a]);return e},_linearRingToPath:function(t){var e,a,i,r="M";if(t)for(var n=0;n<t.length;n++){var o=t[n],s=o[0],l=-o[1];if("M"!==r){var h=s-a,c=l-i;if("l"==r){if(a==s){i=l,e=e+(r="v")+c;continue}if(i==l){a=s,e=e+(r="h")+h;continue}e=e+" "+h+" "+c}else r="l",e=e+"l"+h+" "+c;a=s,i=l}else a=s,i=l,r="x",e="M"+s+" "+l}return e+"Z"},_getCoord:function(t,e){for(var a=e;a<t.length;a++){var i=t[a];if("-"!==i&&(isNaN(i)||" "===i)){var r=null;return" "!==i&&(r=i),{coord:parseInt(t.substring(e,a)),idx:a,cmd:r}}}return{}},_pathToPolygon:function(t){var e=[],a=0,i=0,r=t[0];if(t)for(var n=[],o=1;o<t.length;o++){var s=v._getCoord(t,o),l=null;o=s.idx,"v"!==r&&"h"!==r?(l=v._getCoord(t,++o),o=l.idx,a+=s.coord,i+=l.coord):"v"===r?i+=s.coord:"h"===r&&(a+=s.coord),n.push([a,-i]),l?null!=l.cmd&&(r=l.cmd):null!=s.cmd&&(r=s.cmd),"Z"===r&&(e.push(n),n=[],r=t[++o])}return e}},S=function(t,e){this.Init(t,e)};e.Obj.createSubclass(S,e.Path),S.HOVER_STROKE_WIDTH=2,S.SELECTED_INNER_STROKE_WIDTH=1,S.SELECTED_OUTER_STROKE_WIDTH=4,S.SELECTED_HOVER_OUTER_STROKE_WIDTH=6,S.prototype.Init=function(t,e){S.superclass.Init.call(this,t),this.Zoom=1,this._bSupportsVectorEffects=e},S.prototype.setSelected=function(t){if(this.IsSelected!=t){var e="redwood"===this.getCtx().getThemeBehavior();if(t){var a=e?1:S.HOVER_STROKE_WIDTH,i=e?3:S.SELECTED_HOVER_OUTER_STROKE_WIDTH,r=e?1:S.SELECTED_INNER_STROKE_WIDTH,n=e?3:S.SELECTED_OUTER_STROKE_WIDTH;this.isHoverEffectShown()?(this.CreateSelectedHoverStrokes(),this.SelectedHoverInnerStroke=this._adjustStrokeZoomWidth(this.SelectedHoverInnerStroke,a),this.SelectedHoverOuterStroke=this._adjustStrokeZoomWidth(this.SelectedHoverOuterStroke,i)):(this.SelectedInnerStroke=this._adjustStrokeZoomWidth(this.SelectedInnerStroke,r),this.SelectedOuterStroke=this._adjustStrokeZoomWidth(this.SelectedOuterStroke,n))}S.superclass.setSelected.call(this,t)}},S.prototype.showHoverEffect=function(){this.isSelected()?(this.CreateSelectedHoverStrokes(),this.SelectedHoverInnerStroke=this._adjustStrokeZoomWidth(this.SelectedHoverInnerStroke,S.HOVER_STROKE_WIDTH),this.SelectedHoverOuterStroke=this._adjustStrokeZoomWidth(this.SelectedHoverOuterStroke,S.SELECTED_HOVER_OUTER_STROKE_WIDTH)):this.HoverInnerStroke=this._adjustStrokeZoomWidth(this.HoverInnerStroke,S.HOVER_STROKE_WIDTH),S.superclass.showHoverEffect.call(this)},S.prototype.CreateSelectedHoverStrokes=function(){var t="redwood"===this.getCtx().getThemeBehavior();if(!this.SelectedHoverInnerStroke){var a=t?this.SelectedInnerStroke:this.HoverInnerStroke,i=t?1:S.HOVER_STROKE_WIDTH;this.SelectedHoverInnerStroke=new e.Stroke(a.getColor(),a.getAlpha(),i,this._bSupportsVectorEffects)}if(!this.SelectedHoverOuterStroke){var r=t?3:S.SELECTED_HOVER_OUTER_STROKE_WIDTH;this.SelectedHoverOuterStroke=new e.Stroke(this.SelectedOuterStroke.getColor(),this.SelectedOuterStroke.getAlpha(),r,this._bSupportsVectorEffects)}},S.prototype.hideHoverEffect=function(){if(this.isSelected()){var t="redwood"===this.getCtx().getThemeBehavior(),e=t?1:S.SELECTED_INNER_STROKE_WIDTH,a=t?3:S.SELECTED_OUTER_STROKE_WIDTH;this.SelectedInnerStroke=this._adjustStrokeZoomWidth(this.SelectedInnerStroke,e),this.SelectedOuterStroke=this._adjustStrokeZoomWidth(this.SelectedOuterStroke,a)}S.superclass.hideHoverEffect.call(this)},S.prototype._updateStrokeZoomWidth=function(t,a){if(!this._bSupportsVectorEffects){var i=t.getStroke();if(i){var r=new e.Stroke(i.getColor(),i.getAlpha(),a/this.Zoom,i.isFixedWidth());t.setStroke(r)}}},S.prototype._adjustStrokeZoomWidth=function(t,a){return this._bSupportsVectorEffects?t:new e.Stroke(t.getColor(),t.getAlpha(),a/this.Zoom,t.isFixedWidth())},S.prototype.handleZoomEvent=function(t){this.Zoom=t.getA(),this.isSelected()?this.isHoverEffectShown()?(this._updateStrokeZoomWidth(this.InnerShape,S.HOVER_STROKE_WIDTH),this._updateStrokeZoomWidth(this,S.SELECTED_HOVER_OUTER_STROKE_WIDTH)):(this._updateStrokeZoomWidth(this.InnerShape,S.SELECTED_INNER_STROKE_WIDTH),this._updateStrokeZoomWidth(this,S.SELECTED_OUTER_STROKE_WIDTH)):this.isHoverEffectShown()?this._updateStrokeZoomWidth(this.InnerShape,S.HOVER_STROKE_WIDTH):this._updateStrokeZoomWidth(this,1)};var A={};e.Obj.createSubclass(A,e.Obj),A._VIEWPORT_BOUNDS=new e.Rectangle(0,0,800,500),A._RADIUS=6378206.4,A._NEW_ZEALAND_RECT=new e.Rectangle(500,200,200,200),A._NEW_ZEALAND_BOUNDS=new e.Rectangle(163,-49,17,17),A._AFRICA_BOUNDS=new e.Rectangle(-17.379205428479874,-37.201510854305546,68.66391442808313,77.50071544582713),A._ASIA_BOUNDS=new e.Rectangle(-.8436866097568272,-.7626456732012923,1.8336308036296942,1.5748427214611724),A._AUSTRALIA_BOUNDS=new e.Rectangle(113.29667079927977,-52.89550592498755,65.25257389065216,42.123114617504626),A._EUROPE_BOUNDS=new e.Rectangle(-.47944476148667076,-.0014669405958800579,.7364925893845453,.6293972741802124),A._N_AMERICA_BOUNDS=new e.Rectangle(-.6154469465354344,-.24589767758847714,1.2448236795108683,1.2631535127174947),A._S_AMERICA_BOUNDS=new e.Rectangle(-80.60817722658722,-60.796273249672765,46.608687602908056,66.96595767361796),A._APAC_BOUNDS=new e.Rectangle(68.20516856593524,-52.89892708045518,111.65739821771903,116.55460214469134),A._EMEA_BOUNDS=new e.Rectangle(-24.543831069368586,-37.202500659225905,204.54283106936856,164.9634493690208),A._L_AMERICA_BOUNDS=new e.Rectangle(-117.12451221229134,-54.95921623126266,82.33223251442891,87.67786623127876),A._USA_CANADA_BOUNDS=new e.Rectangle(-.6154656300926513,.0507209798775865,1.0153104799231851,.966537441082997),A._WORLD_BOUNDS=new e.Rectangle(-171.9,-62.6,349.8,150.8),A._ALASKA1_RECT=new e.Rectangle(172,51,8,3),A._ALASKA2_RECT=new e.Rectangle(-180,51,51,21),A._HAWAII_RECT=new e.Rectangle(-178.5,18.9,35,11),A._USA_RECT=new e.Rectangle(-124.8,24.4,58,25.5),A._ALASKA_BOUNDS=new e.Rectangle(-187.5517578125,59.82610321044922,57.562225341796875,43.83738708496094),A._HAWAII_BOUNDS=new e.Rectangle(-160.23606872558594,18.91549301147461,5.4374847412109375,3.3189010620117188),A._USA_BOUNDS=new e.Rectangle(-2386803.25,-1183550.5,4514111,2908402),A._HAWAII_WINDOW=new e.Rectangle(165,400,100,100),A._ALASKA_WINDOW=new e.Rectangle(-75,350,240,150),A._ROBINSON_COORDINATES=[[1,0],[.9986,.0314],[.9954,.0629],[.99,.0943],[.9822,.1258],[.973,.1572],[.96,.1887],[.9427,.2201],[.9216,.2515],[.8962,.2826],[.8679,.3132],[.835,.3433],[.7986,.3726],[.7597,.4008],[.6732,.4532],[.6213,.4765],[.5722,.4951],[.5322,.5072]],A.project=function(t,a,i){var r;switch(i){case"africa":r=A._getAffineProjection(A._AFRICA_BOUNDS,A._getMercatorProjection(t,a));break;case"asia":r=A._getAffineProjection(A._ASIA_BOUNDS,A._getAlbersEqualAreaConicProjection(40,95,20,60,t,a),A.toRadians(5));break;case"australia":r=A._getAustraliaProjection(t,a);break;case"europe":r=A._getAffineProjection(A._EUROPE_BOUNDS,A._getAlbersEqualAreaConicProjection(35,25,40,65,t,a),A.toRadians(10));break;case"northAmerica":r=A._getAffineProjection(A._N_AMERICA_BOUNDS,A._getAlbersEqualAreaConicProjection(23,-96,20,60,t,a));break;case"southAmerica":r=A._getAffineProjection(A._S_AMERICA_BOUNDS,new e.Point(t,a),A.toRadians(5));break;case"apac":r=A._getAffineProjection(A._APAC_BOUNDS,A._getMercatorProjection(t,a));break;case"emea":r=A._getAffineProjection(A._EMEA_BOUNDS,A._getMercatorProjection(t,a));break;case"latinAmerica":r=A._getAffineProjection(A._L_AMERICA_BOUNDS,new e.Point(t,a));break;case"usaAndCanada":r=A._getAffineProjection(A._USA_CANADA_BOUNDS,A._getAlbersEqualAreaConicProjection(23,-96,20,60,t,a));break;case"worldRegions":r=A._getWorldProjection(t,a);break;case"usa":r=A._getUSAProjection(t,a);break;case"world":r=A._getWorldProjection(t,a)}return r?new e.Point(10*r.x,10*r.y):null},A._getUSAProjection=function(t,a){var i,r;return A._ALASKA1_RECT.containsPoint(t,a)||A._ALASKA2_RECT.containsPoint(t,a)?(i=A._getViewPortTransformation(A._ALASKA_BOUNDS,A._ALASKA_WINDOW),r=A._applyAffineTransform(i,A._getMercatorProjection(t,a))):A._HAWAII_RECT.containsPoint(t,a)?(i=A._getViewPortTransformation(A._HAWAII_BOUNDS,A._HAWAII_WINDOW),r=A._applyAffineTransform(i,new e.Point(t,a))):A._USA_RECT.containsPoint(t,a)&&(i=A._getViewPortTransformation(A._USA_BOUNDS,A._VIEWPORT_BOUNDS),r=A._applyAffineTransform(i,A._getOrthographicProjection(new e.Point(-95,36),t,a))),A._getBoundedTransformedPoint(A._VIEWPORT_BOUNDS,r)},A._getWorldProjection=function(t,e){var a=A._getViewPortTransformation(A._WORLD_BOUNDS,A._VIEWPORT_BOUNDS),i=A._applyAffineTransform(a,A._getRobinsonProjection(t,e));return A._getBoundedTransformedPoint(A._VIEWPORT_BOUNDS,i)},A._getAustraliaProjection=function(t,e){var a;a=A._NEW_ZEALAND_BOUNDS.containsPoint(t,e)?A._getViewPortTransformation(A._NEW_ZEALAND_BOUNDS,A._NEW_ZEALAND_RECT):A._getViewPortTransformation(A._AUSTRALIA_BOUNDS,A._VIEWPORT_BOUNDS);var i=A._applyAffineTransform(a,A._getMercatorProjection(t,e));return A._getBoundedTransformedPoint(A._VIEWPORT_BOUNDS,i)},A._getAffineProjection=function(t,a,i){var r=A._getViewPortTransformation(t,A._VIEWPORT_BOUNDS);if(i){var n=new e.Matrix;n=n.rotate(i),r=A._concatAffineTransforms(r,n)}var o=r.transformPoint(a);return A._getBoundedTransformedPoint(A._VIEWPORT_BOUNDS,o)},A._getBoundedTransformedPoint=function(t,e){return e&&t.containsPoint(e.x,e.y)?e:null},A._getAlbersEqualAreaConicProjection=function(t,a,i,r,n,o){var s=A.toRadians(a),l=A.toRadians(t);i=A.toRadians(i),r=A.toRadians(r);var h=.5*(Math.sin(i)+Math.sin(r)),c=Math.pow(Math.cos(i),2)+2*h*Math.sin(i),p=c-2*h*Math.sin(l);p=Math.sqrt(p)/h;var _=A.toRadians(n),g=A.toRadians(o),d=h*(_-s),u=c-2*h*Math.sin(g),y=(u=Math.sqrt(u)/h)*Math.sin(d),f=p-u*Math.cos(d);return new e.Point(y,f)},A._getMercatorProjection=function(t,a){var i=Math.log(Math.tan(.25*Math.PI+.5*A.toRadians(a)));return new e.Point(t,A.toDegrees(i))},A._getOrthographicProjection=function(t,a,i){var r=A.toRadians(a),n=A.toRadians(i),o=A.toRadians(t.x),s=A.toRadians(t.y),l=Math.cos(n)*Math.sin(r-o),h=Math.cos(s)*Math.sin(n)-Math.sin(s)*Math.cos(n)*Math.cos(r-o);return new e.Point(l*A._RADIUS,h*A._RADIUS)},A._getRobinsonProjection=function(t,a){var i=Math.floor(Math.abs(a)/5);i>=A._ROBINSON_COORDINATES.length-1&&(i=A._ROBINSON_COORDINATES.length-2);var r=(Math.abs(a)-5*i)/5,n=A._ROBINSON_COORDINATES[i+1][0]-A._ROBINSON_COORDINATES[i][0],o=A._ROBINSON_COORDINATES[i+1][1]-A._ROBINSON_COORDINATES[i][1],s=t*(A._ROBINSON_COORDINATES[i][0]+r*n),l=A._ROBINSON_COORDINATES[i][1]+r*o;return a<0&&(l*=-1),new e.Point(s,180*l)},A._applyAffineTransform=function(t,a){return new e.Point(a.x*t.getA()+t.getTx(),a.y*t.getD()+t.getTy())},A._concatAffineTransforms=function(t,a){var i=t.getA(),r=a.getA()*i,n=a.getB()*i,o=t.getTx()+a.getTx()*i,s=t.getD(),l=a.getC()*s,h=a.getD()*s,c=t.getTy()+a.getTy()*s;return new e.Matrix(r,n,l,h,o,c)},A._getViewPortTransformation=function(t,a){var i,r=a.x,n=a.y,o=t.w,s=t.h,l=a.w/o,h=a.h/s;i=l<=h?l:h;var c=r-t.x*i,p=n+t.y*i;return c+=(a.w-o*i)/2,p+=a.h-(a.h-s*i)/2,new e.Matrix(i,0,0,-i,c,p)},A.toRadians=function(t){return t*(Math.PI/180)},A.toDegrees=function(t){return t*(180/Math.PI)},A.inverseProject=function(t,a,i){var r;switch(t/=10,a/=10,i){case"africa":r=A._getInverseAffineProjection(A._AFRICA_BOUNDS,new e.Point(t,a)),r=A._getInverseMercatorProjection(r.x,r.y);break;case"asia":r=A._getInverseAffineProjection(A._ASIA_BOUNDS,new e.Point(t,a),A.toRadians(5)),r=A._getInverseAlbersEqualAreaConicProjection(40,95,20,60,r.x,r.y);break;case"australia":r=A._getInverseAustraliaProjection(t,a);break;case"europe":r=A._getInverseAffineProjection(A._EUROPE_BOUNDS,new e.Point(t,a),A.toRadians(10)),r=A._getInverseAlbersEqualAreaConicProjection(35,25,40,65,r.x,r.y);break;case"northAmerica":r=A._getInverseAffineProjection(A._N_AMERICA_BOUNDS,new e.Point(t,a)),r=A._getInverseAlbersEqualAreaConicProjection(23,-96,20,60,r.x,r.y);break;case"southAmerica":r=A._getInverseAffineProjection(A._S_AMERICA_BOUNDS,new e.Point(t,a),A.toRadians(5));break;case"apac":r=A._getInverseAffineProjection(A._APAC_BOUNDS,new e.Point(t,a)),r=A._getInverseMercatorProjection(r.x,r.y);break;case"emea":r=A._getInverseAffineProjection(A._EMEA_BOUNDS,new e.Point(t,a)),r=A._getInverseMercatorProjection(r.x,r.y);break;case"latinAmerica":r=A._getInverseAffineProjection(A._L_AMERICA_BOUNDS,new e.Point(t,a));break;case"usaAndCanada":r=A._getInverseAffineProjection(A._USA_CANADA_BOUNDS,new e.Point(t,a)),r=A._getInverseAlbersEqualAreaConicProjection(23,-96,20,60,r.x,r.y);break;case"worldRegions":r=A._getInverseWorldProjection(t,a);break;case"usa":r=A._getInverseUSAProjection(t,a);break;case"world":r=A._getInverseWorldProjection(t,a)}return r||new e.Point(t,a)},A._getInverseUSAProjection=function(t,a){if(A._ALASKA_WINDOW.containsPoint(t,a)){var i=A._getViewPortTransformation(A._ALASKA_BOUNDS,A._ALASKA_WINDOW).invert().transformPoint(new e.Point(t,a));return A._getInverseMercatorProjection(i.x,i.y)}if(A._HAWAII_WINDOW.containsPoint(t,a))return A._getViewPortTransformation(A._HAWAII_BOUNDS,A._HAWAII_WINDOW).invert().transformPoint(new e.Point(t,a));if(A._VIEWPORT_BOUNDS.containsPoint(t,a)){i=A._getViewPortTransformation(A._USA_BOUNDS,A._VIEWPORT_BOUNDS).invert().transformPoint(new e.Point(t,a));return A._getInverseOrthographicProjection(new e.Point(-95,36),i.x,i.y)}return new e.Point(t,a)},A._getInverseWorldProjection=function(t,a){var i=A._getViewPortTransformation(A._WORLD_BOUNDS,A._VIEWPORT_BOUNDS),r=(i=i.invert()).transformPoint(new e.Point(t,a));return A._getInverseRobinsonProjection(r.x,r.y)},A._getInverseAustraliaProjection=function(t,a){var i=(A._NEW_ZEALAND_RECT.containsPoint(t,a)?A._getViewPortTransformation(A._NEW_ZEALAND_BOUNDS,A._NEW_ZEALAND_RECT):A._getViewPortTransformation(A._AUSTRALIA_BOUNDS,A._VIEWPORT_BOUNDS)).invert().transformPoint(new e.Point(t,a));return A._getInverseMercatorProjection(i.x,i.y)},A._getInverseAffineProjection=function(t,a,i){var r=A._getViewPortTransformation(t,A._VIEWPORT_BOUNDS);if(i){var n=new e.Matrix;n=n.rotate(i),r=A._concatAffineTransforms(r,n)}return(r=r.invert()).transformPoint(a)},A._getInverseAlbersEqualAreaConicProjection=function(t,a,i,r,n,o){var s=A.toRadians(a),l=A.toRadians(t);i=A.toRadians(i),r=A.toRadians(r);var h=.5*(Math.sin(i)+Math.sin(r)),c=Math.pow(Math.cos(i),2)+2*h*Math.sin(i),p=c-2*h*Math.sin(l);p=Math.sqrt(p)/h;var _=Math.sqrt(n*n+(p-o)*(p-o)),g=Math.atan(n/(p-o)),d=Math.asin((c-_*_*h*h)/(2*h)),u=s+g/h;return new e.Point(A.toDegrees(u),A.toDegrees(d))},A._getInverseMercatorProjection=function(t,a){var i=2*Math.atan(Math.exp(A.toRadians(a)))-.5*Math.PI;return new e.Point(t,A.toDegrees(i))},A._getInverseOrthographicProjection=function(t,a,i){var r=a/A._RADIUS,n=i/A._RADIUS,o=A.toRadians(t.x),s=A.toRadians(t.y),l=Math.sqrt(r*r+n*n),h=Math.asin(l),c=Math.asin(Math.cos(h)*Math.sin(s)+n*Math.sin(h)*Math.cos(s)/l),p=o+Math.atan(r*Math.sin(h)/(l*Math.cos(s)*Math.cos(h)-n*Math.sin(s)*Math.sin(h)));return new e.Point(A.toDegrees(p),A.toDegrees(c))},A._getInverseRobinsonProjection=function(t,a){var i=Math.floor(Math.abs(a)/5);i>=A._ROBINSON_COORDINATES.length-1&&(i=A._ROBINSON_COORDINATES.length-2);var r=A._ROBINSON_COORDINATES[i+1][0]-A._ROBINSON_COORDINATES[i][0],n=A._ROBINSON_COORDINATES[i+1][1]-A._ROBINSON_COORDINATES[i][1],o=(Math.abs(a/180)-A._ROBINSON_COORDINATES[i][1])/n,s=5*o+5*i,l=t/(A._ROBINSON_COORDINATES[i][0]+o*r);return a<0&&(s*=-1),new e.Point(l,s)};var m=function(t){this.Init(t)};e.Obj.createSubclass(m,e.Obj),m._MIN_MARKER_SIZE=6,m._MAX_MARKER_SIZE_RATIO=.5,m._PZC_PADDING=20,m.prototype.Init=function(t){this._tmap=t,this._areaLayerStyle=null,this._areaLayerStyleObject=null},m.prototype.parse=function(t){var e=t.mapProvider;v.containsGeoJson(e)&&(this._mapProvider=e),this._parseMapProperties(t),this._parseStyles(t.styleDefaults),this._parseAreaLayer(t.areaLayers),this.ParseDataLayers(t.pointDataLayers,null,null,!1)},m.prototype._parseMapProperties=function(t){var e=t.animationDuration;"string"==typeof e?"ms"==e.slice(-2)?e=parseInt(e.slice(0,-2))/1e3:"s"==e.slice(-1)&&(e=parseFloat(e.slice(0,-1))):e/=1e3,this._tmap.setAnimationDuration(e),this._mapProvider||this._tmap.setMapName(t.basemap),this._tmap.setInitialZooming("auto"==t.initialZooming),this._tmap.setPanning("auto"==t.panning),this._tmap.setZooming("auto"==t.zooming)},m.prototype._parseAreaLayer=function(a){var i=this._tmap.getCtx(),r=this._tmap.Defaults.calcAreaLayerOptions(a[0],i.isCustomElement()),n=r.layer;if(n||this._mapProvider){var s,l=r.areaSvgStyle||r.areaStyle;if(l){l instanceof Object||(l=e.CSSStyle.cssStringToObject(l));var h=m._getAreaCSSStyle(l);this._areaLayerStyleObject=e.JsonUtils.merge(l,this._areaLayerStyleObject),this._areaLayerStyle.merge(h)}var c=this._tmap.getStyleDefaults().labelStyle;c&&this._areaLayerStyle.merge(c),(c=r.labelStyle)&&this._areaLayerStyle.parseInlineStyle(c),s=new o(this._tmap,n,r.labelDisplay,r.labelType,this._tmap.getEventManager());var p,_,g,d=this._tmap.getMapName();if(this._mapProvider){var u=v.parseMapInfo(i,this._mapProvider);p=u.areas,_=u.labels}else p=t.DvtBaseMapManager.getAreaPaths(d,n,this._tmap.getWidth(),this._tmap.getHeight(),this._tmap.getMaxZoomFactor()),_=t.DvtBaseMapManager.getAreaLabels(d,n),g=t.DvtBaseMapManager.getAreaLabelInfo(d,n);s.setAreaShapes(this._createPathShapes(p)),s.setAreaLabels(_),s.setAreaLabelInfo(g),s.setLayerCSSStyle(this._areaLayerStyle),s.setDropSiteCSSStyle(this._areaDropSiteStyle),this._tmap.addLayer(s),r.areaDataLayer&&this.ParseDataLayers([r.areaDataLayer],s,null,!0),r.pointDataLayers&&this.ParseDataLayers(r.pointDataLayers,s,null,!1)}},m.prototype.ParseDataLayers=function(t,a,i,r){if(t)for(var s=this._tmap.getCtx(),l=0;l<t.length;l++){var h=this._tmap.Defaults.calcDataLayerOptions(t[l]);a?a instanceof o&&r&&a.resetRenderedAreas():(a=new n(this._tmap,h.id,this._tmap.getEventManager()),this._tmap.addLayer(a));var c=new y(this._tmap,a,h.id,this._tmap.getEventManager(),h),p=h.selectionMode;"single"==p?c.setSelectionMode(e.SelectionHandler.TYPE_SINGLE):"multiple"==p&&c.setSelectionMode(e.SelectionHandler.TYPE_MULTIPLE),c.setAnimation(h.animationOnDataChange),c.setAnimationDuration(this._tmap.getAnimationDuration());var _,g=null;a instanceof o&&(g=h.isolatedItem);r=a instanceof o;var d=this._tmap.getOptions().hiddenCategories;if(P=h.areas)for(var u=0;u<P.length;u++)if(d&&e.ArrayUtils.hasAnyItem(d,P[u].categories))c.addAreaObject(null);else{var f=P[u].location;if(g){if(!e.Obj.compareValues(s,g,P[u].id))continue;_=f}(T=this._createArea(a,c,P[u]))&&c.addAreaObject(T)}var v=h.renderer;if(C=h.markers){v||m._calcBubbleSizes(this._tmap,C);for(u=0;u<C.length;u++)if(d&&e.ArrayUtils.hasAnyItem(d,C[u].categories))c.addMarkerObject(null);else{f=C[u].location;if(g){if(!e.Obj.compareValues(s,g,C[u].id))continue;_=f}if(v){var S=C[u]._noTemplate?C[u]._itemData:C[u],A=C[u]._itemData,b=v(this._tmap.getOptions()._contextHandler(this._tmap.getElem(),null,S,A,{hovered:!1,selected:!1,focused:!1},null));T=b&&this._createCustomDataItem(a,c,C[u],b,r)}else T=this._createMarker(a,c,C[u],r);T&&c.addMarkerObject(T)}}var D=h.images;if(D)for(u=0;u<D.length;u++){f=D[u].location;if(g){if(!e.Obj.compareValues(s,g,D[u].id))continue;_=f}(T=this._createImage(a,c,D[u],r))&&c.addMarkerObject(T)}var E=h.links;if(E){var L=new s.ojMap,M=new s.ojMap,C=c.getDataMarkerCollection();for(l=0;l<C.length;l++){var O=C[l];O&&L.set(O.getId(),O)}var P=c.getDataAreaCollection();for(l=0;l<P.length;l++){var I=P[l];I&&M.set(I.getId(),I)}for(u=0;u<E.length;u++){var T;if(d&&e.ArrayUtils.hasAnyItem(d,E[u].categories))c.addAreaObject(null);else(T=this._createLink(c,E[u],L,M))&&c.addLinkObject(T)}}_&&(c.setIsolatedAreaRowKey(g),a.setIsolatedArea(_));var R=h.selection;R&&R.length>0&&c.setInitialSelections(R),i?a.updateDataLayer(c,this._tmap.getPanZoomCanvas().getContentPane().getMatrix(),i):a.addDataLayer(c)}},m.prototype._parseStyles=function(t){var a=t.areaSvgStyle||t.areaStyle;!a||a instanceof Object||(a=e.CSSStyle.cssStringToObject(a)),a=e.JsonUtils.merge(a,t._areaStyle),this._areaLayerStyle=m._getAreaCSSStyle(a),this._areaLayerStyleObject=a,this._areaLayerStyle.parseInlineStyle(t.labelStyle),this._areaDropSiteStyle=new e.CSSStyle(t.dropTargetStyle),this._tmap.setStyleDefaults(t)},m._getAreaCSSStyle=function(t){var a=new e.CSSStyle;return[e.CSSStyle.BORDER_COLOR,e.CSSStyle.BACKGROUND_COLOR].forEach(function(i){var r=null,n=e.CSSStyle.cssStringToObjectProperty(i);t&&null!=t[n]&&(r=t[n],delete t[n]),a.setStyle(i,r)}),a},m.prototype._createPathShapes=function(t){var a={},i=this._tmap.getCtx();for(var r in t){var n=new e.Path(i);n.setCmds(t[r]);var o=this._areaLayerStyle.getStyle(e.CSSStyle.BORDER_COLOR);if(o&&"transparent"!=o){var s=new e.Stroke(o,1,1,this._tmap.supportsVectorEffects());n.setStroke(s)}var l=this._areaLayerStyle.getStyle(e.CSSStyle.BACKGROUND_COLOR);"transparent"!=l?n.setSolidFill(l):n.setFill(null),this._areaLayerStyleObject&&n.setStyle(this._areaLayerStyleObject),a[r]=n}return a},m.prototype._createArea=function(t,a,i){var r=i.location;if(t.getAreaShape(r)){t.setAreaRendered(r,!1);var n=this._tmap.getCtx(),o="redwood"===n.getThemeBehavior(),s=new S(n,this._tmap.supportsVectorEffects());(i=e.JsonUtils.merge(i,this._tmap.getStyleDefaults().dataAreaDefaults)).labelStyle||(i.labelStyle=this._tmap.getStyleDefaults().labelStyle);var l=o?3:S.SELECTED_OUTER_STROKE_WIDTH,h=o?3:S.HOVER_STROKE_WIDTH,c=new e.Stroke(i.hoverColor,1,1,this._tmap.supportsVectorEffects()),p=new e.Stroke(i.color,1,h,this._tmap.supportsVectorEffects()),g=new e.Stroke(i.selectedInnerColor,1,S.SELECTED_INNER_STROKE_WIDTH,this._tmap.supportsVectorEffects()),d=new e.Stroke(i.selectedOuterColor,1,l,this._tmap.supportsVectorEffects());s.setHoverStroke(c,p).setSelectedStroke(g,d),t.setLabelRendered(i.location,!1),this._styleDisplayable(i,s);var u=this._createLabel(t,a,i,s,!0),y=m._getLocationName(this._tmap.getMapName(),a,i);return new _(i,a,s,u,y)}return null},m.prototype._createMarker=function(t,a,i,r){var n,o=i._size;if(!(n=this._mapProvider&&!i.location?new e.Point(i.x,-i.y):m.getCenter(a,i.location,i.x,i.y))||0===o)return null;var s,l,h=this._tmap.getStyleDefaults().dataMarkerDefaults,c=h.labelStyle;if(c.parseInlineStyle(i.labelStyle),(i=e.JsonUtils.merge(i,h)).labelStyle=c,null!=o)s=o,l=o;else{var _=i.scaleX;null==_&&(_=1);var g=i.scaleY;null==g&&(g=1);var d=i.width;null==d&&(d=this._tmap.getOptions().styleDefaults.dataMarkerDefaults.width);var u=i.height;null==u&&(u=this._tmap.getOptions().styleDefaults.dataMarkerDefaults.height),s=d*_,l=u*g}var y,f=i.borderRadius;if(i.source)y=new e.ImageMarker(this._tmap.getCtx(),n.x,n.y,s,l,f,i.source,i.sourceSelected,i.sourceHover,i.sourceHoverSelected);else{var v=i.shape?i.shape:this._tmap.getOptions().styleDefaults.dataMarkerDefaults.shape;y=new e.SimpleMarker(this._tmap.getCtx(),v,n.x,n.y,s,l,f)}var S=i.rotation;if(S){var A=S*Math.PI/180;y.setRotation(A)}r&&t.setLabelRendered(i.location,!1),this._styleDisplayable(i,y);var b="redwood"===this._tmap.getCtx().getThemeBehavior(),D=this._createLabel(t,a,i,y,r),E=m._getLocationName(this._tmap.getMapName(),a,i);return new p(i,a,y,D,n,E,b)},m.prototype._createImage=function(t,a,i,r){var n=m.getCenter(a,i.location,i.x,i.y);if(!n)return null;var o=new e.Image(this._tmap.getCtx(),i.url),s=i.width,l=i.height;null!=s&&null!=l&&(o.setX(n.x-s/2),o.setY(n.y-l/2),o.setWidth(s),o.setHeight(l)),r&&t.setLabelRendered(i.location,!1);var h=m._getLocationName(this._tmap.getMapName(),a,i),c=new p(i,a,o,null,n,h);if(!s||!l){e.ImageLoader.loadImage(i.url,function(t){t&&t.width&&t.height&&(o.setWidth(t.width),o.setHeight(t.height),o.setX(n.x-t.width/2),o.setY(n.y-t.height/2),c.__recenter())})}return c},m.prototype._createCustomDataItem=function(t,a,i,r,n){var o;if(!(o=this._mapProvider&&!i.location?new e.Point(i.x,-i.y):m.getCenter(a,i.location,i.x,i.y)))return null;n&&t.setLabelRendered(i.location,!1);var l=new s(this._tmap.getCtx(),r,this._tmap.getStyleDefaults().dataAreaDefaults),h=m._getLocationName(this._tmap.getMapName(),a,i);return new p(i,a,l,null,o,h)},m.prototype._createLink=function(t,a,i,r){var n,o,s,l,c=a.startLocation,p=a.endLocation;if(c.id?(o=i.get(c.id))?n=o.getCenter():(o=r.get(c.id))&&(n=this._getPtFromLocation(t,{location:o.getLocation()})):n=this._getPtFromLocation(t,c),p.id?(l=i.get(p.id))?s=l.getCenter():(l=r.get(p.id))&&(s=this._getPtFromLocation(t,{location:l.getLocation()})):s=this._getPtFromLocation(t,p),!s||!n)return null;var _=new e.Path(this._tmap.getCtx(),h(t,n,s,n,s));_.setFill(null);var g=this._tmap.getStyleDefaults().linkDefaults,d=a.color;d||(d=g.color);var u=a.width;u||(u=g.width);var y=new e.Stroke(d,1,u,!0);_.setStroke(y);var v="redwood"===_.getCtx().getThemeBehavior(),S=g._hoverColor,A=g._selectedColor,m=new e.Stroke(S,1,u),b=new e.Stroke(d,1,u+2),D=new e.Stroke(d,1,u),E=new e.Stroke(A,1,u+2);if(v)var L=D,M=E;else L=new e.Stroke(S,1,u),M=new e.Stroke(A,1,u+2);return _.setHoverStroke(m,b).setSelectedStroke(D,E).setSelectedHoverStroke(L,M),new f(a,t,_,n,s,o,l)},m.prototype._getPtFromLocation=function(t,a){return this._mapProvider?new e.Point(a.x,-a.y):m.getCenter(t,a.location,a.x,a.y)},m.prototype._createLabel=function(t,a,i,n,o){var s=i.location,l=i.label,h=l?"on":"off";o&&(h=t.getLabelDisplay());var c=n instanceof e.Path;if(!l&&o&&(c&&"off"!=h||!c&&"on"==h)&&(l="long"==t.getLabelType()?t.getLongAreaName(s):t.getShortAreaName(s)),l){var p,_=this._tmap.getCtx();p=c?new r(_,l,t.getLabelInfoForArea?t.getLabelInfoForArea(s):null,h,a.getDataLabelContainer(),this._tmap.supportsVectorEffects()):new e.OutputText(_,l,0,0);var g=c?t.getLayerCSSStyle():new e.CSSStyle;i.labelStyle&&g.merge(i.labelStyle);var d=g.getStyle(e.CSSStyle.COLOR);g.setStyle(e.CSSStyle.COLOR,null),p.setCSSStyle(g),i.color&&p instanceof r&&(e.Agent.isHighContrast()||!d)&&(d=e.ColorUtils.getContrastingTextColor(i.color)),d&&p.setSolidFill(d)}return p},m.prototype._styleDisplayable=function(t,a){var i=t.color,r="redwood"===this._tmap.getCtx().getThemeBehavior();if(a instanceof e.SimpleMarker){var n=t.borderStyle;if("none"!=n){var o=t.borderWidth;"string"==typeof o&&(o="px"==o.slice(-2)?parseFloat(t.borderWidth.slice(0,-2)):parseFloat(t.borderWidth));var s=new e.Stroke(t.borderColor,1,o,!this._tmap.isMarkerZoomBehaviorFixed(),e.Stroke.getDefaultDashProps(n,o));if(a.setStroke(s),r){var l=new e.Stroke(t._hoverColor,1,1,this._tmap.isMarkerZoomBehaviorFixed()),h=new e.Stroke(t._selectionColor,1,3,this._tmap.isMarkerZoomBehaviorFixed()),c=new e.Stroke(t._hoverColor,1,1,this._tmap.isMarkerZoomBehaviorFixed()),p=new e.Stroke(t._selectionColor,1,3,this._tmap.isMarkerZoomBehaviorFixed()),_=new e.Stroke(t._hoverColor,1,1,this._tmap.isMarkerZoomBehaviorFixed()),g=new e.Stroke(t.color,1,3,this._tmap.isMarkerZoomBehaviorFixed());a.setHoverStroke(_,g).setSelectedStroke(c,p).setSelectedHoverStroke(l,h)}}var d=t.opacity;i&&a.setSolidFill(i,d)}else if(a instanceof e.Path){var u=t.borderColor;if(u){s=new e.Stroke(u,1,1,this._tmap.supportsVectorEffects());a.setStroke(s)}a.setSolidFill(i,d)}},m.getCenter=function(a,i,r,n){var o=a.getMap(),s=o.getMapName(),l=a.getMapLayer(),h=l.getLayerName();if(i){var c=t.DvtBaseMapManager.getCityCoordinates(s,i);if(c)return c;var p,_=t.DvtBaseMapManager.getAreaCenter(s,h,i);if(_)return _;if(!s&&l.getAreaShape){var g=l.getAreaShape(i);if(!g)return null;p=e.DisplayableUtils.getDimensionsForced(o.getCtx(),g)}else{var d=t.DvtBaseMapManager.getPathForArea(s,h,i);if(!d)return null;var u=e.PathUtils.createPathArray(d);p=e.PathUtils.getDimensions(u)}return p.getCenter()}return A.project(r,n,s)},m._calcBubbleSizes=function(t,a){for(var i=-1/0,r=1/0,n=0;n<a.length;n++){null==(p=a[n].value)||p<=0||(i=Math.max(i,p),r=Math.min(r,p))}if(r!==1/0){var o=2*m._PZC_PADDING,s=t.getWidth()-o,l=t.getHeight()-o,h=s/l;h<1.3?l=2*s/3:h>1.7&&(s=1.5*l);var c=m._MAX_MARKER_SIZE_RATIO*Math.min(s,l);for(n=0;n<a.length;n++){var p=a[n].value;a[n]._size=null==p||p<=0?0:e.LayoutUtils.getBubbleSize(p,r,i,m._MIN_MARKER_SIZE,c)}}},m._getLocationName=function(e,a,i){var r=i.location;if(r){var n=a.getMapLayer();return n instanceof o?n.getLongAreaName(r):t.DvtBaseMapManager.getCityLabel(e,r)}return null};var b=function(t,e){this.Init(t,e)};e.Obj.createSubclass(b,a.PanZoomCanvasKeyboardHandler),b.prototype.Init=function(t,e){b.superclass.Init.call(this,t,e),this._tmap=t,this._linkNavType=b.LINK_NAV},b.prototype.isSelectionEvent=function(t){return this.isNavigationEvent(t)&&!t.ctrlKey},b.prototype.processKeyDown=function(t){var a=t.keyCode,i=this._eventManager.getFocus();if(a==e.KeyboardEvent.CLOSE_BRACKET){this._linkNavType=b.LINK_NAV;var r=[];i instanceof _?0===(r=this._tmap.getNavigableMarkers()).length&&(r=this._tmap.getNavigableLinks()):i instanceof p&&(r=this._tmap.getNavigableLinks()),r.length>0&&(i=e.KeyboardHandler.getNextAdjacentNavigable(i,t,r),this._tmap.ensureObjInViewport(t,i)),this._eventManager.SetClickInfo(i)}else if(a==e.KeyboardEvent.OPEN_BRACKET){this._linkNavType=b.LINK_NAV;r=[];i instanceof f?0===(r=this._tmap.getNavigableMarkers()).length&&(r=this._tmap.getNavigableAreas()):!(i instanceof _)&&i instanceof p&&(r=this._tmap.getNavigableAreas()),r.length>0&&(i=e.KeyboardHandler.getNextAdjacentNavigable(i,t,r),this._tmap.ensureObjInViewport(t,i)),this._eventManager.SetClickInfo(i)}else(t.keyCode==e.KeyboardEvent.OPEN_ANGLED_BRACKET||e.KeyboardEvent.CLOSE_ANGLED_BRACKET)&&t.altKey&&(this._linkMarker=i,this._linkNavType=l),i=b.superclass.processKeyDown.call(this,t),this.isNavigationEvent(t)&&!t.ctrlKey&&this._eventManager.SetClickInfo(i);return i},b.prototype.getLinkNavigationType=function(){return this._linkNavType},b.prototype.getLinkMarker=function(){return this._linkMarker},b.prototype.isMultiSelectEvent=function(t){return t.keyCode==e.KeyboardEvent.SPACE&&t.ctrlKey},b.prototype.isNavigationEvent=function(t){var a=b.superclass.isNavigationEvent.call(this,t);switch(t.keyCode){case e.KeyboardEvent.OPEN_BRACKET:case e.KeyboardEvent.CLOSE_BRACKET:a=!0;break;case e.KeyboardEvent.OPEN_ANGLED_BRACKET:case e.KeyboardEvent.CLOSE_ANGLED_BRACKET:a=!!t.altKey;break;default:a=b.superclass.isNavigationEvent.call(this,t)}return a};const D=function(t,e,a){this.Init(t,e,a)};e.Obj.createSubclass(D,a.PanZoomComponent),D.DEFAULT_MAX_ZOOM_FACTOR=6,D.prototype.Init=function(t,e,a){D.superclass.Init.call(this,t,e,a),this._layers=[],this._createLayers(),this._bRendered=!1,this.Defaults=new d(t),this._initialZooming=!1,this._zooming=!1,this._panning=!1,this._selectedAreas={},this._touchEventContentMarkerRef=null,this._bListenersRemoved=!1,this._createHandlers(),this.EventManager.associate(this,this)},D.prototype._createLayers=function(){this._areaLayers=new e.Container(this.getCtx()),this._dataAreaLayers=new e.Container(this.getCtx()),this._dataAreaLayers.setAriaRole("region",!0),this._dataPointLayers=new e.Container(this.getCtx()),this._dataPointLayers.setAriaRole("region",!0),this._labelLayers=new e.Container(this.getCtx()),this._linkLayers=new e.Container(this.getCtx()),this._linkLayers.setAriaRole("region",!0),e.Agent.isTouchDevice()&&(this._touchEventLayer=new e.Container(this.getCtx()),this._touchEventLayer.setStyle({display:"none"}))},D.prototype._updateAriaForLayers=function(){var t=this.Options.translations;this._dataAreaLayers.setAriaProperty("label",t.areasRegion,!0),this._dataPointLayers.setAriaProperty("label",t.markersRegion,!0),this._linkLayers.setAriaProperty("label",t.linksRegion,!0)},D.newInstance=function(t,e,a){return new D(t,e,a)},D.prototype.SetOptions=function(t){D.superclass.SetOptions.call(this,t),e.Agent.isEnvironmentTest()&&(this.Options.animationOnDisplay="none",this.Options.animationOnMapChange="none"),new m(this).parse(this.Options)},D.prototype.setStyleDefaults=function(t){this._styleDefaults=t},D.prototype.getStyleDefaults=function(){return this._styleDefaults},D.prototype.getMaxZoomFactor=function(){var t=this.Options.maxZoom;return this._zooming?isNaN(t)?D.DEFAULT_MAX_ZOOM_FACTOR:Math.max(t,1):1},D.prototype.isMarkerZoomBehaviorFixed=function(){return"fixed"==this.Options.markerZoomBehavior},D.prototype.addLayer=function(t){this._layers.push(t)},D.prototype.getLayer=function(t){for(var e=0;e<this._layers.length;e++)if(this._layers[e].getLayerName()==t)return this._layers[e]},D.prototype.getAllLayers=function(){return this._layers},D.prototype.getAreaLayerContainer=function(){return this._areaLayers},D.prototype.getDataAreaContainer=function(){return this._dataAreaLayers},D.prototype.getDataPointContainer=function(){return this._dataPointLayers},D.prototype.getLabelContainer=function(){return this._labelLayers},D.prototype.getLinkContainer=function(){return this._linkLayers},D.prototype.setMapName=function(t){this._bBaseMapChanged=this._mapName&&this._mapName!=t,this._mapName=t},D.prototype.setAnimationDuration=function(t){this._animationDuration=parseFloat(t)},D.prototype.getAnimationDuration=function(){return this._animationDuration},D.prototype.getDisplayTooltips=function(){var t=this.Options.tooltipDisplay;switch(t){case"shortDesc":return"shortDescOnly";case"none":return t;default:return"auto"}},D.prototype.setInitialZooming=function(t){this._initialZooming=t},D.prototype.PreRender=function(){D.superclass.PreRender.call(this),this._bBaseMapChanged=!1,!this.IsResize()&&this._pzcContainer&&(this._oldMapProvider=this.Options.mapProvider,this._layers=[],this._zooming=!0,this._panning=!0,this._oldPzc=this._pzc,this._createLayers(),this.EventManager.removeListeners(this),this._createHandlers(),this._bListenersRemoved=!1,this.EventManager.hideTooltip(),this.EventManager.associate(this,this))},D.prototype._createHandlers=function(){this.EventManager=new u(this.getCtx(),this.dispatchEvent,this),this.EventManager.addListeners(this),e.Agent.isTouchDevice()?this._keyboardHandler=null:(this._keyboardHandler=new b(this,this.EventManager),this.EventManager.setKeyboardHandler(this._keyboardHandler))},D.prototype.Render=function(){D.superclass.Render.call(this);var t=new e.Container(this.getCtx()),a=new e.Container(this.getCtx());if(this._pzc=this.getPanZoomCanvas(),this._pzc.addChild(t),this._pzc.getContentPane().addChild(a),this._render(t,a),this._areaLayer){this.StopAnimation(!0);var i=new e.Rectangle(0,0,this.getWidth(),this.getHeight());if(null==this.getMapName()){var r=this.Options.mapProvider;this._oldMapProvider!==r&&(this._bBaseMapChanged=!0,this._oldMapProvider=r)}if(this._bRendered||this._oldPzc){if(this._bBaseMapChanged&&!this.IsResize()){var n=this.Options.animationOnMapChange;(n="auto"===n?"alphaFade":null)&&(this.Animation=e.BlackBoxAnimationHandler.getCombinedAnimation(this.getCtx(),n,this._oldPzc,this._pzc,i,this._animationDuration),this.addChild(this._oldPzc))}}else{var o=this.Options.animationOnDisplay;(o="auto"===o?"alphaFade":null)&&(this.Animation=e.BlackBoxAnimationHandler.getInAnimation(this.getCtx(),o,this._pzc,i,this._animationDuration))}this.Animation?(this.EventManager.hideTooltip(),this.EventManager.removeListeners(this),this._bListenersRemoved=!0,this.Animation.setOnEnd(this.OnAnimationEnd,this),this.Animation.play()):this.OnAnimationEnd(),this._pzcContainer=t,this.getCtx().setKeyboardFocusArray([this]),this._bRendered=!0}},D.prototype._calcMinZoom=function(){var t=this._pzc.getZoomToFitPadding(),e=this._areaLayer.getLayerDim(),a=this._pzc.getSize(),i=(a.w-2*t)/e.w,r=(a.h-2*t)/e.h;return Math.min(i,r)},D.prototype._render=function(t,e){var a;this._updateAriaForLayers(),e.addChild(this._areaLayers),e.addChild(this._dataAreaLayers),this.isMarkerZoomBehaviorFixed()?t.addChild(this._dataPointLayers):e.addChild(this._dataPointLayers),t.addChild(this._labelLayers),t.addChild(this._linkLayers),this._touchEventLayer&&t.addChild(this._touchEventLayer);var i=this._pzc.getContentPane().getMatrix();this._areaLayerRendered=!1;for(var r=0;r<this._layers.length;r++){var n=this._layers[r];(!this._areaLayerRendered&&n instanceof o||!(n instanceof o))&&(n.render(i),!this._areaLayerRendered&&n instanceof o&&(this._areaLayerRendered=!0,this._areaLayer=n,a=n.getLayerDim()))}if(this._areaLayer){var s=this._areaLayer.getIsolatedArea();this._isolatedArea!=s&&(this._isolatedArea=s),this._setInitialKeyboardFocus(),this._pzc.setMinZoom(null),this._pzc.setMaxZoom(null),this._pzc.setZoomingEnabled(!0),this._pzc.setPanningEnabled(!0),this._pzc.zoomToFit(null,a),this._updateZoomLimits(),this._pzc.setZoomingEnabled(this._zooming),this._pzc.setPanningEnabled(this._panning)}},D.prototype._setInitialKeyboardFocus=function(){if(this._keyboardHandler){var t=this.getNavigableAreas();0==t.length&&(t=this.getNavigableMarkers()),0==t.length&&(t=this.getNavigableLinks()),this.EventManager.setInitialFocus(t[0])}},D.prototype.updateLayer=function(t,e,a){this._bRendered=!1,this.StopAnimation(!0),new m(this).ParseDataLayers([t],this.getLayer(e),this._areaLayer.getLayerName(),a),this._bRendered=!0,this._setInitialKeyboardFocus(),this.getCtx().setKeyboardFocusArray([this]),this._updateZoomLimits()},D.prototype._renderCompleted=function(){this.AnimationStopped||this.RenderComplete(),this.Animation=null,this.AnimationStopped=!1},D.prototype._updateZoomLimits=function(){var t=this._calcMinZoom();this._pzc.setMinZoom(t),this._pzc.setMaxZoom(t*this.getMaxZoomFactor())},D.prototype.OnUpdateLayerEnd=function(){this._areaLayer.getIsolatedArea()&&this._pzc.zoomToFit(null,this._areaLayer.getLayerDim()),this._initialZooming&&this._zoomData(),this._renderCompleted()},D.prototype.getMapName=function(){return this._mapName},D.prototype._transformContainers=function(t){var a=new e.Matrix;a=a.translate(t.getTx(),t.getTy()),this.isMarkerZoomBehaviorFixed()&&this._dataPointLayers.setMatrix(a),this._labelLayers.setMatrix(a),this._linkLayers.setMatrix(a)},D.prototype._constrainPanning=function(t){var a=this._pzc.getZoomToFitPadding(),i=this._pzc.getSize(),r=new e.Rectangle(a,a,i.w-2*a,i.h-2*a),n=this._areaLayer.getLayerDim(),o=n.x*t,s=n.y*t,l=n.w*t,h=n.h*t;if(l>r.w)this._pzc.setMinPanX(r.x+r.wt-(o+l)),this._pzc.setMaxPanX(r.x-o);else{var c=(r.x+r.w)/2-(o+l/2);this._pzc.setMinPanX(c),this._pzc.setMaxPanX(c)}if(h>r.h)this._pzc.setMinPanY(r.y+r.h-(s+h)),this._pzc.setMaxPanY(r.y-s);else{var p=(r.y+r.h)/2-(s+h/2);this._pzc.setMinPanY(p),this._pzc.setMaxPanY(p)}},D.prototype._updateAnimator=function(t,a){var i=t.animator;if(i){var r=this._pzc.getContentPane(),n=i.getDestVal(r,r.getMatrix);a&&(this._currentAnimMatrix=r.getMatrix(),i.addProp(e.Animator.TYPE_MATRIX,this,this._getCenteredObjsMatrix,this._setCenteredObjsMatrix,n));var o=new e.Matrix(1,0,0,1,n.getTx(),n.getTy());this.isMarkerZoomBehaviorFixed()&&i.addProp(e.Animator.TYPE_MATRIX,this._dataPointLayers,this._dataPointLayers.getMatrix,this._dataPointLayers.setMatrix,o),i.addProp(e.Animator.TYPE_MATRIX,this._labelLayers,this._labelLayers.getMatrix,this._labelLayers.setMatrix,o),i.addProp(e.Animator.TYPE_MATRIX,this._linkLayers,this._linkLayers.getMatrix,this._linkLayers.setMatrix,o)}},D.prototype.HandleZoomEvent=function(t){switch(t.subtype){case"adjustPanConstraints":this._panning&&this._constrainPanning(t.newZoom);break;case"zooming":case"elasticAnimBegin":this._updateAnimator(t,!0);break;case"zoomed":var a=t.newZoom;if(null!=a){var i=this._pzc.getContentPane().getMatrix();t.animator=null,this.dispatchEvent(e.EventFactory.newThematicMapViewportChangeEvent(i.getTx(),i.getTy(),a)),this._transformContainers(i);for(var r=0;r<this._layers.length;r++)this._layers[r].HandleZoomEvent(t,i)}break;case"zoomAndCenter":this.fitSelectedRegions();break;case"zoomToFitEnd":this.dispatchEvent(e.EventFactory.newThematicMapViewportChangeEvent())}},D.prototype.HandlePanEvent=function(t){var a=t.subtype;if("elasticAnimBegin"==a||"panning"==a)this._updateAnimator(t,!1);else if("panned"==a&&null!=t.newX){var i=this._pzc.getContentPane().getMatrix();t.animator=null,this.dispatchEvent(e.EventFactory.newThematicMapViewportChangeEvent(i.getTx(),i.getTy(),this._pzc.getZoom())),this._transformContainers(i);for(var r=0;r<this._layers.length;r++)this._layers[r].HandlePanEvent(i)}},D.prototype.setZooming=function(t){this._zooming=t},D.prototype.setPanning=function(t){this._panning=t},D.prototype._zoomData=function(){var t=this._dataAreaLayers.getDimensions(),a=this._dataPointLayers.getDimensions();if(this.isMarkerZoomBehaviorFixed()){var i=this._pzc.getContentPane().getMatrix();a.w/=i.getA(),a.h/=i.getD(),a.x/=i.getA(),a.y/=i.getD()}var r,n,o=t.getUnion(a);this.StopAnimation(!0),this._pzc.isZoomingEnabled()||(r=this._pzc.getMaxZoom(),this._pzc.setMaxZoom(r*D.DEFAULT_MAX_ZOOM_FACTOR)),e.Agent.isEnvironmentTest()||(n=new e.Animator(this.getCtx(),.3)),o.w>0&&o.h>0?this._pzc.zoomToFit(n,o):this._pzc.zoomToFit(n,this._areaLayer.getLayerDim()),n&&n.play(),r&&this._pzc.setMaxZoom(r)},D.prototype._zoomToFitBounds=function(t){var a=new e.Animator(this.getCtx(),.3);this._pzc.zoomToFit(a,t),a.play()},D.prototype.fitRegion=function(t){t||(t=this._zoomToFitObject),t||(t=this._clickedObject),this._zoomToFitBounds(t.getDimensions())},D.prototype.fitSelectedRegions=function(){if(this._clickedDataLayerId){var t=this.getLayer(this._clickedLayerName).getDataLayer(this._clickedDataLayerId);if(t){var e=t._selectionHandler;if(e){for(var a=e.getSelection(),i=0;i<a.length;i++)a[i]=a[i].getDisplayable();if(a.length>0){for(var r=a[0].getDimensions(),n=1;n<a.length;n++)r=r.getUnion(a[n].getDimensions());this._zoomToFitBounds(r)}}}}},D.prototype.fitMap=function(){var t=new e.Animator(this.getCtx(),.3);this._pzc.zoomToFit(t),t.play()},D.prototype.getNavigableAreas=function(){var t=[];if(this._areaLayer){var e=this._areaLayer.getDataLayers();for(var a in e)t=t.concat(e[a].getNavigableAreaObjects())}return t},D.prototype.getNavigableMarkers=function(){for(var t=[],e=0;e<this._layers.length;e++){var a=this._layers[e].getDataLayers();for(var i in a)t=t.concat(a[i].getMarkerObjects())}return t},D.prototype.getNavigableLinks=function(){for(var t=[],e=0;e<this._layers.length;e++){var a=this._layers[e].getDataLayers();for(var i in a)t=t.concat(a[i].getLinkObjects())}return t},D.prototype._setCenteredObjsMatrix=function(t){if(this._currentAnimMatrix=t,this.isMarkerZoomBehaviorFixed()){for(var e=this.getNavigableMarkers(),a=0;a<e.length;a++)e[a].HandleZoomEvent(t);for(var i=this._labelLayers.getNumChildren(),n=0;n<i;n++)for(var o=this._labelLayers.getChildAt(n),s=o.getNumChildren(),l=0;l<s;l++){var h=o.getChildAt(l);h instanceof r&&h.update(t)}}},D.prototype._getCenteredObjsMatrix=function(){return this._currentAnimMatrix},D.prototype.setClickInfo=function(t,e,a){this._clickedLayerName=e,this._clickedDataLayerId=t,this._clickedObject=a},D.prototype.dispatchEvent=function(t){"selection"==t.type&&this._handleSelectionEvent(t),D.superclass.dispatchEvent.call(this,t)},D.prototype._handleSelectionEvent=function(t){if(this._clickedDataLayerId){this._selectedRowKeys=t.selection;var a=this.getLayer(this._clickedLayerName).getDataLayer(this._clickedDataLayerId);this._selectedAreas[this._clickedLayerName]=a.getSelectedAreas(this._selectedRowKeys),t.clientId=this._clickedDataLayerId,this._clickedObject&&!(this._clickedObject instanceof e.SimpleMarker||this._clickedObject instanceof e.ImageMarker)&&(this._zoomToFitObject=this._clickedObject)}else this._zoomToFitObject=null},D.prototype.destroy=function(){for(var t=this.getAllLayers(),e=0;e<t.length;e++)t[e].destroy();D.superclass.destroy.call(this)},D.prototype.OnAnimationEnd=function(){this._oldPzc&&(this.removeChild(this._oldPzc),this._oldPzc.destroy(),this._oldPzc=null),this._renderCompleted(),this._initialZooming&&this._zoomData(),this.Options.highlightedCategories&&this.Options.highlightedCategories.length>0&&this.highlight(this.Options.highlightedCategories),this._bListenersRemoved&&(this.EventManager.addListeners(this),this._bListenersRemoved=!1)},D.prototype.getAutomation=function(){return this.Automation||(this.Automation=new g(this)),this.Automation},D.prototype.highlight=function(t){this.Options.highlightedCategories=e.JsonUtils.clone(t),e.CategoryRolloverHandler.highlight(t,this.getNavigableAreas().concat(this.getNavigableMarkers()).concat(this.getNavigableLinks()),"any"==this.Options.highlightMatch)},D.prototype.processDefaultHoverEffect=function(t,e){var a=this._getDataItemById(t);a&&a.processDefaultHoverEffect(e)},D.prototype.processDefaultSelectionEffect=function(t,e){var a=this._getDataItemById(t);a&&a.processDefaultSelectionEffect(e)},D.prototype.processDefaultFocusEffect=function(t,e){var a=this._getDataItemById(t);a&&a.processDefaultFocusEffect(e)},D.prototype.handleTouchStart=function(){},D.prototype.handleTouchEnd=function(){this._clearTouchEventContent(),this._touchEventContentMarkerRef&&this._touchEventContentMarkerRef.handleTouchEnd&&(this._touchEventContentMarkerRef.handleTouchEnd(),this._touchEventContentMarkerRef=null)},D.prototype._getDataItemById=function(t){for(var a=this.getCtx(),i=0;i<this._layers.length;i++){var r=this._layers[i].getDataLayers();for(var n in r)for(var o=r[n].getMarkerObjects(),s=0;s<o.length;s++)if(e.Obj.compareValues(a,o[s].getId(),t))return o[s]}return null},D.prototype._getAreaFromDataLayer=function(t,e){for(var a=e.getAreaObjects(),i=0;i<a.length;i++)if(a[i].getLocation()===t)return a[i];return null},D.prototype.storeTouchEventContent=function(t,a){this._touchEventLayer&&t&&(this._touchEventContentMarkerRef=a,t.namespaceURI===e.ToolkitUtils.SVG_NS?e.ToolkitUtils.appendChildElem(this._touchEventLayer.getElem(),t):Array.isArray(t)&&t.forEach(function(t){e.ToolkitUtils.appendChildElem(this._touchEventLayer.getElem(),t)}.bind(this)))},D.prototype._clearTouchEventContent=function(){if(this._touchEventLayer)for(var t=this._touchEventLayer.getElem();t.firstChild;)t.removeChild(t.firstChild)},t.ThematicMap=D,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=ojthematicmap-toolkit.js.map